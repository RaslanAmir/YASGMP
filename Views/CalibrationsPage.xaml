<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="YasGMP.Views.CalibrationsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Kalibracije – YasGMP"
    BackgroundColor="#f5f7fa">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="Button">
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="42" />
                <Setter Property="CornerRadius" Value="10" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.Content>
        <VerticalStackLayout Padding="20" Spacing="18">

            <!-- 🔍 SEARCH & FILTER PANEL -->
            <Border Padding="12" Stroke="#e0e0e0" StrokeThickness="1" Background="White">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="8">
                    <Label Text="🔍 Pretraživanje i Filtriranje" 
                           FontSize="18" FontAttributes="Bold" TextColor="#00796b" />

                    <HorizontalStackLayout Spacing="8">
                        <Entry Placeholder="Pretraži po napomeni ili rezultatu..."
                               Text="{Binding SearchText}" WidthRequest="200" />

                        <Picker Title="Filtriraj po komponenti"
                                ItemsSource="{Binding Components}" 
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding FilterComponent}" WidthRequest="160" />

                        <DatePicker Date="{Binding FilterDate}" WidthRequest="140" />

                        <Button Text="♻️ Reset" Command="{Binding ReloadCommand}" 
                                BackgroundColor="#eeeeee" TextColor="Black" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- 🟢 ACTION BUTTONS -->
            <HorizontalStackLayout Spacing="12" Padding="0,5,0,0">
                <Button Text="➕ Nova" Command="{Binding AddCommand}" BackgroundColor="#e0f2f1" TextColor="#00695c" />
                <Button Text="✏️ Uredi" Command="{Binding EditCommand}" 
                        IsEnabled="{Binding SelectedCalibration, Converter={StaticResource NullToBoolConverter}}" 
                        BackgroundColor="#fffde7" TextColor="#f9a825" />
                <Button Text="🗑️ Briši" Command="{Binding DeleteCommand}" 
                        IsEnabled="{Binding SelectedCalibration, Converter={StaticResource NullToBoolConverter}}" 
                        BackgroundColor="#ffebee" TextColor="#c62828" />
                <Button Text="📤 Export Excel" Command="{Binding ExportExcelCommand}"
                        BackgroundColor="#dcedc8" TextColor="#33691e" />
                <Button Text="📄 Export PDF" Command="{Binding ExportPdfCommand}"
                        BackgroundColor="#ffe0b2" TextColor="#e65100" />
                <Button Text="📎 Certifikat" Command="{Binding AddCertificateCommand}"
                        BackgroundColor="#e8eaf6" TextColor="#303f9f" />
            </HorizontalStackLayout>

            <!-- 📋 LISTA KALIBRACIJA -->
            <CollectionView ItemsSource="{Binding Calibrations}"
                            SelectedItem="{Binding SelectedCalibration, Mode=TwoWay}"
                            SelectionMode="Single"
                            HeightRequest="520"
                            BackgroundColor="#f5f7fa">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,2" Padding="12" Background="White" Stroke="#cfd8dc" StrokeThickness="1">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10" />
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding Id, StringFormat='#{0}'}" FontSize="14" FontAttributes="Bold" TextColor="#455a64" />
                                <Label Text="{Binding Component.Name, StringFormat='🔧 Komponenta: {0}'}" FontSize="13" TextColor="#1976d2" />
                                <Label Text="{Binding Supplier.Name, StringFormat='🏢 Serviser: {0}'}" FontSize="12" TextColor="#009688" />
                                <Label Text="{Binding CalibrationDate, StringFormat='📅 {0:yyyy-MM-dd}'}" FontSize="12" />
                                <Label Text="{Binding NextDue, StringFormat='📆 Rok: {0:yyyy-MM-dd}'}" FontSize="12" />
                                <Label Text="{Binding Result, StringFormat='📊 Rezultat: {0}'}" FontSize="12" />
                                <Label Text="{Binding CertDoc, StringFormat='📄 Certifikat: {0}'}" FontSize="12" />
                                <Label Text="{Binding Comment, StringFormat='📝 Napomena: {0}'}" FontSize="12" />
                                <Label Text="{Binding DigitalSignature, StringFormat='✍️ Potpis: {0}'}" FontSize="11" TextColor="#fbc02d" />
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- INFO FOOTER -->
            <Label Text="✅ GMP audit-ready: sve promjene logirane, export i filtriranje aktivni."
                   FontSize="11" TextColor="#9e9e9e" HorizontalOptions="Center" />

        </VerticalStackLayout>
    </ContentPage.Content>
</ContentPage>
