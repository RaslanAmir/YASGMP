<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="YasGMP.Views.CalibrationsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Kalibracije â€“ YasGMP"
    BackgroundColor="#f5f7fa">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="Button">
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="42" />
                <Setter Property="CornerRadius" Value="10" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.Content>
        <VerticalStackLayout Padding="20" Spacing="18">

            <!-- ðŸ” SEARCH & FILTER PANEL -->
            <Border Padding="12" Stroke="#e0e0e0" StrokeThickness="1" Background="White">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="8">
                    <Label Text="ðŸ” PretraÅ¾ivanje i Filtriranje" 
                           FontSize="18" FontAttributes="Bold" TextColor="#00796b" />

                    <HorizontalStackLayout Spacing="8">
                        <Entry Placeholder="PretraÅ¾i po napomeni ili rezultatu..."
                               Text="{Binding SearchText}" WidthRequest="200" />

                        <Picker Title="Filtriraj po komponenti"
                                ItemsSource="{Binding Components}" 
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding FilterComponent}" WidthRequest="160" />

                        <DatePicker Date="{Binding FilterDate}" WidthRequest="140" />

                        <Button Text="â™»ï¸ Reset" Command="{Binding ReloadCommand}" 
                                BackgroundColor="#eeeeee" TextColor="Black" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- ðŸŸ¢ ACTION BUTTONS -->
            <HorizontalStackLayout Spacing="12" Padding="0,5,0,0">
                <Button Text="âž• Nova" Command="{Binding AddCommand}" BackgroundColor="#e0f2f1" TextColor="#00695c" />
                <Button Text="âœï¸ Uredi" Command="{Binding EditCommand}" 
                        IsEnabled="{Binding SelectedCalibration, Converter={StaticResource NullToBoolConverter}}" 
                        BackgroundColor="#fffde7" TextColor="#f9a825" />
                <Button Text="ðŸ—‘ï¸ BriÅ¡i" Command="{Binding DeleteCommand}" 
                        IsEnabled="{Binding SelectedCalibration, Converter={StaticResource NullToBoolConverter}}" 
                        BackgroundColor="#ffebee" TextColor="#c62828" />
                <Button Text="ðŸ“¤ Export Excel" Command="{Binding ExportExcelCommand}"
                        BackgroundColor="#dcedc8" TextColor="#33691e" />
                <Button Text="ðŸ“„ Export PDF" Command="{Binding ExportPdfCommand}"
                        BackgroundColor="#ffe0b2" TextColor="#e65100" />
                <Button Text="ðŸ“Ž Certifikat" Command="{Binding AddCertificateCommand}"
                        BackgroundColor="#e8eaf6" TextColor="#303f9f" />
            </HorizontalStackLayout>

            <!-- ðŸ“‹ LISTA KALIBRACIJA -->
            <CollectionView ItemsSource="{Binding Calibrations}"
                            SelectedItem="{Binding SelectedCalibration, Mode=TwoWay}"
                            SelectionMode="Single"
                            HeightRequest="520"
                            BackgroundColor="#f5f7fa">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,2" Padding="12" Background="White" Stroke="#cfd8dc" StrokeThickness="1">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10" />
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="2">
                                <Label Text="{Binding Id, StringFormat='#{0}'}" FontSize="14" FontAttributes="Bold" TextColor="#455a64" />
                                <Label Text="{Binding Component.Name, StringFormat='ðŸ”§ Komponenta: {0}'}" FontSize="13" TextColor="#1976d2" />
                                <Label Text="{Binding Supplier.Name, StringFormat='ðŸ¢ Serviser: {0}'}" FontSize="12" TextColor="#009688" />
                                <Label Text="{Binding CalibrationDate, StringFormat='ðŸ“… {0:yyyy-MM-dd}'}" FontSize="12" />
                                <Label Text="{Binding NextDue, StringFormat='ðŸ“† Rok: {0:yyyy-MM-dd}'}" FontSize="12" />
                                <Label Text="{Binding Result, StringFormat='ðŸ“Š Rezultat: {0}'}" FontSize="12" />
                                <Label Text="{Binding CertDoc, StringFormat='ðŸ“„ Certifikat: {0}'}" FontSize="12" />
                                <Label Text="{Binding Comment, StringFormat='ðŸ“ Napomena: {0}'}" FontSize="12" />
                                <Label Text="{Binding DigitalSignature, StringFormat='âœï¸ Potpis: {0}'}" FontSize="11" TextColor="#fbc02d" />
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- INFO FOOTER -->
            <Label Text="âœ… GMP audit-ready: sve promjene logirane, export i filtriranje aktivni."
                   FontSize="11" TextColor="#9e9e9e" HorizontalOptions="Center" />

        </VerticalStackLayout>
    </ContentPage.Content>
</ContentPage>
