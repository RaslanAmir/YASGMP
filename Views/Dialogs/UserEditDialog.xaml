<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:helpers="clr-namespace:YasGMP.Helpers"
             x:Class="YasGMP.Views.Dialogs.UserEditDialog"
             Title="{helpers:ShellString Key=Module.Security.Text.UserDetails}">
  <ScrollView>
    <VerticalStackLayout Padding="24" Spacing="14">
      <Label Text="{helpers:ShellString Key=Module.Security.Text.UserDetails}"
             FontSize="20"
             FontAttributes="Bold" />

      <Grid ColumnDefinitions="Auto,*" RowSpacing="12">
        <Label Text="{helpers:ShellString Key=Module.Security.Text.Username}" VerticalOptions="Center" />
        <Entry Grid.Column="1"
               Text="{Binding Editor.Username}"
               Placeholder="{helpers:ShellString Key=Module.Security.Text.Username}" />

        <Label Grid.Row="1"
               Text="{helpers:ShellString Key=Module.Security.Text.FullName}"
               VerticalOptions="Center" />
        <Entry Grid.Row="1"
               Grid.Column="1"
               Text="{Binding Editor.FullName}"
               Placeholder="{helpers:ShellString Key=Module.Security.Text.FullName}" />

        <Label Grid.Row="2"
               Text="{helpers:ShellString Key=Module.Security.Text.Email}"
               VerticalOptions="Center" />
        <Entry Grid.Row="2"
               Grid.Column="1"
               Text="{Binding Editor.Email}"
               Keyboard="Email"
               Placeholder="{helpers:ShellString Key=Module.Security.Text.Email}" />

        <Label Grid.Row="3"
               Text="{helpers:ShellString Key=Module.Security.Text.Phone}"
               VerticalOptions="Center" />
        <Entry Grid.Row="3"
               Grid.Column="1"
               Text="{Binding Editor.Phone}"
               Placeholder="{helpers:ShellString Key=Module.Security.Text.Phone}" />

        <Label Grid.Row="4"
               Text="{helpers:ShellString Key=Module.Security.Text.PrimaryRole}"
               VerticalOptions="Center" />
        <Entry Grid.Row="4"
               Grid.Column="1"
               Text="{Binding Editor.Role}"
               Placeholder="{helpers:ShellString Key=Module.Security.Text.PrimaryRole}" />

        <Label Grid.Row="5"
               Text="{helpers:ShellString Key=Module.Security.Text.Department}"
               VerticalOptions="Center" />
        <Entry Grid.Row="5"
               Grid.Column="1"
               Text="{Binding Editor.DepartmentName}"
               Placeholder="{helpers:ShellString Key=Module.Security.Text.Department}" />

        <Label Grid.Row="6"
               Text="{helpers:ShellString Key=Module.Security.Content.Active}"
               VerticalOptions="Center" />
        <Switch Grid.Row="6"
                Grid.Column="1"
                IsToggled="{Binding Editor.Active}" />

        <Label Grid.Row="7"
               Text="{helpers:ShellString Key=Module.Security.Content.Locked}"
               VerticalOptions="Center" />
        <Switch Grid.Row="7"
                Grid.Column="1"
                IsToggled="{Binding Editor.IsLocked}" />

        <Label Grid.Row="8"
               Text="{helpers:ShellString Key=Module.Security.Content.TwoFactor}"
               VerticalOptions="Center" />
        <Switch Grid.Row="8"
                Grid.Column="1"
                IsToggled="{Binding Editor.IsTwoFactorEnabled}" />

        <Label Grid.Row="9"
               Text="{helpers:ShellString Key=Module.Security.Text.NewPassword}"
               VerticalOptions="Center" />
        <Entry Grid.Row="9"
               Grid.Column="1"
               Text="{Binding Editor.NewPassword}"
               IsPassword="True"
               Placeholder="{helpers:ShellString Key=Module.Security.Text.NewPassword}" />

        <Label Grid.Row="10"
               Text="{helpers:ShellString Key=Module.Security.Text.ConfirmPassword}"
               VerticalOptions="Center" />
        <Entry Grid.Row="10"
               Grid.Column="1"
               Text="{Binding Editor.ConfirmPassword}"
               IsPassword="True"
               Placeholder="{helpers:ShellString Key=Module.Security.Text.ConfirmPassword}" />
      </Grid>

      <Label Text="{helpers:ShellString Key=Module.Security.Text.AssignedRoles}"
             FontAttributes="Bold"
             Margin="0,12,0,0" />

      <CollectionView ItemsSource="{Binding RoleOptions}"
                      SelectionMode="None"
                      Margin="0,0,0,8">
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <HorizontalStackLayout Spacing="8" Padding="0,4">
              <CheckBox IsChecked="{Binding IsSelected}" />
              <VerticalStackLayout Spacing="2">
                <Label Text="{Binding Name}" />
                <Label Text="{Binding Description}"
                       FontSize="12"
                       TextColor="Gray" />
              </VerticalStackLayout>
            </HorizontalStackLayout>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>

      <Label Text="{helpers:ShellString Key=Module.Diagnostics.Text.Session}"
             FontAttributes="Bold"
             Margin="0,12,0,0" />

      <HorizontalStackLayout Spacing="12">
        <Label Text="{helpers:ShellString Key=Module.Security.Content.Active}" VerticalOptions="Center" />
        <Switch x:Name="ImpersonationSwitch"
                IsToggled="{Binding IsImpersonating}" />
      </HorizontalStackLayout>

      <Picker Title="{helpers:ShellString Key=Module.Diagnostics.Text.Session}"
              ItemsSource="{Binding ImpersonationTargets}"
              ItemDisplayBinding="{Binding DisplayName}"
              SelectedItem="{Binding SelectedImpersonationTarget}" />

      <Entry Text="{Binding ImpersonationReason}"
             Placeholder="{helpers:ShellString Key=Dialog.ElectronicSignature.Text.ReasonCode}" />

      <Editor Text="{Binding ImpersonationNotes}"
              Placeholder="{helpers:ShellString Key=Dialog.ElectronicSignature.Text.ReasonNote}"
              AutoSize="TextChanges" />

      <HorizontalStackLayout Spacing="14" Margin="0,20,0,0">
        <Button Text="{helpers:ShellString Key=Module.Toolbar.Command.Save.Content}"
                Command="{Binding SaveCommand}" />
        <Button Text="{helpers:ShellString Key=Module.Toolbar.Command.Cancel.Content}"
                Command="{Binding CancelCommand}" />
        <Button Text="{helpers:ShellString Key=Module.Toolbar.Command.Refresh.Content}"
                Command="{Binding ImpersonateCommand}"
                IsEnabled="{Binding Source={x:Reference ImpersonationSwitch}, Path=IsToggled}" />
      </HorizontalStackLayout>
    </VerticalStackLayout>
  </ScrollView>
</ContentPage>
