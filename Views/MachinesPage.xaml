<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="YasGMP.Views.MachinesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:maui="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:views="clr-namespace:YasGMP.Views"
    x:DataType="views:MachinesPage"
    Title="Strojevi / Oprema">

  <ContentPage.Content>
    <VerticalStackLayout Padding="28,20,28,20" Spacing="18">
      <Border>
        <VerticalStackLayout Spacing="14">
          <!-- Header -->
          <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto">
            <Label Grid.Column="0" Text="Pregled strojeva / opreme" Style="{StaticResource YtH1}" />
            <HorizontalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">
              <Label Text="Ukupno:" Style="{StaticResource YtCaption}" />
              <Label Text="{Binding Machines.Count}" FontAttributes="Bold" />
            </HorizontalStackLayout>
          </Grid>

          <!-- Actions toolbar -->
          <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto">
            <SearchBar x:Name="SearchBox" Grid.Column="0" Placeholder="Pretraži po nazivu, šifri, proizvođaču, lokaciji" TextChanged="OnSearchTextChanged" />
            <HorizontalStackLayout Grid.Column="1" Spacing="10">
              <Button Text="Dodaj" Style="{StaticResource YtButton.Primary}" Clicked="OnAddMachineClicked" maui:ToolTipProperties.Text="Unos novog stroja ili opreme" />
              <Button Text="Uredi" Style="{StaticResource YtButton.Secondary}" Clicked="OnEditMachineClicked" maui:ToolTipProperties.Text="Uređivanje odabranog stroja" />
              <Button Text="Briši" Style="{StaticResource YtButton.Danger}" Clicked="OnDeleteMachineClicked" maui:ToolTipProperties.Text="Brisanje odabranog stroja" />
              <Button Text="Dokumenti" Style="{StaticResource YtButton.Flat}" Clicked="OnDocumentsClicked" maui:ToolTipProperties.Text="Priloženi dokumenti za stroj" />
              <Button Text="QR" Style="{StaticResource YtButton.Flat}" Clicked="OnQrClicked" maui:ToolTipProperties.Text="QR kôd za stroj" />
              <Button Text="Komponente" Style="{StaticResource YtButton.Flat}" Clicked="OnComponentsClicked" maui:ToolTipProperties.Text="Povezane komponente" />
              <Button Text="Test DB" Style="{StaticResource YtButton.Flat}" Clicked="OnTestConnectionClicked" maui:ToolTipProperties.Text="Provjera veze s bazom" />
            </HorizontalStackLayout>
          </Grid>

          <!-- Selected machine summary -->
          <Border x:Name="SelectedInfo" IsVisible="False" Padding="12" Background="{StaticResource YtPrimary50}">
            <Border.StrokeShape>
              <RoundRectangle CornerRadius="10" />
            </Border.StrokeShape>
            <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="10">
              <Label Grid.Row="0" Grid.Column="0" Text="{Binding SelectedMachine.Name}" FontAttributes="Bold"/>
              <Label Grid.Row="0" Grid.Column="1" Text="{Binding SelectedMachine.Code}" TextColor="{StaticResource YtOnSurfaceDim}"/>
              <Label Grid.Row="0" Grid.Column="2" Text="{Binding SelectedMachine.Status}" TextColor="{StaticResource YtPrimary700}"/>
              <Label Grid.Row="1" Grid.ColumnSpan="3" Text="{Binding SelectedMachine.Manufacturer}"/>
            </Grid>
          </Border>

          <!-- List (Syncfusion DataGrid) -->
          <sf:SfDataGrid xmlns:sf="http://schemas.syncfusion.com/maui"
                         x:Name="MachineListView"
                         ItemsSource="{Binding Machines}"
                         SelectionMode="Single"
                         ColumnWidthMode="Auto"
                         AutoGenerateColumnsMode="None"
                         HeightRequest="520"
                         GridLinesVisibility="Both"
                         HeaderGridLinesVisibility="Both"
                         RowHeight="36"
                         HeaderRowHeight="40"
                         SortingMode="Multiple"
                         AllowResizingColumns="True"
                         SelectionChanged="OnGridSelectionChanged">
            <sf:SfDataGrid.DefaultStyle>
              <sf:DataGridStyle
                  HeaderRowBackground="{StaticResource YtPrimary50Brush}"
                  HeaderRowTextColor="{StaticResource YtOnSurface}"
                  RowBackground="{StaticResource YtSurfaceCardBrush}"
                  AlternateRowBackground="{StaticResource YtRowBrush}"
                  RowTextColor="{StaticResource YtOnSurface}"
                  SelectedRowTextColor="{StaticResource YtPrimary700}"
                  SelectionBackground="{StaticResource YtPrimary50Brush}"
                  />
            </sf:SfDataGrid.DefaultStyle>
            <sf:SfDataGrid.Columns>
              <!-- Order: Code, Name, Status, Manufacturer, Location, Install -->
              <sf:DataGridTextColumn MappingName="Code"         HeaderText="Šifra"          Width="120" />
              <sf:DataGridTextColumn MappingName="Name"         HeaderText="Naziv"          Width="260" />
              <sf:DataGridTextColumn MappingName="Status"       HeaderText="Status"         Width="130" />
              <sf:DataGridTextColumn MappingName="Manufacturer" HeaderText="Proizvođač"     Width="170" />
              <sf:DataGridTextColumn MappingName="Location"     HeaderText="Lokacija"       Width="150" />
              <sf:DataGridTextColumn MappingName="InstallDate"  HeaderText="Instalirano"    Width="140" Format="yyyy-MM-dd" />
            </sf:SfDataGrid.Columns>
          </sf:SfDataGrid>

          <Label Text="Odaberite redak pa koristite akcije iznad (Uredi/Briši)." Style="{StaticResource YtCaption}" HorizontalOptions="Center"/>
        </VerticalStackLayout>
      </Border>
    </VerticalStackLayout>
  </ContentPage.Content>
</ContentPage>





