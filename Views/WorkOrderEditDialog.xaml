<?xml version="1.0" encoding="utf-8" ?>
<!--
  WorkOrderEditDialog.xaml
  YASTECH-styled modal dialog for creating/updating Work Orders.
  - Uses implicit theme styles (Theme.YASTECH.xaml)
  - Tooltips via built-in MAUI ToolTipProperties
-->
<ContentPage
    x:Class="YasGMP.Views.WorkOrderEditDialog"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:maui="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:dlg="clr-namespace:YasGMP.Views.Dialogs"
    xmlns:vm="clr-namespace:YasGMP.ViewModels"
    xmlns:shapes="clr-namespace:Microsoft.Maui.Controls.Shapes;assembly=Microsoft.Maui.Controls"
    x:DataType="vm:WorkOrderEditDialogViewModel"
    Title="Radni Nalog – Uredi / Dodaj"
    Padding="24">

  <ScrollView>
    <Grid ColumnDefinitions="*"
          RowDefinitions="Auto,Auto"
          RowSpacing="16">

      <!-- Header Card -->
      <Border Grid.Row="0" Padding="20">
        <Border.StrokeShape>
          <shapes:RoundRectangle CornerRadius="10" />
        </Border.StrokeShape>
        <VerticalStackLayout Spacing="8">
          <Label Text="Radni Nalog"
                 Style="{StaticResource YtH1}"
                 HorizontalOptions="Center"
                 maui:ToolTipProperties.Text="Unos ili izmjena radnog naloga za GMP evidenciju" />
          <Label Text="Obavezna polja: Tip, Opis, Stroj, Status."
                 Style="{StaticResource YtCaption}"
                 HorizontalOptions="Center" />
        </VerticalStackLayout>
      </Border>

      <!-- Form Card -->
      <Border Grid.Row="1" Padding="20">
        <Border.StrokeShape>
          <shapes:RoundRectangle CornerRadius="10" />
        </Border.StrokeShape>
        <VerticalStackLayout Spacing="16">

          <!-- Tip naloga -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Tip naloga:"
                   VerticalOptions="Center"
                   maui:ToolTipProperties.Text="Odaberi vrstu radnog naloga (preventivni, korektivni, hitni…)" />
            <Picker Grid.Column="1"
                    ItemsSource="{Binding TypeOptions}"
                    SelectedItem="{Binding Type, Mode=TwoWay}"
                    Title="Odaberi tip" />
          </Grid>

          <!-- Opis zadatka -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Opis zadatka:" VerticalOptions="Center" />
            <Entry Grid.Column="1"
                   Text="{Binding TaskDescription, Mode=TwoWay}"
                   Placeholder="Sažeti opis zadatka"
                   maui:ToolTipProperties.Text="Unesi kratak, jasan opis zadatka" />
          </Grid>

          <!-- Stroj/oprema -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Stroj:" VerticalOptions="Center" />
            <Picker Grid.Column="1"
                    ItemsSource="{Binding Machines}"
                    SelectedItem="{Binding SelectedMachine, Mode=TwoWay}"
                    ItemDisplayBinding="{Binding Name}"
                    Title="Odaberi stroj"
                    maui:ToolTipProperties.Text="Odaberi stroj na koji se odnosi nalog" />
          </Grid>

          <!-- Komponenta (opcionalno) -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Komponenta:" VerticalOptions="Center" />
            <Picker Grid.Column="1"
                    ItemsSource="{Binding Components}"
                    SelectedItem="{Binding SelectedComponent, Mode=TwoWay}"
                    ItemDisplayBinding="{Binding Name}"
                    Title="Odaberi komponentu"
                    maui:ToolTipProperties.Text="Opcionalno: odaberi komponentu ako je poznata" />
          </Grid>

          <!-- Dodijeljen korisnik -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Dodijeljeno:" VerticalOptions="Center" />
            <Picker Grid.Column="1"
                    ItemsSource="{Binding Users}"
                    SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
                    ItemDisplayBinding="{Binding FullName}"
                    Title="Odaberi tehničara"
                    maui:ToolTipProperties.Text="Odaberi korisnika kojem je nalog dodijeljen" />
          </Grid>

          <!-- Datum otvaranja -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Datum otvaranja:" VerticalOptions="Center" />
            <DatePicker Grid.Column="1"
                        Date="{Binding DateOpen, Mode=TwoWay}"
                        maui:ToolTipProperties.Text="Datum i vrijeme otvaranja radnog naloga" />
          </Grid>

          <!-- Status naloga -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Status:" VerticalOptions="Center" />
            <Picker Grid.Column="1"
                    ItemsSource="{Binding StatusOptions}"
                    SelectedItem="{Binding Status, Mode=TwoWay}"
                    Title="Odaberi status"
                    maui:ToolTipProperties.Text="Status naloga (otvoren, u tijeku, završen, odbijen…)" />
          </Grid>

          <!-- Rezultat/intervencija -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Rezultat:" VerticalOptions="Center" />
            <Entry Grid.Column="1"
                   Text="{Binding Result, Mode=TwoWay}"
                   Placeholder="Rezultat ili napomena"
                   maui:ToolTipProperties.Text="Sažmi rezultat intervencije; koristi CAPA referencu po potrebi" />
          </Grid>

          <!-- Digitalni potpis -->
          <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="E-potpis:" VerticalOptions="Center" />
            <Entry Grid.Column="1"
                   Text="{Binding DigitalSignature}"
                   Placeholder="Digitalni potpis / hash"
                   maui:ToolTipProperties.Text="Opcionalno: digitalni potpis korisnika (21 CFR Part 11)" />
          </Grid>

          <!-- Actions -->
          <HorizontalStackLayout Spacing="16" HorizontalOptions="Center" Margin="0,8,0,0">
            <Button Text="Spremi"
                    Command="{Binding SaveCommand}"
                    Style="{StaticResource YtButton.Primary}"
                    maui:ToolTipProperties.Text="Spremi radni nalog i zatvori dijalog" />
            <Button Text="Odustani"
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource YtButton.Flat}"
                    maui:ToolTipProperties.Text="Odustani od izmjena i zatvori dijalog" />
          </HorizontalStackLayout>

          <!-- Status line (optional binding from VM) -->
          <Label Text="{Binding StatusMessage}"
                 Style="{StaticResource YtCaption}"
                 HorizontalOptions="Center" />
        </VerticalStackLayout>
      </Border>

    </Grid>
  </ScrollView>
</ContentPage>
