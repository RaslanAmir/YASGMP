<?xml version="1.0" encoding="utf-8"?>
<!--
  YasGMP â€“ Work Orders Page (GMP / 21 CFR Part 11 compliant)
  YASTECH-styled list with KPI tiles, filters and actions.
  - No external dependencies (AOT-friendly)
  - Tooltips via built-in MAUI ToolTipProperties (xmlns:maui)
  - Works with your existing ViewModel contract (no new members required)
-->
<ContentPage
    x:Class="YasGMP.Views.WorkOrdersPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:maui="http://schemas.microsoft.com/dotnet/2021/maui"
    Title="Radni nalozi"
    BackgroundColor="{StaticResource YtSurface}">
          
  
  <ScrollView>
    <VerticalStackLayout Padding="20" Spacing="18">

      <!-- Title -->
      <Label Text="Radni nalozi"
             Style="{StaticResource YtH1}"
             HorizontalOptions="Center"
             maui:ToolTipProperties.Text="Pregled, filtriranje i upravljanje radnim nalozima (GMP/CSV)"/>

      <!-- KPI tiles -->
      <Grid ColumnDefinitions="*,*,*" ColumnSpacing="14">
        <Frame Padding="14" CornerRadius="14" HasShadow="True" BackgroundColor="{StaticResource YtPrimary600}">
          <VerticalStackLayout Spacing="2">
            <Label Text="Otvoreni" FontSize="12" TextColor="White"/>
            <Label Text="{Binding CountOpen}" FontSize="30" FontAttributes="Bold" HorizontalOptions="Center" TextColor="White"/>
          </VerticalStackLayout>
        </Frame>

        <Frame Grid.Column="1" Padding="14" CornerRadius="14" HasShadow="True" BackgroundColor="{StaticResource YtDanger700}">
          <VerticalStackLayout Spacing="2">
            <Label Text="KritiÄŤni" FontSize="12" TextColor="White"/>
            <Label Text="{Binding CountCritical}" FontSize="30" FontAttributes="Bold" HorizontalOptions="Center" TextColor="White"/>
          </VerticalStackLayout>
        </Frame>

        <Frame Grid.Column="2" Padding="14" CornerRadius="14" HasShadow="True" BackgroundColor="{StaticResource YtAccent700}">
          <VerticalStackLayout Spacing="2">
            <Label Text="Overdue" FontSize="12" TextColor="White"/>
            <Label Text="{Binding CountOverdue}" FontSize="30" FontAttributes="Bold" HorizontalOptions="Center" TextColor="White"/>
          </VerticalStackLayout>
        </Frame>
      </Grid>

      <!-- Filters -->
      <Frame Padding="16" CornerRadius="14" HasShadow="True" BackgroundColor="{StaticResource YtSurfaceCard}">
        <VerticalStackLayout Spacing="12">
          <SearchBar
              Placeholder="PretraĹľi (stroj, naslov, opis)"
              Text="{Binding SearchTerm, Mode=TwoWay}"
              maui:ToolTipProperties.Text="UpiĹˇite kljuÄŤnu rijeÄŤ za pretragu radnih naloga"/>

          <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="12">
            <!-- Status -->
            <Picker Grid.Column="0"
                    Title="Status"
                    ItemsSource="{Binding AvailableStatuses}"
                    SelectedItem="{Binding StatusFilter, Mode=TwoWay}"
                    maui:ToolTipProperties.Text="filter"/>

            <!-- Prioritet -->
            <Picker Grid.Column="1"
                    Title="Prioritet"
                    ItemsSource="{Binding AvailablePriorities}"
                    SelectedItem="{Binding PriorityFilter, Mode=TwoWay}"
                    maui:ToolTipProperties.Text="filter"/>

            <!-- Asset filter (free text) -->
            <Entry Grid.Column="2"
                   WidthRequest="220"
                   Placeholder="Stroj/oprema"
                   Text="{Binding AssetFilter, Mode=TwoWay}"
                   maui:ToolTipProperties.Text="Neobavezno: upiĹˇite ime stroja/opreme"/>
          </Grid>
        </VerticalStackLayout>
      </Frame>

      <!-- Busy -->
      <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" Color="{StaticResource YtPrimary700}"/>

      <!-- Work orders list -->
      <Frame Padding="0" HasShadow="True">
        <VerticalStackLayout Spacing="0">

                              <sf:SfDataGrid xmlns:sf="http://schemas.syncfusion.com/maui"
                         ItemsSource="{Binding FilteredWorkOrders}"
                         SelectionChanged="OnGridSelectionChanged"
                         SelectionMode="Single"
                         ColumnWidthMode="Auto"
                         AutoGenerateColumnsMode="None"
                         HeightRequest="440"
                         GridLinesVisibility="Both"
                         HeaderGridLinesVisibility="Both"
                         RowHeight="34"
                         HeaderRowHeight="40"
                         SortingMode="Multiple"
                         AllowResizingColumns="True">
            <sf:SfDataGrid.DefaultStyle>
              <sf:DataGridStyle
                  HeaderRowBackground="{StaticResource YtPrimary50Brush}"
                  HeaderRowTextColor="{StaticResource YtOnSurface}"
                  RowBackground="{StaticResource YtSurfaceCardBrush}"
                  AlternateRowBackground="{StaticResource YtRowBrush}"
                  RowTextColor="{StaticResource YtOnSurface}"
                  SelectedRowTextColor="{StaticResource YtPrimary700}"
                  SelectionBackground="{StaticResource YtPrimary50Brush}" />
            </sf:SfDataGrid.DefaultStyle>
            <sf:SfDataGrid.Columns>
              <!-- Order: ID, Title, Asset, Status, Priority, Open, Close, Photos, Parts -->
              <sf:DataGridTextColumn MappingName="Id"            HeaderText="#"          Width="70"  />
              <sf:DataGridTextColumn MappingName="Title"         HeaderText="Naslov"     Width="280" />
              <sf:DataGridTextColumn MappingName="Machine.Name"  HeaderText="Stroj / Oprema" Width="220" />
              <sf:DataGridTextColumn MappingName="Status"        HeaderText="Status"     Width="130" />
              <sf:DataGridTextColumn MappingName="Priority"      HeaderText="Prioritet"  Width="130" />
              <sf:DataGridTextColumn MappingName="DateOpen"      HeaderText="Otvoren"    Width="140" Format="yyyy-MM-dd" />
              <sf:DataGridTextColumn MappingName="DateClose"     HeaderText="Zatvaranje" Width="140" Format="yyyy-MM-dd" />
              <sf:DataGridTextColumn MappingName="PhotosCount"   HeaderText="Slike"      Width="100" />
              <sf:DataGridTextColumn MappingName="PartsCount"    HeaderText="Dijelovi"   Width="110" />
            </sf:SfDataGrid.Columns>
          </sf:SfDataGrid>
        </VerticalStackLayout>
      </Frame>

      <!-- Actions -->
      <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="10">
        <Button Grid.Column="0" Text="OsvjeĹľi"    Command="{Binding LoadWorkOrdersCommand}" Style="{StaticResource YtButton.Secondary}" maui:ToolTipProperties.Text="UpiĹˇite kljuÄŤnu rijeÄŤ za pretragu radnih naloga"/>
        <Button Grid.Column="1" Text="Dodaj"      Clicked="OnAddWorkOrderClicked"    Style="{StaticResource YtButton.Primary}"   maui:ToolTipProperties.Text="UpiĹˇite kljuÄŤnu rijeÄŤ za pretragu radnih naloga"/>
        <Button Grid.Column="2" Text="Uredi"      Clicked="OnEditWorkOrderClicked" IsEnabled="{Binding IsWorkOrderSelected}" maui:ToolTipProperties.Text="Uredi odabrani nalog"/>
        <Button Grid.Column="3" Text="ObriĹˇi"     Command="{Binding DeleteWorkOrderCommand}" IsEnabled="{Binding IsWorkOrderSelected}" Style="{StaticResource YtButton.Danger}" maui:ToolTipProperties.Text="Trajno izbriĹˇi odabrani nalog (auditirano)"/>
        <Button Grid.Column="4" Text="Rollback"   Command="{Binding RollbackWorkOrderCommand}" IsEnabled="{Binding IsWorkOrderSelected}" maui:ToolTipProperties.Text="Vrati na prethodno stanje (ako je omoguÄ‡eno)"/>
        <Button Grid.Column="5" Text="Export"     Command="{Binding ExportWorkOrdersCommand}" maui:ToolTipProperties.Text="Izvezi listu u CSV/Excel/PDF (ovisno o implementaciji)"/>
        <Button Grid.Column="6" Text="Odobri"     Command="{Binding ApproveWorkOrderCommand}" IsEnabled="{Binding IsWorkOrderSelected}" maui:ToolTipProperties.Text="Odobri odabrani nalog (e-potpis, audit)"/>
        <Button Grid.Column="7" Text="Zatvori"    Command="{Binding CloseWorkOrderCommand}"   IsEnabled="{Binding IsWorkOrderSelected}" maui:ToolTipProperties.Text="Zatvori nalog i evidentiraj rezultat"/>
        <Button Grid.Column="8" Text="Eskaliraj"  Command="{Binding EscalateWorkOrderCommand}" IsEnabled="{Binding IsWorkOrderSelected}" maui:ToolTipProperties.Text="OznaÄŤi kao eskalirano i obavijesti nadleĹľne"/>
      </Grid>

      <!-- Status & compliance note -->
      <Label Text="{Binding StatusMessage}" FontSize="12" TextColor="{StaticResource YtPrimary700}" LineBreakMode="WordWrap"/>
      <Label Text="Sve akcije se automatski auditiraju (GMP / 21 CFR Part 11)." FontSize="11" TextColor="{StaticResource YtOnSurfaceDim}"/>
    </VerticalStackLayout>
  </ScrollView>
</ContentPage>












