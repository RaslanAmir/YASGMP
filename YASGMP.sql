-- MySQL dump 10.13  Distrib 8.0.43, for Win64 (x86_64)
--
-- Host: localhost    Database: yasgmp
-- ------------------------------------------------------
-- Server version	8.0.43

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Current Database: `yasgmp`
--

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `yasgmp` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;

USE `yasgmp`;

--
-- Table structure for table `admin_activity_log`
--

DROP TABLE IF EXISTS `admin_activity_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `admin_activity_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `admin_id` int DEFAULT NULL,
  `activity_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `activity` varchar(255) DEFAULT NULL,
  `affected_table` varchar(100) DEFAULT NULL,
  `affected_record_id` int DEFAULT NULL,
  `details` text,
  `source_ip` varchar(45) DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`activity_time`) VIRTUAL,
  `action` varchar(255) GENERATED ALWAYS AS (`activity`) VIRTUAL,
  `user?` varchar(255) DEFAULT NULL,
  `device_name` varchar(128) DEFAULT NULL,
  `session_id` varchar(64) DEFAULT NULL,
  `digital_signature` varchar(256) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_adminact_user` (`admin_id`),
  CONSTRAINT `fk_adminact_user` FOREIGN KEY (`admin_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `admin_activity_log`
--

LOCK TABLES `admin_activity_log` WRITE;
/*!40000 ALTER TABLE `admin_activity_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `admin_activity_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_admin_activity_log_fk_guard` BEFORE INSERT ON `admin_activity_log` FOR EACH ROW BEGIN
  IF NEW.admin_id IS NOT NULL THEN
    IF (SELECT COUNT(*) FROM users WHERE id = NEW.admin_id) = 0 THEN
      SET NEW.admin_id = NULL;
    END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_admin_activity_log_ai_audit` AFTER INSERT ON `admin_activity_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'admin_activity_log', 'AdminActivityLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('admin_activity_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_admin_activity_log_au_audit` AFTER UPDATE ON `admin_activity_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'admin_activity_log', 'AdminActivityLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('admin_activity_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_admin_activity_log_ad_audit` AFTER DELETE ON `admin_activity_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'admin_activity_log', 'AdminActivityLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('admin_activity_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `api_audit_log`
--

DROP TABLE IF EXISTS `api_audit_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `api_audit_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `api_key_id` int DEFAULT NULL,
  `user_id` int DEFAULT NULL,
  `action` varchar(255) DEFAULT NULL,
  `timestamp` datetime DEFAULT CURRENT_TIMESTAMP,
  `ip_address` varchar(45) DEFAULT NULL,
  `request_details` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `details` text GENERATED ALWAYS AS (`request_details`) VIRTUAL,
  PRIMARY KEY (`id`),
  KEY `fk_api_audit_key` (`api_key_id`),
  KEY `fk_api_audit_user` (`user_id`),
  CONSTRAINT `fk_api_audit_key` FOREIGN KEY (`api_key_id`) REFERENCES `api_keys` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_api_audit_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `api_audit_log`
--

LOCK TABLES `api_audit_log` WRITE;
/*!40000 ALTER TABLE `api_audit_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `api_audit_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_audit_log_ai_audit` AFTER INSERT ON `api_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'api_audit_log', 'ApiAuditLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('api_audit_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_audit_log_au_audit` AFTER UPDATE ON `api_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'api_audit_log', 'ApiAuditLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('api_audit_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_audit_log_ad_audit` AFTER DELETE ON `api_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'api_audit_log', 'ApiAuditLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('api_audit_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `api_keys`
--

DROP TABLE IF EXISTS `api_keys`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `api_keys` (
  `id` int NOT NULL AUTO_INCREMENT,
  `key_value` varchar(255) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `owner_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `is_active` tinyint(1) DEFAULT '1',
  `last_used_at` datetime DEFAULT NULL,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `usage_logs` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `key_value` (`key_value`),
  KEY `fk_apikey_owner` (`owner_id`),
  CONSTRAINT `fk_apikey_owner` FOREIGN KEY (`owner_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `api_keys`
--

LOCK TABLES `api_keys` WRITE;
/*!40000 ALTER TABLE `api_keys` DISABLE KEYS */;
/*!40000 ALTER TABLE `api_keys` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_keys_ai_audit` AFTER INSERT ON `api_keys` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'api_keys', 'ApiKeysPage', NEW.id, NULL,
     NULL, NULL, CONCAT('api_keys insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_keys_au_audit` AFTER UPDATE ON `api_keys` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'api_keys', 'ApiKeysPage', NEW.id, NULL,
     NULL, NULL, CONCAT('api_keys update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_keys_ad_audit` AFTER DELETE ON `api_keys` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'api_keys', 'ApiKeysPage', OLD.id, NULL,
     NULL, NULL, CONCAT('api_keys delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `api_usage_log`
--

DROP TABLE IF EXISTS `api_usage_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `api_usage_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `api_key_id` int DEFAULT NULL,
  `user_id` int DEFAULT NULL,
  `call_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `endpoint` varchar(255) DEFAULT NULL,
  `method` varchar(20) DEFAULT NULL,
  `params` text,
  `response_code` int DEFAULT NULL,
  `duration_ms` int DEFAULT NULL,
  `success` tinyint(1) DEFAULT '1',
  `error_message` text,
  `source_ip` varchar(45) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`call_time`) VIRTUAL,
  `action` varchar(20) GENERATED ALWAYS AS (`method`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (coalesce(`error_message`,`params`)) VIRTUAL,
  `api_key` varchar(255) DEFAULT NULL,
  `user` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_api_usage_key` (`api_key_id`),
  KEY `fk_api_usage_user` (`user_id`),
  CONSTRAINT `fk_api_usage_key` FOREIGN KEY (`api_key_id`) REFERENCES `api_keys` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_api_usage_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `api_usage_log`
--

LOCK TABLES `api_usage_log` WRITE;
/*!40000 ALTER TABLE `api_usage_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `api_usage_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_usage_log_ai_audit` AFTER INSERT ON `api_usage_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'api_usage_log', 'ApiUsageLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('api_usage_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_usage_log_au_audit` AFTER UPDATE ON `api_usage_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'api_usage_log', 'ApiUsageLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('api_usage_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_api_usage_log_ad_audit` AFTER DELETE ON `api_usage_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'api_usage_log', 'ApiUsageLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('api_usage_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `attachments`
--

DROP TABLE IF EXISTS `attachments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `attachments` (
  `id` int NOT NULL AUTO_INCREMENT,
  `related_table` varchar(50) DEFAULT NULL,
  `related_id` int DEFAULT NULL,
  `file_name` varchar(255) DEFAULT NULL,
  `file_path` varchar(255) DEFAULT NULL,
  `file_type` varchar(40) DEFAULT NULL,
  `uploaded_by` int DEFAULT NULL,
  `uploaded_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `name` varchar(255) DEFAULT NULL,
  `file_size` bigint DEFAULT NULL,
  `entity_type` varchar(255) DEFAULT NULL,
  `entity_id` int DEFAULT NULL,
  `file_content` longblob,
  `ocr_text` varchar(255) DEFAULT NULL,
  `file_hash` varchar(255) DEFAULT NULL,
  `uploaded_by_id` int DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `is_approved` tinyint(1) DEFAULT NULL,
  `approved_by_id` int DEFAULT NULL,
  `approved_at` datetime DEFAULT NULL,
  `expiry_date` datetime DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `ip_address` varchar(255) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(255) DEFAULT NULL,
  `status` varchar(255) DEFAULT NULL,
  `notes` varchar(255) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  `ai_score` decimal(10,2) DEFAULT NULL,
  `chain_id` varchar(255) DEFAULT NULL,
  `version_uid` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_att_user` (`uploaded_by`),
  CONSTRAINT `fk_att_user` FOREIGN KEY (`uploaded_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `attachments`
--

LOCK TABLES `attachments` WRITE;
/*!40000 ALTER TABLE `attachments` DISABLE KEYS */;
/*!40000 ALTER TABLE `attachments` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_attachments_ai_audit` AFTER INSERT ON `attachments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'attachments', 'AttachmentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('attachments insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_attachments_au_audit` AFTER UPDATE ON `attachments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'attachments', 'AttachmentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('attachments update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_attachments_ad_audit` AFTER DELETE ON `attachments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'attachments', 'AttachmentsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('attachments delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary view structure for view `audit_log`
--

DROP TABLE IF EXISTS `audit_log`;
/*!50001 DROP VIEW IF EXISTS `audit_log`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `audit_log` AS SELECT 
 1 AS `id`,
 1 AS `event_time`,
 1 AS `timestamp`,
 1 AS `user_id`,
 1 AS `event_type`,
 1 AS `action`,
 1 AS `table_name`,
 1 AS `related_module`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `details`,
 1 AS `source_ip`,
 1 AS `device_info`,
 1 AS `session_id`,
 1 AS `severity`,
 1 AS `processed`,
 1 AS `created_at`,
 1 AS `updated_at`,
 1 AS `ts_utc`,
 1 AS `username`,
 1 AS `digital_signature`,
 1 AS `entry_hash`,
 1 AS `mac_address`,
 1 AS `geo_location`,
 1 AS `regulator`,
 1 AS `related_case_id`,
 1 AS `related_case_type`,
 1 AS `anomaly_score`,
 1 AS `user`,
 1 AS `change_version`,
 1 AS `is_deleted`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `buildings`
--

DROP TABLE IF EXISTS `buildings`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `buildings` (
  `id` int NOT NULL AUTO_INCREMENT,
  `site_id` int NOT NULL,
  `code` varchar(20) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_build_site` (`site_id`),
  CONSTRAINT `fk_build_site` FOREIGN KEY (`site_id`) REFERENCES `sites` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `buildings`
--

LOCK TABLES `buildings` WRITE;
/*!40000 ALTER TABLE `buildings` DISABLE KEYS */;
/*!40000 ALTER TABLE `buildings` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_buildings_ai_audit` AFTER INSERT ON `buildings` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'buildings', 'BuildingsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('buildings insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_buildings_au_audit` AFTER UPDATE ON `buildings` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'buildings', 'BuildingsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('buildings update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'buildings', 'BuildingsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'buildings update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'buildings', 'BuildingsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'buildings update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_buildings_ad_audit` AFTER DELETE ON `buildings` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'buildings', 'BuildingsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('buildings delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `calibration_audit_log`
--

DROP TABLE IF EXISTS `calibration_audit_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `calibration_audit_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `calibration_id` int DEFAULT NULL,
  `user_id` int DEFAULT NULL,
  `action` enum('CREATE','UPDATE','DELETE','EXPORT') NOT NULL,
  `old_value` text,
  `new_value` text,
  `changed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `source_ip` varchar(45) DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`changed_at`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`note`) VIRTUAL,
  `calibration` varchar(255) DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_cal_audit_cal` (`calibration_id`),
  KEY `fk_cal_audit_user` (`user_id`),
  CONSTRAINT `fk_cal_audit_cal` FOREIGN KEY (`calibration_id`) REFERENCES `calibrations` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_cal_audit_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `calibration_audit_log`
--

LOCK TABLES `calibration_audit_log` WRITE;
/*!40000 ALTER TABLE `calibration_audit_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `calibration_audit_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_audit_log_ai_audit` AFTER INSERT ON `calibration_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'calibration_audit_log', 'CalibrationAuditLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('calibration_audit_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_audit_log_au_audit` AFTER UPDATE ON `calibration_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'calibration_audit_log', 'CalibrationAuditLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('calibration_audit_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_audit_log_ad_audit` AFTER DELETE ON `calibration_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'calibration_audit_log', 'CalibrationAuditLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('calibration_audit_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `calibration_export_log`
--

DROP TABLE IF EXISTS `calibration_export_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `calibration_export_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `export_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `export_format` enum('excel','pdf') DEFAULT NULL,
  `filter_component_id` int DEFAULT NULL,
  `filter_date_from` date DEFAULT NULL,
  `filter_date_to` date DEFAULT NULL,
  `file_path` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`export_time`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`file_path`) VIRTUAL,
  `user?` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_cel_user` (`user_id`),
  CONSTRAINT `fk_cel_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `calibration_export_log`
--

LOCK TABLES `calibration_export_log` WRITE;
/*!40000 ALTER TABLE `calibration_export_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `calibration_export_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_export_log_ai_audit` AFTER INSERT ON `calibration_export_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'calibration_export_log', 'CalibrationExportLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('calibration_export_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_export_log_au_audit` AFTER UPDATE ON `calibration_export_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'calibration_export_log', 'CalibrationExportLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('calibration_export_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_export_log_ad_audit` AFTER DELETE ON `calibration_export_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'calibration_export_log', 'CalibrationExportLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('calibration_export_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `calibration_sensors`
--

DROP TABLE IF EXISTS `calibration_sensors`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `calibration_sensors` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_id` int DEFAULT NULL,
  `sensor_type` enum('temperatura','tlak','vlaga','protok','drugo') DEFAULT NULL,
  `range_min` decimal(10,2) DEFAULT NULL,
  `range_max` decimal(10,2) DEFAULT NULL,
  `unit` varchar(20) DEFAULT NULL,
  `calibration_interval_days` int DEFAULT NULL,
  `iot_device_id` varchar(80) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `sensor_type_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_cs_component` (`component_id`),
  KEY `fk_cs_sensor_type` (`sensor_type_id`),
  CONSTRAINT `fk_cs_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_cs_sensor_type` FOREIGN KEY (`sensor_type_id`) REFERENCES `sensor_types` (`id`),
  CONSTRAINT `fk_cs_sensortype` FOREIGN KEY (`sensor_type_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `calibration_sensors`
--

LOCK TABLES `calibration_sensors` WRITE;
/*!40000 ALTER TABLE `calibration_sensors` DISABLE KEYS */;
/*!40000 ALTER TABLE `calibration_sensors` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_cs_sync` BEFORE INSERT ON `calibration_sensors` FOR EACH ROW BEGIN
  CALL ref_touch('sensor_type', NEW.sensor_type, NEW.sensor_type);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.sensor_type_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_sensors_ai_audit` AFTER INSERT ON `calibration_sensors` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'calibration_sensors', 'CalibrationSensorsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('calibration_sensors insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_cs_sync_u` BEFORE UPDATE ON `calibration_sensors` FOR EACH ROW BEGIN
  IF (NEW.sensor_type <=> OLD.sensor_type) = 0 THEN
    CALL ref_touch('sensor_type', NEW.sensor_type, NEW.sensor_type);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.sensor_type_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_sensors_au_audit` AFTER UPDATE ON `calibration_sensors` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'calibration_sensors', 'CalibrationSensorsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('calibration_sensors update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibration_sensors_ad_audit` AFTER DELETE ON `calibration_sensors` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'calibration_sensors', 'CalibrationSensorsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('calibration_sensors delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `calibrations`
--

DROP TABLE IF EXISTS `calibrations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `calibrations` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_id` int NOT NULL,
  `supplier_id` int DEFAULT NULL,
  `calibration_date` date DEFAULT NULL,
  `next_due` date DEFAULT NULL,
  `cert_doc` varchar(255) DEFAULT NULL,
  `result` enum('prolaz','pao','uvjetno','napomena') DEFAULT 'prolaz',
  `comment` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `last_modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `last_modified_by_id` int DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `result_id` int DEFAULT NULL,
  `machine_component` varchar(255) DEFAULT NULL,
  `supplier?` varchar(255) DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `approved` tinyint(1) DEFAULT NULL,
  `approved_at` datetime DEFAULT NULL,
  `approved_by_id` int DEFAULT NULL,
  `previous_calibration_id` int DEFAULT NULL,
  `calibration?` varchar(255) DEFAULT NULL,
  `next_calibration_id` int DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_cal_component` (`component_id`),
  KEY `fk_cal_supplier` (`supplier_id`),
  KEY `fk_cal_modified` (`last_modified_by_id`),
  KEY `idx_cal_result_id` (`result_id`),
  CONSTRAINT `fk_cal_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_cal_modified` FOREIGN KEY (`last_modified_by_id`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_cal_result` FOREIGN KEY (`result_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_cal_supplier` FOREIGN KEY (`supplier_id`) REFERENCES `suppliers` (`id`),
  CONSTRAINT `chk_cal_dates` CHECK (((`next_due` is null) or (`next_due` > `calibration_date`)))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `calibrations`
--

LOCK TABLES `calibrations` WRITE;
/*!40000 ALTER TABLE `calibrations` DISABLE KEYS */;
/*!40000 ALTER TABLE `calibrations` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_cal_sync2` BEFORE INSERT ON `calibrations` FOR EACH ROW BEGIN
  CALL ref_touch('calibration_result', NEW.result, NEW.result);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.result_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibrations_insert` AFTER INSERT ON `calibrations` FOR EACH ROW BEGIN
    INSERT INTO calibration_audit_log (
        calibration_id, user_id, action, new_value, source_ip
    ) VALUES (
        NEW.id, NEW.last_modified_by_id, 'CREATE',
        CONCAT('Created calibration for component ', NEW.component_id), NEW.source_ip
    );

    INSERT INTO system_event_log(user_id, event_type, table_name, related_module, record_id, description, source_ip, severity)
    VALUES (NEW.last_modified_by_id, 'CREATE', 'calibrations', 'CalibrationModule', NEW.id,
            CONCAT('Created calibration record ID=', NEW.id), NEW.source_ip, 'audit');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibrations_ai_audit` AFTER INSERT ON `calibrations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'calibrations', 'CalibrationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('calibrations insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_cal_sync2_u` BEFORE UPDATE ON `calibrations` FOR EACH ROW BEGIN
  IF (NEW.result <=> OLD.result) = 0 THEN
    CALL ref_touch('calibration_result', NEW.result, NEW.result);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.result_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibrations_update` AFTER UPDATE ON `calibrations` FOR EACH ROW BEGIN
    INSERT INTO calibration_audit_log (
        calibration_id, user_id, action, old_value, new_value, source_ip
    ) VALUES (
        NEW.id, NEW.last_modified_by_id, 'UPDATE', OLD.comment, NEW.comment, NEW.source_ip
    );

    INSERT INTO system_event_log(user_id, event_type, table_name, related_module, record_id, field_name, old_value, new_value, description, source_ip, severity)
    VALUES (NEW.last_modified_by_id, 'UPDATE', 'calibrations', 'CalibrationModule', NEW.id,
            'comment', OLD.comment, NEW.comment, 'Updated calibration record', NEW.source_ip, 'audit');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibrations_au_audit` AFTER UPDATE ON `calibrations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'calibrations', 'CalibrationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('calibrations update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibrations_delete` AFTER DELETE ON `calibrations` FOR EACH ROW BEGIN
    INSERT INTO calibration_audit_log (
        calibration_id, user_id, action, old_value, source_ip
    ) VALUES (
        OLD.id, OLD.last_modified_by_id, 'DELETE', OLD.comment, OLD.source_ip
    );

    INSERT INTO system_event_log(user_id, event_type, table_name, related_module, record_id, description, source_ip, severity)
    VALUES (OLD.last_modified_by_id, 'DELETE', 'calibrations', 'CalibrationModule', OLD.id,
            CONCAT('Deleted calibration record ID=', OLD.id), 'system', 'critical');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_calibrations_ad_audit` AFTER DELETE ON `calibrations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'calibrations', 'CalibrationsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('calibrations delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `capa_action_log`
--

DROP TABLE IF EXISTS `capa_action_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `capa_action_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `capa_case_id` int NOT NULL,
  `action_type` enum('korektivna','preventivna') DEFAULT NULL,
  `description` text,
  `performed_by` int DEFAULT NULL,
  `performed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `status` enum('planirano','u_tijeku','zavrseno','otkazano') DEFAULT 'planirano',
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `capa_case` varchar(255) DEFAULT NULL,
  `performed_by_id` int DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_cal_case` (`capa_case_id`),
  KEY `fk_cal_user` (`performed_by`),
  CONSTRAINT `fk_cal_case` FOREIGN KEY (`capa_case_id`) REFERENCES `capa_cases` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_cal_user` FOREIGN KEY (`performed_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `capa_action_log`
--

LOCK TABLES `capa_action_log` WRITE;
/*!40000 ALTER TABLE `capa_action_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `capa_action_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_action_log_ai_audit` AFTER INSERT ON `capa_action_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'capa_action_log', 'CapaActionLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('capa_action_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_action_log_au_audit` AFTER UPDATE ON `capa_action_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'capa_action_log', 'CapaActionLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('capa_action_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_action_log_ad_audit` AFTER DELETE ON `capa_action_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'capa_action_log', 'CapaActionLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('capa_action_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `capa_actions`
--

DROP TABLE IF EXISTS `capa_actions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `capa_actions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `capa_id` int NOT NULL,
  `action_type` varchar(80) DEFAULT NULL,
  `description` text,
  `due_date` date DEFAULT NULL,
  `completed_at` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_capa_action` (`capa_id`),
  CONSTRAINT `fk_capa_action` FOREIGN KEY (`capa_id`) REFERENCES `capa_cases` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `capa_actions`
--

LOCK TABLES `capa_actions` WRITE;
/*!40000 ALTER TABLE `capa_actions` DISABLE KEYS */;
/*!40000 ALTER TABLE `capa_actions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_actions_ai_audit` AFTER INSERT ON `capa_actions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'capa_actions', 'CapaActionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('capa_actions insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_actions_au_audit` AFTER UPDATE ON `capa_actions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'capa_actions', 'CapaActionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('capa_actions update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_actions_ad_audit` AFTER DELETE ON `capa_actions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'capa_actions', 'CapaActionsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('capa_actions delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary view structure for view `capa_audit_log`
--

DROP TABLE IF EXISTS `capa_audit_log`;
/*!50001 DROP VIEW IF EXISTS `capa_audit_log`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `capa_audit_log` AS SELECT 
 1 AS `id`,
 1 AS `capa_case_id`,
 1 AS `old_status`,
 1 AS `new_status`,
 1 AS `changed_by`,
 1 AS `changed_at`,
 1 AS `note`,
 1 AS `created_at`,
 1 AS `updated_at`,
 1 AS `capa_case`,
 1 AS `source_ip`,
 1 AS `digital_signature`,
 1 AS `change_version`,
 1 AS `is_deleted`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `capa_cases`
--

DROP TABLE IF EXISTS `capa_cases`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `capa_cases` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_id` int DEFAULT NULL,
  `date_open` date DEFAULT NULL,
  `date_close` date DEFAULT NULL,
  `reason` text,
  `actions` text,
  `status` enum('otvoren','zatvoren','u_tijeku') DEFAULT NULL,
  `doc_file` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `status_id` int DEFAULT NULL,
  `title` varchar(255) DEFAULT NULL,
  `description` varchar(255) DEFAULT NULL,
  `machine_component` varchar(255) DEFAULT NULL,
  `user` varchar(255) DEFAULT NULL,
  `priority` varchar(255) DEFAULT NULL,
  `root_cause` varchar(255) DEFAULT NULL,
  `corrective_action` varchar(255) DEFAULT NULL,
  `preventive_action` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `approved` tinyint(1) DEFAULT NULL,
  `approved_at` datetime DEFAULT NULL,
  `approved_by_id` int DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `root_cause_reference` varchar(255) DEFAULT NULL,
  `linked_findings` varchar(255) DEFAULT NULL,
  `notes` varchar(255) DEFAULT NULL,
  `comments` varchar(255) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  `assigned_to_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_capa_component` (`component_id`),
  KEY `idx_capa_status_id` (`status_id`),
  CONSTRAINT `fk_capa_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_capa_status` FOREIGN KEY (`status_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `capa_cases`
--

LOCK TABLES `capa_cases` WRITE;
/*!40000 ALTER TABLE `capa_cases` DISABLE KEYS */;
/*!40000 ALTER TABLE `capa_cases` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_sync` BEFORE INSERT ON `capa_cases` FOR EACH ROW BEGIN
  CALL ref_touch('capa_status', NEW.status, NEW.status);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_cases_ai_audit` AFTER INSERT ON `capa_cases` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'capa_cases', 'CapaCasesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('capa_cases insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_sync_u` BEFORE UPDATE ON `capa_cases` FOR EACH ROW BEGIN
  IF (NEW.status <=> OLD.status) = 0 THEN
    CALL ref_touch('capa_status', NEW.status, NEW.status);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_cases_au_audit` AFTER UPDATE ON `capa_cases` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'capa_cases', 'CapaCasesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('capa_cases update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_cases_ad_audit` AFTER DELETE ON `capa_cases` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'capa_cases', 'CapaCasesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('capa_cases delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `capa_status_history`
--

DROP TABLE IF EXISTS `capa_status_history`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `capa_status_history` (
  `id` int NOT NULL AUTO_INCREMENT,
  `capa_case_id` int DEFAULT NULL,
  `old_status` enum('otvoren','zatvoren','planirano','u_tijeku') DEFAULT NULL,
  `new_status` enum('otvoren','zatvoren','planirano','u_tijeku') DEFAULT NULL,
  `changed_by` int DEFAULT NULL,
  `changed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `capa_case` varchar(255) DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_csh_case` (`capa_case_id`),
  KEY `fk_csh_user` (`changed_by`),
  CONSTRAINT `fk_csh_case` FOREIGN KEY (`capa_case_id`) REFERENCES `capa_cases` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_csh_user` FOREIGN KEY (`changed_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `capa_status_history`
--

LOCK TABLES `capa_status_history` WRITE;
/*!40000 ALTER TABLE `capa_status_history` DISABLE KEYS */;
/*!40000 ALTER TABLE `capa_status_history` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_status_history_ai_audit` AFTER INSERT ON `capa_status_history` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'capa_status_history', 'CapaStatusHistoryPage', NEW.id, NULL,
     NULL, NULL, CONCAT('capa_status_history insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_status_history_au_audit` AFTER UPDATE ON `capa_status_history` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'capa_status_history', 'CapaStatusHistoryPage', NEW.id, NULL,
     NULL, NULL, CONCAT('capa_status_history update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_capa_status_history_ad_audit` AFTER DELETE ON `capa_status_history` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'capa_status_history', 'CapaStatusHistoryPage', OLD.id, NULL,
     NULL, NULL, CONCAT('capa_status_history delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `change_controls`
--

DROP TABLE IF EXISTS `change_controls`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `change_controls` (
  `id` int NOT NULL AUTO_INCREMENT,
  `description` varchar(255) DEFAULT NULL,
  `title` varchar(255) DEFAULT NULL,
  `date_requested` varchar(255) DEFAULT NULL,
  `code` varchar(255) DEFAULT NULL,
  `status` varchar(255) DEFAULT NULL,
  `requested_by_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `change_controls`
--

LOCK TABLES `change_controls` WRITE;
/*!40000 ALTER TABLE `change_controls` DISABLE KEYS */;
/*!40000 ALTER TABLE `change_controls` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `checklist_items`
--

DROP TABLE IF EXISTS `checklist_items`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `checklist_items` (
  `id` int NOT NULL AUTO_INCREMENT,
  `template_id` int NOT NULL,
  `item_order` int DEFAULT '10',
  `label` varchar(255) NOT NULL,
  `expected` varchar(255) DEFAULT NULL,
  `required` tinyint(1) DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_ci_tpl` (`template_id`),
  CONSTRAINT `fk_ci_tpl` FOREIGN KEY (`template_id`) REFERENCES `checklist_templates` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `checklist_items`
--

LOCK TABLES `checklist_items` WRITE;
/*!40000 ALTER TABLE `checklist_items` DISABLE KEYS */;
/*!40000 ALTER TABLE `checklist_items` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_checklist_items_ai_audit` AFTER INSERT ON `checklist_items` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'checklist_items', 'ChecklistItemsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('checklist_items insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_checklist_items_au_audit` AFTER UPDATE ON `checklist_items` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'checklist_items', 'ChecklistItemsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('checklist_items update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_checklist_items_ad_audit` AFTER DELETE ON `checklist_items` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'checklist_items', 'ChecklistItemsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('checklist_items delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `checklist_templates`
--

DROP TABLE IF EXISTS `checklist_templates`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `checklist_templates` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(60) DEFAULT NULL,
  `name` varchar(150) NOT NULL,
  `description` text,
  `created_by` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  KEY `fk_ct_user` (`created_by`),
  CONSTRAINT `fk_ct_user` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `checklist_templates`
--

LOCK TABLES `checklist_templates` WRITE;
/*!40000 ALTER TABLE `checklist_templates` DISABLE KEYS */;
/*!40000 ALTER TABLE `checklist_templates` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_checklist_templates_ai_audit` AFTER INSERT ON `checklist_templates` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'checklist_templates', 'ChecklistTemplatesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('checklist_templates insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_checklist_templates_au_audit` AFTER UPDATE ON `checklist_templates` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'checklist_templates', 'ChecklistTemplatesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('checklist_templates update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'checklist_templates', 'ChecklistTemplatesPage', NEW.id, 'code',
       OLD.code, NEW.code, 'checklist_templates update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'checklist_templates', 'ChecklistTemplatesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'checklist_templates update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_checklist_templates_ad_audit` AFTER DELETE ON `checklist_templates` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'checklist_templates', 'ChecklistTemplatesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('checklist_templates delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `comments`
--

DROP TABLE IF EXISTS `comments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `comments` (
  `id` int NOT NULL AUTO_INCREMENT,
  `entity` varchar(60) NOT NULL,
  `entity_id` int NOT NULL,
  `user_id` int DEFAULT NULL,
  `comment` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_comm_user` (`user_id`),
  CONSTRAINT `fk_comm_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `comments`
--

LOCK TABLES `comments` WRITE;
/*!40000 ALTER TABLE `comments` DISABLE KEYS */;
/*!40000 ALTER TABLE `comments` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_comments_ai_audit` AFTER INSERT ON `comments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'comments', 'CommentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('comments insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_comments_au_audit` AFTER UPDATE ON `comments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'comments', 'CommentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('comments update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_comments_ad_audit` AFTER DELETE ON `comments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'comments', 'CommentsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('comments delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `component_devices`
--

DROP TABLE IF EXISTS `component_devices`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `component_devices` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_id` int NOT NULL,
  `device_id` int NOT NULL,
  `sensor_model_id` int DEFAULT NULL,
  `started_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `ended_at` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_comp_device` (`component_id`,`device_id`,`started_at`),
  KEY `fk_cd_dev` (`device_id`),
  KEY `fk_cd_smodel` (`sensor_model_id`),
  CONSTRAINT `fk_cd_comp` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_cd_dev` FOREIGN KEY (`device_id`) REFERENCES `iot_devices` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_cd_smodel` FOREIGN KEY (`sensor_model_id`) REFERENCES `sensor_models` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `component_devices`
--

LOCK TABLES `component_devices` WRITE;
/*!40000 ALTER TABLE `component_devices` DISABLE KEYS */;
/*!40000 ALTER TABLE `component_devices` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_devices_ai_audit` AFTER INSERT ON `component_devices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'component_devices', 'ComponentDevicesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_devices insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_devices_au_audit` AFTER UPDATE ON `component_devices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'component_devices', 'ComponentDevicesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_devices update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_devices_ad_audit` AFTER DELETE ON `component_devices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'component_devices', 'ComponentDevicesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('component_devices delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `component_models`
--

DROP TABLE IF EXISTS `component_models`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `component_models` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_type_id` int DEFAULT NULL,
  `model_code` varchar(100) DEFAULT NULL,
  `model_name` varchar(150) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_comp_model` (`component_type_id`,`model_code`),
  CONSTRAINT `fk_cmodel_type` FOREIGN KEY (`component_type_id`) REFERENCES `component_types` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `component_models`
--

LOCK TABLES `component_models` WRITE;
/*!40000 ALTER TABLE `component_models` DISABLE KEYS */;
INSERT INTO `component_models` VALUES (1,1,'IEC-IE3-2.2kW','IEC IE3 Motor 2.2kW','2025-08-28 12:36:24','2025-08-28 12:36:24'),(2,7,'SINAMICS-G120','SINAMICS G120 VFD','2025-08-28 12:36:24','2025-08-28 12:36:24'),(3,6,'S7-1200','Siemens S7-1200 PLC','2025-08-28 12:36:24','2025-08-28 12:36:24'),(4,3,'ASCO-2W160','ASCO 2/2 Solenoid Valve 2W160','2025-08-28 12:36:24','2025-08-28 12:36:24'),(5,4,'PALL-0.2UM','Pall 0.2 ╬╝m Filter','2025-08-28 12:36:24','2025-08-28 12:36:24');
/*!40000 ALTER TABLE `component_models` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_models_ai_audit` AFTER INSERT ON `component_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'component_models', 'ComponentModelsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_models insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_models_au_audit` AFTER UPDATE ON `component_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'component_models', 'ComponentModelsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_models update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_models_ad_audit` AFTER DELETE ON `component_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'component_models', 'ComponentModelsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('component_models delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `component_parts`
--

DROP TABLE IF EXISTS `component_parts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `component_parts` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_id` int NOT NULL,
  `part_id` int NOT NULL,
  `nominal_qty` decimal(10,3) NOT NULL DEFAULT '1.000',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_comp_part` (`component_id`,`part_id`),
  KEY `fk_cparts_part` (`part_id`),
  CONSTRAINT `fk_cparts_comp` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_cparts_part` FOREIGN KEY (`part_id`) REFERENCES `parts` (`id`) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `component_parts`
--

LOCK TABLES `component_parts` WRITE;
/*!40000 ALTER TABLE `component_parts` DISABLE KEYS */;
/*!40000 ALTER TABLE `component_parts` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_parts_ai_audit` AFTER INSERT ON `component_parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'component_parts', 'ComponentPartsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_parts insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_parts_au_audit` AFTER UPDATE ON `component_parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'component_parts', 'ComponentPartsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_parts update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_parts_ad_audit` AFTER DELETE ON `component_parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'component_parts', 'ComponentPartsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('component_parts delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `component_qualifications`
--

DROP TABLE IF EXISTS `component_qualifications`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `component_qualifications` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_id` int DEFAULT NULL,
  `type` enum('IQ','OQ','PQ') DEFAULT NULL,
  `qualification_date` date DEFAULT NULL,
  `next_due` date DEFAULT NULL,
  `status` enum('uspjesno','neuspjesno','planirano') DEFAULT NULL,
  `doc_file` varchar(255) DEFAULT NULL,
  `signed_by` varchar(128) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `certificate_number` varchar(255) DEFAULT NULL,
  `supplier_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_cq_component` (`component_id`),
  CONSTRAINT `fk_cq_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `component_qualifications`
--

LOCK TABLES `component_qualifications` WRITE;
/*!40000 ALTER TABLE `component_qualifications` DISABLE KEYS */;
/*!40000 ALTER TABLE `component_qualifications` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_qualifications_ai_audit` AFTER INSERT ON `component_qualifications` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'component_qualifications', 'ComponentQualificationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_qualifications insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_qualifications_au_audit` AFTER UPDATE ON `component_qualifications` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'component_qualifications', 'ComponentQualificationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_qualifications update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_qualifications_ad_audit` AFTER DELETE ON `component_qualifications` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'component_qualifications', 'ComponentQualificationsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('component_qualifications delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `component_types`
--

DROP TABLE IF EXISTS `component_types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `component_types` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(50) DEFAULT NULL,
  `name` varchar(120) NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB AUTO_INCREMENT=41 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `component_types`
--

LOCK TABLES `component_types` WRITE;
/*!40000 ALTER TABLE `component_types` DISABLE KEYS */;
INSERT INTO `component_types` VALUES (1,'MOTOR','Electric Motor','2025-08-28 12:36:24','2025-08-28 12:36:24'),(2,'PUMP_HEAD','Pump Head','2025-08-28 12:36:24','2025-08-28 12:36:24'),(3,'VALVE','Valve','2025-08-28 12:36:24','2025-08-28 12:36:24'),(4,'FILTER','Filter Housing/Element','2025-08-28 12:36:24','2025-08-28 12:36:24'),(5,'SENSOR','Process Sensor','2025-08-28 12:36:24','2025-08-28 12:36:24'),(6,'PLC','PLC/Controller','2025-08-28 12:36:24','2025-08-28 12:36:24'),(7,'VFD','Variable Frequency Drive','2025-08-28 12:36:24','2025-08-28 12:36:24'),(8,'GEARBOX','Gearbox/Reducer','2025-08-28 12:36:24','2025-08-28 12:36:24'),(9,'CONVEYOR','Conveyor Module','2025-08-28 12:36:24','2025-08-28 12:36:24'),(10,'HEAT_EXCHANGER','Heat Exchanger','2025-08-28 12:36:24','2025-08-28 12:36:24');
/*!40000 ALTER TABLE `component_types` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_types_ai_audit` AFTER INSERT ON `component_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'component_types', 'ComponentTypesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_types insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_types_au_audit` AFTER UPDATE ON `component_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'component_types', 'ComponentTypesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('component_types update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'component_types', 'ComponentTypesPage', NEW.id, 'code',
       OLD.code, NEW.code, 'component_types update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'component_types', 'ComponentTypesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'component_types update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_component_types_ad_audit` AFTER DELETE ON `component_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'component_types', 'ComponentTypesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('component_types delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `components`
--

DROP TABLE IF EXISTS `components`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `components` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(200) NOT NULL,
  `component_type` varchar(120) DEFAULT NULL,
  `manufacturer_id` int DEFAULT NULL,
  `serial_number` varchar(120) DEFAULT NULL,
  `calibration_required` tinyint(1) NOT NULL DEFAULT '0',
  `status_id` int DEFAULT NULL,
  `notes` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_components_mfr` (`manufacturer_id`),
  KEY `fk_components_status` (`status_id`),
  CONSTRAINT `fk_components_mfr` FOREIGN KEY (`manufacturer_id`) REFERENCES `manufacturers` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_components_status` FOREIGN KEY (`status_id`) REFERENCES `lkp_status` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `components`
--

LOCK TABLES `components` WRITE;
/*!40000 ALTER TABLE `components` DISABLE KEYS */;
/*!40000 ALTER TABLE `components` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `config_change_log`
--

DROP TABLE IF EXISTS `config_change_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `config_change_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `change_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `changed_by` int DEFAULT NULL,
  `config_name` varchar(255) DEFAULT NULL,
  `old_value` text,
  `new_value` text,
  `change_type` enum('parametar','backup','restore','security','feature','drugo') DEFAULT NULL,
  `note` text,
  `source_ip` varchar(45) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`change_time`) VIRTUAL,
  `action` varchar(20) GENERATED ALWAYS AS (`change_type`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`note`) VIRTUAL,
  PRIMARY KEY (`id`),
  KEY `fk_cfg_user` (`changed_by`),
  CONSTRAINT `fk_cfg_user` FOREIGN KEY (`changed_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `config_change_log`
--

LOCK TABLES `config_change_log` WRITE;
/*!40000 ALTER TABLE `config_change_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `config_change_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_config_change_log_ai_audit` AFTER INSERT ON `config_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'config_change_log', 'ConfigChangeLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('config_change_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_config_change_log_au_audit` AFTER UPDATE ON `config_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'config_change_log', 'ConfigChangeLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('config_change_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_config_change_log_ad_audit` AFTER DELETE ON `config_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'config_change_log', 'ConfigChangeLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('config_change_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `contractor_intervention_audit`
--

DROP TABLE IF EXISTS `contractor_intervention_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `contractor_intervention_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `intervention_id` int NOT NULL,
  `user_id` int DEFAULT NULL,
  `action` varchar(30) NOT NULL,
  `details` text,
  `changed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `source_ip` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `old_value` text,
  `new_value` text,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `description` varchar(255) DEFAULT NULL,
  `timestamp` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_cia_intervention` (`intervention_id`),
  KEY `fk_cia_user` (`user_id`),
  CONSTRAINT `fk_cia_intervention` FOREIGN KEY (`intervention_id`) REFERENCES `contractor_interventions` (`id`),
  CONSTRAINT `fk_cia_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `contractor_intervention_audit`
--

LOCK TABLES `contractor_intervention_audit` WRITE;
/*!40000 ALTER TABLE `contractor_intervention_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `contractor_intervention_audit` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_contractor_intervention_audit_ai_audit` AFTER INSERT ON `contractor_intervention_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'contractor_intervention_audit', 'ContractorInterventionAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('contractor_intervention_audit insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_contractor_intervention_audit_au_audit` AFTER UPDATE ON `contractor_intervention_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'contractor_intervention_audit', 'ContractorInterventionAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('contractor_intervention_audit update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_contractor_intervention_audit_ad_audit` AFTER DELETE ON `contractor_intervention_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'contractor_intervention_audit', 'ContractorInterventionAuditPage', OLD.id, NULL,
     NULL, NULL, CONCAT('contractor_intervention_audit delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `contractor_interventions`
--

DROP TABLE IF EXISTS `contractor_interventions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `contractor_interventions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `contractor_id` int DEFAULT NULL,
  `component_id` int DEFAULT NULL,
  `intervention_date` date DEFAULT NULL,
  `reason` text,
  `result` text,
  `gmp_compliance` tinyint(1) DEFAULT '1',
  `doc_file` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `user` varchar(255) DEFAULT NULL,
  `component` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `start_date` datetime DEFAULT NULL,
  `end_date` datetime DEFAULT NULL,
  `notes` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `comments` varchar(255) DEFAULT NULL,
  `status` varchar(255) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_ci_contractor` (`contractor_id`),
  KEY `fk_ci_component` (`component_id`),
  CONSTRAINT `fk_ci_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_ci_contractor` FOREIGN KEY (`contractor_id`) REFERENCES `external_contractors` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `contractor_interventions`
--

LOCK TABLES `contractor_interventions` WRITE;
/*!40000 ALTER TABLE `contractor_interventions` DISABLE KEYS */;
/*!40000 ALTER TABLE `contractor_interventions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_contractor_interventions_ai_audit` AFTER INSERT ON `contractor_interventions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'contractor_interventions', 'ContractorInterventionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('contractor_interventions insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_contractor_interventions_au_audit` AFTER UPDATE ON `contractor_interventions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'contractor_interventions', 'ContractorInterventionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('contractor_interventions update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_contractor_interventions_ad_audit` AFTER DELETE ON `contractor_interventions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'contractor_interventions', 'ContractorInterventionsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('contractor_interventions delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `dashboards`
--

DROP TABLE IF EXISTS `dashboards`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `dashboards` (
  `id` int NOT NULL AUTO_INCREMENT,
  `dashboard_name` varchar(100) DEFAULT NULL,
  `description` text,
  `created_by` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `config_json` json DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT '1',
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `dashboard_name` (`dashboard_name`),
  KEY `fk_dash_user` (`created_by`),
  CONSTRAINT `fk_dash_user` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `dashboards`
--

LOCK TABLES `dashboards` WRITE;
/*!40000 ALTER TABLE `dashboards` DISABLE KEYS */;
/*!40000 ALTER TABLE `dashboards` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_dashboards_ai_audit` AFTER INSERT ON `dashboards` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'dashboards', 'DashboardsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('dashboards insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_dashboards_au_audit` AFTER UPDATE ON `dashboards` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'dashboards', 'DashboardsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('dashboards update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_dashboards_ad_audit` AFTER DELETE ON `dashboards` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'dashboards', 'DashboardsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('dashboards delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `delegated_permissions`
--

DROP TABLE IF EXISTS `delegated_permissions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `delegated_permissions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `from_user_id` int NOT NULL,
  `to_user_id` int NOT NULL,
  `permission_id` int NOT NULL,
  `start_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `expires_at` datetime NOT NULL,
  `reason` varchar(255) DEFAULT NULL,
  `granted_by` int DEFAULT NULL,
  `revoked` tinyint(1) DEFAULT '0',
  `revoked_at` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `permission?` varchar(255) DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `start_at` datetime DEFAULT NULL,
  `end_at` datetime DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT NULL,
  `is_revoked` tinyint(1) DEFAULT NULL,
  `approved_by` int DEFAULT NULL,
  `note` varchar(512) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `session_id` varchar(64) DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `code` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_dp_from` (`from_user_id`),
  KEY `fk_dp_to` (`to_user_id`),
  KEY `fk_dp_perm` (`permission_id`),
  KEY `fk_dp_by` (`granted_by`),
  CONSTRAINT `fk_dp_by` FOREIGN KEY (`granted_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_dp_from` FOREIGN KEY (`from_user_id`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_dp_perm` FOREIGN KEY (`permission_id`) REFERENCES `permissions` (`id`),
  CONSTRAINT `fk_dp_to` FOREIGN KEY (`to_user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `delegated_permissions`
--

LOCK TABLES `delegated_permissions` WRITE;
/*!40000 ALTER TABLE `delegated_permissions` DISABLE KEYS */;
/*!40000 ALTER TABLE `delegated_permissions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_delegated_permissions_ai_audit` AFTER INSERT ON `delegated_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'delegated_permissions', 'DelegatedPermissionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('delegated_permissions insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_delegated_permissions_au_audit` AFTER UPDATE ON `delegated_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'delegated_permissions', 'DelegatedPermissionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('delegated_permissions update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_delegated_permissions_ad_audit` AFTER DELETE ON `delegated_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'delegated_permissions', 'DelegatedPermissionsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('delegated_permissions delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `delete_log`
--

DROP TABLE IF EXISTS `delete_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `delete_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `deleted_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `deleted_by` int DEFAULT NULL,
  `table_name` varchar(100) DEFAULT NULL,
  `record_id` int DEFAULT NULL,
  `delete_type` enum('soft','hard') DEFAULT NULL,
  `reason` text,
  `recoverable` tinyint(1) DEFAULT '1',
  `backup_file` varchar(255) DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`deleted_at`) VIRTUAL,
  `action` varchar(20) GENERATED ALWAYS AS (`delete_type`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`reason`) VIRTUAL,
  PRIMARY KEY (`id`),
  KEY `fk_del_user` (`deleted_by`),
  CONSTRAINT `fk_del_user` FOREIGN KEY (`deleted_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `delete_log`
--

LOCK TABLES `delete_log` WRITE;
/*!40000 ALTER TABLE `delete_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `delete_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_delete_log_ai_audit` AFTER INSERT ON `delete_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'delete_log', 'DeleteLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('delete_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_delete_log_au_audit` AFTER UPDATE ON `delete_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'delete_log', 'DeleteLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('delete_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_delete_log_ad_audit` AFTER DELETE ON `delete_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'delete_log', 'DeleteLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('delete_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `departments`
--

DROP TABLE IF EXISTS `departments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `departments` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(50) DEFAULT NULL,
  `name` varchar(150) NOT NULL,
  `manager_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  KEY `fk_dept_manager` (`manager_id`),
  CONSTRAINT `fk_dept_manager` FOREIGN KEY (`manager_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `departments`
--

LOCK TABLES `departments` WRITE;
/*!40000 ALTER TABLE `departments` DISABLE KEYS */;
/*!40000 ALTER TABLE `departments` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_departments_ai_audit` AFTER INSERT ON `departments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'departments', 'DepartmentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('departments insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_departments_au_audit` AFTER UPDATE ON `departments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'departments', 'DepartmentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('departments update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'departments', 'DepartmentsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'departments update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'departments', 'DepartmentsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'departments update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_departments_ad_audit` AFTER DELETE ON `departments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'departments', 'DepartmentsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('departments delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `deviation_audit`
--

DROP TABLE IF EXISTS `deviation_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `deviation_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `deviation_id` int NOT NULL,
  `user_id` int NOT NULL,
  `action` varchar(40) NOT NULL,
  `details` text,
  `changed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `device_info` varchar(255) DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `session_id` varchar(128) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `regulatory_status` enum('compliant','pending_review','invalid','forensic','security') DEFAULT 'compliant',
  `ai_anomaly_score` decimal(5,4) DEFAULT '0.0000',
  `validated` tinyint(1) DEFAULT '1',
  `audit_trail_id` int DEFAULT NULL,
  `comment` text,
  `old_value` text,
  `new_value` text,
  `signature_type` enum('pin','password','certificate','biometric','none') DEFAULT 'none',
  `signature_method` varchar(100) DEFAULT NULL,
  `signature_valid` tinyint(1) DEFAULT '1',
  `export_status` enum('none','pdf','csv','xml','emailed','printed') DEFAULT 'none',
  `export_time` datetime DEFAULT NULL,
  `exported_by` int DEFAULT NULL,
  `restored_from_snapshot` tinyint(1) DEFAULT '0',
  `restoration_reference` varchar(128) DEFAULT NULL,
  `approval_status` enum('none','pending','approved','rejected','escalated') DEFAULT 'none',
  `approval_time` datetime DEFAULT NULL,
  `approved_by` int DEFAULT NULL,
  `deleted` tinyint(1) DEFAULT '0',
  `deleted_at` datetime DEFAULT NULL,
  `deleted_by` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `related_file` varchar(255) DEFAULT NULL,
  `related_photo` varchar(255) DEFAULT NULL,
  `iot_event_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_dev_aud_deviation` (`deviation_id`),
  KEY `fk_dev_aud_user` (`user_id`),
  KEY `fk_dev_aud_approved_by` (`approved_by`),
  KEY `fk_dev_aud_audit_trail` (`audit_trail_id`),
  KEY `fk_dev_aud_exported_by` (`exported_by`),
  KEY `fk_dev_aud_deleted_by` (`deleted_by`),
  KEY `fk_dev_aud_iot` (`iot_event_id`),
  CONSTRAINT `fk_dev_aud_approved_by` FOREIGN KEY (`approved_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_dev_aud_audit_trail` FOREIGN KEY (`audit_trail_id`) REFERENCES `system_event_log` (`id`),
  CONSTRAINT `fk_dev_aud_deleted_by` FOREIGN KEY (`deleted_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_dev_aud_deviation` FOREIGN KEY (`deviation_id`) REFERENCES `deviations` (`id`),
  CONSTRAINT `fk_dev_aud_exported_by` FOREIGN KEY (`exported_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_dev_aud_iot` FOREIGN KEY (`iot_event_id`) REFERENCES `iot_event_audit` (`id`),
  CONSTRAINT `fk_dev_aud_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `deviation_audit`
--

LOCK TABLES `deviation_audit` WRITE;
/*!40000 ALTER TABLE `deviation_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `deviation_audit` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_deviation_audit_ai_audit` AFTER INSERT ON `deviation_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'deviation_audit', 'DeviationAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('deviation_audit insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_deviation_audit_au_audit` AFTER UPDATE ON `deviation_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'deviation_audit', 'DeviationAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('deviation_audit update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_deviation_audit_ad_audit` AFTER DELETE ON `deviation_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'deviation_audit', 'DeviationAuditPage', OLD.id, NULL,
     NULL, NULL, CONCAT('deviation_audit delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `deviations`
--

DROP TABLE IF EXISTS `deviations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `deviations` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `code` varchar(40) DEFAULT NULL,
  `title` varchar(200) DEFAULT NULL,
  `description` varchar(4000) DEFAULT NULL,
  `reported_at` datetime DEFAULT NULL,
  `reported_by_id` int DEFAULT NULL,
  `user` varchar(255) DEFAULT NULL,
  `severity` varchar(16) DEFAULT NULL,
  `is_critical` tinyint(1) DEFAULT NULL,
  `status` varchar(255) DEFAULT NULL,
  `assigned_investigator_id` int DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `assigned_investigator_name` varchar(100) DEFAULT NULL,
  `investigation_started_at` datetime DEFAULT NULL,
  `root_cause` varchar(800) DEFAULT NULL,
  `corrective_actions` varchar(255) DEFAULT NULL,
  `linked_capa_id` int DEFAULT NULL,
  `capa_case?` varchar(255) DEFAULT NULL,
  `closure_comment` varchar(2000) DEFAULT NULL,
  `closed_at` datetime DEFAULT NULL,
  `attachment_ids` varchar(255) DEFAULT NULL,
  `attachments` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `risk_score` int DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `audit_note` varchar(1000) DEFAULT NULL,
  `audit_trail` varchar(255) DEFAULT NULL,
  `string>` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `deviations`
--

LOCK TABLES `deviations` WRITE;
/*!40000 ALTER TABLE `deviations` DISABLE KEYS */;
/*!40000 ALTER TABLE `deviations` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_deviations_ai_audit` AFTER INSERT ON `deviations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'deviations', 'DeviationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('deviations insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_deviations_au_audit` AFTER UPDATE ON `deviations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'deviations', 'DeviationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('deviations update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_deviations_ad_audit` AFTER DELETE ON `deviations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'deviations', 'DeviationsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('deviations delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `digital_signatures`
--

DROP TABLE IF EXISTS `digital_signatures`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `digital_signatures` (
  `id` int NOT NULL AUTO_INCREMENT,
  `table_name` varchar(100) DEFAULT NULL,
  `record_id` int DEFAULT NULL,
  `user_id` int DEFAULT NULL,
  `signature_hash` varchar(255) DEFAULT NULL,
  `signed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `method` enum('pin','certificate','biometric','password') DEFAULT NULL,
  `status` enum('valid','revoked','pending') DEFAULT 'valid',
  `ip_address` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `public_key` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_dsig_user` (`user_id`),
  CONSTRAINT `fk_dsig_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `digital_signatures`
--

LOCK TABLES `digital_signatures` WRITE;
/*!40000 ALTER TABLE `digital_signatures` DISABLE KEYS */;
/*!40000 ALTER TABLE `digital_signatures` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_digital_signatures_ai_audit` AFTER INSERT ON `digital_signatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'digital_signatures', 'DigitalSignaturesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('digital_signatures insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_digital_signatures_au_audit` AFTER UPDATE ON `digital_signatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'digital_signatures', 'DigitalSignaturesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('digital_signatures update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_digital_signatures_ad_audit` AFTER DELETE ON `digital_signatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'digital_signatures', 'DigitalSignaturesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('digital_signatures delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `document_links`
--

DROP TABLE IF EXISTS `document_links`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `document_links` (
  `id` int NOT NULL AUTO_INCREMENT,
  `document_id` int NOT NULL,
  `entity_type` enum('Machine','Component','WorkOrder','Calibration','Validation','Vendor','Department') NOT NULL,
  `entity_id` int NOT NULL,
  `note` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `ix_doclinks_entity` (`entity_type`,`entity_id`),
  KEY `fk_doclinks_doc` (`document_id`),
  CONSTRAINT `fk_doclinks_doc` FOREIGN KEY (`document_id`) REFERENCES `documents` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `document_links`
--

LOCK TABLES `document_links` WRITE;
/*!40000 ALTER TABLE `document_links` DISABLE KEYS */;
/*!40000 ALTER TABLE `document_links` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `document_versions`
--

DROP TABLE IF EXISTS `document_versions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `document_versions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `related_table` varchar(50) DEFAULT NULL,
  `related_id` int DEFAULT NULL,
  `version` varchar(40) DEFAULT NULL,
  `file_path` varchar(255) DEFAULT NULL,
  `created_by` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `status` enum('active','archived','obsolete','review') DEFAULT NULL,
  `note` text,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `documentcontrol_id` int DEFAULT NULL,
  `document` varchar(255) DEFAULT NULL,
  `revision` varchar(255) DEFAULT NULL,
  `created_by_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_docv_user` (`created_by`),
  CONSTRAINT `fk_docv_user` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `document_versions`
--

LOCK TABLES `document_versions` WRITE;
/*!40000 ALTER TABLE `document_versions` DISABLE KEYS */;
/*!40000 ALTER TABLE `document_versions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_document_versions_ai_audit` AFTER INSERT ON `document_versions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'document_versions', 'DocumentVersionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('document_versions insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_document_versions_au_audit` AFTER UPDATE ON `document_versions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'document_versions', 'DocumentVersionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('document_versions update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_document_versions_ad_audit` AFTER DELETE ON `document_versions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'document_versions', 'DocumentVersionsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('document_versions delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `documentcontrol`
--

DROP TABLE IF EXISTS `documentcontrol`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `documentcontrol` (
  `id` int NOT NULL AUTO_INCREMENT,
  `device_info` varchar(255) DEFAULT NULL,
  `file_path` varchar(255) DEFAULT NULL,
  `description` varchar(255) DEFAULT NULL,
  `title` varchar(255) DEFAULT NULL,
  `linked_change_controls` varchar(255) DEFAULT NULL,
  `revision` varchar(255) DEFAULT NULL,
  `code` varchar(255) DEFAULT NULL,
  `status` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `documentcontrol`
--

LOCK TABLES `documentcontrol` WRITE;
/*!40000 ALTER TABLE `documentcontrol` DISABLE KEYS */;
/*!40000 ALTER TABLE `documentcontrol` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `documents`
--

DROP TABLE IF EXISTS `documents`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `documents` (
  `id` int NOT NULL AUTO_INCREMENT,
  `file_name` varchar(255) NOT NULL,
  `content_type` varchar(120) DEFAULT NULL,
  `storage_provider` enum('FileSystem','S3','Blob') NOT NULL DEFAULT 'FileSystem',
  `storage_path` varchar(500) NOT NULL,
  `sha256` char(64) DEFAULT NULL,
  `uploaded_by` int DEFAULT NULL,
  `uploaded_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_docs_user` (`uploaded_by`),
  CONSTRAINT `fk_docs_user` FOREIGN KEY (`uploaded_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `documents`
--

LOCK TABLES `documents` WRITE;
/*!40000 ALTER TABLE `documents` DISABLE KEYS */;
INSERT INTO `documents` VALUES (1,'sanol lab_novi_.pdf',NULL,'FileSystem','C:\\Users\\amir\\AppData\\Local\\YasGMP\\YasGMP\\Data\\docs\\sanol lab_novi_.pdf','6C36F185759B6B4970C592B89E697F06152405E24C52B696AEBAE022BC533349',NULL,'2025-09-12 05:46:04','2025-09-12 07:46:04','2025-09-12 07:46:04'),(2,'sanol lab_novi_.pdf',NULL,'FileSystem','C:\\Users\\amir\\AppData\\Local\\YasGMP\\YasGMP\\Data\\docs\\sanol lab_novi_.pdf','6C36F185759B6B4970C592B89E697F06152405E24C52B696AEBAE022BC533349',NULL,'2025-09-12 06:16:44','2025-09-12 08:16:44','2025-09-12 08:16:44');
/*!40000 ALTER TABLE `documents` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `entity_audit_log`
--

DROP TABLE IF EXISTS `entity_audit_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `entity_audit_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `timestamp` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `user_id` int DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `device_info` varchar(256) DEFAULT NULL,
  `entity` varchar(64) NOT NULL,
  `entity_id` int DEFAULT NULL,
  `action` varchar(64) NOT NULL,
  `details` text,
  `session_id` varchar(128) DEFAULT NULL,
  `status` varchar(32) DEFAULT NULL,
  `digital_signature` varchar(256) DEFAULT NULL,
  `signature_hash` varchar(256) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_eal_time` (`timestamp`),
  KEY `idx_eal_user` (`user_id`),
  KEY `idx_eal_entity` (`entity`),
  KEY `idx_eal_action` (`action`),
  KEY `idx_eal_entity_id` (`entity_id`),
  CONSTRAINT `fk_eal_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `entity_audit_log`
--

LOCK TABLES `entity_audit_log` WRITE;
/*!40000 ALTER TABLE `entity_audit_log` DISABLE KEYS */;
INSERT INTO `entity_audit_log` VALUES (1,'2025-08-29 09:15:52',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=31f7ecac078042c692a8c4ef; IPv4=192.168.108.54','users',1,'CHANGE_PASSWORD','Korisnik darko promijenio lozinku (admin ID=1).','31f7ecac078042c692a8c4efad1ddca5',NULL,NULL,NULL,'2025-08-29 09:15:52','2025-08-29 09:15:52'),(2,'2025-08-29 09:15:52',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=31f7ecac078042c692a8c4ef; IPv4=192.168.108.54','users',1,'RESET_PASSWORD_UI','Resetirana lozinka kroz Admin UI','31f7ecac078042c692a8c4efad1ddca5',NULL,NULL,NULL,'2025-08-29 09:15:52','2025-08-29 09:15:52'),(3,'2025-08-29 09:16:56',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=31f7ecac078042c692a8c4ef; IPv4=192.168.108.54','users',8,'CHANGE_PASSWORD','Korisnik amir promijenio lozinku (admin ID=1).','31f7ecac078042c692a8c4efad1ddca5',NULL,NULL,NULL,'2025-08-29 09:16:56','2025-08-29 09:16:56'),(4,'2025-08-29 09:16:56',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=31f7ecac078042c692a8c4ef; IPv4=192.168.108.54','users',8,'RESET_PASSWORD_UI','Resetirana lozinka kroz Admin UI','31f7ecac078042c692a8c4efad1ddca5',NULL,NULL,NULL,'2025-08-29 09:16:56','2025-08-29 09:16:56'),(5,'2025-09-01 10:39:30',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=5ce555cdba7346cca79aaa78; IPv4=192.168.108.54','users',1,'CHANGE_PASSWORD','Korisnik darko promijenio lozinku (admin ID=1).','5ce555cdba7346cca79aaa78f207dccb',NULL,NULL,NULL,'2025-09-01 10:39:30','2025-09-01 10:39:30'),(6,'2025-09-01 10:39:38',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=5ce555cdba7346cca79aaa78; IPv4=192.168.108.54','users',1,'CHANGE_PASSWORD','Korisnik darko promijenio lozinku (admin ID=1).','5ce555cdba7346cca79aaa78f207dccb',NULL,NULL,NULL,'2025-09-01 10:39:38','2025-09-01 10:39:38'),(7,'2025-09-01 10:39:38',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=5ce555cdba7346cca79aaa78; IPv4=192.168.108.54','users',1,'RESET_PASSWORD_UI','Resetirana lozinka kroz Admin UI','5ce555cdba7346cca79aaa78f207dccb',NULL,NULL,NULL,'2025-09-01 10:39:38','2025-09-01 10:39:38'),(8,'2025-09-01 10:40:59',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=5ce555cdba7346cca79aaa78; IPv4=192.168.108.54','calibrations',0,'LOAD','Loaded 0 calibrations','5ce555cdba7346cca79aaa78f207dccb',NULL,NULL,NULL,'2025-09-01 10:40:59','2025-09-01 10:40:59'),(9,'2025-09-01 15:06:50',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=f1a4f63a969044a188ab1144; IPv4=192.168.108.54','calibrations',0,'LOAD','Loaded 0 calibrations','f1a4f63a969044a188ab11448c92e3ed',NULL,NULL,NULL,'2025-09-01 15:06:50','2025-09-01 15:06:50'),(10,'2025-09-04 09:40:24',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=fb3a111a4b8646ada13ad1b9; IPv4=192.168.108.54','calibrations',0,'LOAD','Loaded 0 calibrations','fb3a111a4b8646ada13ad1b9c9230f4c',NULL,NULL,NULL,'2025-09-04 09:40:24','2025-09-04 09:40:24'),(11,'2025-09-04 14:09:23',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.19; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=1e6a417d52e7484794b34047; IPv4=192.168.108.54','calibrations',0,'LOAD','Loaded 0 calibrations','1e6a417d52e7484794b340478565f128',NULL,NULL,NULL,'2025-09-04 14:09:23','2025-09-04 14:09:23'),(12,'2025-09-10 14:42:16',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=406666a22cfc4370afae969d; IPv4=192.168.108.54','calibrations',0,'LOAD','Loaded 0 calibrations','406666a22cfc4370afae969d4cafdc07',NULL,NULL,NULL,'2025-09-10 14:42:16','2025-09-10 14:42:16'),(13,'2025-09-11 10:19:50',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=a62bab959dcb493d8db8e4fb; IPv4=192.168.108.54','calibrations',0,'LOAD','Loaded 0 calibrations','a62bab959dcb493d8db8e4fbd7ec02e3',NULL,NULL,NULL,'2025-09-11 10:19:50','2025-09-11 10:19:50'),(14,'2025-09-12 08:17:14',1,'192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=371562c5081f46a0bb18ed98; IPv4=192.168.108.54','calibrations',0,'LOAD','Loaded 0 calibrations','371562c5081f46a0bb18ed98476b83b1',NULL,NULL,NULL,'2025-09-12 08:17:14','2025-09-12 08:17:14');
/*!40000 ALTER TABLE `entity_audit_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_entity_audit_log_ai_audit` AFTER INSERT ON `entity_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'entity_audit_log', 'EntityAuditLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('entity_audit_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_entity_audit_log_au_audit` AFTER UPDATE ON `entity_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'entity_audit_log', 'EntityAuditLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('entity_audit_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_entity_audit_log_ad_audit` AFTER DELETE ON `entity_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'entity_audit_log', 'EntityAuditLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('entity_audit_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `entity_tags`
--

DROP TABLE IF EXISTS `entity_tags`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `entity_tags` (
  `id` int NOT NULL AUTO_INCREMENT,
  `entity` varchar(60) NOT NULL,
  `entity_id` int NOT NULL,
  `tag_id` int NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_et` (`entity`,`entity_id`,`tag_id`),
  KEY `fk_et_tag` (`tag_id`),
  CONSTRAINT `fk_et_tag` FOREIGN KEY (`tag_id`) REFERENCES `tags` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `entity_tags`
--

LOCK TABLES `entity_tags` WRITE;
/*!40000 ALTER TABLE `entity_tags` DISABLE KEYS */;
/*!40000 ALTER TABLE `entity_tags` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_entity_tags_ai_audit` AFTER INSERT ON `entity_tags` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'entity_tags', 'EntityTagsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('entity_tags insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_entity_tags_au_audit` AFTER UPDATE ON `entity_tags` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'entity_tags', 'EntityTagsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('entity_tags update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_entity_tags_ad_audit` AFTER DELETE ON `entity_tags` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'entity_tags', 'EntityTagsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('entity_tags delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `export_audit_log`
--

DROP TABLE IF EXISTS `export_audit_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `export_audit_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `device_info` varchar(255) DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `filter_criteria` varchar(255) DEFAULT NULL,
  `file_path` varchar(255) DEFAULT NULL,
  `timestamp` varchar(255) DEFAULT NULL,
  `export_type` varchar(255) DEFAULT NULL,
  `user_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `export_audit_log`
--

LOCK TABLES `export_audit_log` WRITE;
/*!40000 ALTER TABLE `export_audit_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `export_audit_log` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `export_print_log`
--

DROP TABLE IF EXISTS `export_print_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `export_print_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `export_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `format` enum('excel','pdf','csv','xml') DEFAULT NULL,
  `table_name` varchar(100) DEFAULT NULL,
  `filter_used` text,
  `file_path` varchar(255) DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `note` text,
  `timestamp` datetime GENERATED ALWAYS AS (`export_time`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`note`) VIRTUAL,
  PRIMARY KEY (`id`),
  KEY `fk_export_user` (`user_id`),
  CONSTRAINT `fk_export_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `export_print_log`
--

LOCK TABLES `export_print_log` WRITE;
/*!40000 ALTER TABLE `export_print_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `export_print_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_export_print_log_ai_audit` AFTER INSERT ON `export_print_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'export_print_log', 'ExportPrintLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('export_print_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_export_print_log_au_audit` AFTER UPDATE ON `export_print_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'export_print_log', 'ExportPrintLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('export_print_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_export_print_log_ad_audit` AFTER DELETE ON `export_print_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'export_print_log', 'ExportPrintLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('export_print_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `external_contractors`
--

DROP TABLE IF EXISTS `external_contractors`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `external_contractors` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) DEFAULT NULL,
  `service_type` varchar(100) DEFAULT NULL,
  `contact` varchar(100) DEFAULT NULL,
  `phone` varchar(50) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `doc_file` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `company_name` varchar(255) DEFAULT NULL,
  `registration_number` varchar(255) DEFAULT NULL,
  `type` varchar(255) DEFAULT NULL,
  `contact_person` varchar(255) DEFAULT NULL,
  `address` varchar(255) DEFAULT NULL,
  `certificates` varchar(255) DEFAULT NULL,
  `is_blacklisted` tinyint(1) DEFAULT NULL,
  `blacklist_reason` varchar(255) DEFAULT NULL,
  `risk_score` decimal(10,2) DEFAULT NULL,
  `supplier_id` int DEFAULT NULL,
  `supplier?` varchar(255) DEFAULT NULL,
  `interventions` varchar(255) DEFAULT NULL,
  `attachments` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `audit_logs` varchar(255) DEFAULT NULL,
  `note` varchar(255) DEFAULT NULL,
  `code` varchar(255) DEFAULT NULL,
  `comment` varchar(255) DEFAULT NULL,
  `status` varchar(255) DEFAULT NULL,
  `cooperation_start` varchar(255) DEFAULT NULL,
  `cooperation_end` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `external_contractors`
--

LOCK TABLES `external_contractors` WRITE;
/*!40000 ALTER TABLE `external_contractors` DISABLE KEYS */;
INSERT INTO `external_contractors` VALUES (1,'x',NULL,NULL,'232323','232323',NULL,'2025-09-12 08:18:17','2025-09-12 08:18:17',NULL,NULL,'servis','232323','232323',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'Darko M.',NULL,NULL,NULL,'2323232','aktivan',NULL,NULL);
/*!40000 ALTER TABLE `external_contractors` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_external_contractors_ai_audit` AFTER INSERT ON `external_contractors` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'external_contractors', 'ExternalContractorsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('external_contractors insert', CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_external_contractors_au_audit` AFTER UPDATE ON `external_contractors` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'external_contractors', 'ExternalContractorsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('external_contractors update', CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'external_contractors', 'ExternalContractorsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'external_contractors update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_external_contractors_ad_audit` AFTER DELETE ON `external_contractors` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'external_contractors', 'ExternalContractorsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('external_contractors delete', CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `failure_modes`
--

DROP TABLE IF EXISTS `failure_modes`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `failure_modes` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_type_id` int DEFAULT NULL,
  `code` varchar(40) DEFAULT NULL,
  `description` varchar(255) DEFAULT NULL,
  `severity_default` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_fm_comp_type` (`component_type_id`),
  CONSTRAINT `fk_fm_comp_type` FOREIGN KEY (`component_type_id`) REFERENCES `component_types` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `failure_modes`
--

LOCK TABLES `failure_modes` WRITE;
/*!40000 ALTER TABLE `failure_modes` DISABLE KEYS */;
/*!40000 ALTER TABLE `failure_modes` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_failure_modes_ai_audit` AFTER INSERT ON `failure_modes` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'failure_modes', 'FailureModesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('failure_modes insert', CONCAT('; code=', COALESCE(NEW.code,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_failure_modes_au_audit` AFTER UPDATE ON `failure_modes` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'failure_modes', 'FailureModesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('failure_modes update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'failure_modes', 'FailureModesPage', NEW.id, 'code',
       OLD.code, NEW.code, 'failure_modes update: code changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_failure_modes_ad_audit` AFTER DELETE ON `failure_modes` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'failure_modes', 'FailureModesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('failure_modes delete', CONCAT('; code=', COALESCE(OLD.code,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `forensic_user_change_log`
--

DROP TABLE IF EXISTS `forensic_user_change_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `forensic_user_change_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `changed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `changed_by` int DEFAULT NULL,
  `action` enum('create_user','update_user','disable_user','change_role','reset_password','delete_user','force_logout') DEFAULT NULL,
  `target_user_id` int DEFAULT NULL,
  `old_role` varchar(50) DEFAULT NULL,
  `new_role` varchar(50) DEFAULT NULL,
  `old_status` tinyint(1) DEFAULT NULL,
  `new_status` tinyint(1) DEFAULT NULL,
  `note` text,
  `source_ip` varchar(45) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`changed_at`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`note`) VIRTUAL,
  `changed_by_user` varchar(255) DEFAULT NULL,
  `target_user` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_fucl_changed_by` (`changed_by`),
  KEY `fk_fucl_target_user` (`target_user_id`),
  CONSTRAINT `fk_fucl_changed_by` FOREIGN KEY (`changed_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_fucl_target_user` FOREIGN KEY (`target_user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `forensic_user_change_log`
--

LOCK TABLES `forensic_user_change_log` WRITE;
/*!40000 ALTER TABLE `forensic_user_change_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `forensic_user_change_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_forensic_user_change_log_ai_audit` AFTER INSERT ON `forensic_user_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'forensic_user_change_log', 'ForensicUserChangeLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('forensic_user_change_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_forensic_user_change_log_au_audit` AFTER UPDATE ON `forensic_user_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'forensic_user_change_log', 'ForensicUserChangeLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('forensic_user_change_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_forensic_user_change_log_ad_audit` AFTER DELETE ON `forensic_user_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'forensic_user_change_log', 'ForensicUserChangeLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('forensic_user_change_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `incident_audit`
--

DROP TABLE IF EXISTS `incident_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `incident_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `incident_audit`
--

LOCK TABLES `incident_audit` WRITE;
/*!40000 ALTER TABLE `incident_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `incident_audit` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `incident_log`
--

DROP TABLE IF EXISTS `incident_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `incident_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `detected_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `reported_by` int DEFAULT NULL,
  `severity` enum('low','medium','high','critical','gmp','compliance') DEFAULT 'low',
  `title` varchar(255) DEFAULT NULL,
  `description` text,
  `resolved` tinyint(1) DEFAULT '0',
  `resolved_at` datetime DEFAULT NULL,
  `resolved_by` int DEFAULT NULL,
  `actions_taken` text,
  `follow_up` text,
  `note` text,
  `source_ip` varchar(45) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `severity_id` int DEFAULT NULL,
  `reported_by_id` int DEFAULT NULL,
  `resolved_by_id` int DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `root_cause` varchar(255) DEFAULT NULL,
  `capa_case_id` int DEFAULT NULL,
  `capa_case` varchar(255) DEFAULT NULL,
  `attachments` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_inc_reported_by` (`reported_by`),
  KEY `fk_inc_resolved_by` (`resolved_by`),
  KEY `idx_inc_sev_id` (`severity_id`),
  CONSTRAINT `fk_inc_reported_by` FOREIGN KEY (`reported_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_inc_resolved_by` FOREIGN KEY (`resolved_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_inc_sev` FOREIGN KEY (`severity_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `incident_log`
--

LOCK TABLES `incident_log` WRITE;
/*!40000 ALTER TABLE `incident_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `incident_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_inc_sync` BEFORE INSERT ON `incident_log` FOR EACH ROW BEGIN
  CALL ref_touch('severity', NEW.severity, NEW.severity);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.severity_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_incident_log_ai_audit` AFTER INSERT ON `incident_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'incident_log', 'IncidentLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('incident_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_inc_sync_u` BEFORE UPDATE ON `incident_log` FOR EACH ROW BEGIN
  IF (NEW.severity <=> OLD.severity) = 0 THEN
    CALL ref_touch('severity', NEW.severity, NEW.severity);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.severity_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_incident_log_au_audit` AFTER UPDATE ON `incident_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'incident_log', 'IncidentLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('incident_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_incident_log_ad_audit` AFTER DELETE ON `incident_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'incident_log', 'IncidentLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('incident_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary view structure for view `incidents`
--

DROP TABLE IF EXISTS `incidents`;
/*!50001 DROP VIEW IF EXISTS `incidents`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `incidents` AS SELECT 
 1 AS `id`,
 1 AS `detected_at`,
 1 AS `reported_by`,
 1 AS `severity`,
 1 AS `title`,
 1 AS `description`,
 1 AS `resolved`,
 1 AS `resolved_at`,
 1 AS `resolved_by`,
 1 AS `actions_taken`,
 1 AS `follow_up`,
 1 AS `note`,
 1 AS `source_ip`,
 1 AS `created_at`,
 1 AS `updated_at`,
 1 AS `severity_id`,
 1 AS `reported_by_id`,
 1 AS `resolved_by_id`,
 1 AS `digital_signature`,
 1 AS `root_cause`,
 1 AS `capa_case_id`,
 1 AS `capa_case`,
 1 AS `attachments`,
 1 AS `last_modified`,
 1 AS `last_modified_by_id`,
 1 AS `last_modified_by`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `inspections`
--

DROP TABLE IF EXISTS `inspections`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `inspections` (
  `id` int NOT NULL AUTO_INCREMENT,
  `inspection_date` date DEFAULT NULL,
  `inspector_name` varchar(100) DEFAULT NULL,
  `type` enum('HALMED','interni','drugi') DEFAULT NULL,
  `result` enum('prolaz','pao','napomena') DEFAULT NULL,
  `related_machine` int DEFAULT NULL,
  `doc_file` varchar(255) DEFAULT NULL,
  `notes` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `type_id` int DEFAULT NULL,
  `result_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_insp_machine` (`related_machine`),
  KEY `idx_insp_type_id` (`type_id`),
  KEY `idx_insp_result_id` (`result_id`),
  CONSTRAINT `fk_insp_machine` FOREIGN KEY (`related_machine`) REFERENCES `machines` (`id`),
  CONSTRAINT `fk_insp_result` FOREIGN KEY (`result_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_insp_type` FOREIGN KEY (`type_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `inspections`
--

LOCK TABLES `inspections` WRITE;
/*!40000 ALTER TABLE `inspections` DISABLE KEYS */;
/*!40000 ALTER TABLE `inspections` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_insp_sync` BEFORE INSERT ON `inspections` FOR EACH ROW BEGIN
  CALL ref_touch('inspection_type', NEW.type, NEW.type);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.type_id = LAST_INSERT_ID(); END IF;
  CALL ref_touch('inspection_result', NEW.result, NEW.result);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.result_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_inspections_ai_audit` AFTER INSERT ON `inspections` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'inspections', 'InspectionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('inspections insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_insp_sync_u` BEFORE UPDATE ON `inspections` FOR EACH ROW BEGIN
  IF (NEW.type <=> OLD.type) = 0 THEN
    CALL ref_touch('inspection_type', NEW.type, NEW.type);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.type_id = LAST_INSERT_ID(); END IF;
  END IF;
  IF (NEW.result <=> OLD.result) = 0 THEN
    CALL ref_touch('inspection_result', NEW.result, NEW.result);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.result_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_inspections_au_audit` AFTER UPDATE ON `inspections` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'inspections', 'InspectionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('inspections update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_inspections_ad_audit` AFTER DELETE ON `inspections` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'inspections', 'InspectionsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('inspections delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `integration_log`
--

DROP TABLE IF EXISTS `integration_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `integration_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `system_name` varchar(100) DEFAULT NULL,
  `api_endpoint` varchar(255) DEFAULT NULL,
  `request_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `request_json` longtext,
  `response_json` longtext,
  `status_code` int DEFAULT NULL,
  `processed` tinyint(1) DEFAULT '0',
  `processed_at` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `integration_log`
--

LOCK TABLES `integration_log` WRITE;
/*!40000 ALTER TABLE `integration_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `integration_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_integration_log_ai_audit` AFTER INSERT ON `integration_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'integration_log', 'IntegrationLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('integration_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_integration_log_au_audit` AFTER UPDATE ON `integration_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'integration_log', 'IntegrationLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('integration_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_integration_log_ad_audit` AFTER DELETE ON `integration_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'integration_log', 'IntegrationLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('integration_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `inventory_locations`
--

DROP TABLE IF EXISTS `inventory_locations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `inventory_locations` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(150) NOT NULL,
  `location_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`),
  KEY `fk_inv_loc_location` (`location_id`),
  CONSTRAINT `fk_inv_loc_location` FOREIGN KEY (`location_id`) REFERENCES `locations` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `inventory_locations`
--

LOCK TABLES `inventory_locations` WRITE;
/*!40000 ALTER TABLE `inventory_locations` DISABLE KEYS */;
/*!40000 ALTER TABLE `inventory_locations` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `inventory_transactions`
--

DROP TABLE IF EXISTS `inventory_transactions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `inventory_transactions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `part_id` int DEFAULT NULL,
  `warehouse_id` int DEFAULT NULL,
  `transaction_type` enum('in','out','transfer','adjust','damage','obsolete') DEFAULT NULL,
  `quantity` int DEFAULT NULL,
  `transaction_date` datetime DEFAULT CURRENT_TIMESTAMP,
  `performed_by` int DEFAULT NULL,
  `related_document` varchar(255) DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `performed_by_id` int DEFAULT NULL,
  `spare_part?` varchar(255) DEFAULT NULL,
  `warehouse?` varchar(255) DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_it_part` (`part_id`),
  KEY `fk_it_warehouse` (`warehouse_id`),
  KEY `fk_it_user` (`performed_by`),
  CONSTRAINT `fk_it_part` FOREIGN KEY (`part_id`) REFERENCES `parts` (`id`),
  CONSTRAINT `fk_it_user` FOREIGN KEY (`performed_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_it_warehouse` FOREIGN KEY (`warehouse_id`) REFERENCES `warehouses` (`id`),
  CONSTRAINT `chk_it_qty_nonneg` CHECK (((`quantity` is null) or (`quantity` >= 0)))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `inventory_transactions`
--

LOCK TABLES `inventory_transactions` WRITE;
/*!40000 ALTER TABLE `inventory_transactions` DISABLE KEYS */;
/*!40000 ALTER TABLE `inventory_transactions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_inventory_transactions_ai_audit` AFTER INSERT ON `inventory_transactions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'inventory_transactions', 'InventoryTransactionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('inventory_transactions insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_inventory_transactions_au_audit` AFTER UPDATE ON `inventory_transactions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'inventory_transactions', 'InventoryTransactionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('inventory_transactions update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_inventory_transactions_ad_audit` AFTER DELETE ON `inventory_transactions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'inventory_transactions', 'InventoryTransactionsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('inventory_transactions delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `iot_anomaly_log`
--

DROP TABLE IF EXISTS `iot_anomaly_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `iot_anomaly_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `sensor_data_id` int DEFAULT NULL,
  `detected_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `detected_by` varchar(100) DEFAULT NULL,
  `description` text,
  `severity` enum('low','medium','high','critical') DEFAULT NULL,
  `resolved` tinyint(1) DEFAULT '0',
  `resolved_at` datetime DEFAULT NULL,
  `resolution_note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_ial_sensor` (`sensor_data_id`),
  CONSTRAINT `fk_ial_sensor` FOREIGN KEY (`sensor_data_id`) REFERENCES `iot_sensor_data` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `iot_anomaly_log`
--

LOCK TABLES `iot_anomaly_log` WRITE;
/*!40000 ALTER TABLE `iot_anomaly_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `iot_anomaly_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_anomaly_log_ai_audit` AFTER INSERT ON `iot_anomaly_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'iot_anomaly_log', 'IotAnomalyLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_anomaly_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_anomaly_log_au_audit` AFTER UPDATE ON `iot_anomaly_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'iot_anomaly_log', 'IotAnomalyLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_anomaly_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_anomaly_log_ad_audit` AFTER DELETE ON `iot_anomaly_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'iot_anomaly_log', 'IotAnomalyLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('iot_anomaly_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `iot_devices`
--

DROP TABLE IF EXISTS `iot_devices`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `iot_devices` (
  `id` int NOT NULL AUTO_INCREMENT,
  `device_uid` varchar(120) NOT NULL,
  `vendor` varchar(120) DEFAULT NULL,
  `model` varchar(120) DEFAULT NULL,
  `firmware` varchar(80) DEFAULT NULL,
  `gateway_id` int DEFAULT NULL,
  `last_seen` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `device_uid` (`device_uid`),
  KEY `fk_dev_gw` (`gateway_id`),
  CONSTRAINT `fk_dev_gw` FOREIGN KEY (`gateway_id`) REFERENCES `iot_gateways` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `iot_devices`
--

LOCK TABLES `iot_devices` WRITE;
/*!40000 ALTER TABLE `iot_devices` DISABLE KEYS */;
/*!40000 ALTER TABLE `iot_devices` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_devices_ai_audit` AFTER INSERT ON `iot_devices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'iot_devices', 'IotDevicesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_devices insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_devices_au_audit` AFTER UPDATE ON `iot_devices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'iot_devices', 'IotDevicesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_devices update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_devices_ad_audit` AFTER DELETE ON `iot_devices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'iot_devices', 'IotDevicesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('iot_devices delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `iot_event_audit`
--

DROP TABLE IF EXISTS `iot_event_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `iot_event_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `iot_event_audit`
--

LOCK TABLES `iot_event_audit` WRITE;
/*!40000 ALTER TABLE `iot_event_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `iot_event_audit` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_event_audit_ai_audit` AFTER INSERT ON `iot_event_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'iot_event_audit', 'IotEventAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_event_audit insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_event_audit_au_audit` AFTER UPDATE ON `iot_event_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'iot_event_audit', 'IotEventAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_event_audit update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_event_audit_ad_audit` AFTER DELETE ON `iot_event_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'iot_event_audit', 'IotEventAuditPage', OLD.id, NULL,
     NULL, NULL, CONCAT('iot_event_audit delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `iot_gateways`
--

DROP TABLE IF EXISTS `iot_gateways`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `iot_gateways` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(80) DEFAULT NULL,
  `name` varchar(120) DEFAULT NULL,
  `location_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  KEY `fk_gw_loc` (`location_id`),
  CONSTRAINT `fk_gw_loc` FOREIGN KEY (`location_id`) REFERENCES `locations` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `iot_gateways`
--

LOCK TABLES `iot_gateways` WRITE;
/*!40000 ALTER TABLE `iot_gateways` DISABLE KEYS */;
/*!40000 ALTER TABLE `iot_gateways` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_gateways_ai_audit` AFTER INSERT ON `iot_gateways` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'iot_gateways', 'IotGatewaysPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_gateways insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_gateways_au_audit` AFTER UPDATE ON `iot_gateways` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'iot_gateways', 'IotGatewaysPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_gateways update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'iot_gateways', 'IotGatewaysPage', NEW.id, 'code',
       OLD.code, NEW.code, 'iot_gateways update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'iot_gateways', 'IotGatewaysPage', NEW.id, 'name',
       OLD.name, NEW.name, 'iot_gateways update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_gateways_ad_audit` AFTER DELETE ON `iot_gateways` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'iot_gateways', 'IotGatewaysPage', OLD.id, NULL,
     NULL, NULL, CONCAT('iot_gateways delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `iot_sensor_data`
--

DROP TABLE IF EXISTS `iot_sensor_data`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `iot_sensor_data` (
  `id` int NOT NULL AUTO_INCREMENT,
  `device_id` varchar(80) DEFAULT NULL,
  `component_id` int DEFAULT NULL,
  `data_type` varchar(50) DEFAULT NULL,
  `value` decimal(12,4) DEFAULT NULL,
  `unit` varchar(20) DEFAULT NULL,
  `timestamp` datetime DEFAULT NULL,
  `status` enum('ok','alert','out_of_range') DEFAULT NULL,
  `anomaly_detected` tinyint(1) DEFAULT '0',
  `processed` tinyint(1) DEFAULT '0',
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `unit_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_isd_component` (`component_id`),
  KEY `fk_isd_unit` (`unit_id`),
  KEY `idx_isd_device_time` (`device_id`,`timestamp`),
  CONSTRAINT `fk_isd_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_isd_unit` FOREIGN KEY (`unit_id`) REFERENCES `units` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `iot_sensor_data`
--

LOCK TABLES `iot_sensor_data` WRITE;
/*!40000 ALTER TABLE `iot_sensor_data` DISABLE KEYS */;
/*!40000 ALTER TABLE `iot_sensor_data` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_sensor_data_ai_audit` AFTER INSERT ON `iot_sensor_data` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'iot_sensor_data', 'IotSensorDataPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_sensor_data insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_sensor_data_au_audit` AFTER UPDATE ON `iot_sensor_data` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'iot_sensor_data', 'IotSensorDataPage', NEW.id, NULL,
     NULL, NULL, CONCAT('iot_sensor_data update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_iot_sensor_data_ad_audit` AFTER DELETE ON `iot_sensor_data` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'iot_sensor_data', 'IotSensorDataPage', OLD.id, NULL,
     NULL, NULL, CONCAT('iot_sensor_data delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `irregularities_log`
--

DROP TABLE IF EXISTS `irregularities_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `irregularities_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `related_type` enum('work_order','component','machine','inspection','capa_case','training','validation') DEFAULT NULL,
  `related_id` int DEFAULT NULL,
  `user_id` int DEFAULT NULL,
  `description` text,
  `detected_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `status` enum('otvoreno','zatvoreno') DEFAULT 'otvoreno',
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `details` text GENERATED ALWAYS AS (`description`) VIRTUAL,
  PRIMARY KEY (`id`),
  KEY `fk_irr_user` (`user_id`),
  CONSTRAINT `fk_irr_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `irregularities_log`
--

LOCK TABLES `irregularities_log` WRITE;
/*!40000 ALTER TABLE `irregularities_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `irregularities_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_irregularities_log_ai_audit` AFTER INSERT ON `irregularities_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'irregularities_log', 'IrregularitiesLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('irregularities_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_irregularities_log_au_audit` AFTER UPDATE ON `irregularities_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'irregularities_log', 'IrregularitiesLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('irregularities_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_irregularities_log_ad_audit` AFTER DELETE ON `irregularities_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'irregularities_log', 'IrregularitiesLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('irregularities_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `job_titles`
--

DROP TABLE IF EXISTS `job_titles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `job_titles` (
  `id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(100) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `title` (`title`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `job_titles`
--

LOCK TABLES `job_titles` WRITE;
/*!40000 ALTER TABLE `job_titles` DISABLE KEYS */;
/*!40000 ALTER TABLE `job_titles` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_job_titles_ai_audit` AFTER INSERT ON `job_titles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'job_titles', 'JobTitlesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('job_titles insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_job_titles_au_audit` AFTER UPDATE ON `job_titles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'job_titles', 'JobTitlesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('job_titles update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_job_titles_ad_audit` AFTER DELETE ON `job_titles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'job_titles', 'JobTitlesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('job_titles delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `lkp_machine_types`
--

DROP TABLE IF EXISTS `lkp_machine_types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `lkp_machine_types` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL,
  `code` varchar(16) GENERATED ALWAYS AS (upper(left(`name`,3))) VIRTUAL,
  `is_active` tinyint(1) NOT NULL DEFAULT '1',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `lkp_machine_types`
--

LOCK TABLES `lkp_machine_types` WRITE;
/*!40000 ALTER TABLE `lkp_machine_types` DISABLE KEYS */;
/*!40000 ALTER TABLE `lkp_machine_types` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `lkp_status`
--

DROP TABLE IF EXISTS `lkp_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `lkp_status` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(60) NOT NULL,
  `is_active` tinyint(1) NOT NULL DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `lkp_status`
--

LOCK TABLES `lkp_status` WRITE;
/*!40000 ALTER TABLE `lkp_status` DISABLE KEYS */;
INSERT INTO `lkp_status` VALUES (1,'U pogonu',1,'2025-09-09 12:36:24','2025-09-09 12:36:24'),(2,'Van pogona',1,'2025-09-09 12:36:24','2025-09-09 12:36:24'),(3,'U validaciji',1,'2025-09-09 12:36:24','2025-09-09 12:36:24'),(4,'Otvoreno',1,'2025-09-09 12:36:24','2025-09-09 12:36:24'),(5,'U tijeku',1,'2025-09-09 12:36:24','2025-09-09 12:36:24'),(6,'Zatvoreno',1,'2025-09-09 12:36:24','2025-09-09 12:36:24');
/*!40000 ALTER TABLE `lkp_status` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `lkp_work_order_types`
--

DROP TABLE IF EXISTS `lkp_work_order_types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `lkp_work_order_types` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(60) NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `lkp_work_order_types`
--

LOCK TABLES `lkp_work_order_types` WRITE;
/*!40000 ALTER TABLE `lkp_work_order_types` DISABLE KEYS */;
INSERT INTO `lkp_work_order_types` VALUES (1,'Korektivno','2025-09-09 12:36:24','2025-09-09 12:36:24'),(2,'Preventivno','2025-09-09 12:36:24','2025-09-09 12:36:24'),(3,'Vanredno','2025-09-09 12:36:24','2025-09-09 12:36:24');
/*!40000 ALTER TABLE `lkp_work_order_types` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `locations`
--

DROP TABLE IF EXISTS `locations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `locations` (
  `id` int NOT NULL AUTO_INCREMENT,
  `parent_id` int DEFAULT NULL,
  `code` varchar(50) DEFAULT NULL,
  `name` varchar(150) NOT NULL,
  `type` enum('site','building','area','room','zone','warehouse') NOT NULL DEFAULT 'site',
  `address` varchar(255) DEFAULT NULL,
  `city` varchar(100) DEFAULT NULL,
  `country` varchar(100) DEFAULT NULL,
  `gps_lat` decimal(10,7) DEFAULT NULL,
  `gps_lng` decimal(10,7) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  KEY `fk_loc_parent` (`parent_id`),
  CONSTRAINT `fk_loc_parent` FOREIGN KEY (`parent_id`) REFERENCES `locations` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `locations`
--

LOCK TABLES `locations` WRITE;
/*!40000 ALTER TABLE `locations` DISABLE KEYS */;
INSERT INTO `locations` VALUES (1,NULL,NULL,'108 OPREM','site',NULL,NULL,NULL,NULL,NULL,'2025-09-10 10:01:09','2025-09-10 10:01:09'),(2,NULL,NULL,'Hala','site',NULL,NULL,NULL,NULL,NULL,'2025-09-10 13:20:49','2025-09-10 13:20:49');
/*!40000 ALTER TABLE `locations` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_locations_ai_audit` AFTER INSERT ON `locations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'locations', 'LocationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('locations insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_locations_au_audit` AFTER UPDATE ON `locations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'locations', 'LocationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('locations update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'locations', 'LocationsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'locations update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'locations', 'LocationsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'locations update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_locations_ad_audit` AFTER DELETE ON `locations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'locations', 'LocationsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('locations delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `lookup_domain`
--

DROP TABLE IF EXISTS `lookup_domain`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `lookup_domain` (
  `id` int NOT NULL AUTO_INCREMENT,
  `domain_code` varchar(50) DEFAULT NULL,
  `description` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `domain_code` (`domain_code`)
) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `lookup_domain`
--

LOCK TABLES `lookup_domain` WRITE;
/*!40000 ALTER TABLE `lookup_domain` DISABLE KEYS */;
INSERT INTO `lookup_domain` VALUES (1,'status','Generic status','2025-08-28 07:24:44','2025-08-28 12:36:25'),(2,'priority','Work-order priority','2025-08-28 07:24:44','2025-08-28 12:36:25'),(3,'severity','Incident / anomaly severity','2025-08-28 07:24:44','2025-08-28 12:36:25'),(4,'result','Pass / fail style','2025-08-28 07:24:44','2025-08-28 12:36:25'),(5,'document_type','Attachment / photo type','2025-08-28 07:24:44','2025-08-28 12:36:25'),(6,'inspection_result',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(7,'calibration_result',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(8,'asset_status',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(9,'lifecycle_phase',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(10,'component_status',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(11,'sensor_type',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(12,'quality_event_type',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(13,'quality_status',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(14,'capa_status',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(15,'capa_action_type',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(16,'supplier_status',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(17,'supplier_type',NULL,'2025-08-28 10:24:01','2025-08-28 12:36:25');
/*!40000 ALTER TABLE `lookup_domain` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_lookup_domain_ai_audit` AFTER INSERT ON `lookup_domain` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'lookup_domain', 'LookupDomainPage', NEW.id, NULL,
     NULL, NULL, CONCAT('lookup_domain insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_lookup_domain_au_audit` AFTER UPDATE ON `lookup_domain` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'lookup_domain', 'LookupDomainPage', NEW.id, NULL,
     NULL, NULL, CONCAT('lookup_domain update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_lookup_domain_ad_audit` AFTER DELETE ON `lookup_domain` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'lookup_domain', 'LookupDomainPage', OLD.id, NULL,
     NULL, NULL, CONCAT('lookup_domain delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `lookup_value`
--

DROP TABLE IF EXISTS `lookup_value`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `lookup_value` (
  `id` int NOT NULL AUTO_INCREMENT,
  `domain_id` int NOT NULL,
  `value_code` varchar(100) DEFAULT NULL,
  `value_label` varchar(100) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT '1',
  `sort_order` int DEFAULT '0',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_domain_code` (`domain_id`,`value_code`),
  CONSTRAINT `fk_lk_domain` FOREIGN KEY (`domain_id`) REFERENCES `lookup_domain` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=287 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `lookup_value`
--

LOCK TABLES `lookup_value` WRITE;
/*!40000 ALTER TABLE `lookup_value` DISABLE KEYS */;
INSERT INTO `lookup_value` VALUES (1,1,'active','Active',1,1,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(2,1,'maintenance','Maintenance',1,2,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(3,1,'decommissioned','Decommissioned',1,3,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(4,1,'open','Open',1,4,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(5,1,'closed','Closed',1,5,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(6,2,'low','Low',1,1,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(7,2,'medium','Medium',1,2,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(8,2,'high','High',1,3,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(9,2,'critical','Critical',1,4,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(10,3,'low','Low',1,1,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(11,3,'medium','Medium',1,2,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(12,3,'high','High',1,3,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(13,3,'critical','Critical',1,4,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(14,3,'gmp','GMP',1,5,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(15,4,'pass','Pass',1,1,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(16,4,'fail','Fail',1,2,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(17,4,'note','Note',1,3,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(18,5,'sop','SOP',1,1,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(19,5,'inspection','Inspection',1,2,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(20,5,'before','Before',1,3,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(21,5,'after','After',1,4,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(22,5,'other','Other',1,5,'2025-08-28 07:24:44','2025-08-28 12:36:25'),(24,6,'prolaz','Prolaz',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(25,6,'pao','Pao',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(26,6,'napomena','Napomena',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(27,7,'prolaz','Prolaz',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(28,7,'pao','Pao',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(29,7,'uvjetno','Uvjetno',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(30,7,'napomena','Napomena',1,40,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(31,8,'active','Active',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(32,8,'maintenance','Maintenance',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(33,8,'decommissioned','Decommissioned',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(34,8,'reserved','Reserved',1,40,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(35,8,'scrapped','Scrapped',1,50,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(36,9,'concept','Concept',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(37,9,'commissioning','Commissioning',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(38,9,'operation','Operation',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(39,9,'retirement','Retirement',1,40,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(40,10,'active','Active',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(41,10,'removed','Removed',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(42,10,'maintenance','Maintenance',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(43,11,'temperatura','Temperatura',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(44,11,'tlak','Tlak',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(45,11,'vlaga','Vlaga',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(46,11,'protok','Protok',1,40,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(47,11,'drugo','Drugo',1,50,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(48,12,'deviation','Deviation',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(49,12,'complaint','Complaint',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(50,12,'recall','Recall',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(51,12,'out_of_spec','Out of spec',1,40,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(52,12,'change_control','Change control',1,50,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(53,12,'audit','Audit',1,60,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(54,12,'training','Training',1,70,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(55,13,'open','Open',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(56,13,'under_review','Under review',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(57,13,'closed','Closed',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(58,14,'otvoren','Otvoren',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(59,14,'u_tijeku','U tijeku',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(60,14,'zatvoren','Zatvoren',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(61,15,'korektivna','Korektivna',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(62,15,'preventivna','Preventivna',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(63,16,'active','Active',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(64,16,'suspended','Suspended',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(65,16,'obsolete','Obsolete',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(66,17,'manufacturer','Manufacturer',1,10,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(67,17,'distributor','Distributor',1,20,'2025-08-28 10:24:01','2025-08-28 12:36:25'),(68,17,'service','Service',1,30,'2025-08-28 10:24:01','2025-08-28 12:36:25');
/*!40000 ALTER TABLE `lookup_value` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_lookup_value_ai_audit` AFTER INSERT ON `lookup_value` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'lookup_value', 'LookupValuePage', NEW.id, NULL,
     NULL, NULL, CONCAT('lookup_value insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_lookup_value_au_audit` AFTER UPDATE ON `lookup_value` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'lookup_value', 'LookupValuePage', NEW.id, NULL,
     NULL, NULL, CONCAT('lookup_value update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_lookup_value_ad_audit` AFTER DELETE ON `lookup_value` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'lookup_value', 'LookupValuePage', OLD.id, NULL,
     NULL, NULL, CONCAT('lookup_value delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `machine_components`
--

DROP TABLE IF EXISTS `machine_components`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `machine_components` (
  `id` int NOT NULL AUTO_INCREMENT,
  `machine_id` int DEFAULT NULL,
  `code` varchar(50) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `type` varchar(50) DEFAULT NULL,
  `sop_doc` varchar(255) DEFAULT NULL,
  `status` enum('active','removed','maintenance') DEFAULT 'active',
  `install_date` date DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `component_type_id` int DEFAULT NULL,
  `status_id` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT '0',
  `deleted_at` datetime DEFAULT NULL,
  `deleted_by` int DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `machine?` varchar(255) DEFAULT NULL,
  `description` varchar(255) DEFAULT NULL,
  `model` varchar(255) DEFAULT NULL,
  `purchase_date` datetime DEFAULT NULL,
  `warranty_until` datetime DEFAULT NULL,
  `warranty_expiry` datetime DEFAULT NULL,
  `serial_number` varchar(255) DEFAULT NULL,
  `supplier` varchar(255) DEFAULT NULL,
  `rfid_tag` varchar(255) DEFAULT NULL,
  `io_tdevice_id` varchar(255) DEFAULT NULL,
  `lifecycle_phase` varchar(255) DEFAULT NULL,
  `is_critical` tinyint(1) DEFAULT NULL,
  `note` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `notes` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `documents` varchar(255) DEFAULT NULL,
  `icollection<photo>` varchar(255) DEFAULT NULL,
  `icollection<calibration>` varchar(255) DEFAULT NULL,
  `icollection<capa_case>` varchar(255) DEFAULT NULL,
  `icollection<work_order>` varchar(255) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  KEY `fk_mc_status` (`status_id`),
  KEY `fk_comp_component_type` (`component_type_id`),
  KEY `ix_machine_components_machine_id` (`machine_id`),
  KEY `ix_machine_components_code` (`code`),
  CONSTRAINT `fk_comp_component_type` FOREIGN KEY (`component_type_id`) REFERENCES `component_types` (`id`),
  CONSTRAINT `fk_mc_machine` FOREIGN KEY (`machine_id`) REFERENCES `machines` (`id`),
  CONSTRAINT `fk_mc_status` FOREIGN KEY (`status_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_mc_type` FOREIGN KEY (`component_type_id`) REFERENCES `component_types` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `machine_components`
--

LOCK TABLES `machine_components` WRITE;
/*!40000 ALTER TABLE `machine_components` DISABLE KEYS */;
INSERT INTO `machine_components` VALUES (4,1,'50000','sonda','pumpa','2323','active',NULL,'2025-09-12 08:11:05','2025-09-12 08:11:05',NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
/*!40000 ALTER TABLE `machine_components` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_components_ai_audit` AFTER INSERT ON `machine_components` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'machine_components', 'MachineComponentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machine_components insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_components_au_audit` AFTER UPDATE ON `machine_components` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'machine_components', 'MachineComponentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machine_components update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'machine_components', 'MachineComponentsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'machine_components update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'machine_components', 'MachineComponentsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'machine_components update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_components_ad_audit` AFTER DELETE ON `machine_components` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'machine_components', 'MachineComponentsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('machine_components delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `machine_lifecycle_event`
--

DROP TABLE IF EXISTS `machine_lifecycle_event`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `machine_lifecycle_event` (
  `id` int NOT NULL AUTO_INCREMENT,
  `machine_id` int DEFAULT NULL,
  `event_type` enum('procurement','installation','maintenance','repair','upgrade','move','decommission','scrap','other') DEFAULT NULL,
  `event_date` datetime DEFAULT CURRENT_TIMESTAMP,
  `performed_by` int DEFAULT NULL,
  `notes` text,
  `doc_file` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `event_type_id` int DEFAULT NULL,
  `machine` varchar(255) DEFAULT NULL,
  `performed_by_id` int DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_mle_machine` (`machine_id`),
  KEY `fk_mle_user` (`performed_by`),
  KEY `fk_mle_type` (`event_type_id`),
  CONSTRAINT `fk_mle_machine` FOREIGN KEY (`machine_id`) REFERENCES `machines` (`id`),
  CONSTRAINT `fk_mle_type` FOREIGN KEY (`event_type_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_mle_user` FOREIGN KEY (`performed_by`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `machine_lifecycle_event`
--

LOCK TABLES `machine_lifecycle_event` WRITE;
/*!40000 ALTER TABLE `machine_lifecycle_event` DISABLE KEYS */;
/*!40000 ALTER TABLE `machine_lifecycle_event` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_mle_sync` BEFORE INSERT ON `machine_lifecycle_event` FOR EACH ROW BEGIN
  CALL ref_touch('lifecycle_phase', NEW.event_type, NEW.event_type);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.event_type_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_lifecycle_event_ai_audit` AFTER INSERT ON `machine_lifecycle_event` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'machine_lifecycle_event', 'MachineLifecycleEventPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machine_lifecycle_event insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_mle_sync_u` BEFORE UPDATE ON `machine_lifecycle_event` FOR EACH ROW BEGIN
  IF (NEW.event_type <=> OLD.event_type) = 0 THEN
    CALL ref_touch('lifecycle_phase', NEW.event_type, NEW.event_type);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.event_type_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_lifecycle_event_au_audit` AFTER UPDATE ON `machine_lifecycle_event` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'machine_lifecycle_event', 'MachineLifecycleEventPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machine_lifecycle_event update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_lifecycle_event_ad_audit` AFTER DELETE ON `machine_lifecycle_event` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'machine_lifecycle_event', 'MachineLifecycleEventPage', OLD.id, NULL,
     NULL, NULL, CONCAT('machine_lifecycle_event delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `machine_models`
--

DROP TABLE IF EXISTS `machine_models`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `machine_models` (
  `id` int NOT NULL AUTO_INCREMENT,
  `manufacturer_id` int DEFAULT NULL,
  `machine_type_id` int DEFAULT NULL,
  `model_code` varchar(100) DEFAULT NULL,
  `model_name` varchar(150) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_mach_model` (`manufacturer_id`,`model_code`),
  KEY `fk_mmodel_type` (`machine_type_id`),
  CONSTRAINT `fk_mmodel_manu` FOREIGN KEY (`manufacturer_id`) REFERENCES `manufacturers` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_mmodel_type` FOREIGN KEY (`machine_type_id`) REFERENCES `machine_types` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `machine_models`
--

LOCK TABLES `machine_models` WRITE;
/*!40000 ALTER TABLE `machine_models` DISABLE KEYS */;
INSERT INTO `machine_models` VALUES (1,4,4,'GA30','GA 30 Compressor','2025-08-28 12:36:25','2025-08-28 12:36:25'),(2,3,2,'RAA-500','RAA 500 Chiller','2025-08-28 12:36:25','2025-08-28 12:36:25'),(3,5,5,'STE-6060','STE 6060 Sterilizer','2025-08-28 12:36:25','2025-08-28 12:36:25'),(4,1,1,'S7-1200-HVAC','S7-1200 HVAC Controller','2025-08-28 12:36:25','2025-08-28 12:36:25');
/*!40000 ALTER TABLE `machine_models` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_models_ai_audit` AFTER INSERT ON `machine_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'machine_models', 'MachineModelsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machine_models insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_models_au_audit` AFTER UPDATE ON `machine_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'machine_models', 'MachineModelsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machine_models update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_models_ad_audit` AFTER DELETE ON `machine_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'machine_models', 'MachineModelsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('machine_models delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `machine_statuses`
--

DROP TABLE IF EXISTS `machine_statuses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `machine_statuses` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `machine_statuses`
--

LOCK TABLES `machine_statuses` WRITE;
/*!40000 ALTER TABLE `machine_statuses` DISABLE KEYS */;
INSERT INTO `machine_statuses` VALUES (1,'U pogon','2025-09-11 12:36:22','2025-09-11 12:36:22');
/*!40000 ALTER TABLE `machine_statuses` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `machine_types`
--

DROP TABLE IF EXISTS `machine_types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `machine_types` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(50) DEFAULT NULL,
  `name` varchar(120) NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB AUTO_INCREMENT=43 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `machine_types`
--

LOCK TABLES `machine_types` WRITE;
/*!40000 ALTER TABLE `machine_types` DISABLE KEYS */;
INSERT INTO `machine_types` VALUES (1,'HVAC','HVAC System','2025-08-28 12:36:25','2025-08-28 12:36:25'),(2,'CHILLER','Chiller','2025-08-28 12:36:25','2025-08-28 12:36:25'),(3,'PUMP','Pump','2025-08-28 12:36:25','2025-08-28 12:36:25'),(4,'COMPRESSOR','Air Compressor','2025-08-28 12:36:25','2025-08-28 12:36:25'),(5,'STERILIZER','Sterilizer/Autoclave','2025-08-28 12:36:25','2025-08-28 12:36:25'),(6,'FILLING_LINE','Filling/Packaging Line','2025-08-28 12:36:25','2025-08-28 12:36:25'),(7,'BLISTER_PKG','Blister Packaging Machine','2025-08-28 12:36:25','2025-08-28 12:36:25'),(8,'TABLET_PRESS','Tablet Press','2025-08-28 12:36:25','2025-08-28 12:36:25'),(9,'MIXER','Mixer/Agitator','2025-08-28 12:36:25','2025-08-28 12:36:25'),(10,'BIOREACTOR','Bioreactor','2025-08-28 12:36:25','2025-08-28 12:36:25'),(41,NULL,'AV','2025-09-10 10:00:22','2025-09-10 10:00:22'),(42,NULL,'PLAM','2025-09-10 13:21:08','2025-09-10 13:21:08');
/*!40000 ALTER TABLE `machine_types` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_types_ai_audit` AFTER INSERT ON `machine_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'machine_types', 'MachineTypesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machine_types insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_types_au_audit` AFTER UPDATE ON `machine_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'machine_types', 'MachineTypesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machine_types update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'machine_types', 'MachineTypesPage', NEW.id, 'code',
       OLD.code, NEW.code, 'machine_types update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'machine_types', 'MachineTypesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'machine_types update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machine_types_ad_audit` AFTER DELETE ON `machine_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'machine_types', 'MachineTypesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('machine_types delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `machines`
--

DROP TABLE IF EXISTS `machines`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `machines` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(64) NOT NULL,
  `name` varchar(100) DEFAULT NULL,
  `description` varchar(1000) DEFAULT NULL,
  `model` varchar(100) DEFAULT NULL,
  `serial_number` varchar(80) DEFAULT NULL,
  `manufacturer` varchar(100) DEFAULT NULL,
  `location` varchar(100) DEFAULT NULL,
  `install_date` date DEFAULT NULL,
  `procurement_date` date DEFAULT NULL,
  `warranty_until` date DEFAULT NULL,
  `acquisition_cost` decimal(18,2) DEFAULT NULL,
  `rfid_tag` varchar(64) DEFAULT NULL,
  `qr_code` varchar(128) DEFAULT NULL,
  `iot_device_id` varchar(64) DEFAULT NULL,
  `cloud_device_guid` varchar(64) DEFAULT NULL,
  `is_critical` tinyint(1) DEFAULT '0',
  `lifecycle_phase` varchar(30) DEFAULT NULL,
  `note` varchar(200) DEFAULT NULL,
  `status` varchar(30) NOT NULL DEFAULT 'active',
  `urs_doc` varchar(255) DEFAULT NULL,
  `decommission_date` date DEFAULT NULL,
  `decommission_reason` text,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `location_id` int DEFAULT NULL,
  `manufacturer_id` int DEFAULT NULL,
  `machine_type_id` int DEFAULT NULL,
  `status_id` int DEFAULT NULL,
  `lifecycle_phase_id` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT '0',
  `deleted_at` datetime DEFAULT NULL,
  `deleted_by` int DEFAULT NULL,
  `tenant_id` int DEFAULT NULL,
  `room_id` int DEFAULT NULL,
  `purchase_date` datetime DEFAULT NULL,
  `warranty_expiry` datetime DEFAULT NULL,
  `notes` varchar(255) DEFAULT NULL,
  `icollection<machine_component>` varchar(255) DEFAULT NULL,
  `icollection<machine_lifecycle_event>` varchar(255) DEFAULT NULL,
  `icollection<capa_case>` varchar(255) DEFAULT NULL,
  `icollection<quality_event>` varchar(255) DEFAULT NULL,
  `icollection<validation>` varchar(255) DEFAULT NULL,
  `icollection<inspection>` varchar(255) DEFAULT NULL,
  `icollection<work_order>` varchar(255) DEFAULT NULL,
  `icollection<photo>` varchar(255) DEFAULT NULL,
  `icollection<attachment>` varchar(255) DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `icollection<calibration>` varchar(255) DEFAULT NULL,
  `responsible_party_id` int DEFAULT NULL,
  `internal_code` varchar(40) DEFAULT NULL,
  `qr_payload` varchar(120) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_machines_code` (`code`),
  KEY `fk_m_last_modified_by` (`last_modified_by_id`),
  KEY `fk_machines_location` (`location_id`),
  KEY `fk_machines_manufacturer` (`manufacturer_id`),
  KEY `idx_m_status_id` (`status_id`),
  KEY `idx_m_phase_id` (`lifecycle_phase_id`),
  KEY `fk_machines_tenant_id` (`tenant_id`),
  KEY `fk_machine_room` (`room_id`),
  KEY `fk_mach_machine_type` (`machine_type_id`),
  KEY `ix_machines_party` (`responsible_party_id`),
  CONSTRAINT `fk_m_last_modified_by` FOREIGN KEY (`last_modified_by_id`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_m_phase` FOREIGN KEY (`lifecycle_phase_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_m_status` FOREIGN KEY (`status_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_mach_machine_type` FOREIGN KEY (`machine_type_id`) REFERENCES `machine_types` (`id`),
  CONSTRAINT `fk_mach_status` FOREIGN KEY (`status_id`) REFERENCES `lookup_value` (`id`),
  CONSTRAINT `fk_machine_room` FOREIGN KEY (`room_id`) REFERENCES `rooms` (`id`),
  CONSTRAINT `fk_machines_location` FOREIGN KEY (`location_id`) REFERENCES `locations` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_machines_manufacturer` FOREIGN KEY (`manufacturer_id`) REFERENCES `manufacturers` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_machines_party` FOREIGN KEY (`responsible_party_id`) REFERENCES `responsible_parties` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_machines_tenant_id` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`),
  CONSTRAINT `fk_machines_type` FOREIGN KEY (`machine_type_id`) REFERENCES `machine_types` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `machines`
--

LOCK TABLES `machines` WRITE;
/*!40000 ALTER TABLE `machines` DISABLE KEYS */;
INSERT INTO `machines` VALUES (1,'DBG-MANUAL-1','Test_manual',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,0,NULL,NULL,'active',NULL,NULL,NULL,NULL,NULL,NULL,'2025-09-12 07:22:09','2025-09-12 07:22:09',NULL,NULL,NULL,NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(11,'500','Kartonirka',NULL,'5000','654654654','CAM','108 OPREM',NULL,NULL,NULL,NULL,NULL,'C:\\Users\\amir\\AppData\\Local\\YasGMP\\YasGMP\\Data\\M_11.png',NULL,NULL,0,NULL,NULL,'active',NULL,NULL,NULL,'2025-09-12 08:23:09',NULL,NULL,'2025-09-12 08:08:53','2025-09-12 08:22:33',1,37,41,NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,1,'KAR-CAM-0001','yasgmp://machine/1');
/*!40000 ALTER TABLE `machines` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`yasgmp_app`@`localhost`*/ /*!50003 TRIGGER `trg_machines_bi_all` BEFORE INSERT ON `machines` FOR EACH ROW BEGIN
  DECLARE v_type_code VARCHAR(3);
  DECLARE v_mfr_code  VARCHAR(3);
  DECLARE v_next_id   BIGINT;

  -- name lookups are tolerant to NULL ids
  SELECT UPPER(LEFT(name,3)) INTO v_type_code FROM lkp_machine_types WHERE id = NEW.machine_type_id;
  IF v_type_code IS NULL OR v_type_code = '' THEN SET v_type_code = 'MCH'; END IF;

  SELECT UPPER(LEFT(name,3)) INTO v_mfr_code  FROM manufacturers     WHERE id = NEW.manufacturer_id;
  IF v_mfr_code  IS NULL OR v_mfr_code  = '' THEN SET v_mfr_code  = 'GEN'; END IF;

  SELECT AUTO_INCREMENT INTO v_next_id
    FROM information_schema.TABLES
   WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'machines';

  IF NEW.internal_code IS NULL OR NEW.internal_code = '' THEN
    SET NEW.internal_code = CONCAT(v_type_code,'-',v_mfr_code,'-',LPAD(COALESCE(v_next_id,1),5,'0'));
  END IF;

  IF NEW.qr_payload IS NULL OR NEW.qr_payload = '' THEN
    SET NEW.qr_payload = CONCAT('yasgmp://machine/', COALESCE(v_next_id,1));
  END IF;

  -- FINAL GUARD: ensure NEW.code is never NULL/empty
  IF NEW.code IS NULL OR CHAR_LENGTH(TRIM(NEW.code)) = 0 THEN
    SET NEW.code = CONCAT('MCH-', LPAD(COALESCE(v_next_id,1), 6, '0'));
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machines_ai_audit` AFTER INSERT ON `machines` FOR EACH ROW BEGIN
  INSERT INTO row_audit_log(table_name,row_pk,operation,before_json,after_json,actor_user_id)
  VALUES(
    'machines',
    NEW.id,
    'INSERT',
    NULL,
    JSON_OBJECT(
      'id',NEW.id,
      'name',NEW.name,
      'type',NEW.machine_type_id,
      'serial',NEW.serial_number,
      'internal_code',NEW.internal_code,
      'qr',NEW.qr_payload
    ),
    NULL
  );
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_m_sync_u` BEFORE UPDATE ON `machines` FOR EACH ROW BEGIN
  IF (NEW.status <=> OLD.status) = 0 THEN
    CALL ref_touch('asset_status', NEW.status, NEW.status);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
  END IF;
  IF (NEW.lifecycle_phase <=> OLD.lifecycle_phase) = 0 THEN
    CALL ref_touch('lifecycle_phase', NEW.lifecycle_phase, NEW.lifecycle_phase);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.lifecycle_phase_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machines_bu` BEFORE UPDATE ON `machines` FOR EACH ROW BEGIN
  SET NEW.status = fn_normalize_machine_status(NEW.status);
  SET NEW.last_modified = NOW();
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`yasgmp_app`@`localhost`*/ /*!50003 TRIGGER `trg_machines_bu_code` BEFORE UPDATE ON `machines` FOR EACH ROW BEGIN
  IF NEW.code IS NULL OR NEW.code = '' THEN
    SET NEW.code = OLD.code;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machines_au_audit` AFTER UPDATE ON `machines` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'machines', 'MachinesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('machines update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'machines', 'MachinesPage', NEW.id, 'code',
       OLD.code, NEW.code, 'machines update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'machines', 'MachinesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'machines update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machines_au` AFTER UPDATE ON `machines` FOR EACH ROW BEGIN
  INSERT INTO row_audit_log(table_name,row_pk,operation,before_json,after_json,actor_user_id)
  VALUES(
    'machines',
    NEW.id,
    'UPDATE',
    JSON_OBJECT('name',OLD.name,'status',OLD.status_id,'loc',OLD.location_id,
                'internal_code',OLD.internal_code,'qr',OLD.qr_payload),
    JSON_OBJECT('name',NEW.name,'status',NEW.status_id,'loc',NEW.location_id,
                'internal_code',NEW.internal_code,'qr',NEW.qr_payload),
    NULL
  );
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machines_bd` BEFORE DELETE ON `machines` FOR EACH ROW BEGIN
  INSERT INTO row_audit_log(table_name,row_pk,operation,before_json,after_json,actor_user_id)
  VALUES(
    'machines',
    OLD.id,
    'DELETE',
    JSON_OBJECT('name',OLD.name,'type',OLD.machine_type_id,'serial',OLD.serial_number,
                'internal_code',OLD.internal_code,'qr',OLD.qr_payload),
    NULL,
    NULL
  );
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_machines_ad_audit` AFTER DELETE ON `machines` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'machines', 'MachinesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('machines delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `manufacturers`
--

DROP TABLE IF EXISTS `manufacturers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `manufacturers` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(150) NOT NULL,
  `website` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=38 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `manufacturers`
--

LOCK TABLES `manufacturers` WRITE;
/*!40000 ALTER TABLE `manufacturers` DISABLE KEYS */;
INSERT INTO `manufacturers` VALUES (1,'Siemens','https://www.siemens.com','2025-08-28 07:24:01','2025-08-28 12:36:25'),(2,'ABB','https://global.abb','2025-08-28 07:24:01','2025-08-28 12:36:25'),(3,'GEA','https://www.gea.com','2025-08-28 07:24:01','2025-08-28 12:36:25'),(4,'Atlas Copco','https://www.atlascopco.com','2025-08-28 07:24:01','2025-08-28 12:36:25'),(5,'Binder','https://www.binder-world.com','2025-08-28 07:24:01','2025-08-28 12:36:25'),(6,'Bosch Rexroth','https://www.boschrexroth.com','2025-08-28 07:24:01','2025-08-28 12:36:25'),(7,'IFM','https://www.ifm.com','2025-08-28 07:24:01','2025-08-28 12:36:25'),(8,'Honeywell','https://www.honeywell.com','2025-08-28 07:24:01','2025-08-28 12:36:25'),(9,'Sensirion','https://sensirion.com','2025-08-28 07:24:01','2025-08-28 12:36:25'),(37,'CAM',NULL,'2025-09-10 13:20:57','2025-09-10 13:20:57');
/*!40000 ALTER TABLE `manufacturers` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_manufacturers_ai_audit` AFTER INSERT ON `manufacturers` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'manufacturers', 'ManufacturersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('manufacturers insert', CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_manufacturers_au_audit` AFTER UPDATE ON `manufacturers` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'manufacturers', 'ManufacturersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('manufacturers update', CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'manufacturers', 'ManufacturersPage', NEW.id, 'name',
       OLD.name, NEW.name, 'manufacturers update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_manufacturers_ad_audit` AFTER DELETE ON `manufacturers` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'manufacturers', 'ManufacturersPage', OLD.id, NULL,
     NULL, NULL, CONCAT('manufacturers delete', CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `measurement_units`
--

DROP TABLE IF EXISTS `measurement_units`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `measurement_units` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(10) DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `measurement_units`
--

LOCK TABLES `measurement_units` WRITE;
/*!40000 ALTER TABLE `measurement_units` DISABLE KEYS */;
INSERT INTO `measurement_units` VALUES (1,'┬░C','Degree Celsius','2025-08-28 12:36:25','2025-08-28 12:36:25'),(2,'Pa','Pascal','2025-08-28 12:36:25','2025-08-28 12:36:25'),(3,'%','Percent','2025-08-28 12:36:25','2025-08-28 12:36:25'),(4,'L/min','Liters per minute','2025-08-28 12:36:25','2025-08-28 12:36:25'),(5,'V','Volt','2025-08-28 12:36:25','2025-08-28 12:36:25'),(6,'A','Ampere','2025-08-28 12:36:25','2025-08-28 12:36:25');
/*!40000 ALTER TABLE `measurement_units` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_measurement_units_ai_audit` AFTER INSERT ON `measurement_units` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'measurement_units', 'MeasurementUnitsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('measurement_units insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_measurement_units_au_audit` AFTER UPDATE ON `measurement_units` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'measurement_units', 'MeasurementUnitsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('measurement_units update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'measurement_units', 'MeasurementUnitsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'measurement_units update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'measurement_units', 'MeasurementUnitsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'measurement_units update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_measurement_units_ad_audit` AFTER DELETE ON `measurement_units` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'measurement_units', 'MeasurementUnitsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('measurement_units delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mobile_device_log`
--

DROP TABLE IF EXISTS `mobile_device_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `mobile_device_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `login_time` datetime DEFAULT NULL,
  `logout_time` datetime DEFAULT NULL,
  `os_version` varchar(50) DEFAULT NULL,
  `location` varchar(100) DEFAULT NULL,
  `ip_address` varchar(45) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_mdl_user` (`user_id`),
  CONSTRAINT `fk_mdl_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `mobile_device_log`
--

LOCK TABLES `mobile_device_log` WRITE;
/*!40000 ALTER TABLE `mobile_device_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `mobile_device_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_mobile_device_log_ai_audit` AFTER INSERT ON `mobile_device_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'mobile_device_log', 'MobileDeviceLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('mobile_device_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_mobile_device_log_au_audit` AFTER UPDATE ON `mobile_device_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'mobile_device_log', 'MobileDeviceLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('mobile_device_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_mobile_device_log_ad_audit` AFTER DELETE ON `mobile_device_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'mobile_device_log', 'MobileDeviceLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('mobile_device_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification_queue`
--

DROP TABLE IF EXISTS `notification_queue`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `notification_queue` (
  `id` int NOT NULL AUTO_INCREMENT,
  `template_id` int DEFAULT NULL,
  `recipient_user_id` int DEFAULT NULL,
  `channel` enum('email','sms','push','webhook') DEFAULT 'email',
  `payload` json DEFAULT NULL,
  `scheduled_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `sent_at` datetime DEFAULT NULL,
  `status` enum('queued','sent','failed') DEFAULT 'queued',
  `last_error` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_nq_tpl` (`template_id`),
  KEY `fk_nq_user` (`recipient_user_id`),
  CONSTRAINT `fk_nq_tpl` FOREIGN KEY (`template_id`) REFERENCES `notification_templates` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_nq_user` FOREIGN KEY (`recipient_user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `notification_queue`
--

LOCK TABLES `notification_queue` WRITE;
/*!40000 ALTER TABLE `notification_queue` DISABLE KEYS */;
/*!40000 ALTER TABLE `notification_queue` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_notification_queue_ai_audit` AFTER INSERT ON `notification_queue` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'notification_queue', 'NotificationQueuePage', NEW.id, NULL,
     NULL, NULL, CONCAT('notification_queue insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_notification_queue_au_audit` AFTER UPDATE ON `notification_queue` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'notification_queue', 'NotificationQueuePage', NEW.id, NULL,
     NULL, NULL, CONCAT('notification_queue update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_notification_queue_ad_audit` AFTER DELETE ON `notification_queue` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'notification_queue', 'NotificationQueuePage', OLD.id, NULL,
     NULL, NULL, CONCAT('notification_queue delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification_templates`
--

DROP TABLE IF EXISTS `notification_templates`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `notification_templates` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(80) DEFAULT NULL,
  `name` varchar(150) DEFAULT NULL,
  `subject` varchar(255) DEFAULT NULL,
  `body` text,
  `channel` enum('email','sms','push','webhook') DEFAULT 'email',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB AUTO_INCREMENT=33 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `notification_templates`
--

LOCK TABLES `notification_templates` WRITE;
/*!40000 ALTER TABLE `notification_templates` DISABLE KEYS */;
INSERT INTO `notification_templates` VALUES (1,'WO_ASSIGNED','Work Order Assigned','WO #{work_order_id} assigned','Hello {{assignee}}, Work Order #{{work_order_id}} was assigned. Machine: {{machine_name}} / Component: {{component_name}}.','email','2025-08-28 12:36:25','2025-08-28 12:36:25'),(2,'WO_OVERDUE','Work Order Overdue','WO #{work_order_id} is overdue','Work Order #{{work_order_id}} is overdue. Status: {{status_name}}.','email','2025-08-28 12:36:25','2025-08-28 12:36:25'),(3,'CALIB_DUE','Calibration Due','Calibration due: {{component_name}}','Calibration for {{component_name}} is due on {{next_due}}.','email','2025-08-28 12:36:25','2025-08-28 12:36:25'),(4,'STOCK_BELOW_MIN','Stock Below Min','Stock alert: {{part_code}}','Part {{part_code}} is below minimum in {{warehouse_name}}.','email','2025-08-28 12:36:25','2025-08-28 12:36:25'),(5,'INCIDENT_REPORTED','Incident Reported','Incident {{severity}} reported','Incident \"{{title}}\" reported by {{reported_by}}.','email','2025-08-28 12:36:25','2025-08-28 12:36:25'),(6,'QE_STATUS_CHANGE','Quality Event Status','Quality event status changed','Quality Event #{{qe_id}} is now {{status_name}}.','email','2025-08-28 12:36:25','2025-08-28 12:36:25'),(7,'CAPA_DUE','CAPA Action Due','CAPA action due','CAPA #{{capa_id}} action due {{due_date}}.','email','2025-08-28 12:36:25','2025-08-28 12:36:25'),(8,'SENSOR_ANOMALY','Sensor Anomaly','Anomaly on {{component_name}}','Anomaly detected by {{algorithm}} at {{timestamp}}. Value: {{value}} {{unit}}.','email','2025-08-28 12:36:25','2025-08-28 12:36:25');
/*!40000 ALTER TABLE `notification_templates` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_notification_templates_ai_audit` AFTER INSERT ON `notification_templates` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'notification_templates', 'NotificationTemplatesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('notification_templates insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_notification_templates_au_audit` AFTER UPDATE ON `notification_templates` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'notification_templates', 'NotificationTemplatesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('notification_templates update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'notification_templates', 'NotificationTemplatesPage', NEW.id, 'code',
       OLD.code, NEW.code, 'notification_templates update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'notification_templates', 'NotificationTemplatesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'notification_templates update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_notification_templates_ad_audit` AFTER DELETE ON `notification_templates` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'notification_templates', 'NotificationTemplatesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('notification_templates delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary view structure for view `notifications`
--

DROP TABLE IF EXISTS `notifications`;
/*!50001 DROP VIEW IF EXISTS `notifications`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `notifications` AS SELECT 
 1 AS `id`,
 1 AS `template_id`,
 1 AS `recipient_user_id`,
 1 AS `channel`,
 1 AS `payload`,
 1 AS `scheduled_at`,
 1 AS `sent_at`,
 1 AS `status`,
 1 AS `last_error`,
 1 AS `created_at`,
 1 AS `updated_at`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `part_bom`
--

DROP TABLE IF EXISTS `part_bom`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `part_bom` (
  `id` int NOT NULL AUTO_INCREMENT,
  `parent_part_id` int NOT NULL,
  `child_part_id` int NOT NULL,
  `quantity` decimal(10,3) NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_bom` (`parent_part_id`,`child_part_id`),
  KEY `fk_bom_child` (`child_part_id`),
  CONSTRAINT `fk_bom_child` FOREIGN KEY (`child_part_id`) REFERENCES `parts` (`id`) ON DELETE RESTRICT,
  CONSTRAINT `fk_bom_parent` FOREIGN KEY (`parent_part_id`) REFERENCES `parts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `part_bom_chk_1` CHECK ((`quantity` > 0))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `part_bom`
--

LOCK TABLES `part_bom` WRITE;
/*!40000 ALTER TABLE `part_bom` DISABLE KEYS */;
/*!40000 ALTER TABLE `part_bom` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_part_bom_ai_audit` AFTER INSERT ON `part_bom` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'part_bom', 'PartBomPage', NEW.id, NULL,
     NULL, NULL, CONCAT('part_bom insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_part_bom_au_audit` AFTER UPDATE ON `part_bom` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'part_bom', 'PartBomPage', NEW.id, NULL,
     NULL, NULL, CONCAT('part_bom update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_part_bom_ad_audit` AFTER DELETE ON `part_bom` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'part_bom', 'PartBomPage', OLD.id, NULL,
     NULL, NULL, CONCAT('part_bom delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `part_stocks`
--

DROP TABLE IF EXISTS `part_stocks`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `part_stocks` (
  `id` int NOT NULL AUTO_INCREMENT,
  `part_id` int NOT NULL,
  `inventory_location_id` int NOT NULL,
  `qty` int NOT NULL DEFAULT '0',
  `min_qty` int NOT NULL DEFAULT '0',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_part_stock` (`part_id`,`inventory_location_id`),
  KEY `fk_stock_loc` (`inventory_location_id`),
  CONSTRAINT `fk_stock_loc` FOREIGN KEY (`inventory_location_id`) REFERENCES `inventory_locations` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_stock_part` FOREIGN KEY (`part_id`) REFERENCES `parts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `part_stocks`
--

LOCK TABLES `part_stocks` WRITE;
/*!40000 ALTER TABLE `part_stocks` DISABLE KEYS */;
/*!40000 ALTER TABLE `part_stocks` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `part_supplier_prices`
--

DROP TABLE IF EXISTS `part_supplier_prices`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `part_supplier_prices` (
  `id` int NOT NULL AUTO_INCREMENT,
  `part_id` int DEFAULT NULL,
  `supplier_id` int DEFAULT NULL,
  `unit_price` decimal(10,2) DEFAULT NULL,
  `currency` varchar(10) DEFAULT NULL,
  `valid_until` date DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `part` varchar(255) DEFAULT NULL,
  `supplier` varchar(255) DEFAULT NULL,
  `supplier_name` varchar(255) DEFAULT NULL,
  `vat_percent` decimal(10,2) DEFAULT NULL,
  `price_with_vat` decimal(10,2) DEFAULT NULL,
  `region` varchar(255) DEFAULT NULL,
  `discount_percent` decimal(10,2) DEFAULT NULL,
  `surcharge` decimal(10,2) DEFAULT NULL,
  `min_order_quantity` int DEFAULT NULL,
  `lead_time_days` int DEFAULT NULL,
  `valid_from` datetime DEFAULT NULL,
  `is_blocked` tinyint(1) DEFAULT NULL,
  `block_reason` varchar(255) DEFAULT NULL,
  `contract_document` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `note` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_psp_part` (`part_id`),
  KEY `fk_psp_supplier` (`supplier_id`),
  CONSTRAINT `fk_psp_part` FOREIGN KEY (`part_id`) REFERENCES `parts` (`id`),
  CONSTRAINT `fk_psp_supplier` FOREIGN KEY (`supplier_id`) REFERENCES `suppliers` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `part_supplier_prices`
--

LOCK TABLES `part_supplier_prices` WRITE;
/*!40000 ALTER TABLE `part_supplier_prices` DISABLE KEYS */;
/*!40000 ALTER TABLE `part_supplier_prices` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_part_supplier_prices_ai_audit` AFTER INSERT ON `part_supplier_prices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'part_supplier_prices', 'PartSupplierPricesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('part_supplier_prices insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_part_supplier_prices_au_audit` AFTER UPDATE ON `part_supplier_prices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'part_supplier_prices', 'PartSupplierPricesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('part_supplier_prices update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_part_supplier_prices_ad_audit` AFTER DELETE ON `part_supplier_prices` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'part_supplier_prices', 'PartSupplierPricesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('part_supplier_prices delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `parts`
--

DROP TABLE IF EXISTS `parts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `parts` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(50) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `default_supplier_id` int DEFAULT NULL,
  `description` text,
  `status` enum('active','obsolete','reorder') DEFAULT 'active',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `category` varchar(255) DEFAULT NULL,
  `barcode` varchar(255) DEFAULT NULL,
  `rfid` varchar(255) DEFAULT NULL,
  `serial_or_lot` varchar(255) DEFAULT NULL,
  `default_supplier` varchar(255) DEFAULT NULL,
  `supplier_prices` varchar(255) DEFAULT NULL,
  `price` decimal(10,2) DEFAULT NULL,
  `stock` int DEFAULT NULL,
  `min_stock_alert` int DEFAULT NULL,
  `warehouse_stocks` varchar(255) DEFAULT NULL,
  `stock_history` varchar(255) DEFAULT NULL,
  `location` varchar(255) DEFAULT NULL,
  `image` varchar(255) DEFAULT NULL,
  `images` varchar(255) DEFAULT NULL,
  `documents` varchar(255) DEFAULT NULL,
  `warranty_until` datetime DEFAULT NULL,
  `expiry_date` datetime DEFAULT NULL,
  `blocked` tinyint(1) DEFAULT NULL,
  `regulatory_certificates` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `change_logs` varchar(255) DEFAULT NULL,
  `work_order_parts` varchar(255) DEFAULT NULL,
  `warehouses` varchar(255) DEFAULT NULL,
  `note` varchar(255) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `supplier` varchar(255) DEFAULT NULL,
  `sku` varchar(100) DEFAULT NULL,
  `sku_norm` varchar(100) GENERATED ALWAYS AS (coalesce(`sku`,_utf8mb4'')) STORED,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  UNIQUE KEY `uq_parts_name_sku` (`name`,`sku_norm`),
  KEY `fk_p_supplier` (`default_supplier_id`),
  KEY `ix_parts_sku` (`sku`),
  CONSTRAINT `fk_p_supplier` FOREIGN KEY (`default_supplier_id`) REFERENCES `suppliers` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `parts`
--

LOCK TABLES `parts` WRITE;
/*!40000 ALTER TABLE `parts` DISABLE KEYS */;
INSERT INTO `parts` (`id`, `code`, `name`, `default_supplier_id`, `description`, `status`, `created_at`, `updated_at`, `category`, `barcode`, `rfid`, `serial_or_lot`, `default_supplier`, `supplier_prices`, `price`, `stock`, `min_stock_alert`, `warehouse_stocks`, `stock_history`, `location`, `image`, `images`, `documents`, `warranty_until`, `expiry_date`, `blocked`, `regulatory_certificates`, `digital_signature`, `last_modified`, `last_modified_by_id`, `last_modified_by`, `source_ip`, `change_logs`, `work_order_parts`, `warehouses`, `note`, `anomaly_score`, `supplier`, `sku`) VALUES (1,'123','123',NULL,NULL,'active','2025-09-05 13:28:23','2025-09-11 10:19:14',NULL,NULL,NULL,NULL,NULL,NULL,3.00,6,2,NULL,NULL,'2','xxx',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'xxx',NULL),(2,'sxsxsx','sxsx',NULL,NULL,'active','2025-09-05 13:28:56','2025-09-05 13:28:56',NULL,NULL,NULL,NULL,NULL,NULL,3.00,3,NULL,NULL,NULL,'2','3',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'sdcsc',NULL);
/*!40000 ALTER TABLE `parts` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_parts_ai_audit` AFTER INSERT ON `parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'parts', 'PartsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('parts insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_parts_au_audit` AFTER UPDATE ON `parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'parts', 'PartsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('parts update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'parts', 'PartsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'parts update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'parts', 'PartsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'parts update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_parts_ad_audit` AFTER DELETE ON `parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'parts', 'PartsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('parts delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `permission_change_log`
--

DROP TABLE IF EXISTS `permission_change_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `permission_change_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `changed_by` int NOT NULL,
  `change_type` enum('role','permission','delegation','override') NOT NULL,
  `role_id` int DEFAULT NULL,
  `permission_id` int DEFAULT NULL,
  `action` enum('grant','revoke','deny','expire','delegate','escalate') NOT NULL,
  `reason` varchar(255) DEFAULT NULL,
  `change_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `expires_at` datetime DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `details` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_pcl_user` (`user_id`),
  KEY `fk_pcl_changed_by` (`changed_by`),
  KEY `fk_pcl_role` (`role_id`),
  KEY `fk_pcl_perm` (`permission_id`),
  CONSTRAINT `fk_pcl_changed_by` FOREIGN KEY (`changed_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_pcl_perm` FOREIGN KEY (`permission_id`) REFERENCES `permissions` (`id`),
  CONSTRAINT `fk_pcl_role` FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`),
  CONSTRAINT `fk_pcl_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `permission_change_log`
--

LOCK TABLES `permission_change_log` WRITE;
/*!40000 ALTER TABLE `permission_change_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `permission_change_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permission_change_log_ai_audit` AFTER INSERT ON `permission_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'permission_change_log', 'PermissionChangeLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('permission_change_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permission_change_log_au_audit` AFTER UPDATE ON `permission_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'permission_change_log', 'PermissionChangeLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('permission_change_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permission_change_log_ad_audit` AFTER DELETE ON `permission_change_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'permission_change_log', 'PermissionChangeLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('permission_change_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `permission_requests`
--

DROP TABLE IF EXISTS `permission_requests`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `permission_requests` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `permission_id` int NOT NULL,
  `requested_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `reason` varchar(255) DEFAULT NULL,
  `status` enum('pending','approved','denied','expired') DEFAULT 'pending',
  `reviewed_by` int DEFAULT NULL,
  `reviewed_at` datetime DEFAULT NULL,
  `review_comment` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_pr_user` (`user_id`),
  KEY `fk_pr_perm` (`permission_id`),
  KEY `fk_pr_by` (`reviewed_by`),
  CONSTRAINT `fk_pr_by` FOREIGN KEY (`reviewed_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_pr_perm` FOREIGN KEY (`permission_id`) REFERENCES `permissions` (`id`),
  CONSTRAINT `fk_pr_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `permission_requests`
--

LOCK TABLES `permission_requests` WRITE;
/*!40000 ALTER TABLE `permission_requests` DISABLE KEYS */;
/*!40000 ALTER TABLE `permission_requests` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permission_requests_ai_audit` AFTER INSERT ON `permission_requests` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'permission_requests', 'PermissionRequestsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('permission_requests insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permission_requests_au_audit` AFTER UPDATE ON `permission_requests` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'permission_requests', 'PermissionRequestsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('permission_requests update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permission_requests_ad_audit` AFTER DELETE ON `permission_requests` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'permission_requests', 'PermissionRequestsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('permission_requests delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `permissions`
--

DROP TABLE IF EXISTS `permissions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `permissions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(100) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `module` varchar(100) DEFAULT NULL,
  `critical` tinyint(1) DEFAULT '0',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `permission_type` varchar(255) DEFAULT NULL,
  `name` varchar(120) DEFAULT NULL,
  `group` varchar(80) DEFAULT NULL,
  `parent_id` int DEFAULT NULL,
  `permission?` varchar(255) DEFAULT NULL,
  `icollection<permission>` varchar(255) DEFAULT NULL,
  `compliance_tags` varchar(120) DEFAULT NULL,
  `created_by` int DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  `note` varchar(512) DEFAULT NULL,
  `icollection<role>` varchar(255) DEFAULT NULL,
  `icollection<user>` varchar(255) DEFAULT NULL,
  `icollection<role_permission>` varchar(255) DEFAULT NULL,
  `icollection<user_permission>` varchar(255) DEFAULT NULL,
  `icollection<delegated_permission>` varchar(255) DEFAULT NULL,
  `string` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `permissions`
--

LOCK TABLES `permissions` WRITE;
/*!40000 ALTER TABLE `permissions` DISABLE KEYS */;
INSERT INTO `permissions` VALUES (1,'manage_system','Full system administration',NULL,0,'2025-08-25 11:36:22','2025-08-25 11:36:22',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(2,'manage_team','Manage team operations',NULL,0,'2025-08-25 11:36:22','2025-08-25 11:36:22',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(3,'use_system','Standard system usage',NULL,0,'2025-08-25 11:36:22','2025-08-25 11:36:22',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(4,'user.change_password','Allows changing user passwords (self/others).','users',1,'2025-08-28 14:05:44','2025-08-28 14:05:44',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
/*!40000 ALTER TABLE `permissions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permissions_ai_audit` AFTER INSERT ON `permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'permissions', 'PermissionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('permissions insert', CONCAT('; code=', COALESCE(NEW.code,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permissions_au_audit` AFTER UPDATE ON `permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'permissions', 'PermissionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('permissions update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'permissions', 'PermissionsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'permissions update: code changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_permissions_ad_audit` AFTER DELETE ON `permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'permissions', 'PermissionsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('permissions delete', CONCAT('; code=', COALESCE(OLD.code,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `photos`
--

DROP TABLE IF EXISTS `photos`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `photos` (
  `id` int NOT NULL AUTO_INCREMENT,
  `work_order_id` int DEFAULT NULL,
  `component_id` int DEFAULT NULL,
  `file_name` varchar(255) DEFAULT NULL,
  `file_path` varchar(255) DEFAULT NULL,
  `type` enum('prije','poslije','dokumentacija','drugo') DEFAULT 'dokumentacija',
  `uploaded_by` int DEFAULT NULL,
  `uploaded_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `watermark_applied` tinyint(1) DEFAULT '0',
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_ph_wo` (`work_order_id`),
  KEY `fk_ph_component` (`component_id`),
  KEY `fk_ph_user` (`uploaded_by`),
  CONSTRAINT `fk_ph_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_ph_user` FOREIGN KEY (`uploaded_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_ph_wo` FOREIGN KEY (`work_order_id`) REFERENCES `work_orders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `photos`
--

LOCK TABLES `photos` WRITE;
/*!40000 ALTER TABLE `photos` DISABLE KEYS */;
/*!40000 ALTER TABLE `photos` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_photos_ai_audit` AFTER INSERT ON `photos` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'photos', 'PhotosPage', NEW.id, NULL,
     NULL, NULL, CONCAT('photos insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_photos_au_audit` AFTER UPDATE ON `photos` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'photos', 'PhotosPage', NEW.id, NULL,
     NULL, NULL, CONCAT('photos update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_photos_ad_audit` AFTER DELETE ON `photos` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'photos', 'PhotosPage', OLD.id, NULL,
     NULL, NULL, CONCAT('photos delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `ppm_plans`
--

DROP TABLE IF EXISTS `ppm_plans`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `ppm_plans` (
  `id` int NOT NULL AUTO_INCREMENT,
  `machine_id` int NOT NULL,
  `title` varchar(200) NOT NULL,
  `plan_json` json DEFAULT NULL,
  `effective_from` date DEFAULT NULL,
  `effective_to` date DEFAULT NULL,
  `status` varchar(30) NOT NULL DEFAULT 'active',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `last_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_ppm_plans_machine` (`machine_id`),
  CONSTRAINT `fk_ppm_plans_machine` FOREIGN KEY (`machine_id`) REFERENCES `machines` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ppm_plans`
--

LOCK TABLES `ppm_plans` WRITE;
/*!40000 ALTER TABLE `ppm_plans` DISABLE KEYS */;
/*!40000 ALTER TABLE `ppm_plans` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_ppm_plans_ai_audit` AFTER INSERT ON `ppm_plans` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'ppm_plans', 'PpmPlansPage', NEW.id, NULL,
     NULL, NULL, CONCAT('ppm_plans insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_ppm_plans_au_audit` AFTER UPDATE ON `ppm_plans` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'ppm_plans', 'PpmPlansPage', NEW.id, NULL,
     NULL, NULL, CONCAT('ppm_plans update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_ppm_plans_ad_audit` AFTER DELETE ON `ppm_plans` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'ppm_plans', 'PpmPlansPage', OLD.id, NULL,
     NULL, NULL, CONCAT('ppm_plans delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `preventive_maintenance_plans`
--

DROP TABLE IF EXISTS `preventive_maintenance_plans`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `preventive_maintenance_plans` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(50) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `description` text,
  `machine_id` int DEFAULT NULL,
  `component_id` int DEFAULT NULL,
  `frequency` varchar(40) DEFAULT NULL,
  `checklist_file` varchar(255) DEFAULT NULL,
  `responsible_user_id` int DEFAULT NULL,
  `last_executed` date DEFAULT NULL,
  `next_due` date DEFAULT NULL,
  `status` varchar(40) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `checklist_template_id` int DEFAULT NULL,
  `machine` varchar(255) DEFAULT NULL,
  `component` varchar(255) DEFAULT NULL,
  `responsible_user` varchar(255) DEFAULT NULL,
  `execution_history` varchar(255) DEFAULT NULL,
  `risk_score` decimal(10,2) DEFAULT NULL,
  `ai_recommendation` varchar(2048) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `session_id` varchar(80) DEFAULT NULL,
  `geo_location` varchar(100) DEFAULT NULL,
  `attachments` varchar(255) DEFAULT NULL,
  `version` int DEFAULT NULL,
  `previous_version_id` int DEFAULT NULL,
  `previous_version` varchar(255) DEFAULT NULL,
  `is_active_version` tinyint(1) DEFAULT NULL,
  `linked_work_orders` varchar(255) DEFAULT NULL,
  `is_automated` tinyint(1) DEFAULT NULL,
  `requires_notification` tinyint(1) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `note` varchar(512) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  KEY `fk_pmp_machine` (`machine_id`),
  KEY `fk_pmp_component` (`component_id`),
  KEY `fk_pmp_responsible` (`responsible_user_id`),
  KEY `fk_pmp_tpl` (`checklist_template_id`),
  CONSTRAINT `fk_pmp_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_pmp_machine` FOREIGN KEY (`machine_id`) REFERENCES `machines` (`id`),
  CONSTRAINT `fk_pmp_responsible` FOREIGN KEY (`responsible_user_id`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_pmp_tpl` FOREIGN KEY (`checklist_template_id`) REFERENCES `checklist_templates` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `preventive_maintenance_plans`
--

LOCK TABLES `preventive_maintenance_plans` WRITE;
/*!40000 ALTER TABLE `preventive_maintenance_plans` DISABLE KEYS */;
/*!40000 ALTER TABLE `preventive_maintenance_plans` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_preventive_maintenance_plans_ai_audit` AFTER INSERT ON `preventive_maintenance_plans` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'preventive_maintenance_plans', 'PreventiveMaintenancePlansPage', NEW.id, NULL,
     NULL, NULL, CONCAT('preventive_maintenance_plans insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_preventive_maintenance_plans_au_audit` AFTER UPDATE ON `preventive_maintenance_plans` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'preventive_maintenance_plans', 'PreventiveMaintenancePlansPage', NEW.id, NULL,
     NULL, NULL, CONCAT('preventive_maintenance_plans update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'preventive_maintenance_plans', 'PreventiveMaintenancePlansPage', NEW.id, 'code',
       OLD.code, NEW.code, 'preventive_maintenance_plans update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'preventive_maintenance_plans', 'PreventiveMaintenancePlansPage', NEW.id, 'name',
       OLD.name, NEW.name, 'preventive_maintenance_plans update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_preventive_maintenance_plans_ad_audit` AFTER DELETE ON `preventive_maintenance_plans` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'preventive_maintenance_plans', 'PreventiveMaintenancePlansPage', OLD.id, NULL,
     NULL, NULL, CONCAT('preventive_maintenance_plans delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `quality_events`
--

DROP TABLE IF EXISTS `quality_events`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `quality_events` (
  `id` int NOT NULL AUTO_INCREMENT,
  `event_type` enum('deviation','complaint','recall','out_of_spec','change_control','audit','training') DEFAULT NULL,
  `date_open` date DEFAULT NULL,
  `date_close` date DEFAULT NULL,
  `description` text,
  `related_machine` int DEFAULT NULL,
  `related_component` int DEFAULT NULL,
  `status` enum('open','closed','under_review') DEFAULT NULL,
  `actions` text,
  `doc_file` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `type_id` int DEFAULT NULL,
  `status_id` int DEFAULT NULL,
  `related_machine_id` int DEFAULT NULL,
  `related_component_id` int DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `created_by_id` int DEFAULT NULL,
  `created_by` varchar(255) DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_qe_machine` (`related_machine`),
  KEY `fk_qe_component` (`related_component`),
  KEY `idx_qe_type_id` (`type_id`),
  KEY `idx_qe_status_id` (`status_id`),
  CONSTRAINT `fk_qe_component` FOREIGN KEY (`related_component`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_qe_machine` FOREIGN KEY (`related_machine`) REFERENCES `machines` (`id`),
  CONSTRAINT `fk_qe_status` FOREIGN KEY (`status_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_qe_type` FOREIGN KEY (`type_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `quality_events`
--

LOCK TABLES `quality_events` WRITE;
/*!40000 ALTER TABLE `quality_events` DISABLE KEYS */;
/*!40000 ALTER TABLE `quality_events` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_qe_sync` BEFORE INSERT ON `quality_events` FOR EACH ROW BEGIN
  CALL ref_touch('quality_event_type', NEW.event_type, NEW.event_type);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.type_id = LAST_INSERT_ID(); END IF;
  CALL ref_touch('quality_status', NEW.status, NEW.status);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_quality_events_ai_audit` AFTER INSERT ON `quality_events` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'quality_events', 'QualityEventsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('quality_events insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_qe_sync_u` BEFORE UPDATE ON `quality_events` FOR EACH ROW BEGIN
  IF (NEW.event_type <=> OLD.event_type) = 0 THEN
    CALL ref_touch('quality_event_type', NEW.event_type, NEW.event_type);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.type_id = LAST_INSERT_ID(); END IF;
  END IF;
  IF (NEW.status <=> OLD.status) = 0 THEN
    CALL ref_touch('quality_status', NEW.status, NEW.status);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_quality_events_au_audit` AFTER UPDATE ON `quality_events` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'quality_events', 'QualityEventsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('quality_events update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_quality_events_ad_audit` AFTER DELETE ON `quality_events` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'quality_events', 'QualityEventsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('quality_events delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `ref_domain`
--

DROP TABLE IF EXISTS `ref_domain`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `ref_domain` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_ref_domain_name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=112 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ref_domain`
--

LOCK TABLES `ref_domain` WRITE;
/*!40000 ALTER TABLE `ref_domain` DISABLE KEYS */;
INSERT INTO `ref_domain` VALUES (1,'capa_status',NULL,'2025-09-03 13:06:39','2025-09-03 13:06:39');
/*!40000 ALTER TABLE `ref_domain` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ref_value`
--

DROP TABLE IF EXISTS `ref_value`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `ref_value` (
  `id` int NOT NULL AUTO_INCREMENT,
  `domain_id` int NOT NULL,
  `code` varchar(255) NOT NULL,
  `label` varchar(255) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT '1',
  `sort_order` int DEFAULT '0',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_ref_value_domain_code` (`domain_id`,`code`),
  KEY `ix_ref_value_domain` (`domain_id`),
  CONSTRAINT `fk_ref_value_domain` FOREIGN KEY (`domain_id`) REFERENCES `ref_domain` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=59 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ref_value`
--

LOCK TABLES `ref_value` WRITE;
/*!40000 ALTER TABLE `ref_value` DISABLE KEYS */;
INSERT INTO `ref_value` VALUES (1,1,'otvoren','otvoren',1,0,'2025-09-03 13:06:39','2025-09-03 13:06:39'),(2,1,'u_tijeku','u_tijeku',1,0,'2025-09-03 13:06:39','2025-09-03 13:06:39'),(3,1,'zatvoren','zatvoren',1,0,'2025-09-03 13:06:39','2025-09-03 13:06:39');
/*!40000 ALTER TABLE `ref_value` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `report_schedule`
--

DROP TABLE IF EXISTS `report_schedule`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `report_schedule` (
  `id` int NOT NULL AUTO_INCREMENT,
  `report_name` varchar(100) DEFAULT NULL,
  `schedule_type` enum('daily','weekly','monthly','on_demand') DEFAULT NULL,
  `format` enum('pdf','excel','csv') DEFAULT NULL,
  `recipients` text,
  `last_generated` datetime DEFAULT NULL,
  `next_due` datetime DEFAULT NULL,
  `status` enum('planned','generated','failed') DEFAULT NULL,
  `generated_by` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_rsch_user` (`generated_by`),
  CONSTRAINT `fk_rsch_user` FOREIGN KEY (`generated_by`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `report_schedule`
--

LOCK TABLES `report_schedule` WRITE;
/*!40000 ALTER TABLE `report_schedule` DISABLE KEYS */;
/*!40000 ALTER TABLE `report_schedule` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_report_schedule_ai_audit` AFTER INSERT ON `report_schedule` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'report_schedule', 'ReportSchedulePage', NEW.id, NULL,
     NULL, NULL, CONCAT('report_schedule insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_report_schedule_au_audit` AFTER UPDATE ON `report_schedule` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'report_schedule', 'ReportSchedulePage', NEW.id, NULL,
     NULL, NULL, CONCAT('report_schedule update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_report_schedule_ad_audit` AFTER DELETE ON `report_schedule` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'report_schedule', 'ReportSchedulePage', OLD.id, NULL,
     NULL, NULL, CONCAT('report_schedule delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `requalification_schedule`
--

DROP TABLE IF EXISTS `requalification_schedule`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `requalification_schedule` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_id` int DEFAULT NULL,
  `last_qualified` date DEFAULT NULL,
  `next_due` date DEFAULT NULL,
  `method` varchar(255) DEFAULT NULL,
  `responsible` varchar(100) DEFAULT NULL,
  `notes` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `component` varchar(255) DEFAULT NULL,
  `responsible_user_id` int DEFAULT NULL,
  `responsible_user` varchar(255) DEFAULT NULL,
  `protocol_file` varchar(255) DEFAULT NULL,
  `status` varchar(30) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `geo_location` varchar(128) DEFAULT NULL,
  `attachments_json` varchar(255) DEFAULT NULL,
  `regulator` varchar(40) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `analytics_json` varchar(2048) DEFAULT NULL,
  `related_case_id` int DEFAULT NULL,
  `related_case_type` varchar(40) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_requal_component` (`component_id`),
  CONSTRAINT `fk_requal_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `requalification_schedule`
--

LOCK TABLES `requalification_schedule` WRITE;
/*!40000 ALTER TABLE `requalification_schedule` DISABLE KEYS */;
/*!40000 ALTER TABLE `requalification_schedule` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_requalification_schedule_ai_audit` AFTER INSERT ON `requalification_schedule` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'requalification_schedule', 'RequalificationSchedulePage', NEW.id, NULL,
     NULL, NULL, CONCAT('requalification_schedule insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_requalification_schedule_au_audit` AFTER UPDATE ON `requalification_schedule` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'requalification_schedule', 'RequalificationSchedulePage', NEW.id, NULL,
     NULL, NULL, CONCAT('requalification_schedule update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_requalification_schedule_ad_audit` AFTER DELETE ON `requalification_schedule` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'requalification_schedule', 'RequalificationSchedulePage', OLD.id, NULL,
     NULL, NULL, CONCAT('requalification_schedule delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `responsible_parties`
--

DROP TABLE IF EXISTS `responsible_parties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `responsible_parties` (
  `id` int NOT NULL AUTO_INCREMENT,
  `party_type` enum('User','Department','Vendor') NOT NULL,
  `user_id` int DEFAULT NULL,
  `department_id` int DEFAULT NULL,
  `vendor_id` int DEFAULT NULL,
  `display_name` varchar(200) GENERATED ALWAYS AS ((case `party_type` when _utf8mb4'User' then concat(_utf8mb4'User#',ifnull(`user_id`,_utf8mb4'?')) when _utf8mb4'Department' then concat(_utf8mb4'Dept#',ifnull(`department_id`,_utf8mb4'?')) when _utf8mb4'Vendor' then concat(_utf8mb4'Vendor#',ifnull(`vendor_id`,_utf8mb4'?')) else _utf8mb4'Party' end)) VIRTUAL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `name` varchar(256) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_party_user` (`user_id`),
  KEY `fk_party_dept` (`department_id`),
  KEY `fk_party_vendor` (`vendor_id`),
  CONSTRAINT `fk_party_dept` FOREIGN KEY (`department_id`) REFERENCES `departments` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_party_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_party_vendor` FOREIGN KEY (`vendor_id`) REFERENCES `vendors` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `responsible_parties`
--

LOCK TABLES `responsible_parties` WRITE;
/*!40000 ALTER TABLE `responsible_parties` DISABLE KEYS */;
INSERT INTO `responsible_parties` (`id`, `party_type`, `user_id`, `department_id`, `vendor_id`, `created_at`, `updated_at`, `name`) VALUES (1,'User',NULL,NULL,NULL,'2025-09-10 13:35:53','2025-09-10 13:35:53','Odjel');
/*!40000 ALTER TABLE `responsible_parties` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risk_assessments`
--

DROP TABLE IF EXISTS `risk_assessments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `risk_assessments` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risk_assessments`
--

LOCK TABLES `risk_assessments` WRITE;
/*!40000 ALTER TABLE `risk_assessments` DISABLE KEYS */;
/*!40000 ALTER TABLE `risk_assessments` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Temporary view structure for view `role`
--

DROP TABLE IF EXISTS `role`;
/*!50001 DROP VIEW IF EXISTS `role`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `role` AS SELECT 
 1 AS `id`,
 1 AS `name`,
 1 AS `description`,
 1 AS `org_unit`,
 1 AS `compliance_tags`,
 1 AS `is_deleted`,
 1 AS `notes`,
 1 AS `created_at`,
 1 AS `updated_at`,
 1 AS `created_by_id`,
 1 AS `last_modified_by_id`,
 1 AS `version`,
 1 AS `icollection<permission>`,
 1 AS `icollection<user>`,
 1 AS `icollection<role_permission>`,
 1 AS `user?`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `role_audit`
--

DROP TABLE IF EXISTS `role_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `role_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `role_id` int DEFAULT NULL,
  `action` varchar(40) NOT NULL,
  `description` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `source_ip` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `details` text GENERATED ALWAYS AS (`description`) VIRTUAL,
  PRIMARY KEY (`id`),
  KEY `fk_ra_role` (`role_id`),
  CONSTRAINT `fk_ra_role` FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `role_audit`
--

LOCK TABLES `role_audit` WRITE;
/*!40000 ALTER TABLE `role_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `role_audit` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_role_audit_ai_audit` AFTER INSERT ON `role_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'role_audit', 'RoleAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('role_audit insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_role_audit_au_audit` AFTER UPDATE ON `role_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'role_audit', 'RoleAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('role_audit update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_role_audit_ad_audit` AFTER DELETE ON `role_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'role_audit', 'RoleAuditPage', OLD.id, NULL,
     NULL, NULL, CONCAT('role_audit delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `role_permissions`
--

DROP TABLE IF EXISTS `role_permissions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `role_permissions` (
  `role_id` int NOT NULL,
  `permission_id` int NOT NULL,
  `allowed` tinyint(1) DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `assigned_by_id` int DEFAULT NULL,
  `assigned_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `change_version` int DEFAULT '1',
  `role?` varchar(255) DEFAULT NULL,
  `permission?` varchar(255) DEFAULT NULL,
  `assigned_by` int DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `expires_at` datetime DEFAULT NULL,
  `reason` varchar(255) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `session_id` varchar(64) DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `note` varchar(512) DEFAULT NULL,
  `code` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`role_id`,`permission_id`),
  KEY `fk_rp_perm` (`permission_id`),
  KEY `fk_rp_assigned_by_id` (`assigned_by_id`),
  CONSTRAINT `fk_rp_assigned_by_id` FOREIGN KEY (`assigned_by_id`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_rp_perm` FOREIGN KEY (`permission_id`) REFERENCES `permissions` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_rp_role` FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `role_permissions`
--

LOCK TABLES `role_permissions` WRITE;
/*!40000 ALTER TABLE `role_permissions` DISABLE KEYS */;
INSERT INTO `role_permissions` VALUES (1,1,1,'2025-08-25 11:36:22','2025-08-25 11:36:22',NULL,'2025-08-27 12:08:25',1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(1,2,1,'2025-08-29 12:08:02','2025-08-29 12:08:02',1,'2025-08-29 10:08:02',1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(1,3,1,'2025-08-29 12:08:13','2025-08-29 12:08:13',1,'2025-08-29 10:08:13',1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(1,4,1,'2025-08-28 14:05:44','2025-08-28 14:05:44',NULL,'2025-08-28 14:05:44',1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(2,2,1,'2025-08-25 11:36:22','2025-08-25 11:36:22',NULL,'2025-08-27 12:08:25',1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(3,2,1,'2025-09-01 14:22:06','2025-09-01 14:22:06',NULL,'2025-09-01 14:22:06',1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(3,3,1,'2025-08-25 11:36:22','2025-08-25 11:36:22',NULL,'2025-08-27 12:08:25',1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
/*!40000 ALTER TABLE `role_permissions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_role_permissions_ai_audit` AFTER INSERT ON `role_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'role_permissions', 'RolePermissionsPage', NEW.role_id, NULL,
     NULL, NULL, CONCAT('role_permissions insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_role_permissions_au_audit` AFTER UPDATE ON `role_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'role_permissions', 'RolePermissionsPage', NEW.role_id, NULL,
     NULL, NULL, CONCAT('role_permissions update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_role_permissions_ad_audit` AFTER DELETE ON `role_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'role_permissions', 'RolePermissionsPage', OLD.role_id, NULL,
     NULL, NULL, CONCAT('role_permissions delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `roles`
--

DROP TABLE IF EXISTS `roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `roles` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `org_unit` varchar(80) DEFAULT NULL,
  `compliance_tags` varchar(120) DEFAULT NULL,
  `is_deleted` tinyint(1) NOT NULL DEFAULT '0',
  `notes` varchar(512) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `created_by_id` int DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `version` int NOT NULL DEFAULT '1',
  `icollection<permission>` varchar(255) DEFAULT NULL,
  `icollection<user>` varchar(255) DEFAULT NULL,
  `icollection<role_permission>` varchar(255) DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`),
  KEY `fk_roles_created_by` (`created_by_id`),
  KEY `fk_roles_last_modified_by` (`last_modified_by_id`),
  CONSTRAINT `fk_roles_created_by` FOREIGN KEY (`created_by_id`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_roles_last_modified_by` FOREIGN KEY (`last_modified_by_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `roles`
--

LOCK TABLES `roles` WRITE;
/*!40000 ALTER TABLE `roles` DISABLE KEYS */;
INSERT INTO `roles` VALUES (1,'admin','System Administrator','IT','SOX',0,'Initial admin role','2025-08-25 11:36:22','2025-08-29 13:49:52',NULL,1,6,NULL,NULL,NULL,NULL),(2,'manager','Department Manager','Operations','ISO9001',0,'Department manager role','2025-08-25 11:36:22','2025-08-29 13:49:52',NULL,1,6,NULL,NULL,NULL,NULL),(3,'user','Standard User','General','None',0,'Standard user role','2025-08-25 11:36:22','2025-08-29 13:49:52',NULL,1,6,NULL,NULL,NULL,NULL);
/*!40000 ALTER TABLE `roles` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_roles_ai_audit` AFTER INSERT ON `roles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'roles', 'RolesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('roles insert', CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_roles_au_audit` AFTER UPDATE ON `roles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'roles', 'RolesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('roles update', CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'roles', 'RolesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'roles update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_roles_ad_audit` AFTER DELETE ON `roles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'roles', 'RolesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('roles delete', CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `rooms`
--

DROP TABLE IF EXISTS `rooms`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `rooms` (
  `id` int NOT NULL AUTO_INCREMENT,
  `building_id` int NOT NULL,
  `code` varchar(20) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `classification` enum('C','D','Not Classified') DEFAULT 'Not Classified',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_room_build` (`building_id`),
  CONSTRAINT `fk_room_build` FOREIGN KEY (`building_id`) REFERENCES `buildings` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `rooms`
--

LOCK TABLES `rooms` WRITE;
/*!40000 ALTER TABLE `rooms` DISABLE KEYS */;
/*!40000 ALTER TABLE `rooms` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_rooms_ai_audit` AFTER INSERT ON `rooms` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'rooms', 'RoomsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('rooms insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_rooms_au_audit` AFTER UPDATE ON `rooms` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'rooms', 'RoomsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('rooms update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'rooms', 'RoomsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'rooms update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'rooms', 'RoomsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'rooms update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_rooms_ad_audit` AFTER DELETE ON `rooms` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'rooms', 'RoomsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('rooms delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `row_audit_log`
--

DROP TABLE IF EXISTS `row_audit_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `row_audit_log` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `table_name` varchar(120) NOT NULL,
  `row_pk` varchar(120) NOT NULL,
  `operation` enum('INSERT','UPDATE','DELETE') NOT NULL,
  `before_json` json DEFAULT NULL,
  `after_json` json DEFAULT NULL,
  `actor_user_id` int DEFAULT NULL,
  `occured_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `ix_audit_tbl` (`table_name`,`occured_at` DESC),
  KEY `fk_audit_user` (`actor_user_id`),
  CONSTRAINT `fk_audit_user` FOREIGN KEY (`actor_user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `row_audit_log`
--

LOCK TABLES `row_audit_log` WRITE;
/*!40000 ALTER TABLE `row_audit_log` DISABLE KEYS */;
INSERT INTO `row_audit_log` VALUES (1,'machines','1','INSERT',NULL,'{\"id\": 1, \"qr\": null, \"name\": \"Test_manual\", \"type\": null, \"serial\": null, \"internal_code\": null}',NULL,'2025-09-12 05:22:09','2025-09-12 07:22:09','2025-09-12 07:22:09'),(2,'machines','2','INSERT',NULL,'{\"id\": 2, \"qr\": null, \"name\": null, \"type\": null, \"serial\": null, \"internal_code\": null}',NULL,'2025-09-12 05:34:44','2025-09-12 07:34:44','2025-09-12 07:34:44'),(3,'machines','3','INSERT',NULL,'{\"id\": 3, \"qr\": null, \"name\": \"T-minimal\", \"type\": null, \"serial\": null, \"internal_code\": null}',NULL,'2025-09-12 05:35:24','2025-09-12 07:35:24','2025-09-12 07:35:24'),(4,'machines','2','UPDATE','{\"qr\": null, \"loc\": null, \"name\": null, \"status\": null, \"internal_code\": null}','{\"qr\": null, \"loc\": null, \"name\": null, \"status\": null, \"internal_code\": null}',NULL,'2025-09-12 05:36:17','2025-09-12 07:36:17','2025-09-12 07:36:17'),(9,'machines','2','UPDATE','{\"qr\": null, \"loc\": null, \"name\": null, \"status\": null, \"internal_code\": null}','{\"qr\": null, \"loc\": null, \"name\": null, \"status\": null, \"internal_code\": null}',NULL,'2025-09-12 05:39:50','2025-09-12 07:39:50','2025-09-12 07:39:50'),(13,'machines','3','UPDATE','{\"qr\": null, \"loc\": null, \"name\": \"T-minimal\", \"status\": null, \"internal_code\": null}','{\"qr\": \"\", \"loc\": 1, \"name\": \"T-minimal\", \"status\": null, \"internal_code\": \"\"}',NULL,'2025-09-12 05:44:55','2025-09-12 07:44:55','2025-09-12 07:44:55'),(14,'machines','2','UPDATE','{\"qr\": null, \"loc\": null, \"name\": null, \"status\": null, \"internal_code\": null}','{\"qr\": \"\", \"loc\": 2, \"name\": \"vak\", \"status\": null, \"internal_code\": \"VAK-BAC-0005\"}',NULL,'2025-09-12 05:45:47','2025-09-12 07:45:47','2025-09-12 07:45:47'),(15,'machines','11','INSERT',NULL,'{\"id\": 11, \"qr\": \"yasgmp://machine/1\", \"name\": \"Kartonirka\", \"type\": 41, \"serial\": \"654654654\", \"internal_code\": \"KAR-CAM-0001\"}',NULL,'2025-09-12 06:08:53','2025-09-12 08:08:53','2025-09-12 08:08:53'),(16,'machines','3','DELETE','{\"qr\": \"\", \"name\": \"T-minimal\", \"type\": 41, \"serial\": null, \"internal_code\": \"\"}',NULL,NULL,'2025-09-12 06:15:46','2025-09-12 08:15:46','2025-09-12 08:15:46'),(19,'machines','2','DELETE','{\"qr\": \"\", \"name\": \"vak\", \"type\": 42, \"serial\": null, \"internal_code\": \"VAK-BAC-0005\"}',NULL,NULL,'2025-09-12 06:16:11','2025-09-12 08:16:11','2025-09-12 08:16:11'),(21,'machines','11','UPDATE','{\"qr\": \"yasgmp://machine/1\", \"loc\": 1, \"name\": \"Kartonirka\", \"status\": null, \"internal_code\": \"KAR-CAM-0001\"}','{\"qr\": \"yasgmp://machine/1\", \"loc\": 1, \"name\": \"Kartonirka\", \"status\": null, \"internal_code\": \"KAR-CAM-0001\"}',NULL,'2025-09-12 06:22:33','2025-09-12 08:22:33','2025-09-12 08:22:33'),(22,'machines','11','UPDATE','{\"qr\": \"yasgmp://machine/1\", \"loc\": 1, \"name\": \"Kartonirka\", \"status\": null, \"internal_code\": \"KAR-CAM-0001\"}','{\"qr\": \"yasgmp://machine/1\", \"loc\": 1, \"name\": \"Kartonirka\", \"status\": null, \"internal_code\": \"KAR-CAM-0001\"}',NULL,'2025-09-12 06:23:04','2025-09-12 08:23:04','2025-09-12 08:23:04'),(23,'machines','11','UPDATE','{\"qr\": \"yasgmp://machine/1\", \"loc\": 1, \"name\": \"Kartonirka\", \"status\": null, \"internal_code\": \"KAR-CAM-0001\"}','{\"qr\": \"yasgmp://machine/1\", \"loc\": 1, \"name\": \"Kartonirka\", \"status\": null, \"internal_code\": \"KAR-CAM-0001\"}',NULL,'2025-09-12 06:23:09','2025-09-12 08:23:09','2025-09-12 08:23:09');
/*!40000 ALTER TABLE `row_audit_log` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `scheduled_job_audit_log`
--

DROP TABLE IF EXISTS `scheduled_job_audit_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `scheduled_job_audit_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `scheduled_job_id` int NOT NULL,
  `user_id` int DEFAULT NULL,
  `action` enum('CREATE','UPDATE','DELETE','EXECUTE','ACKNOWLEDGE','ESCALATE','FAIL','CANCEL','EXPORT') NOT NULL,
  `old_value` text,
  `new_value` text,
  `changed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `source_ip` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`changed_at`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`note`) VIRTUAL,
  PRIMARY KEY (`id`),
  KEY `fk_sjal_job` (`scheduled_job_id`),
  KEY `fk_sjal_user` (`user_id`),
  CONSTRAINT `fk_sjal_job` FOREIGN KEY (`scheduled_job_id`) REFERENCES `scheduled_jobs` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_sjal_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `scheduled_job_audit_log`
--

LOCK TABLES `scheduled_job_audit_log` WRITE;
/*!40000 ALTER TABLE `scheduled_job_audit_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `scheduled_job_audit_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_job_audit_log_ai_audit` AFTER INSERT ON `scheduled_job_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'scheduled_job_audit_log', 'ScheduledJobAuditLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('scheduled_job_audit_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_job_audit_log_au_audit` AFTER UPDATE ON `scheduled_job_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'scheduled_job_audit_log', 'ScheduledJobAuditLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('scheduled_job_audit_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_job_audit_log_ad_audit` AFTER DELETE ON `scheduled_job_audit_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'scheduled_job_audit_log', 'ScheduledJobAuditLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('scheduled_job_audit_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `scheduled_jobs`
--

DROP TABLE IF EXISTS `scheduled_jobs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `scheduled_jobs` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL,
  `job_type` varchar(40) NOT NULL,
  `entity_type` varchar(40) DEFAULT NULL,
  `entity_id` int DEFAULT NULL,
  `status` enum('scheduled','in_progress','pending_ack','overdue','completed','failed','canceled','escalated') DEFAULT 'scheduled',
  `next_due` datetime NOT NULL,
  `recurrence_pattern` varchar(100) DEFAULT NULL,
  `cron_expression` varchar(100) DEFAULT NULL,
  `last_executed` datetime DEFAULT NULL,
  `last_result` varchar(255) DEFAULT NULL,
  `escalation_level` int DEFAULT '0',
  `escalation_note` varchar(255) DEFAULT NULL,
  `chain_job_id` int DEFAULT NULL,
  `is_critical` tinyint(1) DEFAULT '0',
  `needs_acknowledgment` tinyint(1) DEFAULT '0',
  `acknowledged_by` int DEFAULT NULL,
  `acknowledged_at` datetime DEFAULT NULL,
  `alert_on_failure` tinyint(1) DEFAULT '1',
  `retries` int DEFAULT '0',
  `max_retries` int DEFAULT '3',
  `last_error` text,
  `iot_device_id` varchar(80) DEFAULT NULL,
  `extra_params` json DEFAULT NULL,
  `created_by` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `last_modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `last_modified_by` int DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `ip_address` varchar(45) DEFAULT NULL,
  `comment` text,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `last_modified_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_sj_created_by` (`created_by`),
  KEY `fk_sj_last_modified_by` (`last_modified_by`),
  KEY `fk_sj_ack_by` (`acknowledged_by`),
  KEY `fk_sj_chain` (`chain_job_id`),
  KEY `idx_scheduled_jobs_next_due` (`next_due`),
  KEY `idx_scheduled_jobs_status` (`status`),
  KEY `idx_scheduled_jobs_job_type` (`job_type`),
  CONSTRAINT `fk_sj_ack_by` FOREIGN KEY (`acknowledged_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_sj_chain` FOREIGN KEY (`chain_job_id`) REFERENCES `scheduled_jobs` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_sj_created_by` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_sj_last_modified_by` FOREIGN KEY (`last_modified_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `scheduled_jobs`
--

LOCK TABLES `scheduled_jobs` WRITE;
/*!40000 ALTER TABLE `scheduled_jobs` DISABLE KEYS */;
/*!40000 ALTER TABLE `scheduled_jobs` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_jobs_insert` AFTER INSERT ON `scheduled_jobs` FOR EACH ROW BEGIN
    INSERT INTO scheduled_job_audit_log (
        scheduled_job_id, user_id, action, new_value, source_ip, device_info, session_id, digital_signature, note
    ) VALUES (
        NEW.id, NEW.created_by, 'CREATE',
        CONCAT('Created job: ', NEW.name, ' [', NEW.job_type, ']'),
        NEW.ip_address, NEW.device_info, NEW.session_id, NEW.digital_signature, NEW.comment
    );
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_jobs_ai_audit` AFTER INSERT ON `scheduled_jobs` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'scheduled_jobs', 'ScheduledJobsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('scheduled_jobs insert', CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_jobs_update` AFTER UPDATE ON `scheduled_jobs` FOR EACH ROW BEGIN
    INSERT INTO scheduled_job_audit_log (
        scheduled_job_id, user_id, action, old_value, new_value, source_ip, device_info, session_id, digital_signature, note
    ) VALUES (
        NEW.id, NEW.last_modified_by, 'UPDATE',
        OLD.comment, NEW.comment,
        NEW.ip_address, NEW.device_info, NEW.session_id, NEW.digital_signature, NEW.comment
    );
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_jobs_au_audit` AFTER UPDATE ON `scheduled_jobs` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'scheduled_jobs', 'ScheduledJobsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('scheduled_jobs update', CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'scheduled_jobs', 'ScheduledJobsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'scheduled_jobs update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_jobs_delete` AFTER DELETE ON `scheduled_jobs` FOR EACH ROW BEGIN
    INSERT INTO scheduled_job_audit_log (
        scheduled_job_id, user_id, action, old_value, source_ip, device_info, session_id, note
    ) VALUES (
        OLD.id, OLD.last_modified_by, 'DELETE',
        OLD.comment, OLD.ip_address, OLD.device_info, OLD.session_id, OLD.comment
    );
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_scheduled_jobs_ad_audit` AFTER DELETE ON `scheduled_jobs` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'scheduled_jobs', 'ScheduledJobsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('scheduled_jobs delete', CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `schema_migration_log`
--

DROP TABLE IF EXISTS `schema_migration_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `schema_migration_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `migration_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `migrated_by` int DEFAULT NULL,
  `schema_version` varchar(50) DEFAULT NULL,
  `migration_script` text,
  `description` text,
  `source_ip` varchar(45) DEFAULT NULL,
  `success` tinyint(1) DEFAULT '1',
  `error_message` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`migration_time`) VIRTUAL,
  `migrated_by_id` int DEFAULT NULL,
  `username` varchar(80) DEFAULT NULL,
  `rollback_script` varchar(255) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `entry_hash` varchar(128) DEFAULT NULL,
  `attachments_json` varchar(255) DEFAULT NULL,
  `regulator` varchar(40) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `note` varchar(1000) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_mig_user` (`migrated_by`),
  CONSTRAINT `fk_mig_user` FOREIGN KEY (`migrated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `schema_migration_log`
--

LOCK TABLES `schema_migration_log` WRITE;
/*!40000 ALTER TABLE `schema_migration_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `schema_migration_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_schema_migration_log_ai_audit` AFTER INSERT ON `schema_migration_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'schema_migration_log', 'SchemaMigrationLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('schema_migration_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_schema_migration_log_au_audit` AFTER UPDATE ON `schema_migration_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'schema_migration_log', 'SchemaMigrationLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('schema_migration_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_schema_migration_log_ad_audit` AFTER DELETE ON `schema_migration_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'schema_migration_log', 'SchemaMigrationLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('schema_migration_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `sensitive_data_access_log`
--

DROP TABLE IF EXISTS `sensitive_data_access_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `sensitive_data_access_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `access_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `table_name` varchar(100) DEFAULT NULL,
  `record_id` int DEFAULT NULL,
  `field_name` varchar(100) DEFAULT NULL,
  `access_type` enum('view','export','print','api','edit','delete') DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `purpose` varchar(255) DEFAULT NULL,
  `approved_by` int DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `accessed_at` datetime GENERATED ALWAYS AS (`access_time`) VIRTUAL,
  `timestamp` datetime GENERATED ALWAYS AS (`access_time`) VIRTUAL,
  `action` varchar(30) GENERATED ALWAYS AS (`access_type`) VIRTUAL,
  `details` text GENERATED ALWAYS AS (coalesce(`purpose`,`note`)) VIRTUAL,
  `user` varchar(255) DEFAULT NULL,
  `username` varchar(80) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `approved_by_id` int DEFAULT NULL,
  `approver_name` varchar(100) DEFAULT NULL,
  `approved_at` datetime DEFAULT NULL,
  `approval_method` varchar(40) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `entry_hash` varchar(128) DEFAULT NULL,
  `geo_location` varchar(100) DEFAULT NULL,
  `severity` varchar(24) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_sdal_user` (`user_id`),
  KEY `fk_sdal_appr` (`approved_by`),
  CONSTRAINT `fk_sdal_appr` FOREIGN KEY (`approved_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_sdal_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sensitive_data_access_log`
--

LOCK TABLES `sensitive_data_access_log` WRITE;
/*!40000 ALTER TABLE `sensitive_data_access_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `sensitive_data_access_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensitive_access_fk_guard` BEFORE INSERT ON `sensitive_data_access_log` FOR EACH ROW BEGIN
  IF NEW.user_id IS NOT NULL THEN
    IF (SELECT COUNT(*) FROM users WHERE id = NEW.user_id) = 0 THEN
      SET NEW.user_id = NULL;
    END IF;
  END IF;
  IF NEW.approved_by IS NOT NULL THEN
    IF (SELECT COUNT(*) FROM users WHERE id = NEW.approved_by) = 0 THEN
      SET NEW.approved_by = NULL;
    END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensitive_data_access_log_ai_audit` AFTER INSERT ON `sensitive_data_access_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'sensitive_data_access_log', 'SensitiveDataAccessLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sensitive_data_access_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensitive_data_access_log_au_audit` AFTER UPDATE ON `sensitive_data_access_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'sensitive_data_access_log', 'SensitiveDataAccessLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sensitive_data_access_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensitive_data_access_log_ad_audit` AFTER DELETE ON `sensitive_data_access_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'sensitive_data_access_log', 'SensitiveDataAccessLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('sensitive_data_access_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `sensor_data_logs`
--

DROP TABLE IF EXISTS `sensor_data_logs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `sensor_data_logs` (
  `id` int NOT NULL AUTO_INCREMENT,
  `component_id` int DEFAULT NULL,
  `sensor_type` enum('temperatura','tlak','vlaga','protok') DEFAULT NULL,
  `value` decimal(10,2) DEFAULT NULL,
  `unit` varchar(10) DEFAULT NULL,
  `timestamp` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `unit_id` int DEFAULT NULL,
  `sensor_type_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_sdl_component` (`component_id`),
  KEY `idx_sdl_sensor_type_id` (`sensor_type_id`),
  KEY `idx_sdl_unit_id` (`unit_id`),
  CONSTRAINT `fk_sdl_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_sdl_sensortype` FOREIGN KEY (`sensor_type_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_sdl_unit` FOREIGN KEY (`unit_id`) REFERENCES `units` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sensor_data_logs`
--

LOCK TABLES `sensor_data_logs` WRITE;
/*!40000 ALTER TABLE `sensor_data_logs` DISABLE KEYS */;
/*!40000 ALTER TABLE `sensor_data_logs` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sdl_sync` BEFORE INSERT ON `sensor_data_logs` FOR EACH ROW BEGIN
  CALL ref_touch('sensor_type', NEW.sensor_type, NEW.sensor_type);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.sensor_type_id = LAST_INSERT_ID(); END IF;

  
  IF NEW.unit IS NOT NULL THEN
    INSERT INTO units(code,name,quantity) VALUES (NEW.unit, NEW.unit, NULL)
    ON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id), name=VALUES(name);
    SET NEW.unit_id = LAST_INSERT_ID();
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_data_logs_ai_audit` AFTER INSERT ON `sensor_data_logs` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'sensor_data_logs', 'SensorDataLogsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sensor_data_logs insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sdl_sync_u` BEFORE UPDATE ON `sensor_data_logs` FOR EACH ROW BEGIN
  IF (NEW.sensor_type <=> OLD.sensor_type) = 0 THEN
    CALL ref_touch('sensor_type', NEW.sensor_type, NEW.sensor_type);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.sensor_type_id = LAST_INSERT_ID(); END IF;
  END IF;

  IF (NEW.unit <=> OLD.unit) = 0 AND NEW.unit IS NOT NULL THEN
    INSERT INTO units(code,name) VALUES (NEW.unit, NEW.unit)
    ON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id), name=VALUES(name);
    SET NEW.unit_id = LAST_INSERT_ID();
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_data_logs_au_audit` AFTER UPDATE ON `sensor_data_logs` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'sensor_data_logs', 'SensorDataLogsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sensor_data_logs update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_data_logs_ad_audit` AFTER DELETE ON `sensor_data_logs` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'sensor_data_logs', 'SensorDataLogsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('sensor_data_logs delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `sensor_models`
--

DROP TABLE IF EXISTS `sensor_models`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `sensor_models` (
  `id` int NOT NULL AUTO_INCREMENT,
  `vendor` varchar(120) DEFAULT NULL,
  `model_code` varchar(100) DEFAULT NULL,
  `sensor_type_code` varchar(80) DEFAULT NULL,
  `unit_code` varchar(20) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_sensor_model` (`vendor`,`model_code`)
) ENGINE=InnoDB AUTO_INCREMENT=33 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sensor_models`
--

LOCK TABLES `sensor_models` WRITE;
/*!40000 ALTER TABLE `sensor_models` DISABLE KEYS */;
INSERT INTO `sensor_models` VALUES (1,'Sensirion','SHT31-TEMP','temperatura','┬░C','2025-08-28 12:36:26','2025-08-28 12:36:26'),(2,'Sensirion','SHT31-RH','vlaga','%','2025-08-28 12:36:26','2025-08-28 12:36:26'),(3,'Bosch','BMP280','tlak','Pa','2025-08-28 12:36:26','2025-08-28 12:36:26'),(4,'Omega','PT100','temperatura','┬░C','2025-08-28 12:36:26','2025-08-28 12:36:26'),(5,'Siemens','SITRANS-F','protok','L/min','2025-08-28 12:36:26','2025-08-28 12:36:26'),(6,'IFM','PN2094','tlak','Pa','2025-08-28 12:36:26','2025-08-28 12:36:26'),(7,'Honeywell','ABP-PA','tlak','Pa','2025-08-28 12:36:26','2025-08-28 12:36:26'),(8,'Keyence','FT50','protok','L/min','2025-08-28 12:36:26','2025-08-28 12:36:26');
/*!40000 ALTER TABLE `sensor_models` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_models_ai_audit` AFTER INSERT ON `sensor_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'sensor_models', 'SensorModelsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sensor_models insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_models_au_audit` AFTER UPDATE ON `sensor_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'sensor_models', 'SensorModelsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sensor_models update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_models_ad_audit` AFTER DELETE ON `sensor_models` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'sensor_models', 'SensorModelsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('sensor_models delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `sensor_types`
--

DROP TABLE IF EXISTS `sensor_types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `sensor_types` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(20) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `default_unit_id` int DEFAULT NULL,
  `accuracy` decimal(6,3) DEFAULT NULL,
  `range_min` decimal(10,3) DEFAULT NULL,
  `range_max` decimal(10,3) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  KEY `fk_st_unit` (`default_unit_id`),
  CONSTRAINT `fk_st_unit` FOREIGN KEY (`default_unit_id`) REFERENCES `measurement_units` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sensor_types`
--

LOCK TABLES `sensor_types` WRITE;
/*!40000 ALTER TABLE `sensor_types` DISABLE KEYS */;
/*!40000 ALTER TABLE `sensor_types` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_types_ai_audit` AFTER INSERT ON `sensor_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'sensor_types', 'SensorTypesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sensor_types insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_types_au_audit` AFTER UPDATE ON `sensor_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'sensor_types', 'SensorTypesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sensor_types update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'sensor_types', 'SensorTypesPage', NEW.id, 'code',
       OLD.code, NEW.code, 'sensor_types update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'sensor_types', 'SensorTypesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'sensor_types update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sensor_types_ad_audit` AFTER DELETE ON `sensor_types` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'sensor_types', 'SensorTypesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('sensor_types delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `session_log`
--

DROP TABLE IF EXISTS `session_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `session_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `session_token` varchar(128) NOT NULL,
  `login_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `logout_time` datetime DEFAULT NULL,
  `ip_address` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `mfa_success` tinyint(1) DEFAULT '1',
  `reason` text,
  `is_terminated` tinyint(1) DEFAULT '0',
  `terminated_by` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`login_time`) VIRTUAL,
  `action` varchar(20) GENERATED ALWAYS AS (if((`is_terminated` = 1),_cp852'TERMINATE',_cp852'SESSION')) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`reason`) VIRTUAL,
  `user` varchar(255) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `login_at` datetime DEFAULT NULL,
  `logout_at` datetime DEFAULT NULL,
  `is_impersonated` tinyint(1) DEFAULT NULL,
  `impersonated_by_id` int DEFAULT NULL,
  `impersonated_by` varchar(255) DEFAULT NULL,
  `is_temporary_escalation` tinyint(1) DEFAULT NULL,
  `note` varchar(400) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_sl_user` (`user_id`),
  KEY `fk_sl_by` (`terminated_by`),
  CONSTRAINT `fk_sl_by` FOREIGN KEY (`terminated_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_sl_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `session_log`
--

LOCK TABLES `session_log` WRITE;
/*!40000 ALTER TABLE `session_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `session_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_session_log_ai_audit` AFTER INSERT ON `session_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'session_log', 'SessionLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('session_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_session_log_au_audit` AFTER UPDATE ON `session_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'session_log', 'SessionLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('session_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_session_log_ad_audit` AFTER DELETE ON `session_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'session_log', 'SessionLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('session_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `settings`
--

DROP TABLE IF EXISTS `settings`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `settings` (
  `id` int NOT NULL AUTO_INCREMENT,
  `updated_at` datetime DEFAULT NULL,
  `updated_by_id` int DEFAULT NULL,
  `value` varchar(255) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `settings`
--

LOCK TABLES `settings` WRITE;
/*!40000 ALTER TABLE `settings` DISABLE KEYS */;
/*!40000 ALTER TABLE `settings` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `sites`
--

DROP TABLE IF EXISTS `sites`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `sites` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(20) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `timezone` varchar(40) DEFAULT 'Europe/Zagreb',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sites`
--

LOCK TABLES `sites` WRITE;
/*!40000 ALTER TABLE `sites` DISABLE KEYS */;
/*!40000 ALTER TABLE `sites` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sites_ai_audit` AFTER INSERT ON `sites` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'sites', 'SitesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sites insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sites_au_audit` AFTER UPDATE ON `sites` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'sites', 'SitesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sites update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'sites', 'SitesPage', NEW.id, 'code',
       OLD.code, NEW.code, 'sites update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'sites', 'SitesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'sites update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sites_ad_audit` AFTER DELETE ON `sites` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'sites', 'SitesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('sites delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `sop_document_log`
--

DROP TABLE IF EXISTS `sop_document_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `sop_document_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `sop_document_id` int DEFAULT NULL,
  `action` enum('create','update','archive','approve','invalidate','review','new_version') DEFAULT NULL,
  `performed_by` int DEFAULT NULL,
  `performed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_soplog_doc` (`sop_document_id`),
  KEY `fk_soplog_user` (`performed_by`),
  CONSTRAINT `fk_soplog_doc` FOREIGN KEY (`sop_document_id`) REFERENCES `sop_documents` (`id`),
  CONSTRAINT `fk_soplog_user` FOREIGN KEY (`performed_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sop_document_log`
--

LOCK TABLES `sop_document_log` WRITE;
/*!40000 ALTER TABLE `sop_document_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `sop_document_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sop_document_log_ai_audit` AFTER INSERT ON `sop_document_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'sop_document_log', 'SopDocumentLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sop_document_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sop_document_log_au_audit` AFTER UPDATE ON `sop_document_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'sop_document_log', 'SopDocumentLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sop_document_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sop_document_log_ad_audit` AFTER DELETE ON `sop_document_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'sop_document_log', 'SopDocumentLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('sop_document_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `sop_documents`
--

DROP TABLE IF EXISTS `sop_documents`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `sop_documents` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(50) DEFAULT NULL,
  `name` varchar(255) DEFAULT NULL,
  `version` varchar(40) DEFAULT NULL,
  `status` enum('draft','active','archived','obsolete') DEFAULT NULL,
  `created_by` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `approved_by` int DEFAULT NULL,
  `approved_at` datetime DEFAULT NULL,
  `file_path` varchar(255) DEFAULT NULL,
  `notes` text,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `description` varchar(400) DEFAULT NULL,
  `process` varchar(80) DEFAULT NULL,
  `language` varchar(10) DEFAULT NULL,
  `date_issued` datetime DEFAULT NULL,
  `date_expiry` datetime DEFAULT NULL,
  `next_review_date` datetime DEFAULT NULL,
  `attachments` varchar(255) DEFAULT NULL,
  `responsible_user_id` int DEFAULT NULL,
  `responsible_user` varchar(255) DEFAULT NULL,
  `created_by_id` int DEFAULT NULL,
  `version_no` int DEFAULT NULL,
  `file_hash` varchar(128) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `chain_hash` varchar(128) DEFAULT NULL,
  `approver_ids` varchar(255) DEFAULT NULL,
  `approvers` varchar(255) DEFAULT NULL,
  `approval_timestamps` varchar(255) DEFAULT NULL,
  `review_notes` varchar(1000) DEFAULT NULL,
  `pdf_metadata` varchar(1024) DEFAULT NULL,
  `related_type` varchar(40) DEFAULT NULL,
  `related_id` int DEFAULT NULL,
  `comment` varchar(400) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `ai_tags` varchar(512) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`),
  KEY `fk_sop_created` (`created_by`),
  KEY `fk_sop_approved` (`approved_by`),
  CONSTRAINT `fk_sop_approved` FOREIGN KEY (`approved_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_sop_created` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sop_documents`
--

LOCK TABLES `sop_documents` WRITE;
/*!40000 ALTER TABLE `sop_documents` DISABLE KEYS */;
/*!40000 ALTER TABLE `sop_documents` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sop_documents_ai_audit` AFTER INSERT ON `sop_documents` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'sop_documents', 'SopDocumentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sop_documents insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sop_documents_au_audit` AFTER UPDATE ON `sop_documents` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'sop_documents', 'SopDocumentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('sop_documents update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'sop_documents', 'SopDocumentsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'sop_documents update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'sop_documents', 'SopDocumentsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'sop_documents update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sop_documents_ad_audit` AFTER DELETE ON `sop_documents` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'sop_documents', 'SopDocumentsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('sop_documents delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `stock_levels`
--

DROP TABLE IF EXISTS `stock_levels`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `stock_levels` (
  `id` int NOT NULL AUTO_INCREMENT,
  `part_id` int DEFAULT NULL,
  `warehouse_id` int DEFAULT NULL,
  `quantity` int DEFAULT NULL,
  `min_threshold` int DEFAULT NULL,
  `max_threshold` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `part` varchar(255) DEFAULT NULL,
  `warehouse` varchar(255) DEFAULT NULL,
  `auto_reorder_triggered` tinyint(1) DEFAULT NULL,
  `days_below_min` int DEFAULT NULL,
  `alarm_status` varchar(30) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `geo_location` varchar(100) DEFAULT NULL,
  `comment` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `entry_hash` varchar(128) DEFAULT NULL,
  `old_state_snapshot` varchar(255) DEFAULT NULL,
  `new_state_snapshot` varchar(255) DEFAULT NULL,
  `is_automated` tinyint(1) DEFAULT NULL,
  `session_id` varchar(80) DEFAULT NULL,
  `related_case_id` int DEFAULT NULL,
  `related_case_type` varchar(30) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_sl_part` (`part_id`),
  KEY `fk_sl_warehouse` (`warehouse_id`),
  CONSTRAINT `fk_sl_part` FOREIGN KEY (`part_id`) REFERENCES `parts` (`id`),
  CONSTRAINT `fk_sl_warehouse` FOREIGN KEY (`warehouse_id`) REFERENCES `warehouses` (`id`),
  CONSTRAINT `chk_qty_nonneg` CHECK ((`quantity` >= 0)),
  CONSTRAINT `chk_sl_ranges` CHECK (((`min_threshold` is null) or (`max_threshold` is null) or (`max_threshold` >= `min_threshold`)))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `stock_levels`
--

LOCK TABLES `stock_levels` WRITE;
/*!40000 ALTER TABLE `stock_levels` DISABLE KEYS */;
/*!40000 ALTER TABLE `stock_levels` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_stock_levels_ai_audit` AFTER INSERT ON `stock_levels` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'stock_levels', 'StockLevelsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('stock_levels insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_stock_levels_au_audit` AFTER UPDATE ON `stock_levels` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'stock_levels', 'StockLevelsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('stock_levels update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_stock_levels_ad_audit` AFTER DELETE ON `stock_levels` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'stock_levels', 'StockLevelsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('stock_levels delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `supplier`
--

DROP TABLE IF EXISTS `supplier`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `supplier` (
  `id` int NOT NULL AUTO_INCREMENT,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `supplier`
--

LOCK TABLES `supplier` WRITE;
/*!40000 ALTER TABLE `supplier` DISABLE KEYS */;
/*!40000 ALTER TABLE `supplier` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `supplier_audit`
--

DROP TABLE IF EXISTS `supplier_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `supplier_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `digital_signature` varchar(255) DEFAULT NULL,
  `changed_at` datetime DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `details` varchar(255) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `supplier_id` int DEFAULT NULL,
  `action` varchar(255) DEFAULT NULL,
  `user_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `supplier_audit`
--

LOCK TABLES `supplier_audit` WRITE;
/*!40000 ALTER TABLE `supplier_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `supplier_audit` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `supplier_risk_audit`
--

DROP TABLE IF EXISTS `supplier_risk_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `supplier_risk_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `supplier_id` int DEFAULT NULL,
  `audit_date` date DEFAULT NULL,
  `score` int DEFAULT NULL,
  `performed_by` int DEFAULT NULL,
  `findings` text,
  `corrective_actions` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_sra_supplier` (`supplier_id`),
  KEY `fk_sra_user` (`performed_by`),
  CONSTRAINT `fk_sra_supplier` FOREIGN KEY (`supplier_id`) REFERENCES `suppliers` (`id`),
  CONSTRAINT `fk_sra_user` FOREIGN KEY (`performed_by`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `supplier_risk_audit`
--

LOCK TABLES `supplier_risk_audit` WRITE;
/*!40000 ALTER TABLE `supplier_risk_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `supplier_risk_audit` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_supplier_risk_audit_ai_audit` AFTER INSERT ON `supplier_risk_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'supplier_risk_audit', 'SupplierRiskAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('supplier_risk_audit insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_supplier_risk_audit_au_audit` AFTER UPDATE ON `supplier_risk_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'supplier_risk_audit', 'SupplierRiskAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('supplier_risk_audit update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_supplier_risk_audit_ad_audit` AFTER DELETE ON `supplier_risk_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'supplier_risk_audit', 'SupplierRiskAuditPage', OLD.id, NULL,
     NULL, NULL, CONCAT('supplier_risk_audit delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `suppliers`
--

DROP TABLE IF EXISTS `suppliers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `suppliers` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) DEFAULT NULL,
  `vat_number` varchar(40) DEFAULT NULL,
  `code` varchar(50) DEFAULT NULL,
  `oib` varchar(40) DEFAULT NULL,
  `contact` varchar(100) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `phone` varchar(50) DEFAULT NULL,
  `website` varchar(200) DEFAULT NULL,
  `supplier_type` varchar(40) DEFAULT NULL,
  `notes` text,
  `contract_file` varchar(255) DEFAULT NULL,
  `address` text,
  `city` varchar(80) DEFAULT NULL,
  `country` varchar(80) DEFAULT NULL,
  `type` varchar(40) DEFAULT NULL,
  `status` varchar(40) DEFAULT NULL,
  `contract_start` date DEFAULT NULL,
  `contract_end` date DEFAULT NULL,
  `cert_doc` varchar(255) DEFAULT NULL,
  `valid_until` date DEFAULT NULL,
  `risk_score` int DEFAULT '50',
  `last_audit` date DEFAULT NULL,
  `comment` text,
  `digital_signature` varchar(128) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `status_id` int DEFAULT NULL,
  `type_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_sup_status_id` (`status_id`),
  KEY `idx_sup_type_id` (`type_id`),
  CONSTRAINT `fk_sup_status` FOREIGN KEY (`status_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_sup_type` FOREIGN KEY (`type_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `suppliers`
--

LOCK TABLES `suppliers` WRITE;
/*!40000 ALTER TABLE `suppliers` DISABLE KEYS */;
/*!40000 ALTER TABLE `suppliers` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sup_sync` BEFORE INSERT ON `suppliers` FOR EACH ROW BEGIN
  CALL ref_touch('supplier_status', NEW.status, NEW.status);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
  CALL ref_touch('supplier_type', NEW.type, NEW.type);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.type_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_suppliers_ai_audit` AFTER INSERT ON `suppliers` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'suppliers', 'SuppliersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('suppliers insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_sup_sync_u` BEFORE UPDATE ON `suppliers` FOR EACH ROW BEGIN
  IF (NEW.status <=> OLD.status) = 0 THEN
    CALL ref_touch('supplier_status', NEW.status, NEW.status);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
  END IF;
  IF (NEW.type <=> OLD.type) = 0 THEN
    CALL ref_touch('supplier_type', NEW.type, NEW.type);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.type_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_suppliers_au_audit` AFTER UPDATE ON `suppliers` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'suppliers', 'SuppliersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('suppliers update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'suppliers', 'SuppliersPage', NEW.id, 'code',
       OLD.code, NEW.code, 'suppliers update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'suppliers', 'SuppliersPage', NEW.id, 'name',
       OLD.name, NEW.name, 'suppliers update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_suppliers_ad_audit` AFTER DELETE ON `suppliers` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'suppliers', 'SuppliersPage', OLD.id, NULL,
     NULL, NULL, CONCAT('suppliers delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `system_event_log`
--

DROP TABLE IF EXISTS `system_event_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `system_event_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `event_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `timestamp` datetime DEFAULT CURRENT_TIMESTAMP,
  `user_id` int DEFAULT NULL,
  `event_type` varchar(100) DEFAULT NULL,
  `action` varchar(100) DEFAULT NULL,
  `table_name` varchar(100) DEFAULT NULL,
  `related_module` varchar(100) DEFAULT NULL,
  `record_id` int DEFAULT NULL,
  `field_name` varchar(100) DEFAULT NULL,
  `old_value` text,
  `new_value` text,
  `description` text,
  `details` text,
  `source_ip` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `severity` varchar(20) DEFAULT NULL,
  `processed` tinyint(1) DEFAULT '0',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `ts_utc` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `username` varchar(128) DEFAULT NULL,
  `digital_signature` varchar(256) DEFAULT NULL,
  `entry_hash` varchar(256) DEFAULT NULL,
  `mac_address` varchar(64) DEFAULT NULL,
  `geo_location` varchar(128) DEFAULT NULL,
  `regulator` varchar(64) DEFAULT NULL,
  `related_case_id` int DEFAULT NULL,
  `related_case_type` varchar(64) DEFAULT NULL,
  `anomaly_score` double DEFAULT NULL,
  `user` varchar(255) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_sel_user` (`user_id`),
  KEY `idx_sel_time_sev` (`timestamp`,`severity`),
  KEY `ix_system_event_log_ts` (`ts_utc`),
  KEY `ix_event_table_record_ts` (`table_name`,`record_id`,`ts_utc`),
  KEY `ix_event_type_ts` (`event_type`,`ts_utc`),
  CONSTRAINT `fk_sel_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=15451 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `system_event_log`
--

LOCK TABLES `system_event_log` WRITE;
/*!40000 ALTER TABLE `system_event_log` DISABLE KEYS */;
INSERT INTO `system_event_log` VALUES (15348,'2025-09-10 10:33:26','2025-09-10 10:33:26',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=cc74e9d9d84b41e29a2ba88e; IPv4=192.168.108.54','cc74e9d9d84b41e29a2ba88ef7df070c','info',0,'2025-09-10 10:33:26','2025-09-10 10:33:26','2025-09-10 10:33:26',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15349,'2025-09-10 10:33:26','2025-09-10 10:33:26',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=cc74e9d9d84b41e29a2ba88e; IPv4=192.168.108.54','cc74e9d9d84b41e29a2ba88ef7df070c','info',0,'2025-09-10 10:33:26','2025-09-10 10:33:26','2025-09-10 10:33:26',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15350,'2025-09-10 10:33:26','2025-09-10 10:33:26',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 10:33:26','2025-09-10 10:33:26','2025-09-10 10:33:26',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15351,'2025-09-10 11:49:13','2025-09-10 11:49:13',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=7d8e6e113e94414fae1ffd8e; IPv4=192.168.108.54','7d8e6e113e94414fae1ffd8ef480f609','info',0,'2025-09-10 11:49:13','2025-09-10 11:49:13','2025-09-10 11:49:13',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15352,'2025-09-10 11:49:13','2025-09-10 11:49:13',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=7d8e6e113e94414fae1ffd8e; IPv4=192.168.108.54','7d8e6e113e94414fae1ffd8ef480f609','info',0,'2025-09-10 11:49:13','2025-09-10 11:49:13','2025-09-10 11:49:13',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15353,'2025-09-10 11:49:13','2025-09-10 11:49:13',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 11:49:13','2025-09-10 11:49:13','2025-09-10 11:49:13',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15354,'2025-09-10 12:54:47','2025-09-10 12:54:47',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=9d536be1df01438f9e839236; IPv4=192.168.108.54','9d536be1df01438f9e839236d7974f3b','info',0,'2025-09-10 12:54:47','2025-09-10 12:54:47','2025-09-10 12:54:47',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15355,'2025-09-10 12:54:47','2025-09-10 12:54:47',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=9d536be1df01438f9e839236; IPv4=192.168.108.54','9d536be1df01438f9e839236d7974f3b','info',0,'2025-09-10 12:54:47','2025-09-10 12:54:47','2025-09-10 12:54:47',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15356,'2025-09-10 12:54:47','2025-09-10 12:54:47',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 12:54:47','2025-09-10 12:54:47','2025-09-10 12:54:47',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15357,'2025-09-10 12:59:13','2025-09-10 12:59:13',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=efd569c7010d4706ac5bcfa1; IPv4=192.168.108.54','efd569c7010d4706ac5bcfa1a13df57c','info',0,'2025-09-10 12:59:13','2025-09-10 12:59:13','2025-09-10 12:59:13',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15358,'2025-09-10 12:59:14','2025-09-10 12:59:14',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=efd569c7010d4706ac5bcfa1; IPv4=192.168.108.54','efd569c7010d4706ac5bcfa1a13df57c','info',0,'2025-09-10 12:59:14','2025-09-10 12:59:14','2025-09-10 12:59:14',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15359,'2025-09-10 12:59:14','2025-09-10 12:59:14',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 12:59:14','2025-09-10 12:59:14','2025-09-10 12:59:14',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15360,'2025-09-10 13:19:04','2025-09-10 13:19:04',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=cc64770b82354aa7897ce5e5; IPv4=192.168.108.54','cc64770b82354aa7897ce5e5be0d1730','info',0,'2025-09-10 13:19:04','2025-09-10 13:19:04','2025-09-10 13:19:04',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15361,'2025-09-10 13:19:04','2025-09-10 13:19:04',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=cc64770b82354aa7897ce5e5; IPv4=192.168.108.54','cc64770b82354aa7897ce5e5be0d1730','info',0,'2025-09-10 13:19:04','2025-09-10 13:19:04','2025-09-10 13:19:04',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15362,'2025-09-10 13:19:04','2025-09-10 13:19:04',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 13:19:04','2025-09-10 13:19:04','2025-09-10 13:19:04',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15363,'2025-09-10 13:20:49','2025-09-10 13:20:49',NULL,'INSERT','INSERT','locations','LocationsPage',2,NULL,NULL,NULL,'locations insert; code=; name=Hala','locations insert; code=; name=Hala','system','server','','info',0,'2025-09-10 13:20:49','2025-09-10 13:20:49','2025-09-10 13:20:49',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15364,'2025-09-10 13:20:57','2025-09-10 13:20:57',NULL,'INSERT','INSERT','manufacturers','ManufacturersPage',37,NULL,NULL,NULL,'manufacturers insert; name=CAM','manufacturers insert; name=CAM','system','server','','info',0,'2025-09-10 13:20:57','2025-09-10 13:20:57','2025-09-10 13:20:57',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15365,'2025-09-10 13:21:08','2025-09-10 13:21:08',NULL,'INSERT','INSERT','machine_types','MachineTypesPage',42,NULL,NULL,NULL,'machine_types insert; code=; name=PLAM','machine_types insert; code=; name=PLAM','system','server','','info',0,'2025-09-10 13:21:08','2025-09-10 13:21:08','2025-09-10 13:21:08',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15366,'2025-09-10 13:35:32','2025-09-10 13:35:32',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=9b5cde86bb2a4af4b2360948; IPv4=192.168.108.54','9b5cde86bb2a4af4b236094808f4754f','info',0,'2025-09-10 13:35:32','2025-09-10 13:35:32','2025-09-10 13:35:32',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15367,'2025-09-10 13:35:32','2025-09-10 13:35:32',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=9b5cde86bb2a4af4b2360948; IPv4=192.168.108.54','9b5cde86bb2a4af4b236094808f4754f','info',0,'2025-09-10 13:35:32','2025-09-10 13:35:32','2025-09-10 13:35:32',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15368,'2025-09-10 13:35:32','2025-09-10 13:35:32',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 13:35:32','2025-09-10 13:35:32','2025-09-10 13:35:32',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15369,'2025-09-10 14:24:28','2025-09-10 14:24:28',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=d7d1b094faf34e4a89f79615; IPv4=192.168.108.54','d7d1b094faf34e4a89f79615f2a2e8e0','info',0,'2025-09-10 14:24:28','2025-09-10 14:24:28','2025-09-10 14:24:28',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15370,'2025-09-10 14:24:28','2025-09-10 14:24:28',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=d7d1b094faf34e4a89f79615; IPv4=192.168.108.54','d7d1b094faf34e4a89f79615f2a2e8e0','info',0,'2025-09-10 14:24:28','2025-09-10 14:24:28','2025-09-10 14:24:28',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15371,'2025-09-10 14:24:28','2025-09-10 14:24:28',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 14:24:28','2025-09-10 14:24:28','2025-09-10 14:24:28',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15372,'2025-09-10 14:25:00','2025-09-10 14:25:00',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=a2f374b124a240aa8813ee0a; IPv4=192.168.108.54','a2f374b124a240aa8813ee0af447f80e','info',0,'2025-09-10 14:25:00','2025-09-10 14:25:00','2025-09-10 14:25:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15373,'2025-09-10 14:25:00','2025-09-10 14:25:00',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=a2f374b124a240aa8813ee0a; IPv4=192.168.108.54','a2f374b124a240aa8813ee0af447f80e','info',0,'2025-09-10 14:25:00','2025-09-10 14:25:00','2025-09-10 14:25:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15374,'2025-09-10 14:25:00','2025-09-10 14:25:00',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 14:25:00','2025-09-10 14:25:00','2025-09-10 14:25:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15375,'2025-09-10 14:37:13','2025-09-10 14:37:13',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=406666a22cfc4370afae969d; IPv4=192.168.108.54','406666a22cfc4370afae969d4cafdc07','info',0,'2025-09-10 14:37:13','2025-09-10 14:37:13','2025-09-10 14:37:13',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15376,'2025-09-10 14:37:13','2025-09-10 14:37:13',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=406666a22cfc4370afae969d; IPv4=192.168.108.54','406666a22cfc4370afae969d4cafdc07','info',0,'2025-09-10 14:37:13','2025-09-10 14:37:13','2025-09-10 14:37:13',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15377,'2025-09-10 14:37:13','2025-09-10 14:37:13',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-10 14:37:13','2025-09-10 14:37:13','2025-09-10 14:37:13',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15378,'2025-09-10 14:42:16','2025-09-10 14:42:16',NULL,'INSERT','INSERT','entity_audit_log','EntityAuditLogPage',12,NULL,NULL,NULL,'entity_audit_log insert','entity_audit_log insert','system','server','','info',0,'2025-09-10 14:42:16','2025-09-10 14:42:16','2025-09-10 14:42:16',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15379,'2025-09-10 14:42:16','2025-09-10 14:42:16',1,'LOAD','LOAD','calibrations',NULL,0,NULL,NULL,NULL,'Loaded 0 calibrations','Loaded 0 calibrations','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=406666a22cfc4370afae969d; IPv4=192.168.108.54','406666a22cfc4370afae969d4cafdc07','info',0,'2025-09-10 14:42:16','2025-09-10 14:42:16','2025-09-10 14:42:16',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15380,'2025-09-11 08:32:49','2025-09-11 08:32:49',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=2e58fedcf8604fa5a89d0530; IPv4=192.168.108.54','2e58fedcf8604fa5a89d0530d05bd7b3','info',0,'2025-09-11 08:32:49','2025-09-11 08:32:49','2025-09-11 08:32:49',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15381,'2025-09-11 08:32:49','2025-09-11 08:32:49',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=2e58fedcf8604fa5a89d0530; IPv4=192.168.108.54','2e58fedcf8604fa5a89d0530d05bd7b3','info',0,'2025-09-11 08:32:49','2025-09-11 08:32:49','2025-09-11 08:32:49',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15382,'2025-09-11 08:32:49','2025-09-11 08:32:49',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 08:32:49','2025-09-11 08:32:49','2025-09-11 08:32:49',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15383,'2025-09-11 10:17:11','2025-09-11 10:17:11',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=a62bab959dcb493d8db8e4fb; IPv4=192.168.108.54','a62bab959dcb493d8db8e4fbd7ec02e3','info',0,'2025-09-11 10:17:11','2025-09-11 10:17:11','2025-09-11 10:17:11',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15384,'2025-09-11 10:17:11','2025-09-11 10:17:11',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=a62bab959dcb493d8db8e4fb; IPv4=192.168.108.54','a62bab959dcb493d8db8e4fbd7ec02e3','info',0,'2025-09-11 10:17:11','2025-09-11 10:17:11','2025-09-11 10:17:11',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15385,'2025-09-11 10:17:11','2025-09-11 10:17:11',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 10:17:11','2025-09-11 10:17:11','2025-09-11 10:17:11',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15386,'2025-09-11 10:18:59','2025-09-11 10:18:59',NULL,'UPDATE','UPDATE','parts','PartsPage',1,NULL,NULL,NULL,'parts update; code: xxx → 123; name: xxx → 123','parts update; code: xxx → 123; name: xxx → 123','system','server','','info',0,'2025-09-11 10:18:59','2025-09-11 10:18:59','2025-09-11 10:18:59',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15387,'2025-09-11 10:18:59','2025-09-11 10:18:59',NULL,'UPDATE','UPDATE','parts','PartsPage',1,'code','xxx','123','parts update: code changed','parts update: code changed','system','server','','info',0,'2025-09-11 10:18:59','2025-09-11 10:18:59','2025-09-11 10:18:59',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15388,'2025-09-11 10:18:59','2025-09-11 10:18:59',NULL,'UPDATE','UPDATE','parts','PartsPage',1,'name','xxx','123','parts update: name changed','parts update: name changed','system','server','','info',0,'2025-09-11 10:18:59','2025-09-11 10:18:59','2025-09-11 10:18:59',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15389,'2025-09-11 10:19:14','2025-09-11 10:19:14',NULL,'UPDATE','UPDATE','parts','PartsPage',1,NULL,NULL,NULL,'parts update; code: 123 → 123; name: 123 → 123','parts update; code: 123 → 123; name: 123 → 123','system','server','','info',0,'2025-09-11 10:19:14','2025-09-11 10:19:14','2025-09-11 10:19:14',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15390,'2025-09-11 10:19:14','2025-09-11 10:19:14',NULL,'STOCK_INCREASE','STOCK_INCREASE','parts','PartsPage',1,NULL,NULL,NULL,'delta=4; part=123','delta=4; part=123','ui','PartsPage',NULL,'info',0,'2025-09-11 10:19:14','2025-09-11 10:19:14','2025-09-11 10:19:14',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15391,'2025-09-11 10:19:50','2025-09-11 10:19:50',NULL,'INSERT','INSERT','entity_audit_log','EntityAuditLogPage',13,NULL,NULL,NULL,'entity_audit_log insert','entity_audit_log insert','system','server','','info',0,'2025-09-11 10:19:50','2025-09-11 10:19:50','2025-09-11 10:19:50',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15392,'2025-09-11 10:19:50','2025-09-11 10:19:50',1,'LOAD','LOAD','calibrations',NULL,0,NULL,NULL,NULL,'Loaded 0 calibrations','Loaded 0 calibrations','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=a62bab959dcb493d8db8e4fb; IPv4=192.168.108.54','a62bab959dcb493d8db8e4fbd7ec02e3','info',0,'2025-09-11 10:19:50','2025-09-11 10:19:50','2025-09-11 10:19:50',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15393,'2025-09-11 11:21:28','2025-09-11 11:21:28',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=1890b3a714fc42489de2eb1c; IPv4=192.168.108.54','1890b3a714fc42489de2eb1c6f2f0e4f','info',0,'2025-09-11 11:21:28','2025-09-11 11:21:28','2025-09-11 11:21:28',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15394,'2025-09-11 11:21:28','2025-09-11 11:21:28',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=1890b3a714fc42489de2eb1c; IPv4=192.168.108.54','1890b3a714fc42489de2eb1c6f2f0e4f','info',0,'2025-09-11 11:21:28','2025-09-11 11:21:28','2025-09-11 11:21:28',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15395,'2025-09-11 11:21:28','2025-09-11 11:21:28',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 11:21:28','2025-09-11 11:21:28','2025-09-11 11:21:28',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15396,'2025-09-11 11:34:06','2025-09-11 11:34:06',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=e667ff6d13f54836b854a0ba; IPv4=192.168.108.54','e667ff6d13f54836b854a0bae36b7ac1','info',0,'2025-09-11 11:34:06','2025-09-11 11:34:06','2025-09-11 11:34:06',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15397,'2025-09-11 11:34:06','2025-09-11 11:34:06',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=e667ff6d13f54836b854a0ba; IPv4=192.168.108.54','e667ff6d13f54836b854a0bae36b7ac1','info',0,'2025-09-11 11:34:06','2025-09-11 11:34:06','2025-09-11 11:34:06',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15398,'2025-09-11 11:34:06','2025-09-11 11:34:06',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 11:34:06','2025-09-11 11:34:06','2025-09-11 11:34:06',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15399,'2025-09-11 12:21:59','2025-09-11 12:21:59',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=fedbc88ef55841a790c37c69; IPv4=192.168.108.54','fedbc88ef55841a790c37c698a669b79','info',0,'2025-09-11 12:21:59','2025-09-11 12:21:59','2025-09-11 12:21:59',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15400,'2025-09-11 12:21:59','2025-09-11 12:21:59',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=fedbc88ef55841a790c37c69; IPv4=192.168.108.54','fedbc88ef55841a790c37c698a669b79','info',0,'2025-09-11 12:21:59','2025-09-11 12:21:59','2025-09-11 12:21:59',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15401,'2025-09-11 12:21:59','2025-09-11 12:21:59',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 12:21:59','2025-09-11 12:21:59','2025-09-11 12:21:59',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15402,'2025-09-11 12:52:09','2025-09-11 12:52:09',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=c418a523b7c34c0a83af8a86; IPv4=192.168.108.54','c418a523b7c34c0a83af8a86089576e8','info',0,'2025-09-11 12:52:09','2025-09-11 12:52:09','2025-09-11 12:52:09',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15403,'2025-09-11 12:52:09','2025-09-11 12:52:09',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=c418a523b7c34c0a83af8a86; IPv4=192.168.108.54','c418a523b7c34c0a83af8a86089576e8','info',0,'2025-09-11 12:52:09','2025-09-11 12:52:09','2025-09-11 12:52:09',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15404,'2025-09-11 12:52:09','2025-09-11 12:52:09',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 12:52:09','2025-09-11 12:52:09','2025-09-11 12:52:09',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15405,'2025-09-11 12:58:29','2025-09-11 12:58:29',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=cd61ad69500e4b84953dda98; IPv4=192.168.108.54','cd61ad69500e4b84953dda982a9737c5','info',0,'2025-09-11 12:58:29','2025-09-11 12:58:29','2025-09-11 12:58:29',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15406,'2025-09-11 12:58:29','2025-09-11 12:58:29',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=cd61ad69500e4b84953dda98; IPv4=192.168.108.54','cd61ad69500e4b84953dda982a9737c5','info',0,'2025-09-11 12:58:29','2025-09-11 12:58:29','2025-09-11 12:58:29',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15407,'2025-09-11 12:58:29','2025-09-11 12:58:29',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 12:58:29','2025-09-11 12:58:29','2025-09-11 12:58:29',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15408,'2025-09-11 13:05:09','2025-09-11 13:05:09',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=28afae4e5ab1475b9cdc0fb4; IPv4=192.168.108.54','28afae4e5ab1475b9cdc0fb4efa82b44','info',0,'2025-09-11 13:05:09','2025-09-11 13:05:09','2025-09-11 13:05:09',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15409,'2025-09-11 13:05:09','2025-09-11 13:05:09',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=28afae4e5ab1475b9cdc0fb4; IPv4=192.168.108.54','28afae4e5ab1475b9cdc0fb4efa82b44','info',0,'2025-09-11 13:05:09','2025-09-11 13:05:09','2025-09-11 13:05:09',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15410,'2025-09-11 13:05:09','2025-09-11 13:05:09',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 13:05:09','2025-09-11 13:05:09','2025-09-11 13:05:09',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15411,'2025-09-11 13:12:53','2025-09-11 13:12:53',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=33b50b60f4904aa88c9d3ac3; IPv4=192.168.108.54','33b50b60f4904aa88c9d3ac38b41aa7e','info',0,'2025-09-11 13:12:53','2025-09-11 13:12:53','2025-09-11 13:12:53',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15412,'2025-09-11 13:12:53','2025-09-11 13:12:53',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=33b50b60f4904aa88c9d3ac3; IPv4=192.168.108.54','33b50b60f4904aa88c9d3ac38b41aa7e','info',0,'2025-09-11 13:12:53','2025-09-11 13:12:53','2025-09-11 13:12:53',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15413,'2025-09-11 13:12:53','2025-09-11 13:12:53',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 13:12:53','2025-09-11 13:12:53','2025-09-11 13:12:53',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15414,'2025-09-11 13:22:27','2025-09-11 13:22:27',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=cb7026416b694ac8ac8ba3ec; IPv4=192.168.108.54','cb7026416b694ac8ac8ba3ec50ac40a2','info',0,'2025-09-11 13:22:27','2025-09-11 13:22:27','2025-09-11 13:22:27',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15415,'2025-09-11 13:22:27','2025-09-11 13:22:27',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=cb7026416b694ac8ac8ba3ec; IPv4=192.168.108.54','cb7026416b694ac8ac8ba3ec50ac40a2','info',0,'2025-09-11 13:22:27','2025-09-11 13:22:27','2025-09-11 13:22:27',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15416,'2025-09-11 13:22:27','2025-09-11 13:22:27',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-11 13:22:27','2025-09-11 13:22:27','2025-09-11 13:22:27',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15417,'2025-09-12 07:36:17','2025-09-12 07:36:17',NULL,'UPDATE','UPDATE','machines','MachinesPage',2,NULL,NULL,NULL,'machines update; code: 232 → 23232; name:  → ','machines update; code: 232 → 23232; name:  → ','system','server','','info',0,'2025-09-12 07:36:17','2025-09-12 07:36:17','2025-09-12 07:36:17',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15418,'2025-09-12 07:36:17','2025-09-12 07:36:17',NULL,'UPDATE','UPDATE','machines','MachinesPage',2,'code','232','23232','machines update: code changed','machines update: code changed','system','server','','info',0,'2025-09-12 07:36:17','2025-09-12 07:36:17','2025-09-12 07:36:17',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15419,'2025-09-12 07:39:50','2025-09-12 07:39:50',NULL,'UPDATE','UPDATE','machines','MachinesPage',2,NULL,NULL,NULL,'machines update; code: 23232 → wdwd; name:  → ','machines update; code: 23232 → wdwd; name:  → ','system','server','','info',0,'2025-09-12 07:39:50','2025-09-12 07:39:50','2025-09-12 07:39:50',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15420,'2025-09-12 07:39:50','2025-09-12 07:39:50',NULL,'UPDATE','UPDATE','machines','MachinesPage',2,'code','23232','wdwd','machines update: code changed','machines update: code changed','system','server','','info',0,'2025-09-12 07:39:50','2025-09-12 07:39:50','2025-09-12 07:39:50',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15421,'2025-09-12 07:42:42','2025-09-12 07:42:42',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=6bbf7fd41e15441faee10e9b; IPv4=192.168.108.54','6bbf7fd41e15441faee10e9b3363baad','info',0,'2025-09-12 07:42:42','2025-09-12 07:42:42','2025-09-12 07:42:42',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15422,'2025-09-12 07:42:42','2025-09-12 07:42:42',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=6bbf7fd41e15441faee10e9b; IPv4=192.168.108.54','6bbf7fd41e15441faee10e9b3363baad','info',0,'2025-09-12 07:42:42','2025-09-12 07:42:42','2025-09-12 07:42:42',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15423,'2025-09-12 07:42:42','2025-09-12 07:42:42',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-12 07:42:42','2025-09-12 07:42:42','2025-09-12 07:42:42',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15424,'2025-09-12 07:44:55','2025-09-12 07:44:55',NULL,'UPDATE','UPDATE','machines','MachinesPage',3,NULL,NULL,NULL,'machines update; code: T-1757655324 → T-1757655324; name: T-minimal → T-minimal','machines update; code: T-1757655324 → T-1757655324; name: T-minimal → T-minimal','system','server','','info',0,'2025-09-12 07:44:55','2025-09-12 07:44:55','2025-09-12 07:44:55',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15425,'2025-09-12 07:44:55','2025-09-12 07:44:55',NULL,'MACHINE_UPDATE','MACHINE_UPDATE','machines','MachineModule',3,NULL,NULL,NULL,'T-minimal','T-minimal','ui','MachinesPage',NULL,'audit',0,'2025-09-12 07:44:55','2025-09-12 07:44:55','2025-09-12 07:44:55',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15426,'2025-09-12 07:45:47','2025-09-12 07:45:47',NULL,'UPDATE','UPDATE','machines','MachinesPage',2,NULL,NULL,NULL,'machines update; code: wdwd → wdwd; name:  → vak','machines update; code: wdwd → wdwd; name:  → vak','system','server','','info',0,'2025-09-12 07:45:47','2025-09-12 07:45:47','2025-09-12 07:45:47',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15427,'2025-09-12 07:45:47','2025-09-12 07:45:47',NULL,'UPDATE','UPDATE','machines','MachinesPage',2,'name',NULL,'vak','machines update: name changed','machines update: name changed','system','server','','info',0,'2025-09-12 07:45:47','2025-09-12 07:45:47','2025-09-12 07:45:47',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15428,'2025-09-12 07:45:47','2025-09-12 07:45:47',NULL,'MACHINE_UPDATE','MACHINE_UPDATE','machines','MachineModule',2,NULL,NULL,NULL,'vak','vak','ui','MachinesPage',NULL,'audit',0,'2025-09-12 07:45:47','2025-09-12 07:45:47','2025-09-12 07:45:47',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15429,'2025-09-12 08:04:39','2025-09-12 08:04:39',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=b533f90384304f2a97515cf6; IPv4=192.168.108.54','b533f90384304f2a97515cf6c9cb08bd','info',0,'2025-09-12 08:04:39','2025-09-12 08:04:39','2025-09-12 08:04:39',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15430,'2025-09-12 08:04:39','2025-09-12 08:04:39',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=b533f90384304f2a97515cf6; IPv4=192.168.108.54','b533f90384304f2a97515cf6c9cb08bd','info',0,'2025-09-12 08:04:39','2025-09-12 08:04:39','2025-09-12 08:04:39',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15431,'2025-09-12 08:04:39','2025-09-12 08:04:39',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-12 08:04:39','2025-09-12 08:04:39','2025-09-12 08:04:39',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15432,'2025-09-12 08:08:53','2025-09-12 08:08:53',NULL,'MACHINE_CREATE','MACHINE_CREATE','machines','MachineModule',0,NULL,NULL,NULL,'Kartonirka','Kartonirka','ui','MachinesPage',NULL,'audit',0,'2025-09-12 08:08:53','2025-09-12 08:08:53','2025-09-12 08:08:53',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15433,'2025-09-12 08:10:08','2025-09-12 08:10:08',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=6cd21c405459468f997d0eb5; IPv4=192.168.108.54','6cd21c405459468f997d0eb514f3c071','info',0,'2025-09-12 08:10:08','2025-09-12 08:10:08','2025-09-12 08:10:08',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15434,'2025-09-12 08:10:08','2025-09-12 08:10:08',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=6cd21c405459468f997d0eb5; IPv4=192.168.108.54','6cd21c405459468f997d0eb514f3c071','info',0,'2025-09-12 08:10:08','2025-09-12 08:10:08','2025-09-12 08:10:08',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15435,'2025-09-12 08:10:08','2025-09-12 08:10:08',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-12 08:10:08','2025-09-12 08:10:08','2025-09-12 08:10:08',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15436,'2025-09-12 08:11:05','2025-09-12 08:11:05',NULL,'INSERT','INSERT','machine_components','MachineComponentsPage',4,NULL,NULL,NULL,'machine_components insert; code=50000; name=sonda','machine_components insert; code=50000; name=sonda','system','server','','info',0,'2025-09-12 08:11:05','2025-09-12 08:11:05','2025-09-12 08:11:05',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15437,'2025-09-12 08:15:32','2025-09-12 08:15:32',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=0289ad59fbad42648d057cfa; IPv4=192.168.108.54','0289ad59fbad42648d057cfaef56132b','info',0,'2025-09-12 08:15:32','2025-09-12 08:15:32','2025-09-12 08:15:32',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15438,'2025-09-12 08:15:32','2025-09-12 08:15:32',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=0289ad59fbad42648d057cfa; IPv4=192.168.108.54','0289ad59fbad42648d057cfaef56132b','info',0,'2025-09-12 08:15:32','2025-09-12 08:15:32','2025-09-12 08:15:32',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15439,'2025-09-12 08:15:32','2025-09-12 08:15:32',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-12 08:15:32','2025-09-12 08:15:32','2025-09-12 08:15:32',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15440,'2025-09-12 08:15:46','2025-09-12 08:15:46',NULL,'DELETE','DELETE','machines','MachinesPage',3,NULL,NULL,NULL,'machines delete; code=T-1757655324; name=T-minimal','machines delete; code=T-1757655324; name=T-minimal','system','server','','warning',0,'2025-09-12 08:15:46','2025-09-12 08:15:46','2025-09-12 08:15:46',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15441,'2025-09-12 08:16:11','2025-09-12 08:16:11',NULL,'DELETE','DELETE','machines','MachinesPage',2,NULL,NULL,NULL,'machines delete; code=wdwd; name=vak','machines delete; code=wdwd; name=vak','system','server','','warning',0,'2025-09-12 08:16:11','2025-09-12 08:16:11','2025-09-12 08:16:11',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15442,'2025-09-12 08:17:07','2025-09-12 08:17:07',1,'LOGIN_ATTEMPT','LOGIN_ATTEMPT','users',NULL,1,NULL,NULL,NULL,'username=darko; note=attempt','username=darko; note=attempt','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=371562c5081f46a0bb18ed98; IPv4=192.168.108.54','371562c5081f46a0bb18ed98476b83b1','info',0,'2025-09-12 08:17:07','2025-09-12 08:17:07','2025-09-12 08:17:07',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15443,'2025-09-12 08:17:07','2025-09-12 08:17:07',1,'LOGIN_SUCCESS','LOGIN_SUCCESS','users',NULL,1,NULL,NULL,NULL,'username=darko; auth=local; shape=base64-sha256','username=darko; auth=local; shape=base64-sha256','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=371562c5081f46a0bb18ed98; IPv4=192.168.108.54','371562c5081f46a0bb18ed98476b83b1','info',0,'2025-09-12 08:17:07','2025-09-12 08:17:07','2025-09-12 08:17:07',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15444,'2025-09-12 08:17:07','2025-09-12 08:17:07',NULL,'UPDATE','UPDATE','users','UsersPage',1,NULL,NULL,NULL,'users update; username: darko → darko','users update; username: darko → darko','system','server','','info',0,'2025-09-12 08:17:07','2025-09-12 08:17:07','2025-09-12 08:17:07',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15445,'2025-09-12 08:17:14','2025-09-12 08:17:14',NULL,'INSERT','INSERT','entity_audit_log','EntityAuditLogPage',14,NULL,NULL,NULL,'entity_audit_log insert','entity_audit_log insert','system','server','','info',0,'2025-09-12 08:17:14','2025-09-12 08:17:14','2025-09-12 08:17:14',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15446,'2025-09-12 08:17:14','2025-09-12 08:17:14',1,'LOAD','LOAD','calibrations',NULL,0,NULL,NULL,NULL,'Loaded 0 calibrations','Loaded 0 calibrations','192.168.108.54','OS=Microsoft Windows NT 10.0.26100.0; FW=.NET 8.0.20; Arch=X64/X64; Platform=WinUI; Mfr=LENOVO; Model=11ED002CCR; Host=Y-077; User=amir; Domain=yasenka; App=1.0.0.0(0); Sess=371562c5081f46a0bb18ed98; IPv4=192.168.108.54','371562c5081f46a0bb18ed98476b83b1','info',0,'2025-09-12 08:17:14','2025-09-12 08:17:14','2025-09-12 08:17:14',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15447,'2025-09-12 08:18:17','2025-09-12 08:18:17',NULL,'INSERT','INSERT','external_contractors','ExternalContractorsPage',1,NULL,NULL,NULL,'external_contractors insert; name=x','external_contractors insert; name=x','system','server','','info',0,'2025-09-12 08:18:17','2025-09-12 08:18:17','2025-09-12 08:18:17',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15448,'2025-09-12 08:22:33','2025-09-12 08:22:33',NULL,'UPDATE','UPDATE','machines','MachinesPage',11,NULL,NULL,NULL,'machines update; code: 500 → 500; name: Kartonirka → Kartonirka','machines update; code: 500 → 500; name: Kartonirka → Kartonirka','system','server','','info',0,'2025-09-12 08:22:33','2025-09-12 08:22:33','2025-09-12 08:22:33',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15449,'2025-09-12 08:23:04','2025-09-12 08:23:04',NULL,'UPDATE','UPDATE','machines','MachinesPage',11,NULL,NULL,NULL,'machines update; code: 500 → 500; name: Kartonirka → Kartonirka','machines update; code: 500 → 500; name: Kartonirka → Kartonirka','system','server','','info',0,'2025-09-12 08:23:04','2025-09-12 08:23:04','2025-09-12 08:23:04',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15450,'2025-09-12 08:23:09','2025-09-12 08:23:09',NULL,'UPDATE','UPDATE','machines','MachinesPage',11,NULL,NULL,NULL,'machines update; code: 500 → 500; name: Kartonirka → Kartonirka','machines update; code: 500 → 500; name: Kartonirka → Kartonirka','system','server','','info',0,'2025-09-12 08:23:09','2025-09-12 08:23:09','2025-09-12 08:23:09',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
/*!40000 ALTER TABLE `system_event_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_system_event_log_bi` BEFORE INSERT ON `system_event_log` FOR EACH ROW BEGIN
  
  IF NEW.event_time IS NULL THEN SET NEW.event_time = CURRENT_TIMESTAMP; END IF;
  IF NEW.`timestamp` IS NULL THEN SET NEW.`timestamp` = NEW.event_time; END IF;

  
  IF NEW.event_type IS NULL AND NEW.`action` IS NOT NULL THEN SET NEW.event_type = NEW.`action`; END IF;
  IF NEW.`action` IS NULL THEN SET NEW.`action` = NEW.event_type; END IF;

  
  IF NEW.description IS NULL AND NEW.`details` IS NOT NULL THEN SET NEW.description = NEW.`details`; END IF;
  IF NEW.`details` IS NULL THEN SET NEW.`details` = NEW.description; END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_system_event_log_fk_guard` BEFORE INSERT ON `system_event_log` FOR EACH ROW BEGIN
  IF NEW.user_id IS NOT NULL THEN
    IF (SELECT COUNT(*) FROM users WHERE id = NEW.user_id) = 0 THEN
      SET NEW.user_id = NULL;
    END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_system_event_log_bu` BEFORE UPDATE ON `system_event_log` FOR EACH ROW BEGIN
  
  IF (NEW.event_time <=> OLD.event_time) = 0 THEN
    SET NEW.`timestamp` = NEW.event_time;
  END IF;

  
  IF ((NEW.event_type <=> OLD.event_type) = 0) OR ((NEW.`action` <=> OLD.`action`) = 0) THEN
    IF (NEW.event_type <=> OLD.event_type) = 0 THEN
      SET NEW.`action` = NEW.event_type;
    ELSEIF (NEW.`action` <=> OLD.`action`) = 0 THEN
      SET NEW.event_type = NEW.`action`;
    END IF;
  END IF;

  
  IF ((NEW.description <=> OLD.description) = 0) OR ((NEW.`details` <=> OLD.`details`) = 0) THEN
    IF (NEW.description <=> OLD.description) = 0 THEN
      SET NEW.`details` = NEW.description;
    ELSEIF (NEW.`details` <=> OLD.`details`) = 0 THEN
      SET NEW.description = NEW.`details`;
    END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `system_parameters`
--

DROP TABLE IF EXISTS `system_parameters`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `system_parameters` (
  `id` int NOT NULL AUTO_INCREMENT,
  `param_name` varchar(100) DEFAULT NULL,
  `param_value` text,
  `updated_by` int DEFAULT NULL,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `digital_signature` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `param_name` (`param_name`),
  KEY `fk_sysparam_user` (`updated_by`),
  CONSTRAINT `fk_sysparam_user` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `system_parameters`
--

LOCK TABLES `system_parameters` WRITE;
/*!40000 ALTER TABLE `system_parameters` DISABLE KEYS */;
/*!40000 ALTER TABLE `system_parameters` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_system_parameters_ai_audit` AFTER INSERT ON `system_parameters` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'system_parameters', 'SystemParametersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('system_parameters insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_system_parameters_au_audit` AFTER UPDATE ON `system_parameters` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'system_parameters', 'SystemParametersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('system_parameters update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_system_parameters_ad_audit` AFTER DELETE ON `system_parameters` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'system_parameters', 'SystemParametersPage', OLD.id, NULL,
     NULL, NULL, CONCAT('system_parameters delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `tags`
--

DROP TABLE IF EXISTS `tags`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `tags` (
  `id` int NOT NULL AUTO_INCREMENT,
  `tag` varchar(60) NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `tag` (`tag`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `tags`
--

LOCK TABLES `tags` WRITE;
/*!40000 ALTER TABLE `tags` DISABLE KEYS */;
/*!40000 ALTER TABLE `tags` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_tags_ai_audit` AFTER INSERT ON `tags` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'tags', 'TagsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('tags insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_tags_au_audit` AFTER UPDATE ON `tags` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'tags', 'TagsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('tags update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_tags_ad_audit` AFTER DELETE ON `tags` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'tags', 'TagsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('tags delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `tenants`
--

DROP TABLE IF EXISTS `tenants`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `tenants` (
  `id` int NOT NULL AUTO_INCREMENT,
  `code` varchar(40) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `contact` varchar(100) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `tenants`
--

LOCK TABLES `tenants` WRITE;
/*!40000 ALTER TABLE `tenants` DISABLE KEYS */;
/*!40000 ALTER TABLE `tenants` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_tenants_ai_audit` AFTER INSERT ON `tenants` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'tenants', 'TenantsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('tenants insert', CONCAT('; code=', COALESCE(NEW.code,'')), CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_tenants_au_audit` AFTER UPDATE ON `tenants` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'tenants', 'TenantsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('tenants update', CONCAT('; code: ', COALESCE(OLD.code,''), ' → ', COALESCE(NEW.code,'')), CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.code,'') <> COALESCE(NEW.code,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'tenants', 'TenantsPage', NEW.id, 'code',
       OLD.code, NEW.code, 'tenants update: code changed', 'system', 'server', '', 'info');
  END IF;

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'tenants', 'TenantsPage', NEW.id, 'name',
       OLD.name, NEW.name, 'tenants update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_tenants_ad_audit` AFTER DELETE ON `tenants` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'tenants', 'TenantsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('tenants delete', CONCAT('; code=', COALESCE(OLD.code,'')), CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary view structure for view `units`
--

DROP TABLE IF EXISTS `units`;
/*!50001 DROP VIEW IF EXISTS `units`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `units` AS SELECT 
 1 AS `id`,
 1 AS `code`,
 1 AS `name`,
 1 AS `created_at`,
 1 AS `updated_at`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `user_audit`
--

DROP TABLE IF EXISTS `user_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `action` varchar(40) NOT NULL,
  `description` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `source_ip` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `details` text GENERATED ALWAYS AS (`description`) VIRTUAL,
  PRIMARY KEY (`id`),
  KEY `fk_ua_user` (`user_id`),
  CONSTRAINT `fk_ua_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_audit`
--

LOCK TABLES `user_audit` WRITE;
/*!40000 ALTER TABLE `user_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `user_audit` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_audit_ai_audit` AFTER INSERT ON `user_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'user_audit', 'UserAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_audit insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_audit_au_audit` AFTER UPDATE ON `user_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'user_audit', 'UserAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_audit update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_audit_ad_audit` AFTER DELETE ON `user_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'user_audit', 'UserAuditPage', OLD.id, NULL,
     NULL, NULL, CONCAT('user_audit delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `user_esignatures`
--

DROP TABLE IF EXISTS `user_esignatures`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user_esignatures` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `signed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `action` varchar(100) DEFAULT NULL,
  `table_name` varchar(100) DEFAULT NULL,
  `record_id` int DEFAULT NULL,
  `signature_hash` varchar(255) DEFAULT NULL,
  `method` enum('pin','certificate','biometric','password') DEFAULT NULL,
  `status` enum('valid','revoked','pending') DEFAULT 'valid',
  `ip_address` varchar(45) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_ues_user` (`user_id`),
  CONSTRAINT `fk_ues_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_esignatures`
--

LOCK TABLES `user_esignatures` WRITE;
/*!40000 ALTER TABLE `user_esignatures` DISABLE KEYS */;
/*!40000 ALTER TABLE `user_esignatures` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_esignatures_ai_audit` AFTER INSERT ON `user_esignatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'user_esignatures', 'UserEsignaturesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_esignatures insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_esignatures_au_audit` AFTER UPDATE ON `user_esignatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'user_esignatures', 'UserEsignaturesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_esignatures update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_esignatures_ad_audit` AFTER DELETE ON `user_esignatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'user_esignatures', 'UserEsignaturesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('user_esignatures delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `user_login_audit`
--

DROP TABLE IF EXISTS `user_login_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user_login_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `login_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `logout_time` datetime DEFAULT NULL,
  `session_token` varchar(128) DEFAULT NULL,
  `ip_address` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `success` tinyint(1) DEFAULT '1',
  `reason` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `timestamp` datetime GENERATED ALWAYS AS (`login_time`) VIRTUAL,
  `action` varchar(20) GENERATED ALWAYS AS (if((`success` = 1),_cp852'LOGIN',_cp852'LOGIN_FAIL')) VIRTUAL,
  `details` text GENERATED ALWAYS AS (`reason`) VIRTUAL,
  `two_factor_ok` tinyint(1) DEFAULT NULL,
  `sso_used` tinyint(1) DEFAULT NULL,
  `biometric_used` tinyint(1) DEFAULT NULL,
  `geo_location` varchar(128) DEFAULT NULL,
  `risk_score` double DEFAULT NULL,
  `status` varchar(32) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `note` text,
  `user` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_ula_user` (`user_id`),
  CONSTRAINT `fk_ula_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_login_audit`
--

LOCK TABLES `user_login_audit` WRITE;
/*!40000 ALTER TABLE `user_login_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `user_login_audit` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_login_audit_ai_audit` AFTER INSERT ON `user_login_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'user_login_audit', 'UserLoginAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_login_audit insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_login_audit_au_audit` AFTER UPDATE ON `user_login_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'user_login_audit', 'UserLoginAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_login_audit update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_login_audit_ad_audit` AFTER DELETE ON `user_login_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'user_login_audit', 'UserLoginAuditPage', OLD.id, NULL,
     NULL, NULL, CONCAT('user_login_audit delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `user_permissions`
--

DROP TABLE IF EXISTS `user_permissions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user_permissions` (
  `user_id` int NOT NULL,
  `permission_id` int NOT NULL,
  `allowed` tinyint(1) NOT NULL,
  `reason` varchar(255) DEFAULT NULL,
  `granted_by` int DEFAULT NULL,
  `granted_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `expires_at` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `user` varchar(255) DEFAULT NULL,
  `permission` varchar(255) DEFAULT NULL,
  `assigned_at` datetime DEFAULT NULL,
  `assigned_by` int DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT NULL,
  `change_version` int DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `session_id` varchar(64) DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `note` varchar(512) DEFAULT NULL,
  `code` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`user_id`,`permission_id`),
  KEY `fk_up_perm` (`permission_id`),
  KEY `fk_up_by` (`granted_by`),
  CONSTRAINT `fk_up_by` FOREIGN KEY (`granted_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_up_perm` FOREIGN KEY (`permission_id`) REFERENCES `permissions` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_up_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_permissions`
--

LOCK TABLES `user_permissions` WRITE;
/*!40000 ALTER TABLE `user_permissions` DISABLE KEYS */;
INSERT INTO `user_permissions` VALUES (1,1,1,NULL,1,'2025-09-01 14:57:53',NULL,'2025-09-01 14:57:53','2025-09-01 14:57:53',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(1,2,1,NULL,1,'2025-09-01 14:57:53',NULL,'2025-09-01 14:57:53','2025-09-01 14:57:53',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(1,3,1,NULL,1,'2025-09-01 14:57:53',NULL,'2025-09-01 14:57:53','2025-09-01 14:57:53',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(1,4,1,'bootstrap grant',NULL,'2025-08-28 14:05:44',NULL,'2025-08-28 14:05:44','2025-08-28 14:05:44',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
/*!40000 ALTER TABLE `user_permissions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_permissions_ai_audit` AFTER INSERT ON `user_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'user_permissions', 'UserPermissionsPage', NEW.user_id, NULL,
     NULL, NULL, CONCAT('user_permissions insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_permissions_au_audit` AFTER UPDATE ON `user_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'user_permissions', 'UserPermissionsPage', NEW.user_id, NULL,
     NULL, NULL, CONCAT('user_permissions update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_permissions_ad_audit` AFTER DELETE ON `user_permissions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'user_permissions', 'UserPermissionsPage', OLD.user_id, NULL,
     NULL, NULL, CONCAT('user_permissions delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `user_roles`
--

DROP TABLE IF EXISTS `user_roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user_roles` (
  `user_id` int NOT NULL,
  `role_id` int NOT NULL,
  `assigned_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `assigned_by_id` int DEFAULT NULL,
  `expires_at` datetime DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `granted_by` int DEFAULT NULL,
  `granted_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `is_active` tinyint(1) DEFAULT '1',
  `change_version` int DEFAULT '1',
  `digital_signature` varchar(256) DEFAULT NULL,
  `user` varchar(255) DEFAULT NULL,
  `role` varchar(255) DEFAULT NULL,
  `assigned_by` int DEFAULT NULL,
  `reason` varchar(255) DEFAULT NULL,
  `session_id` varchar(64) DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `note` varchar(512) DEFAULT NULL,
  PRIMARY KEY (`user_id`,`role_id`),
  KEY `fk_ur_role` (`role_id`),
  KEY `ix_user_roles_granted_by` (`granted_by`),
  KEY `fk_ur_assigned_by_id` (`assigned_by_id`),
  CONSTRAINT `fk_ur_assigned_by_id` FOREIGN KEY (`assigned_by_id`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_ur_role` FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_ur_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_user_roles_granted_by` FOREIGN KEY (`granted_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_roles`
--

LOCK TABLES `user_roles` WRITE;
/*!40000 ALTER TABLE `user_roles` DISABLE KEYS */;
INSERT INTO `user_roles` VALUES (1,1,'2025-08-25 11:36:22',NULL,NULL,'2025-08-25 11:36:22','2025-09-02 10:26:59',NULL,'2025-08-28 11:52:14',1,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(1,2,'2025-08-29 09:18:00',NULL,NULL,'2025-08-29 09:18:00','2025-08-29 09:18:00',1,'2025-08-29 09:18:00',1,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(1,3,'2025-08-29 09:18:06',NULL,NULL,'2025-08-29 09:18:06','2025-08-29 09:18:06',1,'2025-08-29 09:18:06',1,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(8,1,'2025-08-28 12:07:05',NULL,NULL,'2025-08-28 12:07:05','2025-08-28 12:07:05',1,'2025-08-28 12:07:05',1,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
/*!40000 ALTER TABLE `user_roles` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_roles_ai_audit` AFTER INSERT ON `user_roles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'user_roles', 'UserRolesPage', NEW.user_id, NULL,
     NULL, NULL, CONCAT('user_roles insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_roles_au_audit` AFTER UPDATE ON `user_roles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'user_roles', 'UserRolesPage', NEW.user_id, NULL,
     NULL, NULL, CONCAT('user_roles update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_roles_ad_audit` AFTER DELETE ON `user_roles` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'user_roles', 'UserRolesPage', OLD.user_id, NULL,
     NULL, NULL, CONCAT('user_roles delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `user_subscriptions`
--

DROP TABLE IF EXISTS `user_subscriptions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user_subscriptions` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `template_id` int NOT NULL,
  `enabled` tinyint(1) DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_user_tpl` (`user_id`,`template_id`),
  KEY `fk_us_tpl` (`template_id`),
  CONSTRAINT `fk_us_tpl` FOREIGN KEY (`template_id`) REFERENCES `notification_templates` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_us_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_subscriptions`
--

LOCK TABLES `user_subscriptions` WRITE;
/*!40000 ALTER TABLE `user_subscriptions` DISABLE KEYS */;
INSERT INTO `user_subscriptions` VALUES (1,1,3,1,'2025-08-28 12:36:27','2025-08-28 12:36:27'),(2,1,8,1,'2025-08-28 12:36:27','2025-08-28 12:36:27'),(3,1,1,1,'2025-08-28 12:36:27','2025-08-28 12:36:27'),(4,1,2,1,'2025-08-28 12:36:27','2025-08-28 12:36:27');
/*!40000 ALTER TABLE `user_subscriptions` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_subscriptions_ai_audit` AFTER INSERT ON `user_subscriptions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'user_subscriptions', 'UserSubscriptionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_subscriptions insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_subscriptions_au_audit` AFTER UPDATE ON `user_subscriptions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'user_subscriptions', 'UserSubscriptionsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_subscriptions update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_subscriptions_ad_audit` AFTER DELETE ON `user_subscriptions` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'user_subscriptions', 'UserSubscriptionsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('user_subscriptions delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `user_training`
--

DROP TABLE IF EXISTS `user_training`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user_training` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `training_type` varchar(100) DEFAULT NULL,
  `training_date` date DEFAULT NULL,
  `valid_until` date DEFAULT NULL,
  `certificate_file` varchar(255) DEFAULT NULL,
  `provider` varchar(100) DEFAULT NULL,
  `status` enum('planned','completed','expired') DEFAULT NULL,
  `notes` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_ut_user` (`user_id`),
  CONSTRAINT `fk_ut_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_training`
--

LOCK TABLES `user_training` WRITE;
/*!40000 ALTER TABLE `user_training` DISABLE KEYS */;
/*!40000 ALTER TABLE `user_training` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_training_ai_audit` AFTER INSERT ON `user_training` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'user_training', 'UserTrainingPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_training insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_training_au_audit` AFTER UPDATE ON `user_training` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'user_training', 'UserTrainingPage', NEW.id, NULL,
     NULL, NULL, CONCAT('user_training update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_user_training_ad_audit` AFTER DELETE ON `user_training` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'user_training', 'UserTrainingPage', OLD.id, NULL,
     NULL, NULL, CONCAT('user_training delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `user_window_layouts`
--

DROP TABLE IF EXISTS `user_window_layouts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user_window_layouts` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `page_type` varchar(200) NOT NULL,
  `pos_x` int DEFAULT NULL,
  `pos_y` int DEFAULT NULL,
  `width` int NOT NULL,
  `height` int NOT NULL,
  `saved_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_user_page` (`user_id`,`page_type`),
  CONSTRAINT `fk_uwl_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user_window_layouts`
--

LOCK TABLES `user_window_layouts` WRITE;
/*!40000 ALTER TABLE `user_window_layouts` DISABLE KEYS */;
/*!40000 ALTER TABLE `user_window_layouts` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `password` varchar(128) NOT NULL,
  `password_hash` varchar(256) DEFAULT NULL,
  `full_name` varchar(100) NOT NULL,
  `role` varchar(30) DEFAULT NULL,
  `role_id` int DEFAULT NULL,
  `active` tinyint(1) DEFAULT '1',
  `is_locked` tinyint(1) DEFAULT '0',
  `last_failed_login` datetime DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `phone` varchar(40) DEFAULT NULL,
  `last_login` datetime DEFAULT NULL,
  `password_reset_required` tinyint(1) DEFAULT '0',
  `is_deleted` tinyint(1) DEFAULT '0',
  `deleted_at` datetime DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `department_id` int DEFAULT NULL,
  `department_name` varchar(80) DEFAULT NULL,
  `is_two_factor_enabled` tinyint(1) DEFAULT '0',
  `privacy_consent_version` varchar(20) DEFAULT NULL,
  `privacy_consent_date` datetime DEFAULT NULL,
  `custom_attributes` text,
  `security_anomaly_score` decimal(5,3) DEFAULT NULL,
  `is_system_account` tinyint(1) DEFAULT '0',
  `notification_channel` varchar(24) DEFAULT NULL,
  `external_provider_id` varchar(255) DEFAULT NULL,
  `external_provider_type` varchar(40) DEFAULT NULL,
  `federated_unique_id` varchar(255) DEFAULT NULL,
  `global_federated_id` varchar(255) DEFAULT NULL,
  `preferred_culture` varchar(16) DEFAULT NULL,
  `last_change_signature` varchar(256) DEFAULT NULL,
  `public_key` longtext,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `last_modified` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `last_modified_by_id` int DEFAULT NULL,
  `change_version` int NOT NULL DEFAULT '1',
  `failed_login_attempts` int DEFAULT '0',
  `tenant_id` int DEFAULT NULL,
  `job_title_id` int DEFAULT NULL,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `user?` varchar(255) DEFAULT NULL,
  `icollection<role>` varchar(255) DEFAULT NULL,
  `icollection<permission>` varchar(255) DEFAULT NULL,
  `icollection<delegated_permission>` varchar(255) DEFAULT NULL,
  `icollection<audit_log>` varchar(255) DEFAULT NULL,
  `icollection<digital_signature>` varchar(255) DEFAULT NULL,
  `icollection<session_log>` varchar(255) DEFAULT NULL,
  `icollection<work_order>` varchar(255) DEFAULT NULL,
  `icollection<photo>` varchar(255) DEFAULT NULL,
  `icollection<attachment>` varchar(255) DEFAULT NULL,
  `icollection<admin_activity_log>` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_users_username_lower` ((lower(`username`))),
  KEY `fk_users_last_modified_by` (`last_modified_by_id`),
  KEY `fk_users_department` (`department_id`),
  KEY `fk_users_tenant_id` (`tenant_id`),
  KEY `fk_users_job_title` (`job_title_id`),
  KEY `fk_users_role` (`role_id`),
  KEY `idx_users_username_insensitive` ((lower(`username`))),
  CONSTRAINT `fk_users_department` FOREIGN KEY (`department_id`) REFERENCES `departments` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_users_job_title` FOREIGN KEY (`job_title_id`) REFERENCES `job_titles` (`id`),
  CONSTRAINT `fk_users_last_modified_by` FOREIGN KEY (`last_modified_by_id`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_users_role` FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`),
  CONSTRAINT `fk_users_tenant_id` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `users`
--

LOCK TABLES `users` WRITE;
/*!40000 ALTER TABLE `users` DISABLE KEYS */;
INSERT INTO `users` VALUES (1,'darko','9uCh4qxBlFqap/+KiqoM68EqO8yYGpKa1c+BCgkOEa4=','9uCh4qxBlFqap/+KiqoM68EqO8yYGpKa1c+BCgkOEa4=','Darko M.','Admin',1,1,0,'2025-09-09 13:56:07','',NULL,'2025-09-12 08:17:07',0,0,NULL,NULL,NULL,NULL,0,NULL,NULL,NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'2025-08-25 09:36:22','2025-09-12 06:17:07',NULL,1,0,NULL,NULL,'2025-09-12 08:17:07',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(7,'system','B0gPuehbk5avBvAGzxyVAkryUxxl+1Bc+9Ct0eLzFXM=',NULL,'System Account',NULL,1,1,0,'2025-08-29 14:09:12',NULL,NULL,NULL,0,0,NULL,NULL,NULL,NULL,0,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'2025-08-25 11:15:25','2025-08-29 12:15:04',NULL,1,1,NULL,NULL,'2025-08-30 12:36:23',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(8,'amir','B0gPuehbk5avBvAGzxyVAkryUxxl+1Bc+9Ct0eLzFXM=',NULL,'Amir Reslan','',1,1,0,'2025-08-29 14:09:44','',NULL,NULL,0,0,NULL,NULL,NULL,NULL,0,NULL,NULL,NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'2025-08-25 11:15:25','2025-08-29 12:16:53',NULL,1,3,NULL,NULL,'2025-08-30 12:36:23',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
/*!40000 ALTER TABLE `users` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_users_ai_audit` AFTER INSERT ON `users` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'users', 'UsersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('users insert', CONCAT('; username=', COALESCE(NEW.username,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_users_au_audit` AFTER UPDATE ON `users` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'users', 'UsersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('users update', CONCAT('; username: ', COALESCE(OLD.username,''), ' → ', COALESCE(NEW.username,''))), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_users_ad_audit` AFTER DELETE ON `users` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'users', 'UsersPage', OLD.id, NULL,
     NULL, NULL, CONCAT('users delete', CONCAT('; username=', COALESCE(OLD.username,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary view structure for view `v_machine_components_ui`
--

DROP TABLE IF EXISTS `v_machine_components_ui`;
/*!50001 DROP VIEW IF EXISTS `v_machine_components_ui`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `v_machine_components_ui` AS SELECT 
 1 AS `id`,
 1 AS `machine_id`,
 1 AS `code`,
 1 AS `name`,
 1 AS `type`,
 1 AS `sop_doc`,
 1 AS `status`,
 1 AS `install_date`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `v_suppliers_ui`
--

DROP TABLE IF EXISTS `v_suppliers_ui`;
/*!50001 DROP VIEW IF EXISTS `v_suppliers_ui`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `v_suppliers_ui` AS SELECT 
 1 AS `id`,
 1 AS `name`,
 1 AS `vat_number`,
 1 AS `address`,
 1 AS `supplier_type`,
 1 AS `email`,
 1 AS `phone`,
 1 AS `contract_file`,
 1 AS `notes`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `validation_audit`
--

DROP TABLE IF EXISTS `validation_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `validation_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `digital_signature` varchar(255) DEFAULT NULL,
  `changed_at` datetime DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `details` varchar(255) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `validation_id` int DEFAULT NULL,
  `action` varchar(255) DEFAULT NULL,
  `user_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `validation_audit`
--

LOCK TABLES `validation_audit` WRITE;
/*!40000 ALTER TABLE `validation_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `validation_audit` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `validation_records`
--

DROP TABLE IF EXISTS `validation_records`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `validation_records` (
  `id` int NOT NULL AUTO_INCREMENT,
  `validation_set_id` int NOT NULL,
  `phase` enum('URS','IQ','OQ','PQ') NOT NULL,
  `date_done` date DEFAULT NULL,
  `document_id` int DEFAULT NULL,
  `notes` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_vrec_set` (`validation_set_id`),
  KEY `fk_vrec_doc` (`document_id`),
  CONSTRAINT `fk_vrec_doc` FOREIGN KEY (`document_id`) REFERENCES `documents` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_vrec_set` FOREIGN KEY (`validation_set_id`) REFERENCES `validation_sets` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `validation_records`
--

LOCK TABLES `validation_records` WRITE;
/*!40000 ALTER TABLE `validation_records` DISABLE KEYS */;
/*!40000 ALTER TABLE `validation_records` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `validation_sets`
--

DROP TABLE IF EXISTS `validation_sets`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `validation_sets` (
  `id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(200) NOT NULL,
  `machine_id` int DEFAULT NULL,
  `component_id` int DEFAULT NULL,
  `lead_party_id` int DEFAULT NULL,
  `pq_renewal_due` date DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_valset_mach` (`machine_id`),
  KEY `fk_valset_comp` (`component_id`),
  KEY `fk_valset_lead` (`lead_party_id`),
  CONSTRAINT `fk_valset_comp` FOREIGN KEY (`component_id`) REFERENCES `components` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_valset_lead` FOREIGN KEY (`lead_party_id`) REFERENCES `responsible_parties` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_valset_mach` FOREIGN KEY (`machine_id`) REFERENCES `machines` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `validation_sets`
--

LOCK TABLES `validation_sets` WRITE;
/*!40000 ALTER TABLE `validation_sets` DISABLE KEYS */;
/*!40000 ALTER TABLE `validation_sets` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `validations`
--

DROP TABLE IF EXISTS `validations`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `validations` (
  `id` int NOT NULL AUTO_INCREMENT,
  `type` varchar(40) DEFAULT NULL,
  `machine_id` int DEFAULT NULL,
  `component_id` int DEFAULT NULL,
  `validation_date` date DEFAULT NULL,
  `status` varchar(40) DEFAULT NULL,
  `doc_file` varchar(255) DEFAULT NULL,
  `signed_by` varchar(128) DEFAULT NULL,
  `next_due` date DEFAULT NULL,
  `comment` text,
  `digital_signature` varchar(128) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `code` varchar(40) DEFAULT NULL,
  `machine?` varchar(255) DEFAULT NULL,
  `machine_component?` varchar(255) DEFAULT NULL,
  `date_start` datetime DEFAULT NULL,
  `date_end` datetime DEFAULT NULL,
  `signed_by_id` int DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `signed_by_name` varchar(100) DEFAULT NULL,
  `entry_hash` varchar(128) DEFAULT NULL,
  `created_by_id` int DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `source_ip` varchar(64) DEFAULT NULL,
  `workflow_status` varchar(40) DEFAULT NULL,
  `additional_signers` varchar(512) DEFAULT NULL,
  `regulator` varchar(60) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `linked_capa_id` int DEFAULT NULL,
  `capa_case?` varchar(255) DEFAULT NULL,
  `signature_timestamp` datetime DEFAULT NULL,
  `session_id` varchar(80) DEFAULT NULL,
  `documentation` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_val_machine` (`machine_id`),
  KEY `fk_val_component` (`component_id`),
  CONSTRAINT `fk_val_component` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_val_machine` FOREIGN KEY (`machine_id`) REFERENCES `machines` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `validations`
--

LOCK TABLES `validations` WRITE;
/*!40000 ALTER TABLE `validations` DISABLE KEYS */;
INSERT INTO `validations` VALUES (1,'IQ',NULL,NULL,NULL,'',NULL,NULL,NULL,'scxs','','2025-09-05 13:27:17','2025-09-09 14:15:23','',NULL,NULL,'2025-09-24 00:00:00','2025-09-30 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'C:\\Users\\amir\\AppData\\Local\\YasGMP\\YasGMP\\Data\\validation_docs\\20250909_121506_nalaz_lab_1756211728374.pdf');
/*!40000 ALTER TABLE `validations` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_validations_ai_audit` AFTER INSERT ON `validations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'validations', 'ValidationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('validations insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_validations_au_audit` AFTER UPDATE ON `validations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'validations', 'ValidationsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('validations update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_validations_ad_audit` AFTER DELETE ON `validations` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'validations', 'ValidationsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('validations delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `vendors`
--

DROP TABLE IF EXISTS `vendors`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `vendors` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(200) NOT NULL,
  `vat_no` varchar(50) DEFAULT NULL,
  `contact_name` varchar(120) DEFAULT NULL,
  `phone` varchar(60) DEFAULT NULL,
  `email` varchar(160) DEFAULT NULL,
  `website` varchar(255) DEFAULT NULL,
  `is_external_service_provider` tinyint(1) NOT NULL DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `vendors`
--

LOCK TABLES `vendors` WRITE;
/*!40000 ALTER TABLE `vendors` DISABLE KEYS */;
/*!40000 ALTER TABLE `vendors` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Temporary view structure for view `vw_admin_activity_log_audit`
--

DROP TABLE IF EXISTS `vw_admin_activity_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_admin_activity_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_admin_activity_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_api_audit_log_audit`
--

DROP TABLE IF EXISTS `vw_api_audit_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_api_audit_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_api_audit_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_api_keys_audit`
--

DROP TABLE IF EXISTS `vw_api_keys_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_api_keys_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_api_keys_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_api_usage_log_audit`
--

DROP TABLE IF EXISTS `vw_api_usage_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_api_usage_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_api_usage_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_attachments_audit`
--

DROP TABLE IF EXISTS `vw_attachments_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_attachments_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_attachments_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_buildings_audit`
--

DROP TABLE IF EXISTS `vw_buildings_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_buildings_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_buildings_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_calibration_audit_log_audit`
--

DROP TABLE IF EXISTS `vw_calibration_audit_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_calibration_audit_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_calibration_audit_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_calibration_export_log_audit`
--

DROP TABLE IF EXISTS `vw_calibration_export_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_calibration_export_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_calibration_export_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_calibration_sensors_audit`
--

DROP TABLE IF EXISTS `vw_calibration_sensors_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_calibration_sensors_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_calibration_sensors_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_calibrations_audit`
--

DROP TABLE IF EXISTS `vw_calibrations_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_calibrations_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_calibrations_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_calibrations_filter`
--

DROP TABLE IF EXISTS `vw_calibrations_filter`;
/*!50001 DROP VIEW IF EXISTS `vw_calibrations_filter`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_calibrations_filter` AS SELECT 
 1 AS `id`,
 1 AS `component_name`,
 1 AS `supplier_name`,
 1 AS `calibration_date`,
 1 AS `next_due`,
 1 AS `result`,
 1 AS `comment`,
 1 AS `digital_signature`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_capa_action_log_audit`
--

DROP TABLE IF EXISTS `vw_capa_action_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_capa_action_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_capa_action_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_capa_actions_audit`
--

DROP TABLE IF EXISTS `vw_capa_actions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_capa_actions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_capa_actions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_capa_cases_audit`
--

DROP TABLE IF EXISTS `vw_capa_cases_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_capa_cases_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_capa_cases_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_capa_status_history_audit`
--

DROP TABLE IF EXISTS `vw_capa_status_history_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_capa_status_history_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_capa_status_history_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_checklist_items_audit`
--

DROP TABLE IF EXISTS `vw_checklist_items_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_checklist_items_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_checklist_items_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_checklist_templates_audit`
--

DROP TABLE IF EXISTS `vw_checklist_templates_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_checklist_templates_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_checklist_templates_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_comments_audit`
--

DROP TABLE IF EXISTS `vw_comments_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_comments_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_comments_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_component_devices_audit`
--

DROP TABLE IF EXISTS `vw_component_devices_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_component_devices_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_component_devices_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_component_models_audit`
--

DROP TABLE IF EXISTS `vw_component_models_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_component_models_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_component_models_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_component_parts_audit`
--

DROP TABLE IF EXISTS `vw_component_parts_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_component_parts_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_component_parts_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_component_qualifications_audit`
--

DROP TABLE IF EXISTS `vw_component_qualifications_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_component_qualifications_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_component_qualifications_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_component_types_audit`
--

DROP TABLE IF EXISTS `vw_component_types_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_component_types_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_component_types_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_config_change_log_audit`
--

DROP TABLE IF EXISTS `vw_config_change_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_config_change_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_config_change_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_contractor_intervention_audit_audit`
--

DROP TABLE IF EXISTS `vw_contractor_intervention_audit_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_contractor_intervention_audit_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_contractor_intervention_audit_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_contractor_interventions_audit`
--

DROP TABLE IF EXISTS `vw_contractor_interventions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_contractor_interventions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_contractor_interventions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_dashboards_audit`
--

DROP TABLE IF EXISTS `vw_dashboards_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_dashboards_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_dashboards_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_delegated_permissions_audit`
--

DROP TABLE IF EXISTS `vw_delegated_permissions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_delegated_permissions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_delegated_permissions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_delete_log_audit`
--

DROP TABLE IF EXISTS `vw_delete_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_delete_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_delete_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_departments_audit`
--

DROP TABLE IF EXISTS `vw_departments_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_departments_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_departments_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_deviation_audit_audit`
--

DROP TABLE IF EXISTS `vw_deviation_audit_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_deviation_audit_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_deviation_audit_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_deviations_audit`
--

DROP TABLE IF EXISTS `vw_deviations_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_deviations_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_deviations_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_digital_signatures_audit`
--

DROP TABLE IF EXISTS `vw_digital_signatures_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_digital_signatures_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_digital_signatures_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_document_versions_audit`
--

DROP TABLE IF EXISTS `vw_document_versions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_document_versions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_document_versions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_entity_audit_log_audit`
--

DROP TABLE IF EXISTS `vw_entity_audit_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_entity_audit_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_entity_audit_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_entity_tags_audit`
--

DROP TABLE IF EXISTS `vw_entity_tags_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_entity_tags_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_entity_tags_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_export_print_log_audit`
--

DROP TABLE IF EXISTS `vw_export_print_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_export_print_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_export_print_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_external_contractors_audit`
--

DROP TABLE IF EXISTS `vw_external_contractors_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_external_contractors_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_external_contractors_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_failure_modes_audit`
--

DROP TABLE IF EXISTS `vw_failure_modes_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_failure_modes_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_failure_modes_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_forensic_user_change_log_audit`
--

DROP TABLE IF EXISTS `vw_forensic_user_change_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_forensic_user_change_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_forensic_user_change_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_incident_log_audit`
--

DROP TABLE IF EXISTS `vw_incident_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_incident_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_incident_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_inspections_audit`
--

DROP TABLE IF EXISTS `vw_inspections_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_inspections_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_inspections_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_integration_log_audit`
--

DROP TABLE IF EXISTS `vw_integration_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_integration_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_integration_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_inventory_transactions_audit`
--

DROP TABLE IF EXISTS `vw_inventory_transactions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_inventory_transactions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_inventory_transactions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_iot_anomaly_log_audit`
--

DROP TABLE IF EXISTS `vw_iot_anomaly_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_iot_anomaly_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_iot_anomaly_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_iot_devices_audit`
--

DROP TABLE IF EXISTS `vw_iot_devices_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_iot_devices_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_iot_devices_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_iot_event_audit_audit`
--

DROP TABLE IF EXISTS `vw_iot_event_audit_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_iot_event_audit_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_iot_event_audit_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_iot_gateways_audit`
--

DROP TABLE IF EXISTS `vw_iot_gateways_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_iot_gateways_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_iot_gateways_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_iot_sensor_data_audit`
--

DROP TABLE IF EXISTS `vw_iot_sensor_data_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_iot_sensor_data_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_iot_sensor_data_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_irregularities_log_audit`
--

DROP TABLE IF EXISTS `vw_irregularities_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_irregularities_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_irregularities_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_job_titles_audit`
--

DROP TABLE IF EXISTS `vw_job_titles_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_job_titles_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_job_titles_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_locations_audit`
--

DROP TABLE IF EXISTS `vw_locations_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_locations_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_locations_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_lookup_domain_audit`
--

DROP TABLE IF EXISTS `vw_lookup_domain_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_lookup_domain_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_lookup_domain_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_lookup_value_audit`
--

DROP TABLE IF EXISTS `vw_lookup_value_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_lookup_value_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_lookup_value_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_machine_components_audit`
--

DROP TABLE IF EXISTS `vw_machine_components_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_machine_components_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_machine_components_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_machine_lifecycle_event_audit`
--

DROP TABLE IF EXISTS `vw_machine_lifecycle_event_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_machine_lifecycle_event_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_machine_lifecycle_event_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_machine_models_audit`
--

DROP TABLE IF EXISTS `vw_machine_models_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_machine_models_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_machine_models_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_machine_types_audit`
--

DROP TABLE IF EXISTS `vw_machine_types_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_machine_types_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_machine_types_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_machines_audit`
--

DROP TABLE IF EXISTS `vw_machines_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_machines_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_machines_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_manufacturers_audit`
--

DROP TABLE IF EXISTS `vw_manufacturers_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_manufacturers_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_manufacturers_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_measurement_units_audit`
--

DROP TABLE IF EXISTS `vw_measurement_units_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_measurement_units_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_measurement_units_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_mobile_device_log_audit`
--

DROP TABLE IF EXISTS `vw_mobile_device_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_mobile_device_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_mobile_device_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_notification_queue_audit`
--

DROP TABLE IF EXISTS `vw_notification_queue_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_notification_queue_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_notification_queue_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_notification_templates_audit`
--

DROP TABLE IF EXISTS `vw_notification_templates_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_notification_templates_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_notification_templates_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_part_bom_audit`
--

DROP TABLE IF EXISTS `vw_part_bom_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_part_bom_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_part_bom_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_part_supplier_prices_audit`
--

DROP TABLE IF EXISTS `vw_part_supplier_prices_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_part_supplier_prices_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_part_supplier_prices_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_parts_audit`
--

DROP TABLE IF EXISTS `vw_parts_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_parts_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_parts_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_permission_change_log_audit`
--

DROP TABLE IF EXISTS `vw_permission_change_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_permission_change_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_permission_change_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_permission_requests_audit`
--

DROP TABLE IF EXISTS `vw_permission_requests_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_permission_requests_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_permission_requests_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_permissions_audit`
--

DROP TABLE IF EXISTS `vw_permissions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_permissions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_permissions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_photos_audit`
--

DROP TABLE IF EXISTS `vw_photos_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_photos_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_photos_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_ppm_plans_audit`
--

DROP TABLE IF EXISTS `vw_ppm_plans_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_ppm_plans_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_ppm_plans_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_preventive_maintenance_plans_audit`
--

DROP TABLE IF EXISTS `vw_preventive_maintenance_plans_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_preventive_maintenance_plans_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_preventive_maintenance_plans_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_quality_events_audit`
--

DROP TABLE IF EXISTS `vw_quality_events_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_quality_events_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_quality_events_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_report_schedule_audit`
--

DROP TABLE IF EXISTS `vw_report_schedule_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_report_schedule_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_report_schedule_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_requalification_schedule_audit`
--

DROP TABLE IF EXISTS `vw_requalification_schedule_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_requalification_schedule_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_requalification_schedule_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_role_audit_audit`
--

DROP TABLE IF EXISTS `vw_role_audit_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_role_audit_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_role_audit_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_role_permissions_audit`
--

DROP TABLE IF EXISTS `vw_role_permissions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_role_permissions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_role_permissions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_roles_audit`
--

DROP TABLE IF EXISTS `vw_roles_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_roles_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_roles_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_rooms_audit`
--

DROP TABLE IF EXISTS `vw_rooms_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_rooms_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_rooms_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_scheduled_job_audit_log_audit`
--

DROP TABLE IF EXISTS `vw_scheduled_job_audit_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_scheduled_job_audit_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_scheduled_job_audit_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_scheduled_jobs_audit`
--

DROP TABLE IF EXISTS `vw_scheduled_jobs_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_scheduled_jobs_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_scheduled_jobs_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_scheduled_jobs_due`
--

DROP TABLE IF EXISTS `vw_scheduled_jobs_due`;
/*!50001 DROP VIEW IF EXISTS `vw_scheduled_jobs_due`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_scheduled_jobs_due` AS SELECT 
 1 AS `id`,
 1 AS `name`,
 1 AS `job_type`,
 1 AS `entity_type`,
 1 AS `entity_id`,
 1 AS `status`,
 1 AS `next_due`,
 1 AS `recurrence_pattern`,
 1 AS `cron_expression`,
 1 AS `last_executed`,
 1 AS `last_result`,
 1 AS `escalation_level`,
 1 AS `escalation_note`,
 1 AS `chain_job_id`,
 1 AS `is_critical`,
 1 AS `needs_acknowledgment`,
 1 AS `acknowledged_by`,
 1 AS `acknowledged_at`,
 1 AS `alert_on_failure`,
 1 AS `retries`,
 1 AS `max_retries`,
 1 AS `last_error`,
 1 AS `iot_device_id`,
 1 AS `extra_params`,
 1 AS `created_by`,
 1 AS `created_at`,
 1 AS `last_modified`,
 1 AS `last_modified_by`,
 1 AS `digital_signature`,
 1 AS `device_info`,
 1 AS `session_id`,
 1 AS `ip_address`,
 1 AS `comment`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_schema_migration_log_audit`
--

DROP TABLE IF EXISTS `vw_schema_migration_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_schema_migration_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_schema_migration_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_sensitive_data_access_log_audit`
--

DROP TABLE IF EXISTS `vw_sensitive_data_access_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_sensitive_data_access_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_sensitive_data_access_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_sensor_data_enriched`
--

DROP TABLE IF EXISTS `vw_sensor_data_enriched`;
/*!50001 DROP VIEW IF EXISTS `vw_sensor_data_enriched`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_sensor_data_enriched` AS SELECT 
 1 AS `id`,
 1 AS `component_id`,
 1 AS `sensor_type_id`,
 1 AS `unit_id`,
 1 AS `value`,
 1 AS `timestamp`,
 1 AS `created_at`,
 1 AS `sensor_type_name`,
 1 AS `unit_name`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_sensor_data_logs_audit`
--

DROP TABLE IF EXISTS `vw_sensor_data_logs_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_sensor_data_logs_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_sensor_data_logs_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_sensor_models_audit`
--

DROP TABLE IF EXISTS `vw_sensor_models_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_sensor_models_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_sensor_models_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_sensor_types_audit`
--

DROP TABLE IF EXISTS `vw_sensor_types_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_sensor_types_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_sensor_types_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_session_log_audit`
--

DROP TABLE IF EXISTS `vw_session_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_session_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_session_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_sites_audit`
--

DROP TABLE IF EXISTS `vw_sites_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_sites_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_sites_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_sop_document_log_audit`
--

DROP TABLE IF EXISTS `vw_sop_document_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_sop_document_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_sop_document_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_sop_documents_audit`
--

DROP TABLE IF EXISTS `vw_sop_documents_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_sop_documents_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_sop_documents_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_stock_current`
--

DROP TABLE IF EXISTS `vw_stock_current`;
/*!50001 DROP VIEW IF EXISTS `vw_stock_current`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_stock_current` AS SELECT 
 1 AS `part_id`,
 1 AS `part_code`,
 1 AS `part_name`,
 1 AS `warehouse_id`,
 1 AS `warehouse_name`,
 1 AS `quantity`,
 1 AS `min_threshold`,
 1 AS `max_threshold`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_stock_levels_audit`
--

DROP TABLE IF EXISTS `vw_stock_levels_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_stock_levels_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_stock_levels_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_supplier_risk_audit_audit`
--

DROP TABLE IF EXISTS `vw_supplier_risk_audit_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_supplier_risk_audit_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_supplier_risk_audit_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_suppliers_audit`
--

DROP TABLE IF EXISTS `vw_suppliers_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_suppliers_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_suppliers_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_system_parameters_audit`
--

DROP TABLE IF EXISTS `vw_system_parameters_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_system_parameters_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_system_parameters_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_tags_audit`
--

DROP TABLE IF EXISTS `vw_tags_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_tags_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_tags_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_tenants_audit`
--

DROP TABLE IF EXISTS `vw_tenants_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_tenants_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_tenants_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_user_audit_audit`
--

DROP TABLE IF EXISTS `vw_user_audit_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_user_audit_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_user_audit_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_user_esignatures_audit`
--

DROP TABLE IF EXISTS `vw_user_esignatures_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_user_esignatures_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_user_esignatures_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_user_login_audit_audit`
--

DROP TABLE IF EXISTS `vw_user_login_audit_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_user_login_audit_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_user_login_audit_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_user_permissions_audit`
--

DROP TABLE IF EXISTS `vw_user_permissions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_user_permissions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_user_permissions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_user_roles_audit`
--

DROP TABLE IF EXISTS `vw_user_roles_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_user_roles_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_user_roles_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_user_subscriptions_audit`
--

DROP TABLE IF EXISTS `vw_user_subscriptions_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_user_subscriptions_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_user_subscriptions_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_user_training_audit`
--

DROP TABLE IF EXISTS `vw_user_training_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_user_training_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_user_training_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_users_audit`
--

DROP TABLE IF EXISTS `vw_users_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_users_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_users_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_validations_audit`
--

DROP TABLE IF EXISTS `vw_validations_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_validations_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_validations_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_warehouses_audit`
--

DROP TABLE IF EXISTS `vw_warehouses_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_warehouses_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_warehouses_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_order_audit_audit`
--

DROP TABLE IF EXISTS `vw_work_order_audit_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_work_order_audit_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_order_audit_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_order_checklist_item_audit`
--

DROP TABLE IF EXISTS `vw_work_order_checklist_item_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_work_order_checklist_item_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_order_checklist_item_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_order_comments_audit`
--

DROP TABLE IF EXISTS `vw_work_order_comments_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_work_order_comments_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_order_comments_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_order_parts_audit`
--

DROP TABLE IF EXISTS `vw_work_order_parts_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_work_order_parts_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_order_parts_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_order_signatures_audit`
--

DROP TABLE IF EXISTS `vw_work_order_signatures_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_work_order_signatures_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_order_signatures_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_order_status_log_audit`
--

DROP TABLE IF EXISTS `vw_work_order_status_log_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_work_order_status_log_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_order_status_log_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_orders_audit`
--

DROP TABLE IF EXISTS `vw_work_orders_audit`;
/*!50001 DROP VIEW IF EXISTS `vw_work_orders_audit`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_orders_audit` AS SELECT 
 1 AS `id`,
 1 AS `ts_utc`,
 1 AS `event_type`,
 1 AS `record_id`,
 1 AS `field_name`,
 1 AS `old_value`,
 1 AS `new_value`,
 1 AS `description`,
 1 AS `severity`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_orders_enriched`
--

DROP TABLE IF EXISTS `vw_work_orders_enriched`;
/*!50001 DROP VIEW IF EXISTS `vw_work_orders_enriched`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_orders_enriched` AS SELECT 
 1 AS `id`,
 1 AS `machine_id`,
 1 AS `component_id`,
 1 AS `type`,
 1 AS `created_by`,
 1 AS `assigned_to`,
 1 AS `date_open`,
 1 AS `date_close`,
 1 AS `description`,
 1 AS `result`,
 1 AS `status`,
 1 AS `digital_signature`,
 1 AS `priority`,
 1 AS `related_incident`,
 1 AS `created_at`,
 1 AS `updated_at`,
 1 AS `status_id`,
 1 AS `type_id`,
 1 AS `priority_id`,
 1 AS `tenant_id`,
 1 AS `status_name`,
 1 AS `type_name`,
 1 AS `priority_name`,
 1 AS `machine_name`,
 1 AS `component_name`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `vw_work_orders_user`
--

DROP TABLE IF EXISTS `vw_work_orders_user`;
/*!50001 DROP VIEW IF EXISTS `vw_work_orders_user`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `vw_work_orders_user` AS SELECT 
 1 AS `id`,
 1 AS `machine_id`,
 1 AS `component_id`,
 1 AS `type`,
 1 AS `created_by`,
 1 AS `assigned_to`,
 1 AS `date_open`,
 1 AS `date_close`,
 1 AS `description`,
 1 AS `result`,
 1 AS `status`,
 1 AS `digital_signature`,
 1 AS `priority`,
 1 AS `related_incident`,
 1 AS `created_at`,
 1 AS `updated_at`,
 1 AS `status_id`,
 1 AS `type_id`,
 1 AS `priority_id`,
 1 AS `tenant_id`*/;
SET character_set_client = @saved_cs_client;

--
-- Temporary view structure for view `warehouse`
--

DROP TABLE IF EXISTS `warehouse`;
/*!50001 DROP VIEW IF EXISTS `warehouse`*/;
SET @saved_cs_client     = @@character_set_client;
/*!50503 SET character_set_client = utf8mb4 */;
/*!50001 CREATE VIEW `warehouse` AS SELECT 
 1 AS `id`,
 1 AS `name`,
 1 AS `location`,
 1 AS `responsible_id`,
 1 AS `created_at`,
 1 AS `updated_at`,
 1 AS `location_id`,
 1 AS `responsible`,
 1 AS `qr_code`,
 1 AS `note`,
 1 AS `created_by_id`,
 1 AS `created_by`,
 1 AS `last_modified`,
 1 AS `last_modified_by_id`,
 1 AS `last_modified_by`,
 1 AS `digital_signature`,
 1 AS `status`,
 1 AS `io_tdevice_id`,
 1 AS `climate_mode`,
 1 AS `compliance_docs`,
 1 AS `entry_hash`,
 1 AS `source_ip`,
 1 AS `is_qualified`,
 1 AS `last_qualified`,
 1 AS `session_id`,
 1 AS `anomaly_score`,
 1 AS `is_deleted`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `warehouses`
--

DROP TABLE IF EXISTS `warehouses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `warehouses` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) DEFAULT NULL,
  `location` varchar(255) DEFAULT NULL,
  `responsible_id` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `location_id` int DEFAULT NULL,
  `responsible` varchar(255) DEFAULT NULL,
  `qr_code` varchar(255) DEFAULT NULL,
  `note` varchar(500) DEFAULT NULL,
  `created_by_id` int DEFAULT NULL,
  `created_by` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `last_modified_by` varchar(255) DEFAULT NULL,
  `digital_signature` varchar(128) DEFAULT NULL,
  `status` varchar(30) DEFAULT NULL,
  `io_tdevice_id` varchar(64) DEFAULT NULL,
  `climate_mode` varchar(60) DEFAULT NULL,
  `compliance_docs` varchar(255) DEFAULT NULL,
  `entry_hash` varchar(128) DEFAULT NULL,
  `source_ip` varchar(45) DEFAULT NULL,
  `is_qualified` tinyint(1) DEFAULT NULL,
  `last_qualified` datetime DEFAULT NULL,
  `session_id` varchar(80) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `is_deleted` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_wh_user` (`responsible_id`),
  KEY `fk_wh_location` (`location_id`),
  CONSTRAINT `fk_wh_location` FOREIGN KEY (`location_id`) REFERENCES `locations` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_wh_user` FOREIGN KEY (`responsible_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `warehouses`
--

LOCK TABLES `warehouses` WRITE;
/*!40000 ALTER TABLE `warehouses` DISABLE KEYS */;
/*!40000 ALTER TABLE `warehouses` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_warehouses_ai_audit` AFTER INSERT ON `warehouses` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'warehouses', 'WarehousesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('warehouses insert', CONCAT('; name=', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_warehouses_au_audit` AFTER UPDATE ON `warehouses` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'warehouses', 'WarehousesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('warehouses update', CONCAT('; name: ', COALESCE(OLD.name,''), ' → ', COALESCE(NEW.name,''))), 'system', 'server', '', 'info');

  IF COALESCE(OLD.name,'') <> COALESCE(NEW.name,'') THEN
    INSERT INTO system_event_log
      (user_id, event_type, table_name, related_module, record_id, field_name,
       old_value, new_value, description, source_ip, device_info, session_id, severity)
    VALUES
      (NULL, 'UPDATE', 'warehouses', 'WarehousesPage', NEW.id, 'name',
       OLD.name, NEW.name, 'warehouses update: name changed', 'system', 'server', '', 'info');
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_warehouses_ad_audit` AFTER DELETE ON `warehouses` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'warehouses', 'WarehousesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('warehouses delete', CONCAT('; name=', COALESCE(OLD.name,''))), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `work_order_audit`
--

DROP TABLE IF EXISTS `work_order_audit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `work_order_audit` (
  `id` int NOT NULL AUTO_INCREMENT,
  `work_order_id` int NOT NULL,
  `user_id` int NOT NULL,
  `action` enum('CREATE','UPDATE','DELETE','SIGN','EXPORT','ROLLBACK') NOT NULL,
  `old_value` text,
  `new_value` text,
  `changed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `source_ip` varchar(45) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `incident_id` int DEFAULT NULL,
  `capa_id` int DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `work_order` varchar(255) DEFAULT NULL,
  `user` varchar(255) DEFAULT NULL,
  `session_id` varchar(64) DEFAULT NULL,
  `digital_signature` varchar(256) DEFAULT NULL,
  `integrity_hash` varchar(256) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_woa_wo` (`work_order_id`),
  KEY `fk_woa_user` (`user_id`),
  CONSTRAINT `fk_woa_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_woa_wo` FOREIGN KEY (`work_order_id`) REFERENCES `work_orders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `work_order_audit`
--

LOCK TABLES `work_order_audit` WRITE;
/*!40000 ALTER TABLE `work_order_audit` DISABLE KEYS */;
/*!40000 ALTER TABLE `work_order_audit` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_audit_ai_audit` AFTER INSERT ON `work_order_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'work_order_audit', 'WorkOrderAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_audit insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_audit_au_audit` AFTER UPDATE ON `work_order_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'work_order_audit', 'WorkOrderAuditPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_audit update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_audit_ad_audit` AFTER DELETE ON `work_order_audit` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'work_order_audit', 'WorkOrderAuditPage', OLD.id, NULL,
     NULL, NULL, CONCAT('work_order_audit delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `work_order_checklist_item`
--

DROP TABLE IF EXISTS `work_order_checklist_item`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `work_order_checklist_item` (
  `id` int NOT NULL AUTO_INCREMENT,
  `work_order_id` int NOT NULL,
  `item_id` int NOT NULL,
  `result` varchar(255) DEFAULT NULL,
  `ok` tinyint(1) DEFAULT NULL,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_wocli` (`work_order_id`,`item_id`),
  KEY `fk_wocli_item` (`item_id`),
  CONSTRAINT `fk_wocli_item` FOREIGN KEY (`item_id`) REFERENCES `checklist_items` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_wocli_wo` FOREIGN KEY (`work_order_id`) REFERENCES `work_orders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `work_order_checklist_item`
--

LOCK TABLES `work_order_checklist_item` WRITE;
/*!40000 ALTER TABLE `work_order_checklist_item` DISABLE KEYS */;
/*!40000 ALTER TABLE `work_order_checklist_item` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_checklist_item_ai_audit` AFTER INSERT ON `work_order_checklist_item` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'work_order_checklist_item', 'WorkOrderChecklistItemPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_checklist_item insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_checklist_item_au_audit` AFTER UPDATE ON `work_order_checklist_item` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'work_order_checklist_item', 'WorkOrderChecklistItemPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_checklist_item update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_checklist_item_ad_audit` AFTER DELETE ON `work_order_checklist_item` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'work_order_checklist_item', 'WorkOrderChecklistItemPage', OLD.id, NULL,
     NULL, NULL, CONCAT('work_order_checklist_item delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `work_order_comments`
--

DROP TABLE IF EXISTS `work_order_comments`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `work_order_comments` (
  `id` int NOT NULL AUTO_INCREMENT,
  `work_order_id` int NOT NULL,
  `user_id` int NOT NULL,
  `comment` text,
  `revision_no` int DEFAULT '1',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_woc_wo` (`work_order_id`),
  KEY `fk_woc_user` (`user_id`),
  CONSTRAINT `fk_woc_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_woc_wo` FOREIGN KEY (`work_order_id`) REFERENCES `work_orders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `work_order_comments`
--

LOCK TABLES `work_order_comments` WRITE;
/*!40000 ALTER TABLE `work_order_comments` DISABLE KEYS */;
/*!40000 ALTER TABLE `work_order_comments` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_comments_ai_audit` AFTER INSERT ON `work_order_comments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'work_order_comments', 'WorkOrderCommentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_comments insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_comments_au_audit` AFTER UPDATE ON `work_order_comments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'work_order_comments', 'WorkOrderCommentsPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_comments update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_comments_ad_audit` AFTER DELETE ON `work_order_comments` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'work_order_comments', 'WorkOrderCommentsPage', OLD.id, NULL,
     NULL, NULL, CONCAT('work_order_comments delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `work_order_parts`
--

DROP TABLE IF EXISTS `work_order_parts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `work_order_parts` (
  `work_order_id` int NOT NULL,
  `part_id` int NOT NULL,
  `quantity` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `id` int DEFAULT NULL,
  `unit_of_measure` varchar(255) DEFAULT NULL,
  `unit_price` decimal(10,2) DEFAULT NULL,
  `currency` varchar(255) DEFAULT NULL,
  `warehouse_id` int DEFAULT NULL,
  `capa_case_id` int DEFAULT NULL,
  `incident_id` int DEFAULT NULL,
  `used_at` datetime DEFAULT NULL,
  `used_by_id` int DEFAULT NULL,
  `digital_signature` varchar(255) DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `session_id` varchar(255) DEFAULT NULL,
  `note` varchar(255) DEFAULT NULL,
  `last_modified_at` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `work_order?` varchar(255) DEFAULT NULL,
  `part?` varchar(255) DEFAULT NULL,
  `warehouse?` varchar(255) DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `capa_case?` varchar(255) DEFAULT NULL,
  `incident?` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`work_order_id`,`part_id`),
  KEY `fk_wop_part` (`part_id`),
  CONSTRAINT `fk_wop_part` FOREIGN KEY (`part_id`) REFERENCES `parts` (`id`),
  CONSTRAINT `fk_wop_wo` FOREIGN KEY (`work_order_id`) REFERENCES `work_orders` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `work_order_parts`
--

LOCK TABLES `work_order_parts` WRITE;
/*!40000 ALTER TABLE `work_order_parts` DISABLE KEYS */;
/*!40000 ALTER TABLE `work_order_parts` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_parts_ai_audit` AFTER INSERT ON `work_order_parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'work_order_parts', 'WorkOrderPartsPage', NEW.work_order_id, NULL,
     NULL, NULL, CONCAT('work_order_parts insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_parts_au_audit` AFTER UPDATE ON `work_order_parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'work_order_parts', 'WorkOrderPartsPage', NEW.work_order_id, NULL,
     NULL, NULL, CONCAT('work_order_parts update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_parts_ad_audit` AFTER DELETE ON `work_order_parts` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'work_order_parts', 'WorkOrderPartsPage', OLD.work_order_id, NULL,
     NULL, NULL, CONCAT('work_order_parts delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `work_order_photos`
--

DROP TABLE IF EXISTS `work_order_photos`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `work_order_photos` (
  `id` int NOT NULL AUTO_INCREMENT,
  `work_order_id` int NOT NULL,
  `document_id` int NOT NULL,
  `tag` enum('Before','After','Other') DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_woph_wo` (`work_order_id`),
  KEY `fk_woph_doc` (`document_id`),
  CONSTRAINT `fk_woph_doc` FOREIGN KEY (`document_id`) REFERENCES `documents` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_woph_wo` FOREIGN KEY (`work_order_id`) REFERENCES `work_orders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `work_order_photos`
--

LOCK TABLES `work_order_photos` WRITE;
/*!40000 ALTER TABLE `work_order_photos` DISABLE KEYS */;
/*!40000 ALTER TABLE `work_order_photos` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `work_order_signatures`
--

DROP TABLE IF EXISTS `work_order_signatures`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `work_order_signatures` (
  `id` int NOT NULL AUTO_INCREMENT,
  `work_order_id` int NOT NULL,
  `user_id` int NOT NULL,
  `signature_hash` varchar(255) DEFAULT NULL,
  `signed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `pin_used` varchar(20) DEFAULT NULL,
  `signature_type` enum('zakljucavanje','odobrenje','potvrda') DEFAULT 'zakljucavanje',
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_wos_wo` (`work_order_id`),
  KEY `fk_wos_user` (`user_id`),
  CONSTRAINT `fk_wos_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_wos_wo` FOREIGN KEY (`work_order_id`) REFERENCES `work_orders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `work_order_signatures`
--

LOCK TABLES `work_order_signatures` WRITE;
/*!40000 ALTER TABLE `work_order_signatures` DISABLE KEYS */;
/*!40000 ALTER TABLE `work_order_signatures` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_signatures_ai_audit` AFTER INSERT ON `work_order_signatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'work_order_signatures', 'WorkOrderSignaturesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_signatures insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_signatures_au_audit` AFTER UPDATE ON `work_order_signatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'work_order_signatures', 'WorkOrderSignaturesPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_signatures update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_signatures_ad_audit` AFTER DELETE ON `work_order_signatures` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'work_order_signatures', 'WorkOrderSignaturesPage', OLD.id, NULL,
     NULL, NULL, CONCAT('work_order_signatures delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `work_order_status_log`
--

DROP TABLE IF EXISTS `work_order_status_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `work_order_status_log` (
  `id` int NOT NULL AUTO_INCREMENT,
  `work_order_id` int NOT NULL,
  `old_status` varchar(50) DEFAULT NULL,
  `new_status` varchar(50) DEFAULT NULL,
  `changed_by` int DEFAULT NULL,
  `changed_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `note` text,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `work_order` varchar(255) DEFAULT NULL,
  `changed_by_id` int DEFAULT NULL,
  `reason` varchar(400) DEFAULT NULL,
  `is_incident` tinyint(1) DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `ip_address` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_wosl_wo` (`work_order_id`),
  KEY `fk_wosl_user` (`changed_by`),
  CONSTRAINT `fk_wosl_user` FOREIGN KEY (`changed_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_wosl_wo` FOREIGN KEY (`work_order_id`) REFERENCES `work_orders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `work_order_status_log`
--

LOCK TABLES `work_order_status_log` WRITE;
/*!40000 ALTER TABLE `work_order_status_log` DISABLE KEYS */;
/*!40000 ALTER TABLE `work_order_status_log` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_status_log_ai_audit` AFTER INSERT ON `work_order_status_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'work_order_status_log', 'WorkOrderStatusLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_status_log insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_status_log_au_audit` AFTER UPDATE ON `work_order_status_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'work_order_status_log', 'WorkOrderStatusLogPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_order_status_log update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_order_status_log_ad_audit` AFTER DELETE ON `work_order_status_log` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'work_order_status_log', 'WorkOrderStatusLogPage', OLD.id, NULL,
     NULL, NULL, CONCAT('work_order_status_log delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `work_orders`
--

DROP TABLE IF EXISTS `work_orders`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `work_orders` (
  `id` int NOT NULL AUTO_INCREMENT,
  `machine_id` int DEFAULT NULL,
  `component_id` int DEFAULT NULL,
  `type` enum('preventivni','korektivni','vanredni') DEFAULT NULL,
  `created_by` int DEFAULT NULL,
  `assigned_to` int DEFAULT NULL,
  `date_open` date DEFAULT NULL,
  `date_close` date DEFAULT NULL,
  `description` text,
  `result` text,
  `status` enum('otvoren','u_tijeku','zavrsen','odbijen','na_─Źekanju','planiran','otkazan') DEFAULT 'otvoren',
  `digital_signature` varchar(128) DEFAULT NULL,
  `priority` enum('nizak','srednji','visok','kritican') DEFAULT 'srednji',
  `related_incident` int DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `status_id` int DEFAULT NULL,
  `type_id` int DEFAULT NULL,
  `priority_id` int DEFAULT NULL,
  `tenant_id` int DEFAULT NULL,
  `title` varchar(255) DEFAULT NULL,
  `task_description` varchar(255) DEFAULT NULL,
  `due_date` datetime DEFAULT NULL,
  `closed_at` datetime DEFAULT NULL,
  `requested_by_id` int DEFAULT NULL,
  `user?` varchar(255) DEFAULT NULL,
  `created_by_id` int DEFAULT NULL,
  `assigned_to_id` int DEFAULT NULL,
  `machine?` varchar(255) DEFAULT NULL,
  `machine_component?` varchar(255) DEFAULT NULL,
  `capa_case_id` int DEFAULT NULL,
  `capa_case?` varchar(255) DEFAULT NULL,
  `incident_id` int DEFAULT NULL,
  `incident?` varchar(255) DEFAULT NULL,
  `notes` varchar(255) DEFAULT NULL,
  `last_modified` datetime DEFAULT NULL,
  `last_modified_by_id` int DEFAULT NULL,
  `device_info` varchar(255) DEFAULT NULL,
  `source_ip` varchar(255) DEFAULT NULL,
  `session_id` varchar(255) DEFAULT NULL,
  `document_path` varchar(255) DEFAULT NULL,
  `next_due` datetime DEFAULT NULL,
  `external_ref` varchar(255) DEFAULT NULL,
  `entry_hash` varchar(255) DEFAULT NULL,
  `audit_flag` tinyint(1) DEFAULT NULL,
  `anomaly_score` decimal(10,2) DEFAULT NULL,
  `photo_before_ids` varchar(255) DEFAULT NULL,
  `photo_after_ids` varchar(255) DEFAULT NULL,
  `icollection<work_order_part>` varchar(255) DEFAULT NULL,
  `icollection<photo>` varchar(255) DEFAULT NULL,
  `icollection<work_order_comment>` varchar(255) DEFAULT NULL,
  `icollection<work_order_status_log>` varchar(255) DEFAULT NULL,
  `icollection<work_order_signature>` varchar(255) DEFAULT NULL,
  `icollection<work_order_audit>` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_wo_comp` (`component_id`),
  KEY `fk_wo_created` (`created_by`),
  KEY `fk_wo_assigned` (`assigned_to`),
  KEY `fk_wo_incident` (`related_incident`),
  KEY `idx_wo_status_id` (`status_id`),
  KEY `idx_wo_type_id` (`type_id`),
  KEY `idx_wo_priority_id` (`priority_id`),
  KEY `idx_wo_machine_stat` (`machine_id`,`status_id`),
  KEY `fk_wo_tenant_id` (`tenant_id`),
  CONSTRAINT `fk_wo_assigned` FOREIGN KEY (`assigned_to`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_wo_comp` FOREIGN KEY (`component_id`) REFERENCES `machine_components` (`id`),
  CONSTRAINT `fk_wo_created` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`),
  CONSTRAINT `fk_wo_incident` FOREIGN KEY (`related_incident`) REFERENCES `incident_log` (`id`),
  CONSTRAINT `fk_wo_machine` FOREIGN KEY (`machine_id`) REFERENCES `machines` (`id`),
  CONSTRAINT `fk_wo_priority` FOREIGN KEY (`priority_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_wo_status` FOREIGN KEY (`status_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_wo_tenant_id` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`),
  CONSTRAINT `fk_wo_type` FOREIGN KEY (`type_id`) REFERENCES `ref_value` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `work_orders`
--

LOCK TABLES `work_orders` WRITE;
/*!40000 ALTER TABLE `work_orders` DISABLE KEYS */;
/*!40000 ALTER TABLE `work_orders` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_wo_sync` BEFORE INSERT ON `work_orders` FOR EACH ROW BEGIN
  
  CALL ref_touch('work_order_status', NEW.status, NEW.status);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
  
  CALL ref_touch('work_order_type', NEW.type, NEW.type);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.type_id = LAST_INSERT_ID(); END IF;
  
  CALL ref_touch('priority', NEW.priority, NEW.priority);
  IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.priority_id = LAST_INSERT_ID(); END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_orders_ai_audit` AFTER INSERT ON `work_orders` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'INSERT', 'work_orders', 'WorkOrdersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_orders insert'), 'system', 'server', '', 'info');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_wo_sync_u` BEFORE UPDATE ON `work_orders` FOR EACH ROW BEGIN
  IF (NEW.status <=> OLD.status) = 0 THEN
    CALL ref_touch('work_order_status', NEW.status, NEW.status);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.status_id = LAST_INSERT_ID(); END IF;
  END IF;
  IF (NEW.type <=> OLD.type) = 0 THEN
    CALL ref_touch('work_order_type', NEW.type, NEW.type);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.type_id = LAST_INSERT_ID(); END IF;
  END IF;
  IF (NEW.priority <=> OLD.priority) = 0 THEN
    CALL ref_touch('priority', NEW.priority, NEW.priority);
    IF LAST_INSERT_ID() IS NOT NULL THEN SET NEW.priority_id = LAST_INSERT_ID(); END IF;
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_orders_au_audit` AFTER UPDATE ON `work_orders` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'UPDATE', 'work_orders', 'WorkOrdersPage', NEW.id, NULL,
     NULL, NULL, CONCAT('work_orders update'), 'system', 'server', '', 'info');

END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_work_orders_ad_audit` AFTER DELETE ON `work_orders` FOR EACH ROW BEGIN
  INSERT INTO system_event_log
    (user_id, event_type, table_name, related_module, record_id, field_name,
     old_value, new_value, description, source_ip, device_info, session_id, severity)
  VALUES
    (NULL, 'DELETE', 'work_orders', 'WorkOrdersPage', OLD.id, NULL,
     NULL, NULL, CONCAT('work_orders delete'), 'system', 'server', '', 'warning');
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Dumping events for database 'yasgmp'
--
/*!50106 SET @save_time_zone= @@TIME_ZONE */ ;
/*!50106 DROP EVENT IF EXISTS `ev_autotimestamps` */;
DELIMITER ;;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;;
/*!50003 SET character_set_client  = cp852 */ ;;
/*!50003 SET character_set_results = cp852 */ ;;
/*!50003 SET collation_connection  = cp852_general_ci */ ;;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;;
/*!50003 SET @saved_time_zone      = @@time_zone */ ;;
/*!50003 SET time_zone             = 'SYSTEM' */ ;;
/*!50106 CREATE*/ /*!50117 DEFINER=`root`@`localhost`*/ /*!50106 EVENT `ev_autotimestamps` ON SCHEDULE EVERY 1 DAY STARTS '2025-08-25 12:36:22' ON COMPLETION NOT PRESERVE ENABLE DO CALL ensure_timestamps_all() */ ;;
/*!50003 SET time_zone             = @saved_time_zone */ ;;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;;
/*!50003 SET character_set_client  = @saved_cs_client */ ;;
/*!50003 SET character_set_results = @saved_cs_results */ ;;
/*!50003 SET collation_connection  = @saved_col_connection */ ;;
DELIMITER ;
/*!50106 SET TIME_ZONE= @save_time_zone */ ;

--
-- Dumping routines for database 'yasgmp'
--
/*!50003 DROP FUNCTION IF EXISTS `CURRENT_USER_ID` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `CURRENT_USER_ID`() RETURNS int
    DETERMINISTIC
    SQL SECURITY INVOKER
BEGIN
  
  RETURN NULL;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `fn_normalize_machine_status` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `fn_normalize_machine_status`(raw VARCHAR(64)) RETURNS varchar(32) CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci
    DETERMINISTIC
BEGIN
  DECLARE s VARCHAR(64) DEFAULT TRIM(LOWER(IFNULL(raw,'')));
  RETURN
    CASE
      WHEN s IN ('maintenance','maint','service','van pogona','neispravan','kvar','servis') THEN 'maintenance'
      WHEN s IN ('decommissioned','decom','retired','dekomisioniran') THEN 'decommissioned'
      WHEN s IN ('reserved','rezerviran') THEN 'reserved'
      WHEN s IN ('scrapped','scrap','otpisan','rashodovan') THEN 'scrapped'
      WHEN s IN ('u pogonu','operativan','operational','active','') THEN 'active'
      ELSE 'active'
    END;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `add_column_if_missing` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `add_column_if_missing`(
    IN p_table  VARCHAR(64),
    IN p_column VARCHAR(64),
    IN p_def    TEXT
)
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM INFORMATION_SCHEMA.COLUMNS
         WHERE TABLE_SCHEMA = DATABASE()
           AND TABLE_NAME   = p_table
           AND COLUMN_NAME  = p_column
    ) THEN
        SET @ddl = CONCAT('ALTER TABLE `', p_table, '` ADD COLUMN `', p_column, '` ', p_def);
        PREPARE stmt FROM @ddl;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
    END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `add_fk_if_missing` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `add_fk_if_missing`(IN p_tbl VARCHAR(64), IN p_fk VARCHAR(64), IN p_ddl TEXT)
BEGIN
  IF EXISTS (SELECT 1 FROM information_schema.tables
              WHERE table_schema = DATABASE() AND table_name = p_tbl) THEN
    IF NOT EXISTS (SELECT 1 FROM information_schema.table_constraints
                    WHERE table_schema   = DATABASE()
                      AND table_name     = p_tbl
                      AND constraint_type = 'FOREIGN KEY'
                      AND constraint_name = p_fk) THEN
      SET @sql := p_ddl; PREPARE ps FROM @sql; EXECUTE ps; DEALLOCATE PREPARE ps;
    END IF;
  END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `add_index_if_missing` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `add_index_if_missing`(IN p_tbl VARCHAR(64), IN p_idx VARCHAR(64), IN p_ddl TEXT)
BEGIN
  IF EXISTS (SELECT 1 FROM information_schema.tables
              WHERE table_schema = DATABASE() AND table_name = p_tbl) THEN
    IF NOT EXISTS (SELECT 1 FROM information_schema.statistics
                    WHERE table_schema = DATABASE()
                      AND table_name   = p_tbl
                      AND index_name   = p_idx) THEN
      SET @sql := p_ddl; PREPARE ps FROM @sql; EXECUTE ps; DEALLOCATE PREPARE ps;
    END IF;
  END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `backfill_catalog_ids` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `backfill_catalog_ids`()
BEGIN
  
  UPDATE work_orders wo
  JOIN ref_domain d ON d.code='work_order_status'
  JOIN ref_value rv ON rv.domain_id=d.id AND rv.code=wo.status
  SET wo.status_id=rv.id
  WHERE wo.status IS NOT NULL;

  UPDATE work_orders wo
  JOIN ref_domain d ON d.code='work_order_type'
  JOIN ref_value rv ON rv.domain_id=d.id AND rv.code=wo.type
  SET wo.type_id=rv.id
  WHERE wo.type IS NOT NULL;

  UPDATE work_orders wo
  JOIN ref_domain d ON d.code='priority'
  JOIN ref_value rv ON rv.domain_id=d.id AND rv.code=wo.priority
  SET wo.priority_id=rv.id
  WHERE wo.priority IS NOT NULL;

  
  UPDATE inspections i
  JOIN ref_domain d1 ON d1.code='inspection_type'
  JOIN ref_value rv1 ON rv1.domain_id=d1.id AND rv1.code=i.type
  SET i.type_id=rv1.id
  WHERE i.type IS NOT NULL;

  UPDATE inspections i
  JOIN ref_domain d2 ON d2.code='inspection_result'
  JOIN ref_value rv2 ON rv2.domain_id=d2.id AND rv2.code=i.result
  SET i.result_id=rv2.id
  WHERE i.result IS NOT NULL;

  
  UPDATE calibrations c
  JOIN ref_domain d ON d.code='calibration_result'
  JOIN ref_value rv ON rv.domain_id=d.id AND rv.code=c.result
  SET c.result_id=rv.id
  WHERE c.result IS NOT NULL;

  
  UPDATE quality_events q
  JOIN ref_domain d ON d.code='quality_event_type'
  JOIN ref_value rv ON rv.domain_id=d.id AND rv.code=q.event_type
  SET q.type_id=rv.id
  WHERE q.event_type IS NOT NULL;

  UPDATE quality_events q
  JOIN ref_domain d ON d.code='quality_status'
  JOIN ref_value rv ON rv.domain_id=d.id AND rv.code=q.status
  SET q.status_id=rv.id
  WHERE q.status IS NOT NULL;

  
  UPDATE machines m
  JOIN ref_domain d ON d.code='asset_status'
  JOIN ref_value rv ON rv.domain_id=d.id AND rv.code=m.status
  SET m.status_id=rv.id
  WHERE m.status IS NOT NULL;

  UPDATE machines m
  JOIN ref_domain d ON d.code='lifecycle_phase'
  JOIN ref_value rv ON rv.domain_id=d.id AND rv.code=m.lifecycle_phase
  SET m.lifecycle_phase_id=rv.id
  WHERE m.lifecycle_phase IS NOT NULL;

  
  UPDATE suppliers s
  JOIN ref_domain d1 ON d1.code='supplier_status'
  JOIN ref_value rv1 ON rv1.domain_id=d1.id AND rv1.code=s.status
  SET s.status_id=rv1.id
  WHERE s.status IS NOT NULL;

  UPDATE suppliers s
  JOIN ref_domain d2 ON d2.code='supplier_type'
  JOIN ref_value rv2 ON rv2.domain_id=d2.id AND rv2.code=s.type
  SET s.type_id=rv2.id
  WHERE s.type IS NOT NULL;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ensure_timestamps_all` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `ensure_timestamps_all`()
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE tbl VARCHAR(100);
  DECLARE cur CURSOR FOR
    SELECT TABLE_NAME
      FROM INFORMATION_SCHEMA.TABLES
     WHERE TABLE_SCHEMA = DATABASE()
       AND TABLE_TYPE = 'BASE TABLE';
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

  OPEN cur;
  read_loop: LOOP
    FETCH cur INTO tbl;
    IF done THEN
      LEAVE read_loop;
    END IF;

    IF NOT EXISTS (
      SELECT 1 FROM INFORMATION_SCHEMA.COLUMNS
       WHERE TABLE_SCHEMA = DATABASE()
         AND TABLE_NAME = tbl
         AND COLUMN_NAME = 'created_at'
    ) THEN
      SET @s = CONCAT('ALTER TABLE ', tbl,
                      ' ADD COLUMN created_at DATETIME DEFAULT CURRENT_TIMESTAMP');
      PREPARE stmt FROM @s; EXECUTE stmt; DEALLOCATE PREPARE stmt;
    END IF;

    IF NOT EXISTS (
      SELECT 1 FROM INFORMATION_SCHEMA.COLUMNS
       WHERE TABLE_SCHEMA = DATABASE()
         AND TABLE_NAME = tbl
         AND COLUMN_NAME = 'updated_at'
    ) THEN
      SET @s = CONCAT('ALTER TABLE ', tbl,
                      ' ADD COLUMN updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP');
      PREPARE stmt FROM @s; EXECUTE stmt; DEALLOCATE PREPARE stmt;
    END IF;

  END LOOP;
  CLOSE cur;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `migrate_enum_to_fk` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `migrate_enum_to_fk`(
    IN p_table        VARCHAR(64),
    IN p_old_col      VARCHAR(64),
    IN p_new_col      VARCHAR(64),
    IN p_domain_code  VARCHAR(50),
    IN p_default_code VARCHAR(100)
)
BEGIN
  DECLARE v_domain_id  INT;
  DECLARE v_fk_name    VARCHAR(128);

  
  SELECT id INTO v_domain_id
    FROM lookup_domain
   WHERE domain_code = p_domain_code;

  
  CALL add_column_if_missing(p_table, CONCAT('`',p_new_col,'`'),'INT NULL');

  
  SET @sql := CONCAT(
    'UPDATE ',p_table,' t ',
    'JOIN lookup_value v ',
    '  ON v.domain_id = ',v_domain_id,
    ' AND v.value_code COLLATE utf8mb4_unicode_ci = ',
    '     COALESCE(t.',p_old_col,',\'',p_default_code,'\') ',
    '       COLLATE utf8mb4_unicode_ci ',
    'SET t.',p_new_col,' = v.id ',
    'WHERE t.',p_new_col,' IS NULL');
  PREPARE s FROM @sql; EXECUTE s; DEALLOCATE PREPARE s;

  
  SET v_fk_name := CONCAT('fk_',p_table,'_',p_new_col);
  CALL add_fk_if_missing(
        p_table,
        v_fk_name,
        CONCAT(
          'ALTER TABLE ',p_table,
          ' ADD CONSTRAINT ',v_fk_name,
          ' FOREIGN KEY (',p_new_col,') REFERENCES lookup_value(id)')
  );
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ref_touch` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `ref_touch`(
    IN p_domain VARCHAR(64),
    IN p_code   VARCHAR(255),
    IN p_label  VARCHAR(255)
)
BEGIN
    DECLARE v_domain_id INT;
    DECLARE v_value_id  INT;

    -- ensure domain exists; set LAST_INSERT_ID to its id
    INSERT INTO ref_domain(`name`) VALUES (p_domain)
    ON DUPLICATE KEY UPDATE `id` = LAST_INSERT_ID(`id`);
    SET v_domain_id = LAST_INSERT_ID();

    -- ensure value exists; set LAST_INSERT_ID to its id (inserted or existing)
    INSERT INTO ref_value(`domain_id`,`code`,`label`,`is_active`)
    VALUES (v_domain_id, p_code, COALESCE(p_label, p_code), 1)
    ON DUPLICATE KEY UPDATE `id` = LAST_INSERT_ID(`id`), `label`=VALUES(`label`), `is_active`=1;
    SET v_value_id = LAST_INSERT_ID();

    -- expose value id via session LAST_INSERT_ID() without returning a result set
    DO LAST_INSERT_ID(v_value_id);
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_emit_audit_triggers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_emit_audit_triggers`(IN p_table VARCHAR(64))
BEGIN
  /*
    Emits a suggested 3-trigger audit block for p_table as a single TEXT column (ddl).
    Usage:
      CALL sp_emit_audit_triggers('your_table');
    Notes:
      - MySQL cannot PREPARE CREATE TRIGGER; copy the result into a script and run.
      - related_module defaults to CONCAT(p_table, 'Page').
  */
  DECLARE has_id        BOOL DEFAULT FALSE;
  DECLARE has_code      BOOL DEFAULT FALSE;
  DECLARE has_name      BOOL DEFAULT FALSE;
  DECLARE has_number    BOOL DEFAULT FALSE;
  DECLARE has_username  BOOL DEFAULT FALSE;

  SELECT COUNT(*)>0 INTO has_id       FROM information_schema.columns WHERE table_schema = DATABASE() AND table_name = p_table AND column_name = 'id';
  SELECT COUNT(*)>0 INTO has_code     FROM information_schema.columns WHERE table_schema = DATABASE() AND table_name = p_table AND column_name = 'code';
  SELECT COUNT(*)>0 INTO has_name     FROM information_schema.columns WHERE table_schema = DATABASE() AND table_name = p_table AND column_name = 'name';
  SELECT COUNT(*)>0 INTO has_number   FROM information_schema.columns WHERE table_schema = DATABASE() AND table_name = p_table AND column_name = 'number';
  SELECT COUNT(*)>0 INTO has_username FROM information_schema.columns WHERE table_schema = DATABASE() AND table_name = p_table AND column_name = 'username';

  SELECT CONCAT(
'-- ===== Triggers for ', p_table, ' =====\n',
'DROP TRIGGER IF EXISTS trg_', p_table, '_ai_audit;\n',
'DROP TRIGGER IF EXISTS trg_', p_table, '_au_audit;\n',
'DROP TRIGGER IF EXISTS trg_', p_table, '_ad_audit;\n',
'DELIMITER $$\n\n',

'CREATE TRIGGER trg_', p_table, '_ai_audit\n',
'AFTER INSERT ON ', p_table, '\nFOR EACH ROW\nBEGIN\n',
'  INSERT INTO system_event_log\n',
'    (user_id, event_type, table_name, related_module, record_id, field_name,\n',
'     old_value, new_value, description, source_ip, device_info, session_id, severity)\n',
'  VALUES\n',
'    (NULL, ''INSERT'', ''', p_table, ''', ''', p_table, 'Page'', NEW.', IF(has_id,'id','id'), ', NULL,\n',
'     NULL, NULL, CONCAT(''', p_table, ' insert''',
IF(has_code,     ', CONCAT(''; code='', COALESCE(NEW.code, ''''))', ''),
IF(has_name,     ', CONCAT(''; name='', COALESCE(NEW.name, ''''))', ''),
IF(has_number,   ', CONCAT(''; number='', COALESCE(NEW.number, ''''))', ''),
IF(has_username, ', CONCAT(''; username='', COALESCE(NEW.username, ''''))', ''),
'), ''system'', ''server'', '''', ''info'');\n',
'END$$\n\n',

'CREATE TRIGGER trg_', p_table, '_au_audit\n',
'AFTER UPDATE ON ', p_table, '\nFOR EACH ROW\nBEGIN\n',
'  INSERT INTO system_event_log\n',
'    (user_id, event_type, table_name, related_module, record_id, field_name,\n',
'     old_value, new_value, description, source_ip, device_info, session_id, severity)\n',
'  VALUES\n',
'    (NULL, ''UPDATE'', ''', p_table, ''', ''', p_table, 'Page'', NEW.', IF(has_id,'id','id'), ', NULL,\n',
'     NULL, NULL, CONCAT(''', p_table, ' update''',
IF(has_code,     ', CONCAT(''; code: '', COALESCE(OLD.code, ''''), '' → '', COALESCE(NEW.code, ''''))', ''),
IF(has_name,     ', CONCAT(''; name: '', COALESCE(OLD.name, ''''), '' → '', COALESCE(NEW.name, ''''))', ''),
IF(has_number,   ', CONCAT(''; number: '', COALESCE(OLD.number, ''''), '' → '', COALESCE(NEW.number, ''''))', ''),
IF(has_username, ', CONCAT(''; username: '', COALESCE(OLD.username, ''''), '' → '', COALESCE(NEW.username, ''''))', ''),
'), ''system'', ''server'', '''', ''info'');\n',
IF(has_code, CONCAT(
'  IF COALESCE(OLD.code, '''') <> COALESCE(NEW.code, '''') THEN\n',
'    INSERT INTO system_event_log (user_id, event_type, table_name, related_module, record_id, field_name, old_value, new_value, description, source_ip, device_info, session_id, severity)\n',
'    VALUES (NULL, ''UPDATE'', ''', p_table, ''', ''', p_table, 'Page'', NEW.', IF(has_id,'id','id'), ', ''code'', OLD.code, NEW.code, ''', p_table, ' update: code changed'', ''system'', ''server'', '''', ''info'');\n',
'  END IF;\n'), ''),
IF(has_name, CONCAT(
'  IF COALESCE(OLD.name, '''') <> COALESCE(NEW.name, '''') THEN\n',
'    INSERT INTO system_event_log (user_id, event_type, table_name, related_module, record_id, field_name, old_value, new_value, description, source_ip, device_info, session_id, severity)\n',
'    VALUES (NULL, ''UPDATE'', ''', p_table, ''', ''', p_table, 'Page'', NEW.', IF(has_id,'id','id'), ', ''name'', OLD.name, NEW.name, ''', p_table, ' update: name changed'', ''system'', ''server'', '''', ''info'');\n',
'  END IF;\n'), ''),
'END$$\n\n',

'CREATE TRIGGER trg_', p_table, '_ad_audit\n',
'AFTER DELETE ON ', p_table, '\nFOR EACH ROW\nBEGIN\n',
'  INSERT INTO system_event_log\n',
'    (user_id, event_type, table_name, related_module, record_id, field_name,\n',
'     old_value, new_value, description, source_ip, device_info, session_id, severity)\n',
'  VALUES\n',
'    (NULL, ''DELETE'', ''', p_table, ''', ''', p_table, 'Page'', OLD.', IF(has_id,'id','id'), ', NULL,\n',
'     NULL, NULL, CONCAT(''', p_table, ' delete''',
IF(has_code,     ', CONCAT(''; code='', COALESCE(OLD.code, ''''))', ''),
IF(has_name,     ', CONCAT(''; name='', COALESCE(OLD.name, ''''))', ''),
'), ''system'', ''server'', '''', ''warning'');\n',
'END$$\n\n',
'DELIMITER ;\n'
  ) AS ddl;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_inspect_triggers_for_resultsets` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_inspect_triggers_for_resultsets`(IN p_table VARCHAR(64))
BEGIN
  /*
    Scans trigger bodies for suspicious tokens that could emit result sets or do admin ops.
    Usage:
      CALL sp_inspect_triggers_for_resultsets('machines');
      CALL sp_inspect_triggers_for_resultsets(NULL); -- all tables
  */
  SELECT
      TRIGGER_NAME,
      EVENT_OBJECT_TABLE AS table_name,
      ACTION_TIMING,
      EVENT_MANIPULATION AS event_op,
      ACTION_STATEMENT
  FROM INFORMATION_SCHEMA.TRIGGERS
  WHERE TRIGGER_SCHEMA = DATABASE()
    AND (p_table IS NULL OR EVENT_OBJECT_TABLE = p_table)
    AND (
      ACTION_STATEMENT REGEXP '\\bSELECT\\b'
      OR ACTION_STATEMENT REGEXP '\\bSHOW\\b'
      OR ACTION_STATEMENT REGEXP '\\bCREATE\\s+TEMPORARY\\s+TABLE\\b'
      OR ACTION_STATEMENT REGEXP '\\bALTER\\s+TABLE\\b'
      OR ACTION_STATEMENT REGEXP '\\bDROP\\s+TABLE\\b'
    )
  ORDER BY EVENT_OBJECT_TABLE, TRIGGER_NAME;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_list_table_triggers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_list_table_triggers`(IN p_table VARCHAR(64))
BEGIN
  /*
    CALL sp_list_table_triggers('machines');
  */
  SELECT
      TRIGGER_NAME,
      ACTION_TIMING,
      EVENT_MANIPULATION AS event_op
  FROM INFORMATION_SCHEMA.TRIGGERS
  WHERE TRIGGER_SCHEMA = DATABASE()
    AND EVENT_OBJECT_TABLE = p_table
  ORDER BY TRIGGER_NAME;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_log_calibration_export` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = cp852 */ ;
/*!50003 SET character_set_results = cp852 */ ;
/*!50003 SET collation_connection  = cp852_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_log_calibration_export`(
    IN p_user_id INT,
    IN p_format ENUM('excel','pdf'),
    IN p_component_id INT,
    IN p_date_from DATE,
    IN p_date_to DATE,
    IN p_file_path VARCHAR(255)
)
BEGIN
    INSERT INTO calibration_export_log (
        user_id, export_format, filter_component_id, filter_date_from, filter_date_to, file_path
    ) VALUES (
        p_user_id, p_format, p_component_id, p_date_from, p_date_to, p_file_path
    );
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Current Database: `yasgmp`
--

USE `yasgmp`;

--
-- Final view structure for view `audit_log`
--

/*!50001 DROP VIEW IF EXISTS `audit_log`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `audit_log` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`event_time` AS `event_time`,`system_event_log`.`timestamp` AS `timestamp`,`system_event_log`.`user_id` AS `user_id`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`action` AS `action`,`system_event_log`.`table_name` AS `table_name`,`system_event_log`.`related_module` AS `related_module`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`details` AS `details`,`system_event_log`.`source_ip` AS `source_ip`,`system_event_log`.`device_info` AS `device_info`,`system_event_log`.`session_id` AS `session_id`,`system_event_log`.`severity` AS `severity`,`system_event_log`.`processed` AS `processed`,`system_event_log`.`created_at` AS `created_at`,`system_event_log`.`updated_at` AS `updated_at`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`username` AS `username`,`system_event_log`.`digital_signature` AS `digital_signature`,`system_event_log`.`entry_hash` AS `entry_hash`,`system_event_log`.`mac_address` AS `mac_address`,`system_event_log`.`geo_location` AS `geo_location`,`system_event_log`.`regulator` AS `regulator`,`system_event_log`.`related_case_id` AS `related_case_id`,`system_event_log`.`related_case_type` AS `related_case_type`,`system_event_log`.`anomaly_score` AS `anomaly_score`,`system_event_log`.`user` AS `user`,`system_event_log`.`change_version` AS `change_version`,`system_event_log`.`is_deleted` AS `is_deleted` from `system_event_log` */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `capa_audit_log`
--

/*!50001 DROP VIEW IF EXISTS `capa_audit_log`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `capa_audit_log` AS select `capa_status_history`.`id` AS `id`,`capa_status_history`.`capa_case_id` AS `capa_case_id`,`capa_status_history`.`old_status` AS `old_status`,`capa_status_history`.`new_status` AS `new_status`,`capa_status_history`.`changed_by` AS `changed_by`,`capa_status_history`.`changed_at` AS `changed_at`,`capa_status_history`.`note` AS `note`,`capa_status_history`.`created_at` AS `created_at`,`capa_status_history`.`updated_at` AS `updated_at`,`capa_status_history`.`capa_case` AS `capa_case`,`capa_status_history`.`source_ip` AS `source_ip`,`capa_status_history`.`digital_signature` AS `digital_signature`,`capa_status_history`.`change_version` AS `change_version`,`capa_status_history`.`is_deleted` AS `is_deleted` from `capa_status_history` */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `incidents`
--

/*!50001 DROP VIEW IF EXISTS `incidents`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `incidents` AS select `incident_log`.`id` AS `id`,`incident_log`.`detected_at` AS `detected_at`,`incident_log`.`reported_by` AS `reported_by`,`incident_log`.`severity` AS `severity`,`incident_log`.`title` AS `title`,`incident_log`.`description` AS `description`,`incident_log`.`resolved` AS `resolved`,`incident_log`.`resolved_at` AS `resolved_at`,`incident_log`.`resolved_by` AS `resolved_by`,`incident_log`.`actions_taken` AS `actions_taken`,`incident_log`.`follow_up` AS `follow_up`,`incident_log`.`note` AS `note`,`incident_log`.`source_ip` AS `source_ip`,`incident_log`.`created_at` AS `created_at`,`incident_log`.`updated_at` AS `updated_at`,`incident_log`.`severity_id` AS `severity_id`,`incident_log`.`reported_by_id` AS `reported_by_id`,`incident_log`.`resolved_by_id` AS `resolved_by_id`,`incident_log`.`digital_signature` AS `digital_signature`,`incident_log`.`root_cause` AS `root_cause`,`incident_log`.`capa_case_id` AS `capa_case_id`,`incident_log`.`capa_case` AS `capa_case`,`incident_log`.`attachments` AS `attachments`,`incident_log`.`last_modified` AS `last_modified`,`incident_log`.`last_modified_by_id` AS `last_modified_by_id`,`incident_log`.`last_modified_by` AS `last_modified_by` from `incident_log` */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `notifications`
--

/*!50001 DROP VIEW IF EXISTS `notifications`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `notifications` AS select `notification_queue`.`id` AS `id`,`notification_queue`.`template_id` AS `template_id`,`notification_queue`.`recipient_user_id` AS `recipient_user_id`,`notification_queue`.`channel` AS `channel`,`notification_queue`.`payload` AS `payload`,`notification_queue`.`scheduled_at` AS `scheduled_at`,`notification_queue`.`sent_at` AS `sent_at`,`notification_queue`.`status` AS `status`,`notification_queue`.`last_error` AS `last_error`,`notification_queue`.`created_at` AS `created_at`,`notification_queue`.`updated_at` AS `updated_at` from `notification_queue` */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `role`
--

/*!50001 DROP VIEW IF EXISTS `role`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `role` AS select `roles`.`id` AS `id`,`roles`.`name` AS `name`,`roles`.`description` AS `description`,`roles`.`org_unit` AS `org_unit`,`roles`.`compliance_tags` AS `compliance_tags`,`roles`.`is_deleted` AS `is_deleted`,`roles`.`notes` AS `notes`,`roles`.`created_at` AS `created_at`,`roles`.`updated_at` AS `updated_at`,`roles`.`created_by_id` AS `created_by_id`,`roles`.`last_modified_by_id` AS `last_modified_by_id`,`roles`.`version` AS `version`,`roles`.`icollection<permission>` AS `icollection<permission>`,`roles`.`icollection<user>` AS `icollection<user>`,`roles`.`icollection<role_permission>` AS `icollection<role_permission>`,`roles`.`user?` AS `user?` from `roles` */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `units`
--

/*!50001 DROP VIEW IF EXISTS `units`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `units` AS select `measurement_units`.`id` AS `id`,`measurement_units`.`code` AS `code`,`measurement_units`.`name` AS `name`,`measurement_units`.`created_at` AS `created_at`,`measurement_units`.`updated_at` AS `updated_at` from `measurement_units` */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `v_machine_components_ui`
--

/*!50001 DROP VIEW IF EXISTS `v_machine_components_ui`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `v_machine_components_ui` AS select `machine_components`.`id` AS `id`,`machine_components`.`machine_id` AS `machine_id`,`machine_components`.`code` AS `code`,`machine_components`.`name` AS `name`,`machine_components`.`type` AS `type`,`machine_components`.`sop_doc` AS `sop_doc`,`machine_components`.`status` AS `status`,`machine_components`.`install_date` AS `install_date` from `machine_components` where ((`machine_components`.`is_deleted` = 0) or (`machine_components`.`is_deleted` is null)) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `v_suppliers_ui`
--

/*!50001 DROP VIEW IF EXISTS `v_suppliers_ui`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `v_suppliers_ui` AS select `suppliers`.`id` AS `id`,`suppliers`.`name` AS `name`,`suppliers`.`oib` AS `vat_number`,`suppliers`.`address` AS `address`,`suppliers`.`type` AS `supplier_type`,`suppliers`.`email` AS `email`,`suppliers`.`phone` AS `phone`,`suppliers`.`cert_doc` AS `contract_file`,`suppliers`.`comment` AS `notes` from `suppliers` */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_admin_activity_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_admin_activity_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_admin_activity_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'admin_activity_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_api_audit_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_api_audit_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_api_audit_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'api_audit_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_api_keys_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_api_keys_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_api_keys_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'api_keys') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_api_usage_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_api_usage_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_api_usage_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'api_usage_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_attachments_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_attachments_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_attachments_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'attachments') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_buildings_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_buildings_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_buildings_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'buildings') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_calibration_audit_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_calibration_audit_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_calibration_audit_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'calibration_audit_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_calibration_export_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_calibration_export_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_calibration_export_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'calibration_export_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_calibration_sensors_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_calibration_sensors_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_calibration_sensors_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'calibration_sensors') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_calibrations_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_calibrations_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_calibrations_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'calibrations') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_calibrations_filter`
--

/*!50001 DROP VIEW IF EXISTS `vw_calibrations_filter`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = cp852 */;
/*!50001 SET character_set_results     = cp852 */;
/*!50001 SET collation_connection      = cp852_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_calibrations_filter` AS select `c`.`id` AS `id`,`mc`.`name` AS `component_name`,`s`.`name` AS `supplier_name`,`c`.`calibration_date` AS `calibration_date`,`c`.`next_due` AS `next_due`,`c`.`result` AS `result`,`c`.`comment` AS `comment`,`c`.`digital_signature` AS `digital_signature` from ((`calibrations` `c` left join `machine_components` `mc` on((`c`.`component_id` = `mc`.`id`))) left join `suppliers` `s` on((`c`.`supplier_id` = `s`.`id`))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_capa_action_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_capa_action_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_capa_action_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'capa_action_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_capa_actions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_capa_actions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_capa_actions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'capa_actions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_capa_cases_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_capa_cases_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_capa_cases_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'capa_cases') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_capa_status_history_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_capa_status_history_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_capa_status_history_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'capa_status_history') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_checklist_items_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_checklist_items_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_checklist_items_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'checklist_items') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_checklist_templates_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_checklist_templates_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_checklist_templates_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'checklist_templates') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_comments_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_comments_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_comments_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'comments') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_component_devices_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_component_devices_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_component_devices_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'component_devices') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_component_models_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_component_models_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_component_models_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'component_models') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_component_parts_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_component_parts_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_component_parts_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'component_parts') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_component_qualifications_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_component_qualifications_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_component_qualifications_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'component_qualifications') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_component_types_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_component_types_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_component_types_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'component_types') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_config_change_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_config_change_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_config_change_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'config_change_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_contractor_intervention_audit_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_contractor_intervention_audit_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_contractor_intervention_audit_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'contractor_intervention_audit') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_contractor_interventions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_contractor_interventions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_contractor_interventions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'contractor_interventions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_dashboards_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_dashboards_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_dashboards_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'dashboards') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_delegated_permissions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_delegated_permissions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_delegated_permissions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'delegated_permissions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_delete_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_delete_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_delete_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'delete_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_departments_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_departments_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_departments_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'departments') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_deviation_audit_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_deviation_audit_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_deviation_audit_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'deviation_audit') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_deviations_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_deviations_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_deviations_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'deviations') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_digital_signatures_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_digital_signatures_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_digital_signatures_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'digital_signatures') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_document_versions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_document_versions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_document_versions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'document_versions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_entity_audit_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_entity_audit_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_entity_audit_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'entity_audit_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_entity_tags_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_entity_tags_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_entity_tags_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'entity_tags') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_export_print_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_export_print_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_export_print_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'export_print_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_external_contractors_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_external_contractors_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_external_contractors_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'external_contractors') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_failure_modes_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_failure_modes_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_failure_modes_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'failure_modes') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_forensic_user_change_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_forensic_user_change_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_forensic_user_change_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'forensic_user_change_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_incident_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_incident_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_incident_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'incident_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_inspections_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_inspections_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_inspections_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'inspections') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_integration_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_integration_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_integration_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'integration_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_inventory_transactions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_inventory_transactions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_inventory_transactions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'inventory_transactions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_iot_anomaly_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_iot_anomaly_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_iot_anomaly_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'iot_anomaly_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_iot_devices_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_iot_devices_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_iot_devices_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'iot_devices') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_iot_event_audit_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_iot_event_audit_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_iot_event_audit_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'iot_event_audit') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_iot_gateways_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_iot_gateways_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_iot_gateways_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'iot_gateways') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_iot_sensor_data_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_iot_sensor_data_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_iot_sensor_data_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'iot_sensor_data') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_irregularities_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_irregularities_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_irregularities_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'irregularities_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_job_titles_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_job_titles_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_job_titles_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'job_titles') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_locations_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_locations_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_locations_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'locations') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_lookup_domain_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_lookup_domain_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_lookup_domain_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'lookup_domain') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_lookup_value_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_lookup_value_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_lookup_value_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'lookup_value') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_machine_components_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_machine_components_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_machine_components_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'machine_components') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_machine_lifecycle_event_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_machine_lifecycle_event_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_machine_lifecycle_event_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'machine_lifecycle_event') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_machine_models_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_machine_models_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_machine_models_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'machine_models') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_machine_types_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_machine_types_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_machine_types_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'machine_types') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_machines_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_machines_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_machines_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'machines') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_manufacturers_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_manufacturers_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_manufacturers_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'manufacturers') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_measurement_units_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_measurement_units_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_measurement_units_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'measurement_units') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_mobile_device_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_mobile_device_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_mobile_device_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'mobile_device_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_notification_queue_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_notification_queue_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_notification_queue_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'notification_queue') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_notification_templates_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_notification_templates_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_notification_templates_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'notification_templates') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_part_bom_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_part_bom_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_part_bom_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'part_bom') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_part_supplier_prices_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_part_supplier_prices_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_part_supplier_prices_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'part_supplier_prices') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_parts_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_parts_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_parts_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'parts') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_permission_change_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_permission_change_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_permission_change_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'permission_change_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_permission_requests_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_permission_requests_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_permission_requests_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'permission_requests') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_permissions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_permissions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_permissions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'permissions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_photos_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_photos_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_photos_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'photos') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_ppm_plans_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_ppm_plans_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_ppm_plans_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'ppm_plans') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_preventive_maintenance_plans_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_preventive_maintenance_plans_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_preventive_maintenance_plans_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'preventive_maintenance_plans') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_quality_events_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_quality_events_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_quality_events_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'quality_events') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_report_schedule_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_report_schedule_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_report_schedule_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'report_schedule') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_requalification_schedule_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_requalification_schedule_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_requalification_schedule_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'requalification_schedule') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_role_audit_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_role_audit_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_role_audit_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'role_audit') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_role_permissions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_role_permissions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_role_permissions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'role_permissions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_roles_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_roles_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_roles_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'roles') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_rooms_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_rooms_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_rooms_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'rooms') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_scheduled_job_audit_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_scheduled_job_audit_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_scheduled_job_audit_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'scheduled_job_audit_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_scheduled_jobs_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_scheduled_jobs_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_scheduled_jobs_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'scheduled_jobs') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_scheduled_jobs_due`
--

/*!50001 DROP VIEW IF EXISTS `vw_scheduled_jobs_due`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = cp852 */;
/*!50001 SET character_set_results     = cp852 */;
/*!50001 SET collation_connection      = cp852_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_scheduled_jobs_due` AS select `scheduled_jobs`.`id` AS `id`,`scheduled_jobs`.`name` AS `name`,`scheduled_jobs`.`job_type` AS `job_type`,`scheduled_jobs`.`entity_type` AS `entity_type`,`scheduled_jobs`.`entity_id` AS `entity_id`,`scheduled_jobs`.`status` AS `status`,`scheduled_jobs`.`next_due` AS `next_due`,`scheduled_jobs`.`recurrence_pattern` AS `recurrence_pattern`,`scheduled_jobs`.`cron_expression` AS `cron_expression`,`scheduled_jobs`.`last_executed` AS `last_executed`,`scheduled_jobs`.`last_result` AS `last_result`,`scheduled_jobs`.`escalation_level` AS `escalation_level`,`scheduled_jobs`.`escalation_note` AS `escalation_note`,`scheduled_jobs`.`chain_job_id` AS `chain_job_id`,`scheduled_jobs`.`is_critical` AS `is_critical`,`scheduled_jobs`.`needs_acknowledgment` AS `needs_acknowledgment`,`scheduled_jobs`.`acknowledged_by` AS `acknowledged_by`,`scheduled_jobs`.`acknowledged_at` AS `acknowledged_at`,`scheduled_jobs`.`alert_on_failure` AS `alert_on_failure`,`scheduled_jobs`.`retries` AS `retries`,`scheduled_jobs`.`max_retries` AS `max_retries`,`scheduled_jobs`.`last_error` AS `last_error`,`scheduled_jobs`.`iot_device_id` AS `iot_device_id`,`scheduled_jobs`.`extra_params` AS `extra_params`,`scheduled_jobs`.`created_by` AS `created_by`,`scheduled_jobs`.`created_at` AS `created_at`,`scheduled_jobs`.`last_modified` AS `last_modified`,`scheduled_jobs`.`last_modified_by` AS `last_modified_by`,`scheduled_jobs`.`digital_signature` AS `digital_signature`,`scheduled_jobs`.`device_info` AS `device_info`,`scheduled_jobs`.`session_id` AS `session_id`,`scheduled_jobs`.`ip_address` AS `ip_address`,`scheduled_jobs`.`comment` AS `comment` from `scheduled_jobs` where ((`scheduled_jobs`.`status` in ('scheduled','in_progress','pending_ack','overdue')) and (`scheduled_jobs`.`next_due` <= now())) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_schema_migration_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_schema_migration_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_schema_migration_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'schema_migration_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_sensitive_data_access_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_sensitive_data_access_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_sensitive_data_access_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'sensitive_data_access_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_sensor_data_enriched`
--

/*!50001 DROP VIEW IF EXISTS `vw_sensor_data_enriched`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=MERGE */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY INVOKER */
/*!50001 VIEW `vw_sensor_data_enriched` AS select `sdl`.`id` AS `id`,`sdl`.`component_id` AS `component_id`,`sdl`.`sensor_type_id` AS `sensor_type_id`,`sdl`.`unit_id` AS `unit_id`,`sdl`.`value` AS `value`,`sdl`.`timestamp` AS `timestamp`,`sdl`.`created_at` AS `created_at`,`lv`.`value_label` AS `sensor_type_name`,`mu`.`name` AS `unit_name` from ((`sensor_data_logs` `sdl` left join `lookup_value` `lv` on((`lv`.`id` = `sdl`.`sensor_type_id`))) left join `measurement_units` `mu` on((`mu`.`id` = `sdl`.`unit_id`))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_sensor_data_logs_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_sensor_data_logs_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_sensor_data_logs_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'sensor_data_logs') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_sensor_models_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_sensor_models_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_sensor_models_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'sensor_models') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_sensor_types_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_sensor_types_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_sensor_types_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'sensor_types') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_session_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_session_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_session_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'session_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_sites_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_sites_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_sites_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'sites') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_sop_document_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_sop_document_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_sop_document_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'sop_document_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_sop_documents_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_sop_documents_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_sop_documents_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'sop_documents') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_stock_current`
--

/*!50001 DROP VIEW IF EXISTS `vw_stock_current`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=MERGE */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY INVOKER */
/*!50001 VIEW `vw_stock_current` AS select `p`.`id` AS `part_id`,`p`.`code` AS `part_code`,`p`.`name` AS `part_name`,`w`.`id` AS `warehouse_id`,coalesce(`w`.`name`,`l`.`name`) AS `warehouse_name`,`sl`.`quantity` AS `quantity`,`sl`.`min_threshold` AS `min_threshold`,`sl`.`max_threshold` AS `max_threshold` from (((`stock_levels` `sl` join `parts` `p` on((`p`.`id` = `sl`.`part_id`))) left join `warehouses` `w` on((`w`.`id` = `sl`.`warehouse_id`))) left join `locations` `l` on((`l`.`id` = `w`.`location_id`))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_stock_levels_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_stock_levels_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_stock_levels_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'stock_levels') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_supplier_risk_audit_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_supplier_risk_audit_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_supplier_risk_audit_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'supplier_risk_audit') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_suppliers_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_suppliers_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_suppliers_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'suppliers') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_system_parameters_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_system_parameters_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_system_parameters_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'system_parameters') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_tags_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_tags_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_tags_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'tags') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_tenants_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_tenants_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_tenants_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'tenants') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_user_audit_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_user_audit_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_user_audit_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'user_audit') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_user_esignatures_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_user_esignatures_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_user_esignatures_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'user_esignatures') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_user_login_audit_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_user_login_audit_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_user_login_audit_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'user_login_audit') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_user_permissions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_user_permissions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_user_permissions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'user_permissions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_user_roles_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_user_roles_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_user_roles_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'user_roles') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_user_subscriptions_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_user_subscriptions_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_user_subscriptions_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'user_subscriptions') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_user_training_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_user_training_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_user_training_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'user_training') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_users_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_users_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_users_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'users') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_validations_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_validations_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_validations_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'validations') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_warehouses_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_warehouses_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_warehouses_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'warehouses') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_order_audit_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_order_audit_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_work_order_audit_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'work_order_audit') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_order_checklist_item_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_order_checklist_item_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_work_order_checklist_item_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'work_order_checklist_item') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_order_comments_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_order_comments_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_work_order_comments_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'work_order_comments') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_order_parts_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_order_parts_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_work_order_parts_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'work_order_parts') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_order_signatures_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_order_signatures_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_work_order_signatures_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'work_order_signatures') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_order_status_log_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_order_status_log_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_work_order_status_log_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'work_order_status_log') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_orders_audit`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_orders_audit`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_work_orders_audit` AS select `system_event_log`.`id` AS `id`,`system_event_log`.`ts_utc` AS `ts_utc`,`system_event_log`.`event_type` AS `event_type`,`system_event_log`.`record_id` AS `record_id`,`system_event_log`.`field_name` AS `field_name`,`system_event_log`.`old_value` AS `old_value`,`system_event_log`.`new_value` AS `new_value`,`system_event_log`.`description` AS `description`,`system_event_log`.`severity` AS `severity` from `system_event_log` where (`system_event_log`.`table_name` = 'work_orders') order by `system_event_log`.`ts_utc` desc,`system_event_log`.`id` desc */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_orders_enriched`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_orders_enriched`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=MERGE */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY INVOKER */
/*!50001 VIEW `vw_work_orders_enriched` AS select `wo`.`id` AS `id`,`wo`.`machine_id` AS `machine_id`,`wo`.`component_id` AS `component_id`,`wo`.`type` AS `type`,`wo`.`created_by` AS `created_by`,`wo`.`assigned_to` AS `assigned_to`,`wo`.`date_open` AS `date_open`,`wo`.`date_close` AS `date_close`,`wo`.`description` AS `description`,`wo`.`result` AS `result`,`wo`.`status` AS `status`,`wo`.`digital_signature` AS `digital_signature`,`wo`.`priority` AS `priority`,`wo`.`related_incident` AS `related_incident`,`wo`.`created_at` AS `created_at`,`wo`.`updated_at` AS `updated_at`,`wo`.`status_id` AS `status_id`,`wo`.`type_id` AS `type_id`,`wo`.`priority_id` AS `priority_id`,`wo`.`tenant_id` AS `tenant_id`,`vs`.`value_label` AS `status_name`,`vt`.`value_label` AS `type_name`,`vp`.`value_label` AS `priority_name`,`m`.`name` AS `machine_name`,`mc`.`name` AS `component_name` from (((((`work_orders` `wo` left join `lookup_value` `vs` on((`vs`.`id` = `wo`.`status_id`))) left join `lookup_value` `vt` on((`vt`.`id` = `wo`.`type_id`))) left join `lookup_value` `vp` on((`vp`.`id` = `wo`.`priority_id`))) left join `machines` `m` on((`m`.`id` = `wo`.`machine_id`))) left join `machine_components` `mc` on((`mc`.`id` = `wo`.`component_id`))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `vw_work_orders_user`
--

/*!50001 DROP VIEW IF EXISTS `vw_work_orders_user`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = cp852 */;
/*!50001 SET character_set_results     = cp852 */;
/*!50001 SET collation_connection      = cp852_general_ci */;
/*!50001 CREATE ALGORITHM=MERGE */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `vw_work_orders_user` AS select `wo`.`id` AS `id`,`wo`.`machine_id` AS `machine_id`,`wo`.`component_id` AS `component_id`,`wo`.`type` AS `type`,`wo`.`created_by` AS `created_by`,`wo`.`assigned_to` AS `assigned_to`,`wo`.`date_open` AS `date_open`,`wo`.`date_close` AS `date_close`,`wo`.`description` AS `description`,`wo`.`result` AS `result`,`wo`.`status` AS `status`,`wo`.`digital_signature` AS `digital_signature`,`wo`.`priority` AS `priority`,`wo`.`related_incident` AS `related_incident`,`wo`.`created_at` AS `created_at`,`wo`.`updated_at` AS `updated_at`,`wo`.`status_id` AS `status_id`,`wo`.`type_id` AS `type_id`,`wo`.`priority_id` AS `priority_id`,`wo`.`tenant_id` AS `tenant_id` from (`work_orders` `wo` join `users` `u` on((`u`.`id` = `CURRENT_USER_ID`()))) where ((`wo`.`tenant_id` = `u`.`tenant_id`) or (`u`.`tenant_id` is null)) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;

--
-- Final view structure for view `warehouse`
--

/*!50001 DROP VIEW IF EXISTS `warehouse`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8mb4 */;
/*!50001 SET character_set_results     = utf8mb4 */;
/*!50001 SET collation_connection      = utf8mb4_0900_ai_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013 DEFINER=`root`@`localhost` SQL SECURITY DEFINER */
/*!50001 VIEW `warehouse` AS select `warehouses`.`id` AS `id`,`warehouses`.`name` AS `name`,`warehouses`.`location` AS `location`,`warehouses`.`responsible_id` AS `responsible_id`,`warehouses`.`created_at` AS `created_at`,`warehouses`.`updated_at` AS `updated_at`,`warehouses`.`location_id` AS `location_id`,`warehouses`.`responsible` AS `responsible`,`warehouses`.`qr_code` AS `qr_code`,`warehouses`.`note` AS `note`,`warehouses`.`created_by_id` AS `created_by_id`,`warehouses`.`created_by` AS `created_by`,`warehouses`.`last_modified` AS `last_modified`,`warehouses`.`last_modified_by_id` AS `last_modified_by_id`,`warehouses`.`last_modified_by` AS `last_modified_by`,`warehouses`.`digital_signature` AS `digital_signature`,`warehouses`.`status` AS `status`,`warehouses`.`io_tdevice_id` AS `io_tdevice_id`,`warehouses`.`climate_mode` AS `climate_mode`,`warehouses`.`compliance_docs` AS `compliance_docs`,`warehouses`.`entry_hash` AS `entry_hash`,`warehouses`.`source_ip` AS `source_ip`,`warehouses`.`is_qualified` AS `is_qualified`,`warehouses`.`last_qualified` AS `last_qualified`,`warehouses`.`session_id` AS `session_id`,`warehouses`.`anomaly_score` AS `anomaly_score`,`warehouses`.`is_deleted` AS `is_deleted` from `warehouses` */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2025-09-12  8:30:26
