<Window x:Class="YasGMP.Wpf.Views.Dialogs.ReauthenticationDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:YasGMP.Wpf.Converters"
        Title="Re-authentication Required"
        Width="520"
        Height="440"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        WindowStyle="ToolWindow"
        ShowInTaskbar="False">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <conv:StringNullOrEmptyToVisibilityConverter x:Key="StatusVisibilityConverter" />
    </Window.Resources>
    <ScrollViewer Padding="24">
        <StackPanel Orientation="Vertical" Spacing="12">
            <TextBlock Text="Please confirm your credentials and select a GMP reason before proceeding."
                       FontWeight="Bold"
                       TextWrapping="Wrap" />

            <StackPanel>
                <TextBlock Text="Username" FontWeight="SemiBold" />
                <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,4,0,0"
                         AutomationProperties.AutomationId="ReauthUsername" />
            </StackPanel>

            <StackPanel>
                <TextBlock Text="Password" FontWeight="SemiBold" />
                <PasswordBox Margin="0,4,0,0"
                             PasswordChanged="OnPasswordChanged"
                             AutomationProperties.AutomationId="ReauthPassword" />
            </StackPanel>

            <StackPanel>
                <TextBlock Text="MFA / TOTP Code (optional)" FontWeight="SemiBold" />
                <TextBox Text="{Binding MfaCode, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,4,0,0"
                         AutomationProperties.AutomationId="ReauthMfa" />
            </StackPanel>

            <StackPanel>
                <TextBlock Text="Signature Reason" FontWeight="SemiBold" />
                <ComboBox ItemsSource="{Binding Reasons}"
                          SelectedItem="{Binding SelectedReason}"
                          DisplayMemberPath="DisplayLabel"
                          Margin="0,4,0,0"
                          AutomationProperties.AutomationId="ReauthReason" />
            </StackPanel>

            <StackPanel Visibility="{Binding IsCustomReasonVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <TextBlock Text="Custom Reason Code" FontWeight="SemiBold" />
                <TextBox Text="{Binding CustomReasonCode, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,4,0,0"
                         AutomationProperties.AutomationId="ReauthCustomReason" />
            </StackPanel>

            <StackPanel>
                <TextBlock Text="Reason Detail" FontWeight="SemiBold" />
                <TextBox Text="{Binding ReasonDetail, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,4,0,0"
                         AcceptsReturn="True"
                         MinHeight="80"
                         TextWrapping="Wrap"
                         AutomationProperties.AutomationId="ReauthReasonDetail" />
            </StackPanel>

            <TextBlock Text="{Binding StatusMessage}"
                       Foreground="Red"
                       TextWrapping="Wrap"
                       Visibility="{Binding StatusMessage, Converter={StaticResource StatusVisibilityConverter}}" />

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" Margin="0,16,0,0">
                <Button Content="Cancel"
                        Width="90"
                        IsCancel="True"
                        Command="{Binding CancelCommand}"
                        AutomationProperties.AutomationId="ReauthCancel" />
                <Button Content="Confirm"
                        Width="100"
                        IsDefault="True"
                        Command="{Binding ConfirmCommand}"
                        AutomationProperties.AutomationId="ReauthConfirm" />
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Window>
