# Codex Plan — WPF Shell & Full Integration

## Current Compile Status
- [ ] Dotnet SDKs detected and recorded *(blocked: `dotnet` CLI not available in container PATH`; `dotnet --info` retried 2025-09-24, 2025-09-25, 2025-09-26, 2025-09-27, 2025-09-28, 2025-09-29, 2025-10-06, 2025-10-07, 2025-10-14, 2025-10-17, 2025-10-23, 2025-10-24, 2025-10-30, 2025-11-01, 2025-11-04, 2025-11-07, 2025-11-09, and 2025-11-18, 2025-11-19, 2025-11-30, 2025-12-04, 2025-12-08, 2025-12-31, 2026-02-10, 2026-02-19, 2026-02-25 → **command not found**)*
  - 2025-10-07T11:06Z: Current container session again reports `bash: command not found: dotnet`; document cadence remains static-analysis only until SDK is provisioned.
  - 2026-02-09T09:42Z: `dotnet --version` retried for this batch; container still returns `bash: command not found: dotnet`.
  - 2026-02-20T08:57Z: `dotnet restore yasgmp.sln` retried post-inspector automation updates; container still reports `bash: command not found: dotnet`.
- [ ] Solution restores *(pending SDK availability; `dotnet restore` retried 2025-09-24, 2025-09-25, 2025-09-26, 2025-09-27, 2025-09-29, 2025-10-06, 2025-10-07, 2025-10-14, 2025-10-17, 2025-10-23, 2025-10-24, 2025-10-30, 2025-11-01, 2025-11-02, 2025-11-04, 2025-11-07, 2025-11-09, and 2025-11-18, 2025-11-19, 2025-11-30, 2025-12-04, 2025-12-08, 2025-12-18, 2025-12-31, 2026-01-30, 2026-02-02, 2026-02-10, 2026-02-19, 2026-02-25 → **command not found**)*
- [ ] MAUI builds *(pending SDK availability; `dotnet build` retried 2025-09-25, 2025-09-26, 2025-09-27, 2025-09-29, 2025-10-06, 2025-10-07, 2025-10-14, 2025-10-17, 2025-10-23, 2025-10-24, 2025-10-30, 2025-11-01, 2025-11-02, 2025-11-04, 2025-11-07, 2025-11-09, and 2025-11-18, 2025-11-19, 2025-11-30, 2025-12-04, 2025-12-08, 2025-12-31, 2026-01-30, 2026-02-02, 2026-02-10, 2026-02-19, 2026-02-25 → **command not found**)*
- [ ] WPF builds *(pending SDK availability; `dotnet build` retried 2025-09-25, 2025-09-26, 2025-09-27, 2025-09-29, 2025-10-06, 2025-10-07, 2025-10-14, 2025-10-17, 2025-10-23, 2025-10-24, 2025-10-30, 2025-11-01, 2025-11-02, 2025-11-04, 2025-11-07, 2025-11-09, and 2025-11-18, 2025-11-19, 2025-11-30, 2025-12-04, 2025-12-08, 2025-12-31, 2026-01-30, 2026-02-02, 2026-02-10, 2026-02-19, 2026-02-22, 2026-02-25 → **command not found**)*

## Decisions & Pins
- Preferred WPF target: **net9.0-windows10.0.19041.0** (retain once .NET 9 SDK is installed).
- Repo-level SDK pin: `global.json` set to **9.0.100** *(reinforced via bootstrap script).* 
- AvalonDock: **4.72.1** *(pinned in `YasGMP.Wpf.csproj`).*
- Other NuGets: **Fluent.Ribbon 11.0.1**, **CommunityToolkit.Mvvm 8.4.0**, **Microsoft.Extensions.* 9.0.3**, **MySqlConnector 2.4.0** *(pinned in csproj).* 
- Environment gap: install/enable **.NET 9 SDK** and **Windows 10 SDK (19041+)** on the host. The build container currently lacks `dotnet`; run `scripts/bootstrap-dotnet9.ps1` or install via `winget install Microsoft.DotNet.SDK.9`.

## Batches
- **B0 — Environment stabilization** (SDKs, NuGets, XAML namespaces) — **blocked** *(no `dotnet` CLI)*
  - 2025-10-07: Reconfirmed CLI absence this run; planning next increment around static analysis, documentation refresh, and schema review until installation is possible.
  - 2025-10-08: Authored `WPF Smoke Tests` GitHub Actions workflow to run restore/build/FlaUI smoke automation on `windows-latest` using .NET 9 when available (falls back to .NET 8). Local validation remains blocked because `dotnet --info` still reports `command not found`.
- **B1 — Shell foundation** (Ribbon, Docking, StatusBar, FormMode state machine) — [ ] todo
  - 2026-01-25: Documented B1FormDocumentViewModel command/state surface so derived modules inherit SAP B1 toolbar, audit, and busy-state guidance.
  - 2026-02-10: Modules pane groups/links now source localized headers, tooltips, automation names/ids through ILocalizationService subscriptions so culture switches update without rebuilding the tree; awaiting SDK install to validate via build/smoke.
  - 2026-02-11: ModulesPane XAML now binds group expanders and module buttons to the localized headers/tooltips/automation metadata exposed by their view-models so accessibility/name/id updates propagate directly through the UI tree.
  - 2026-02-12: Strings.xaml now carries automation id tokens for every ModuleRegistry category/module (Cockpit, SupplyChain, QualityCompliance, etc.) so ModuleTreeViewModel resolves sanitized identifiers for UIA and smoke harnesses even when localization falls back.
  - 2026-02-13: Inspector pane view-model now publishes localized module header automation name/id/tooltip metadata and refreshes them on language switches while dotnet restore/build/smoke remain blocked by the missing CLI.
  - 2026-02-14: Inspector pane titles and automation metadata now pull formatting templates from ShellStrings so module/record captions plus UIA names/ids/tooltips reformat with active context whenever localization changes while dotnet restore/build/smoke remain blocked by the missing CLI.
  - 2026-02-15: Inspector pane update now recomputes module automation name/id/tooltip using localized templates with fallback defaults for empty context and refreshes cached metadata on language changes; dotnet restore/build/smoke still blocked by the missing CLI.
- 2026-02-16: Inspector header strings now rebuild from the latest localization templates before applying property updates, and inspector field payloads feed through a helper that regenerates automation name/id/tooltip metadata from the active module/record text (with fallback normalization for legacy field lists) so accessibility tooling receives stable identifiers even before the CLI is restored; `dotnet restore` retried this batch and still reports **command not found**.
- 2026-02-17: Inspector pane language-change handler now replays the field automation helper against existing rows using localized placeholders when context is empty, and raises property change notifications so accessibility consumers pick up the refreshed metadata; `dotnet restore`/`dotnet build` retried this batch and still fail with **command not found** while the CLI is missing.
- 2026-02-18: Inspector field view-model now accepts a recomputation delegate from the pane so automation name/id/tooltip metadata refresh automatically whenever field values mutate, keeping accessibility strings aligned with the current module/record context; `dotnet restore` retried for this batch continues to return **command not found** because the CLI is still unavailable.
- 2026-02-19: Centralized automation token normalization via AutomationIdSanitizer so module, record, and field identifiers reuse the same lowercase/trimmed/separator-stable helper with predictable defaults; `dotnet restore` retried this batch still exits with **command not found** because the CLI remains absent.
- 2026-02-20: Inspector test doubles now call AutomationIdSanitizer for module/record/field tokens so WPF tests align with production automation identifiers while `dotnet restore` continues to fail with **command not found** due to the missing CLI.
- 2026-02-21: Added AutomationIdSanitizer and InspectorField regression tests that assert sanitized automation ids across null/empty, locale-specific, and punctuation-heavy inputs; `dotnet restore`, `dotnet build` (MAUI + WPF), and smoke/test attempts still return **command not found** because the CLI remains unavailable.
- 2026-02-22: Inspector pane XAML now binds module/record headers to the localized automation name/id/tooltip properties exposed by the view-model so UIA metadata flows to screen readers; `dotnet build YasGMP.Wpf.csproj` retried this batch and still fails with **command not found** because the CLI remains unavailable in the container. Inspect/FlaUI validation remains pending until a Windows host with the WPF shell is available.
- 2026-02-23: Inspector field item template now binds each row container to the localized automation name/id/tooltip so UIA tools can announce field metadata correctly; `dotnet restore` and `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj` retried this batch and still exit with **command not found** because the CLI remains unavailable. FlaUI verification remains pending until a Windows host with the WPF shell is available.
- 2026-02-24: Module tree localization resources now mirror every ModuleRegistry category/module across neutral, en, and hr resx files; `dotnet restore yasgmp.sln` and `dotnet build yasgmp.sln` retried for this batch still fail with **command not found** because the .NET CLI is absent in the container.
- 2026-02-25: Inspector field automation metadata now reads neutral/en/hr templates from ShellStrings with localized record fallbacks so the pane composes UIA names/tooltips in both languages; `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, and `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows` each still return **command not found** because the .NET SDK is missing.
- 2026-03-01: Added YasGMP.Wpf.Smoke FlaUI harness that builds/launches the WPF shell, drives module navigation, and asserts Modules pane + inspector automation ids/names/tooltips update when switching between English/Croatian; `dotnet restore/build` retried this batch still fail with **command not found** because the CLI is absent.
- 2026-03-02: Added XML documentation to ShellStatusBarViewModel status text and active module properties to satisfy CS1591 while `dotnet restore yasgmp.sln` and `dotnet build yasgmp.sln -c Release` continue to fail with **command not found** because the CLI is unavailable in the container.
- 2026-03-03: Modules pane root now binds Dock.Modules automation name/help text alongside expander/button HelpText bindings and the FlaUI smoke test expects the new resources; `dotnet restore yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, and MAUI Windows builds still fail with **command not found** while the CLI is absent.
- 2026-03-05: ShellStatusBarViewModel now refreshes company/environment/server/database/user metadata from IConfiguration, DatabaseOptions, IHostEnvironment, and IUserSession, ShellStatusBar.xaml binds tooltips/automation ids for every field, and WPF tests assert EN↔HR localization plus automation metadata; `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, and `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows` retried for this batch and continue to fail with **command not found** because the CLI is unavailable.
- 2026-03-06: Modules pane XAML now routes localized tooltips/help text and automation ids from ModuleGroup/ModuleLink view-models, Inspector pane rows expose localized tooltips with labeled-by associations, ShellStrings neutral/en/hr files define category/node automation id resources, and new WPF unit tests assert both panes emit the expected automation metadata after EN↔HR language switches; `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, and `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows` retried this batch and still return **command not found** because the CLI remains unavailable in the container.
- 2026-03-08: ShellStrings neutral/en/hr now define localized status bar captions, tooltips, and automation names for status/company/environment/server/database/user/UTC fields so ShellStatusBar.xaml bindings resolve in both languages while the new WPF tests cover metadata population; `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, and `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows` retried this batch and continue to fail with **command not found** because the CLI is unavailable in the container.
- 2026-03-09: ModulesPane expander headers now render through a TextBlock header template that carries localized tooltips plus automation names/ids from module metadata, InspectorPane field labels/values echo the row automation tooltip to screen readers, ShellStrings neutral/en/hr gained Dock.Modules/Inspector automation id entries, and the FlaUI smoke test now asserts module group/button automation ids; `dotnet restore yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, and `dotnet build yasgmp.csproj -f net9.0-windows10.0.19041.0` were retried and still return **command not found** because the .NET CLI remains unavailable.
- 2026-03-10: Assets module navigation payload helper now resolves numeric ids via `TryGetByIdAsync`, filters string payloads against machine code/name case-insensitively, and `LoadAsync` ensures the targeted record surfaces first without duplicates while `dotnet restore`/`dotnet build`/smoke attempts remain blocked by the missing CLI.
- 2026-03-10: Shell status messages, layout reset prompts, and smoke-test notifications now resolve through ShellStrings resx keys with MainWindowViewModel, ShellLayoutController, and ShellStatusBarViewModel consuming ILocalizationService; status bar fallback values re-localize on language switches and new WPF unit tests assert EN↔HR toggles for the Active label and metadata. `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, and `dotnet build yasgmp.csproj -f net9.0-windows10.0.19041.0` were retried this batch and all still return **command not found** because the .NET CLI is missing. WPF smoke automation remains blocked by the same CLI gap.
- 2026-03-11: ModulesPane.xaml now applies scoped styles that bind each expander/button to the localized tooltip/help text and automation name/id exposed by module metadata, InspectorPaneViewModel consumes localized field automation templates (including a new automation-id resource) so plain InspectorField rows recompute culture-aware names/tooltips/ids, and WPF unit tests assert the localized fallbacks; `dotnet restore yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, and `dotnet build yasgmp.csproj -f net9.0-windows10.0.19041.0` were each retried this batch and continue to fail with **command not found** because the CLI is still missing in the container.
- 2026-03-12: Shell status bar view-model documentation now calls out the configuration/session services backing each property, status bar control tests assert every label/value uses the localized tooltip/help text plus automation name/id from ShellStrings/Strings, and `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, and `dotnet build yasgmp.csproj -f net9.0-windows10.0.19041.0` were retried; all commands still return **command not found** because the .NET CLI is unavailable in the container.
- 2026-03-12: Layout persistence helpers now force the `@layout` parameter to `LongText` so longer AvalonDock XML snapshots round-trip without truncation, and regression tests assert the parameter typing across DatabaseService + WPF persistence paths; `dotnet restore yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, and MAUI/WPF builds remain blocked by **command not found** until the .NET CLI is installed.
- 2026-03-12: Added a ModuleToolbarCommand regression test that stubs ILocalizationService, flips EN↔HR, and asserts caption/tooltip/automation metadata refresh on LanguageChanged; `dotnet test YasGMP.Wpf.Tests` retried this batch and still fails with **command not found** because the CLI is unavailable in the container.
- 2026-03-13: Modules pane XAML now applies localized tooltips and automation ids directly on each expander/button, Inspector pane root/header/field templates surface localized help text plus appended label/value automation ids, ShellStrings neutral/en/hr gained Dock.Inspector.ToolTip resources, and WPF unit tests assert the new help text bindings while `dotnet restore yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, and MAUI net9.0-windows builds still fail with **command not found** because the CLI is absent.
- 2026-03-14: Debug smoke harness summaries now emit localization resource keys consumed by MainWindowViewModel so shell status updates retranslate after language switches, ShellStrings neutral/en/hr gained smoke result keys, and localization unit tests assert EN↔HR formatting while `dotnet restore yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, and MAUI net9.0-windows builds still fail with **command not found** because the CLI remains unavailable.
- 2026-03-15: Centralized the module toolbar ToggleButton template into `Resources/ModuleToolbarResources.xaml` and merged it via `App.xaml` so every module/document toolbar pulls caption/command/check/enabled/tooltip/automation bindings from view-models; `dotnet restore yasgmp.sln` retried for this batch still returns **command not found** because the CLI is unavailable, preventing runtime verification of tooltip/automation updates.
- 2026-03-16: Added `ResourceDictionary.MergedDictionaries` imports for `ModuleToolbarResources.xaml` to every module/document view so toolbar ItemsControls bind the shared ToggleButton template without local definitions; spot-checked Assets, Dashboard, and Audit module views to confirm the centralized template loads while `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, and `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows` each still report **command not found** because the CLI remains unavailable.
- 2026-03-17: Assets module activation now routes navigation payloads through the helper to focus existing records and only triggers `RefreshAsync` when the target is missing; `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, and `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows` remain blocked with **command not found** until the CLI is installed.
- 2026-03-10: Shell status bar value fields now expose AutomationProperties.LabeledBy links to their localized label blocks, XML docs call out configuration/session sources for metadata, and WPF tests assert the new associations while `dotnet restore yasgmp.sln`, `dotnet build yasgmp.sln`, and `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows` continue to fail with **command not found** due to the missing CLI.
- 2026-03-10: Layout persistence helpers now include null-row regression coverage so DatabaseService + DockLayoutPersistenceService return null snapshots without raising, and `dotnet restore yasgmp.sln`, `dotnet build YasGMP.Wpf/YasGMP.Wpf.csproj -f net9.0-windows`, plus `dotnet build yasgmp.csproj -f net9.0-windows10.0.19041.0` continue to fail with **command not found** while the CLI is missing.
- **B2 — Cross-cutting** (Attachments DB, E-Signature, Audit) — [~] in-progress *(e-sign capture now spans Assets, Components, Warehouses, Incidents, CAPA, Change Control, Validations, Scheduled Jobs, Suppliers, External Servicers, Users, and Work Orders; WPF adapters and AppCore services propagate optional signature metadata through to the database, falling back to the legacy hash generator only when metadata is missing; the WPF dialog service now emits audit events on capture/persist while broader audit surfacing remains gated on SDK access)*
- 2026-03-04: DatabaseService now exposes layout-specific helpers that upsert/delete `user_window_layouts` entries and emit `LAYOUT_SAVE`/`LAYOUT_RESET` audit events (including session/device/signature context) so WPF + MAUI shells share immutable traces; DockLayoutPersistenceService consumes the extensions via DI (DatabaseService + IAuthContext) and unit coverage asserts SQL parameters plus audit forwarding.
- 2026-03-07: DockLayoutPersistenceService failure propagation test now passes a default `WindowGeometry` instance to avoid nullable struct compilation errors while `dotnet build YasGMP.Wpf.Tests` continues to fail with **command not found** because the CLI is unavailable.
- **B3 — Editor framework** (templates, host, unsaved-guard) — [ ] todo
- **B4+ — Module rollout:**
  - Assets/Machines — [x] done *(mode-aware CRUD with attachment uploads and e-signature capture via IElectronicSignatureDialogService; audit surfacing still pending)*
  - Components — [x] done *(mode-aware editor wired to ComponentService with IElectronicSignatureDialogService gating persistence; audit surfacing remains blocked on SDK access)*
  - Parts & Warehouses — [x] done *(inventory snapshots, warehouse ledger preview, stock health warnings, and e-signature capture baked into save flows; audit surfacing remains blocked on SDK access)*
  - Work Orders — [x] done *(CRUD adapter wired with attachments and e-signature capture ahead of adapter calls; audit surfacing queued once SDK access returns)*
  - Calibration — [x] done *(CRUD editor with attachment uploads and e-signature capture; audit surfacing remains queued for Batch B2)*
  - Incident → CAPA → Change Control — [x] done *(Incidents, CAPA, and Change Control editors now CRUD-capable with attachments and signature capture; audit surfacing still queued for SDK access)*
  - Validations (IQ/OQ/PQ) — [x] done *(mode-aware validation editor with CRUD adapter, CFL, attachment workflow, and signature capture; audit surfacing queued once the SDK blocker clears)*
  - Scheduled Jobs — [x] done *(mode-aware editor with execute/acknowledge tooling, attachment workflow, and enforced signature capture; audit surfacing tracked under Batch B2)*
  - Users/Roles — [x] done *(Security module now exposes a CRUD-capable user/role editor with CFL, toolbar modes, role assignment management, and e-signature gating)*
  - Suppliers/External Servicers — [x] done *(Suppliers module enforces electronic signatures on save alongside attachments + CFL; External Servicers cockpit now also blocks persistence on signature capture)*
  - Audit/API Audit — [~] in-progress *(WPF audit trail retains export filters and status guards; MAUI AuditLogViewModel now drives the shell document with synchronized inspector/search/export parity and resolves through DI with the shared DatabaseService; WPF Audit Log document view mirrors the dashboard patterns with toolbar buttons, filters, busy overlay, and status styling; new API audit module surfaces masked API key activity with inspector payloads, dynamic action filters, and smoke registration. These audit-focused modules are now grouped under the "Quality & Compliance" category in the ModuleRegistry.)*
    - 2026-01-12: Date range normalization now promotes the earliest selected day to FilterFrom and the latest to FilterTo so the formatted descriptions and export payloads reflect the true chronological span while CLI validation remains blocked by the missing dotnet toolchain.
    - 2026-01-14: API audit view-model tests now expose refresh invocation tracking with awaitable signals, covering each filter setter's auto-refresh behavior and verifying state resets while dotnet restore/build remain blocked by the missing CLI.
    - 2026-01-15: Updated `docs/WPF_MAPPING.md` Quality & Compliance parity map with an API Audit Trail row noting masked API key metadata, dynamic action filters, and busy/error guards so documentation matches the current WPF implementation while dotnet restore/build remain blocked by the missing CLI.
    - 2026-01-21: Centralized B1 status phrases and module titles in ShellStrings with localization-backed formatting helpers, updated module option lists to pull translated labels, and refreshed unit tests with a deterministic localization stub while the dotnet CLI gap persists.
  - 2025-10-06: Container check reconfirmed the absence of the `dotnet` CLI; planning scope remains constrained to static analysis and documentation updates until the SDK is provisioned.
  - 2026-01-15: Updated `docs/WPF_MAPPING.md` Quality & Compliance parity map with an API Audit Trail row noting masked API key metadata, dynamic action filters, and busy/error guards so documentation matches the current WPF implementation while dotnet restore/build remain blocked by the missing CLI.
  - Documents/Attachments — [x] done *(Attachments module now ships a finalized split inspector/editor workspace with staged upload queueing, signature-gated CRUD flow, and retention policy handling.)*
    - 2026-01-05: Attachments view now splits the layout into a records grid and inspector/editor pane that surfaces SelectedAttachment metadata alongside staged upload previews and retention flags.
    - 2026-01-06: Editor pane now drives staged uploads through the AttachmentService, requiring an electronic signature before committing changes and hiding commands when the workflow is unavailable.
    - 2026-01-07: Attachments editor now enforces retention rules during save/delete, shows busy overlays tied to IsBusy, and surfaces validation/status messaging while dotnet restore/build remain blocked by the missing CLI.
  - Dashboard/Reports — [~] in-progress *(dashboard cockpit now binds toolbar toggles, CFL/Golden Arrow commands, search label, and grid columns through the localization service with automation metadata for Accessibility Insights/FlaUI validation; module tree categories/nodes now surface localized captions/tooltips across EN↔HR switches.)*
  - Settings/Admin — [ ] todo

- **Open Issues / Blockers**
- `dotnet` executable not found. Install/expose **.NET 9 SDK** and **Windows 10 SDK (19041+)** on the host; if building inside a container, expose host `dotnet` or install within the container. Run `scripts/bootstrap-dotnet9.ps1` to verify and pin via `global.json`. *(2025-09-25 & 2025-09-27 retries confirmed `dotnet --info` continues to fail with **command not found**; 2025-10-09 recheck still reports the command missing.)*
  - Pending inventory of MAUI assets/services/modules; schedule once SDK issue is resolved.
  - Smoke automation is blocked until SDK + Windows tooling are installed.
- Audit inspector surfacing and smoke automation remain blocked until the SDK gap is resolved.
  - 2025-09-24: Batch 0 rerun inside container confirmed `.NET 9` CLI is still missing; all `dotnet` commands fail immediately. Remains a prerequisite before module CRUD refactors can progress.

## Notes
- 2026-02-09: MainWindowViewModel now resolves session/configuration metadata via IUserSession + DatabaseOptions and pushes the values into ShellStatusBarViewModel; new WPF unit tests instantiate the status bar control to verify EN/HR localization strings and metadata population while dotnet restore/build/test remain blocked because the CLI is unavailable in the container.
- 2026-02-08: Shell status bar layout now localizes labels/tooltips/automation metadata for company, environment, server, database, user, and UTC timestamp fields, surfacing the bindings through the redesigned control while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-02-07: Shell status bar now resolves company, environment, database, server, user, and UTC clock metadata via revived DatabaseOptions + configuration bindings and a dispatcher-driven timer while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-02-06: Added layout persistence regression tests covering DatabaseService helpers, DockLayoutPersistenceService forwarding, and ShellLayoutController reset ordering so SQL payloads and reset/save sequencing stay exercised even while the dotnet CLI is unavailable in this container.
- 2026-02-05: Shell layout reset now clears the persisted snapshot via DockLayoutPersistenceService.ResetAsync before saving the default layout so the database state stays aligned with the restored UI; dotnet CLI remains unavailable for restore/build validation in this container.
- 2025-10-07: Retired the redundant DatabaseOptions wrapper and host registration so DockLayoutPersistenceService continues to resolve the shared DatabaseService singleton directly for layout persistence while dotnet tooling remains unavailable in the container.
- 2026-02-03: Added DatabaseService layout persistence extensions so WPF shell sessions can round-trip ribbon/dock arrangements even while .NET tooling remains unavailable in the container; tests remain blocked pending SDK installation.
- 2026-02-04: WPF DockLayoutPersistenceService now delegates load/save/reset to the shared DatabaseService layout helpers so both shells share the persistence path while dotnet restore/build remain blocked by the missing CLI.
- 2025-10-07: Refreshed CRUD service adapter/interface XML documentation to spell out WPF module → adapter → MAUI service flow, dispatcher marshalling, localization responsibilities, and shared audit plumbing; `dotnet restore`/`dotnet build`/smoke reruns still fail because the `dotnet` CLI is unavailable in this container.
- 2025-10-07: Re-enabled CS1591 warnings by removing the repo-wide suppression, added XML documentation across AppCore data models and MAUI shell session properties, and recorded the continued `dotnet restore`/`dotnet build` failures due to the missing CLI.
- 2025-10-07: Elevated documentation enforcement by promoting CS1591 to a warnings-as-errors rule in `Directory.Build.props`; attempted `dotnet build` still fails with `command not found` until the .NET CLI is installed.
- 2026-01-28: Expanded CFL dialog service XML documentation so Golden Arrow callers understand dispatcher invocation, owner wiring, localization sourcing, and how to feed selections into the audit appenders while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-01-29: Expanded shell interaction/navigation service XML docs covering ribbon & Golden Arrow usage patterns, dispatcher marshalling, and how <code>IModuleRegistry</code> metadata drives inspector/audit wiring while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-01-30: Documented WPF electronic signature dialog interface/service XML remarks covering shell entry points, dispatcher requirements, localization hooks, and audit/cancellation parity guidance while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-02-01: Expanded WPF dialog/file picker/platform/dispatcher XML docs to spell out MAUI parity limits, localization responsibilities, and migration guidance while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-02-02: Refreshed CRUD context XML docs to cross-link <code>CrudSaveResult.SignatureMetadata</code> and <code>SignatureMetadataDto</code>, clarifying WPF/MAUI audit propagation expectations while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-01-16: Added shared localization dictionaries for ribbon, backstage, and dock pane metadata with dynamic resources and automation identifiers so EN↔HR switches update headers, tooltips, and accessibility names; dotnet restore/build/smoke remain blocked by the missing CLI in the container.
- 2026-01-17: Localized dashboard toolbar toggles/buttons, search, and data grid columns plus module tree categories/nodes via the shared localization service, adding automation ids/names for Accessibility Insights/FlaUI; dotnet restore/build/smoke remain blocked pending CLI availability.
- 2026-01-18: Extended module tree templates so each node's header now binds tooltip and automation metadata directly from localization-aware view-model properties, keeping screen reader output aligned after language switches; `dotnet restore`/`dotnet build`/smoke remain blocked by the missing CLI.
- 2026-01-19: Golden Arrow toolbar control now exposes localization-aware tooltip/name/id dependency properties backed by the localization service so UIA names follow language switches; dotnet restore/build/smoke remain blocked by the missing CLI so announcements verified via static analysis only.
- 2026-01-21: Moved shell localization to ResourceManager-backed `ShellStrings` resx files while keeping automation ids in `Strings.xaml`; dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-01-22: Refreshed ModuleToolbarCommand documentation to capture localization-driven caption/tooltip/automation metadata and SAP B1 mode mapping; dotnet restore/build/smoke remain blocked by the missing CLI.
- 2026-01-26: Expanded ModuleRecord XML docs to spell out SAP B1 form-mode, Golden Arrow, and inspector semantics for navigation payloads while dotnet restore/build/smoke stay blocked by the missing CLI.
- 2026-01-27: Expanded ModuleRegistry XML docs to explain how module keys, titles, and categories drive Modules pane population, localization lookups, Golden Arrow automation ids, and SAP B1 toolbar/form-mode integration while dotnet restore/build/smoke remain blocked by the missing CLI.

### Accessibility Verification — Locale-Sensitive Metadata
- **Verification date:** 2026-01-20
- **Tooling:** Accessibility Insights for Windows (intended) — launch blocked in the Linux-based container; no Windows desktop/Win32 UI automation channel is available to attach to the WPF shell build.
- **Scope targeted:** Fluent Ribbon (Home/View/Tools tabs), AvalonDock panes (Modules tree, document host tabs, Inspector, Status bar), and representative module document views (Dashboard, Audit, Attachments) for tooltip/name localization parity.

### Language Toggle Workflow (WPF Shell)
1. **Navigation path** — From the WPF shell ribbon choose **View ▸ Language ▸ English/Croatian** (or invoke the backstage **Settings ▸ Language** command once the menu is wired). The toggle ultimately calls `ILocalizationService.SetLanguage("en"|"hr")`.
2. **Expected behavior** — Ribbon tabs/groups, toolbar toggles, module tree headers, dock titles, and status text update immediately after the command runs. View-models (e.g., `ModuleTreeViewModel`, `B1FormDocumentViewModel`) receive the `LanguageChanged` event and refresh their localized properties before notifying bindings.
3. **Persistence + layout** — Current language is stored in the shell profile to restore on next launch; layout files include the culture token so persisted AvalonDock layouts pick the proper resource dictionary.
4. **Fallback handling** — If an unsupported locale (e.g., `fr-FR`) is requested, `LocalizationManager` normalizes the culture to `en` and keeps the UI responsive, logging the downgrade for operators. Missing keys fall back to XAML resource dictionaries (typically `Strings.xaml`) and ultimately echo the key name for diagnosis.
5. **Operational note** — When running without full resource dictionaries (design-time or test harness), expect ribbon/toolbars to display invariant English strings. Smoke harness scripts should queue a language flip (EN→HR→EN) to confirm bindings respond.
- **Follow-up / actions:** Coordinate a Windows 11 host with the .NET 9 toolchain and Accessibility Insights installed, rerun the locale-sensitive tooltip/name pass, and archive the output (captured UIA tree + screenshots) in `Diagnostics/Accessibility`. Retry is scheduled alongside the next Windows-based smoke harness execution.
- 2026-01-11: Audit trail filters now trigger an automatic refresh so results stay aligned with user selections; another `dotnet restore` attempt (and implied builds/smoke) failed with **command not found** because the CLI remains unavailable in the container.
- 2026-01-12: Audit module test double now exposes refresh invocation tracking so filter property changes can assert auto-refresh behavior and pre-refresh state resets in unit tests; `dotnet restore`/`dotnet build` retries still fail with **command not found** because the CLI is unavailable in the container.
- 2026-01-13: API audit filter setters now invoke a shared refresh helper that mirrors the main Audit module's busy/initialization guards, resets state, and kicks the async refresh command; `dotnet restore` retried and still fails with **command not found** so builds/smoke remain blocked pending SDK installation.
- 2026-01-10: Debug smoke harness now navigates to the Attachments module, stages a temp upload, completes the signature-gated save, downloads via AttachmentService, and deletes the record with temp-file cleanup so attachments are covered in the automation log; dotnet restore/build remain blocked because the CLI is unavailable in the container.
- 2026-01-04: WPF host now resolves AttachmentsModuleViewModel via an explicit factory so DatabaseService, AttachmentService, FilePicker, signature dialog, audit, CFL, shell interaction, and navigation services are injected consistently even if constructor ordering shifts; dotnet restore/build remain blocked by the missing CLI.
- 2026-01-03: Attachments document now clears staged uploads on mode transitions, restricts upload/download/delete tooling to the appropriate form modes, requires an electronic signature before committing staged files on Save (logging attachment audits and refreshing the inspector afterwards), and Cancel now discards temporary uploads before refreshing; dotnet restore/build remain blocked by the missing CLI.
- 2026-01-09: Added Attachments module regression tests covering mode transitions, staged upload dedupe, save/cancel flows, and download/delete command enablement while the dotnet CLI remains unavailable for restore/build/smoke.
- 2026-01-02: Attachments module toolbar now exposes async upload/download/delete commands with SHA-256 deduplication, proxy-backed persistence to avoid double uploads, streaming downloads via AttachmentService, and status messaging that reflects duplicate skips/failures while dotnet restore/build remain blocked by the missing CLI.
- 2025-12-31: Attachments module now materializes ModuleRecord inspector fields directly from DatabaseService results (entity/table, linked record id, SHA-256, status) and mirrors the schema in design-time data; dotnet restore/build attempts still fail with `command not found` because the CLI remains unavailable in the container.
- 2025-10-02: Added the AuditDashboardDocument WPF view with toolbar/filter parity, busy overlay, and shell DataTemplate wiring while dotnet restore/build remain blocked by the missing CLI.
- 2025-12-05: Added WPF unit coverage exercising ValidationCrudServiceAdapter context propagation, updated the validation CRUD
  fake to retain signature/IP/session metadata, and asserted CrudSaveResult mirrors the persisted entity so regressions surface
  quickly while dotnet CLI access remains blocked.
- 2025-12-07: External Servicer CRUD fake now records saved snapshots alongside contexts, cleans up deleted entries, and confirms CrudSaveResult metadata still flows from the provided context; attempted dotnet restore/build/smoke remain blocked because the CLI is still missing in the container.
- 2025-12-08: Test signature dialog now tracks captured results/persist invocations, CRUD fakes accept configurable signature-id providers to mirror adapter-assigned identifiers, and module regression tests assert returned ids skip redundant persistence while the dotnet CLI remains unavailable.
- 2025-12-09: ElectronicSignatureDialogService now skips redundant digital signature inserts when an id already exists, captures the generated id on fresh inserts, and centralizes the SIGNATURE_PERSISTED audit hook in preparation for log-only flows; dotnet restore/build/smoke remain blocked until the CLI is installed.
- 2025-12-10: ElectronicSignatureDialogService exposes LogPersistedSignatureAsync so modules can emit SIGNATURE_PERSISTED audits for adapter-supplied signature ids without re-touching the database, and SignaturePersistenceHelper now invokes it when persistence is skipped; dotnet CLI remains unavailable so restore/build/smoke stay blocked.
- 2025-12-11: SignaturePersistenceHelper now awaits the log-only path and dedicated unit coverage asserts persisted signatures trigger audit logging without reinsertion while fresh signatures still persist; dotnet CLI access remains blocked for restore/build/test.
- 2025-12-12: TestElectronicSignatureDialogService now records log-only signature payloads without mutating identifiers, and SignaturePersistenceHelper tests assert the log path replays persisted metadata while dotnet CLI access remains blocked for restore/build/test.
- 2025-12-15: Audit trail WPF view now surfaces Export PDF/Excel toolbar buttons tied to the async commands, shows a busy overlay aligned with IsBusy, and keeps the status text/error styling wired so export failures bubble immediately; dotnet restore/build/smoke remain blocked without the CLI.
- 2025-12-16: Audit trail unit tests now stub ExportService to exercise PDF export success/failure flows, asserting busy flag lifecycles and status messaging while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2025-12-17: API audit module added to the WPF shell with masked inspector payloads, dynamic action filters, module registration, smoke coverage updates, and unit tests alongside a new AuditService.GetApiAuditEntriesAsync helper; dotnet restore/build/test still blocked because the CLI is unavailable in the container.
- 2025-12-18: Audit module tests now cover Excel export success/failure paths using the TestAuditModuleViewModel overrides to stub ExportService handlers; attempted dotnet restore continues to fail with `command not found` because the CLI is unavailable in the container.
- 2025-12-19: API audit module unit tests now assert reversed/null date filters normalize to swapped day bounds and end-of-day query ranges via TestApiAuditModuleViewModel captures; dotnet restore/build remain blocked because the CLI is unavailable in the container.
- 2025-12-20: Added WPF Audit Dashboard document that reuses the MAUI dashboard filters/exports, wired toolbar commands to the shared AsyncRelayCommand logic, and registered the module so compliance users can open the live feed; dotnet restore/build attempts still fail with "command not found" because the CLI is missing in the container.
- 2025-12-21: Introduced AuditLogDocumentViewModel to project the MAUI AuditLogViewModel into the WPF shell with synchronized records, inspector payloads, and export commands; module registry now opens the new document while dotnet CLI access remains blocked.
- 2025-12-22: WPF host now resolves AuditLogViewModel via a DI factory so the shared DatabaseService flows into the MAUI-backed audit adapter when the module opens; ModuleRegistry mapping continues to target the new document while dotnet CLI access remains blocked.
- 2025-12-26: Window menu now exposes dedicated commands for the Audit, Audit Dashboard, and API Audit modules so compliance users can launch the immutable trail, dashboard, and API activity panes directly; dotnet restore/build/smoke remain blocked without the CLI.
- 2025-12-23: Explicit DI wiring now constructs AuditLogDocumentViewModel through the host so AuditService/ExportService/DatabaseService-backed AuditLogViewModel and shell services are injected consistently; toolbar commands surface in the module, and dotnet restore/build attempts continue to fail with "command not found" because the CLI is unavailable.
- 2025-12-30: Added AuditLogDocumentViewModel unit coverage using the shared shell stubs plus a configurable MAUI AuditLogViewModel double to verify refresh/filter/export busy lifecycles, error fallback messaging, and status synchronization; dotnet restore/build/smoke remain blocked without the CLI.
- 2025-12-24: Added the WPF Audit Log document view with toolbar buttons, filter controls, busy overlay, and status messaging mirroring the dashboard patterns so compliance users can open the shell document; dotnet restore/build/smoke remain blocked because the CLI is unavailable in the container.
- 2025-12-25: WPF host now explicitly registers AuditDashboardViewModel so AuditDashboardDocumentViewModel resolves correctly through DI alongside ModuleRegistry/DataTemplate wiring; dotnet CLI remains unavailable for restore/build/smoke validation.
- 2025-12-26: ModuleRegistry retagged Audit Log, Audit Dashboard, and API Audit modules under "Quality & Compliance" to match the updated taxonomy; dotnet --info/restore/build retries continue to fail because the CLI is missing in the container.
- 2025-12-27: Documentation updated to highlight that Audit Log, Audit Dashboard, and API Audit modules now reside in the "Quality & Compliance" category so plan artifacts stay aligned with the ModuleRegistry regrouping; dotnet CLI access remains a prerequisite for restore/build/smoke.
- 2025-12-28: Home ribbon and backstage now surface Quality & Compliance buttons (Audit Trail, Audit Dashboard, API Audit) wired to the shared window commands; dotnet restore/build/run attempts remain blocked because the CLI is still unavailable in the container.
- 2025-12-29: Promoted shell stub services into shared TestDoubles and added AuditDashboardDocument unit coverage that exercises load/export success and failure flows while dotnet restore/build/smoke remain blocked by the missing CLI.
- 2025-12-29: Attachments module now rides on ModuleDocumentViewModel with DI-aligned services, design-time records, and attachment workflow guards while dotnet restore/build/smoke remain blocked until the CLI is installed.
- 2025-12-30: Attachments module now tracks attachment rows, staged uploads, and a selected attachment view-model while pushing attachment-specific inspector payloads; dotnet restore/build/smoke remain blocked without the CLI.
- 2025-12-14: Audit trail module now caches the latest query payload and formatted filters so export commands can reuse them, added async PDF/Excel exports with busy/error guards, and refreshed DI to supply ExportService; dotnet restore/build/smoke still blocked until the CLI is installed.
- 2025-12-13: Added a counting DatabaseService double plus module/service tests that simulate adapter-driven signature inserts, asserting a single InsertDigitalSignatureAsync call still yields SIGNATURE_PERSISTED auditing while dotnet CLI access remains unavailable.
- 2025-12-13: ElectronicSignatureDialogService WPF tests now assert insert skips fire when a signature id already exists, confirm audit logging for both persisted and log-only flows, and reiterate that dotnet restore/build remain blocked because the CLI is unavailable in the container.
- 2025-12-06: Security persistence now writes `digital_signature`/`last_change_signature` along with IP/device/session metadata via DatabaseService.Users extensions, and new UserCrudServiceAdapter tests assert the context and signatures persist end-to-end while the dotnet CLI gap continues to block restore/build.
- 2025-12-04: Validation persistence now writes `source_ip`/`session_id` on insert/update and ValidationService unit tests assert the metadata survives adapter calls; dotnet CLI still missing so restore/build/test remain blocked.
- 2025-12-01: Change Control schema/service now persist digital signature hash plus IP/session/device context so adapter metadata flows through unchanged; database scripts updated accordingly while CLI validation remains blocked.
- 2025-12-03: ValidationService now preserves adapter-provided digital signature hashes on create/update paths, only regenerating during forced transitions (e.g., Execute); unit coverage added to confirm the adapter hash survives persistence while dotnet CLI access remains blocked.
- 2025-12-02: ComponentService now accepts a ComponentSaveContext so WPF adapters can persist signature hash/IP/device/session without regeneration; machine_components INSERT/UPDATE now write digital_signature/source_ip/device/session columns and unit coverage asserts the stored hash matches the adapter payload while dotnet CLI validation remains blocked.
- 2025-12-01: dotnet restore/build and WPF smoke harness still blocked by missing dotnet CLI; rerun once host installs .NET 9/Windows SDK.
- 2025-11-30: Assets save flow now applies CrudSaveResult digital signature ids immediately after persistence and removes the stale OnRecordSelected signature block; build validation remains blocked pending dotnet CLI access.
- 2025-11-13: Completed signature metadata DTO propagation through Machine, Work Order, Calibration, Supplier, and Part services plus DatabaseService helpers; persistence now accepts optional metadata and falls back to the legacy hash generator when absent, while WPF adapters feed DTOs downstream.
- 2025-11-14: Database helpers for machines, work orders, calibrations, suppliers, and parts now persist digital_signature_id columns when present, tolerate legacy schemas, and upsert the digital_signatures table with hash/method/status/note metadata while propagating the resulting signature id back to DTOs and audit flows.
- 2025-11-15: Read-side queries for calibrations, work orders, and parts now prefer the digital_signature_id column with legacy fallbacks so editors and audit trails can reuse persisted signature references regardless of schema vintage.
- 2025-11-16: CAPA service/interface now accept optional `SignatureMetadataDto` arguments propagated from the WPF adapter; DatabaseService.Capa helpers persist the metadata into `digital_signatures` while preserving legacy overloads, and `dotnet restore/build` attempts still fail because the CLI is absent inside the container (`command not found`).
- 2025-11-17: System event logging now records digital signature ids/hashes alongside audit payloads with automatic fallbacks for legacy schemas; unit coverage verifies both the enriched insert and the legacy downgrade path.
- 2025-11-18: Test electronic signature dialog service now assigns incremental signature ids, clones persisted results, and records hash/method/status/note metadata for assertions while dotnet CLI access remains blocked.
- 2025-11-19: WPF test CRUD fakes now capture create/update snapshots with contexts to simplify module assertions; dotnet restore/build retries still fail because the CLI is absent in the container.
- 2025-11-20: WPF module regression tests now pin signature dialog ids, assert CRUD contexts surface signature hash/method/status/note metadata, and confirm persisted signature ids are returned from the enhanced dialog service while dotnet CLI access remains unavailable.
- 2025-11-28: Added a shared `CrudSaveResult` payload so adapters can return the persisted identifier together with captured signature metadata, keeping downstream editors and audit logging aligned once save operations complete.
- 2025-11-29: WPF CRUD interfaces, adapters, and module view-models now consume the new `CrudSaveResult` record end-to-end, storing returned identifiers, refreshing editor state, and surfacing signature metadata; WPF test doubles and regression tests assert the result payload.
- `scripts/bootstrap-dotnet9.ps1` added to guide host setup *(installs/verifies .NET 9, Windows SDK, runs restore/build, seeds smoke test fixture).* 
- `YasGMP.Wpf` already targets .NET 9 and references pinned packages; validate once builds are possible.
- `tests/fixtures/hello.txt` seeded for upcoming smoke harness scenarios.
- 2025-10-30: Introduced `AttachmentWorkflowService` in the WPF shell so module view-models share MAUI's dedup/encryption/retention workflow via `AttachmentService` + `DatabaseService.Attachments` helpers; registration and commands now rely on the adapter.
- 2025-11-01: Assets, Work Orders, Calibration, Suppliers, and Parts now block saves on successful electronic signature capture, persist the resulting digital signature hash, and surface cancellation/failure states through StatusMessage; unit tests gained a reusable signature dialog stub.
- 2025-11-02: Test project relocated the electronic signature dialog fake into `TestDoubles`, added queueable results/exception hooks, and updated module/unit factories to inject the dependency explicitly.
- 2025-11-03: Extended IElectronicSignatureDialogService integration across Components, Warehouses, Incidents, Validations, CAPA, Change Control, External Servicers, Scheduling, and Security modules with metadata propagation and refreshed unit coverage.
- 2025-11-04: Assets (machines) save flow now enriches the persisted machine with last-modified metadata after signature capture to keep downstream persistence aligned with Issue 3 requirements.
- 2025-11-05: Electronic signature dialog service now separates capture from persistence, allowing modules to update generated record ids, persist the business entity first, and retry signature storage with clear status messaging when failures occur.
- 2025-11-06: Assets editor now surfaces full e-sign metadata (hash, signer, reason, session/IP) via the new SignatureAwareEditor base and SignatureMetadataView control; save flow stamps the metadata before persistence while SDK access remains blocked.
- 2025-11-07: Added `B1FormDocumentViewModel` regression coverage to ensure cancellation status text, dirty tracking, and form mode remain intact when `OnSaveAsync` returns false; SDK/tooling still blocked by missing `dotnet` CLI.
- 2025-11-08: Introduced `TestElectronicSignatureDialogService` with queueable confirmations/cancellations/exceptions and updated module/unit factories to consume the new helper while keeping the legacy fake as an alias.
- 2025-11-09: Updated WPF module unit tests to inject `TestElectronicSignatureDialogService` in the new constructor slot after attachment workflow services; dotnet CLI still unavailable so test runs remain blocked.
- 2025-11-10: Added WPF module regression tests covering electronic signature cancellation/exception flows to ensure edit mode persists and adapters are not invoked when capture fails; dotnet CLI remains unavailable so restore/build/test steps are still blocked.
- 2025-11-21: Calibration module unit tests now queue cancellation/exception paths on the signature dialog to assert saves abort before persistence and no signature metadata is stored when capture fails.
- 2025-11-22: Suppliers module unit tests now cover electronic signature cancellation and capture exception flows to ensure form mode/status remain stable and no supplier/signature data persists when capture fails; dotnet CLI access is still pending for restore/build validation.
- 2025-11-23: Attachment workflow now injects AuditService to stamp upload metadata (actor/entity/dedup/reason/timestamp) and unit coverage verifies the audit hook fires for both new and deduplicated uploads; dotnet CLI remains unavailable so restore/build/test attempts still fail with `command not found`.
- 2025-11-24: ElectronicSignatureDialogService now resolves AuditService, logging capture and persistence events with reason metadata; WPF dialog service tests assert both audit emissions alongside digital signature persistence while the dotnet CLI gap persists.
- 2025-11-25: DataDrivenModuleDocumentViewModel now accepts an optional AuditService hook so every module can share audit helpers, and Work Orders save flow records CREATE/UPDATE audit events with signature/user/IP/device/session metadata after successful persistence; WPF module tests now inject AuditService accordingly while dotnet CLI access remains unavailable.
- 2025-11-26: Introduced a RecordingAuditService test double for the WPF harness so Work Orders unit tests assert CREATE saves stamp signer context and attachment uploads emit audit hooks; restore/build attempts remain blocked by the missing dotnet CLI.
- 2025-11-27: All module save flows now rehydrate adapter-updated signature ids/hashes/method/status metadata before invoking the dialog service, skipping redundant persistence when the signature already exists while keeping the existing success messaging unchanged.
- 2025-10-31: WPF shell now exposes an `IElectronicSignatureDialogService` that drives the signature dialog, captures password/PIN plus GMP reason text, and persists the note via the shared DatabaseService extensions before closing.
- Assets module now exposes an attachment command that uploads via `IAttachmentService`; coverage added in unit tests.
- Components module now completes the CRUD rollout with mode-aware editor, validation, machine lookups, and electronic signature capture ahead of persistence.
- Parts and Warehouse modules now expose CRUD-capable editors with attachment upload support, stock-health warnings, warehouse inventory previews, and enforced e-signature capture; audit surfacing remains tied to Batch B2 once SDK access is restored.
- 2025-09-29: WPF mapping updated to reflect the Components document and adapter usage; attachment/e-signature work still planned for Batch B2 once SDK access restored.
  - Work Orders module now drives CRUD through `IWorkOrderCrudService` with attachment uploads; e-signature/audit pane pending B2.
- Calibration module now reuses `CalibrationService` through a new adapter with mode-aware editor, supplier/component lookups, and attachment uploads via `IAttachmentService`; signature/audit follow-ups remain planned under Batch B2.
- Validations module now mirrors the MAUI experience with a CRUD-capable editor backed by `ValidationService`, machine/component lookups, CFL support, attachment uploads, and signature capture; audit surfacing targeted for Batch B2 once the SDK blocker clears.
- Scheduling module now ships with a CRUD-capable editor backed by the new `IScheduledJobCrudService`, attachment uploads, execute/acknowledge commands, and signature gating; audit prompts remain planned for Batch B2.
- 2025-10-06: Users/Roles (Security) module now reuses the shared user/RBAC services through a new adapter, exposing a mode-aware editor with CFL, role assignments, unit coverage, and e-signature enforcement; audit surfacing remains queued for Batch B2.
- 2025-10-07: Suppliers module now leverages ISupplierCrudService with a mode-aware editor, attachments via AttachmentService, CFL/golden-arrow integration, and unit coverage; External Servicers now share the same signature enforcement path.
- 2025-10-08: External Servicers module now mirrors MAUI CRUD with a dedicated adapter, WPF view, CFL picker, golden-arrow navigation, and unit/smoke coverage updates.
- 2025-10-09: External Servicer service now delegates CRUD to `DatabaseServiceExternalServicersExtensions`; regression tests assert create/update/delete hit `external_contractors`. Restore/build remain blocked until the .NET CLI is available in the container.
- 2025-10-10: Audit module now surfaces AuditService-backed filtering (user/entity/action/date) with richer inspector columns and WPF unit coverage; `dotnet --info` still reports `command not found` inside the container.
- 2025-10-11: B1 form base now exposes FormatLoadedStatus, letting the Audit module emit entry-specific status text without collection hooks; tests cover singular/plural/no-result messages.
- 2025-10-12: Audit module filters now normalize date ranges to inclusive day boundaries and backfill empty end dates so AuditService always receives valid bounds; unit tests cover the end-of-day behavior.
- 2025-10-13: WPF host now keeps a single AuditService singleton registration aligned with MAUI; attempted `dotnet restore`/`dotnet build` still fail because the CLI is unavailable in the container.
- 2025-10-15: Audit filters now clamp the start date to midnight, expand the end date to the day's final tick, and auto-swap reversed ranges; WPF coverage verifies date-only `FilterTo` inputs reach the end-of-day timestamp.
- 2025-10-16: B1 refresh path now pushes counts through `FormatLoadedStatus`, letting Audit override emit zero/singular/plural status text; tests assert the audit-specific messaging via `RefreshAsync`.
- 2025-10-17: Audit filters now treat null DatePicker inputs as optional bounds, default the end date to the selected start day, and extend it to the day's final tick; WPF unit coverage verifies `LastToFilter` captures the end-of-day timestamp for calendar-only inputs.
- 2025-10-18: Centralised the WPF host's `AuditService` registration through a guard helper so only the singleton remains; added DI coverage ensuring duplicate registrations are removed before building the provider.
- 2025-10-19: B1 refresh status now pulls from the applied record count so overrides reflect the actual dataset after filtering; audit module retains zero/singular/plural messaging via `FormatLoadedStatus`.
- 2025-10-20: Audit filters now centralize range normalization so date pickers can be left empty, clamp the start day to midnight, and expand the end day to its final tick; coverage asserts a date-only upper bound reaches the service as an end-of-day timestamp.
- 2025-10-21: Confirmed the WPF host retains a singleton AuditService registration and added DI coverage ensuring AuditModuleViewModel resolves after the cleanup.
- 2025-10-22: Hardened B1 status formatting to clamp negative counts and kept the Audit override routing zero-or-less results to the empty audit message; unit tests continue to assert the singular/plural/no-result wording via RefreshAsync.
- 2025-10-23: Audit filters now normalize nullable DatePicker inputs with unspecified kinds, persisting sanitized start/end dates in the view-model while expanding the service-bound end date to the day's final tick; `dotnet --info`/restore/build attempts still fail because the CLI remains unavailable in the container.
- 2025-10-24: WPF host now registers `AuditService` directly as a singleton (removing the stray transient), and DI coverage confirms `AuditModuleViewModel` resolves with the singleton; `dotnet restore`/`dotnet build` retries continue to fail with **command not found** until the SDK is installed.
- 2025-10-25: Audit module now surfaces HasResults/HasError flags, highlights offline/error status text in the view, and relabels the inspector reason column; `dotnet` CLI is still unavailable so restore/build attempts continue to fail.
- 2025-10-26: Audit filters now preserve the user-selected end date even when it predates the start picker, clamping the query's start bound to the chosen end day and covering the regression with WPF tests.
- 2025-10-27: Audit filters now clamp the lower bound when the upper bound is moved earlier while preserving the user's selected end day; WPF regression coverage verifies both persisted filters and query arguments.
- 2025-10-28: Audit filters now keep the user's "To" picker intact while ordering the query bounds when the upper date precedes the lower; WPF coverage adds a default-from regression asserting the service respects the earlier upper bound.
- 2025-10-29: Audit filters now order query bounds by min/max so inverted ranges still span the full window while preserving the user's "To" picker; WPF regression coverage asserts the service receives the later bound's end-of-day timestamp.
- 2025-11-11: CRUD context factories now expose signature id/hash/method/status/note members with an overload that accepts `ElectronicSignatureDialogResult`, letting module save flows hydrate audit metadata alongside user/IP/session defaults.
- 2025-11-12: Machine, Work Order, Calibration, Supplier, and Part adapters now hydrate captured signature hash/method/status/note onto their entities before persistence and include the metadata in supplier/part audit stamps while core services await extended signatures support.
- Next actionable slice once SDK access is restored: wire Assets attachments + signatures, then replicate CRUD pattern for Components.
- 2025-09-26: Assets editor now drives MachineService CRUD + validation with mode-aware UI; run smoke harness once SDK restored.
- 2025-09-27: Components module now surfaces a CRUD-capable editor using ComponentService with machine lookups; attachments/e-signature integration tracked under Batch B2.
- 2025-09-30: Incidents module now drives CRUD via `IIncidentCrudService`, exposes a full editor with toolbar modes, and supports attachment uploads; CAPA/Change Control modules remain queued.
- 2025-10-01: Incidents editor adds CFL linking for work orders/CAPA cases with tests covering the new mode transitions.
- 2025-10-02: CAPA module now runs through ICapaCrudService with mode-aware editor, component lookups, and attachment uploads; signature/audit follow-ups remain planned under Batch B2.
- 2025-10-03: Change Control module now reuses the new `IChangeControlCrudService` adapter with a mode-aware editor, CFL picker, and attachment workflow; e-signature/audit surfacing will arrive with Batch B2 once the SDK blocker lifts.
- 2025-11-13: Updated WPF mapping to document the attachments split view, inspector/editor behaviors, CRUD/signature flow, and retention enforcement now live in the shell; `dotnet restore`/`dotnet build` retries still fail because the CLI is absent in this container.
- 2026-01-22: Module dialogs and every module view grid/toolbar label now bind through ShellStrings resx keys with shared ToolTip/Automation metadata so UIA stays localized; dotnet restore/build/smoke remain blocked without the CLI.
